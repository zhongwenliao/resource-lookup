(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["sub-package/pages/dev-manage/bt-version-upgrade"],{324:function(e,n,r){"use strict";(function(e,n){var t=r(4);r(26),r(27);t(r(25));var o=t(r(325));e.__webpack_require_UNI_MP_PLUGIN__=r,n(o.default)}).call(this,r(1)["default"],r(2)["createPage"])},325:function(e,n,r){"use strict";r.r(n);var t=r(326),o=r(328);for(var i in o)["default"].indexOf(i)<0&&function(e){r.d(n,e,(function(){return o[e]}))}(i);r(330);var a,s=r(39),c=Object(s["default"])(o["default"],t["render"],t["staticRenderFns"],!1,null,null,null,!1,t["components"],a);c.options.__file="sub-package/pages/dev-manage/bt-version-upgrade.vue",n["default"]=c.exports},326:function(e,n,r){"use strict";r.r(n);var t=r(327);r.d(n,"render",(function(){return t["render"]})),r.d(n,"staticRenderFns",(function(){return t["staticRenderFns"]})),r.d(n,"recyclableRender",(function(){return t["recyclableRender"]})),r.d(n,"components",(function(){return t["components"]}))},327:function(e,n,r){"use strict";var t;r.r(n),r.d(n,"render",(function(){return o})),r.d(n,"staticRenderFns",(function(){return a})),r.d(n,"recyclableRender",(function(){return i})),r.d(n,"components",(function(){return t}));try{t={uniBasePage:function(){return r.e("components/uni-base-page/uni-base-page").then(r.bind(null,979))}}}catch(s){if(-1===s.message.indexOf("Cannot find module")||-1===s.message.indexOf(".vue"))throw s;console.error(s.message),console.error("1. 排查组件名称拼写是否正确"),console.error("2. 排查组件是否符合 easycom 规范，文档：https://uniapp.dcloud.net.cn/collocation/pages?id=easycom"),console.error("3. 若组件不符合 easycom 规范，需手动引入，并在 components 中注册该组件")}var o=function(){var e=this,n=e.$createElement,r=(e._self._c,e.firmwareList.length);e.$mp.data=Object.assign({},{$root:{g0:r}})},i=!1,a=[];o._withStripped=!0},328:function(e,n,r){"use strict";r.r(n);var t=r(329),o=r.n(t);for(var i in t)["default"].indexOf(i)<0&&function(e){r.d(n,e,(function(){return t[e]}))}(i);n["default"]=o.a},329:function(e,n,r){"use strict";(function(e){Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var r="",t=!0,o={data:function(){return{firmwareList:[],savedFilePath:"",upgardeProgress:0,firmwareVersion:"正在获取中...",printMsg:"",preUpgradeVersion:"",upgradeTitle:"",modelValue:"",source:null}},computed:{manage:function(){return this.$t("manage")},sdk1:function(){return this.$t("sdk")},common:function(){return this.$t("common")}},methods:{getDevSystemVersion:function(n){var r=this;this.$sdkUtil.getDeviceConfig(this.devObj,(function(t){if(0===t.errorCode){var o=t.data;if(n)n.preUpgradeVersion==o.systemVersion?e.showModal({title:r.common["hint"]||"提示",content:r.sdk1["firmware-upgrade-succeed"]||"设备蓝牙固件升级成功",confirmText:r.common["confirm"]||"确定",showCancel:!1,isShowLoading:!1,success:function(n){e.navigateBack({delta:2})}}):e.showModal({title:r.common["hint"]||"提示",content:r.sdk1["abnormal-reboot-device"]||"升级重启异常，请断电重启设备",confirmText:r.common["confirm"]||"确定",showCancel:!1,success:function(n){e.navigateBack({delta:2})}});else{r.firmwareVersion=o.systemVersion;r.devObj.devSn,r.firmwareVersion,o.devType;r.modelValue=o.devType,r.getFirmwareVersion(r.devObj.devSn,r.firmwareVersion,r.modelValue)}}}))},getFirmwareVersion:function(e,n,r){var t=this;this.$req.request({url:"/platDevFirmware/app/listByDevSn",data:{devSn:e,versionNum:n,isShowLoad:!1,modelValue:r,source:this.source},success:function(e){t.firmwareList=e.data}})},clickUpgrade:function(n,r,t){var o=this;this.preUpgradeVersion=r,e.showModal({content:this.manage["if-upgrade"]+"【"+r+"】"+this.manage["version"]+"?",success:function(e){e.confirm&&o.searchLocalFirmware(n,t)}})},downLoadFirmware:function(e,n){var t=this;this.$showLoading(this.manage["downloading"]||"正在下载...");var o=plus.downloader.createDownload(e,{},(function(e,o){if(200==o){console.log("Download success: "+e.filename),r=e.filename;var i=plus.io.convertLocalFileSystemURL(r);t.$hideLoading(),t.upgradeFirmWare(i,n)}else console.log("Download failed: "+o)}));o.start()},upgradeFirmWare:function(e,n){var r=this.$refs.poster;r.show(),this.upgrade(e,n)},upgrade:function(e,n){var r=this,o=1,i=this.$refs.poster;this.$sdkUtil.upgradeDevice(this.devObj,e,(function(a){var s=a.errorCode;if(3===s){if(a.msg){var c=a.msg;r.printMsg=c}}else if(2===s){var u=a.data.progress;r.upgardeProgress=u,100==u&&(i.hide(),r.upgardeProgress=0,r.uploadFirmwareVersion(n),r.firmwareVersion=r.preUpgradeVersion,t=!0,1===o&&(o++,setTimeout((function(){r.getDevSystemVersion({preUpgradeVersion:r.preUpgradeVersion})}),5e3)))}else-2===s&&r.upgardeProgress<99&&!0===t?(t=!1,r.upgradeTitle="正在尝试重新升级...",setTimeout((function(){r.upgrade(e,n)}),2e3)):i.hide()}))},searchLocalFirmware:function(n,r){var t=this;if(n.indexOf("/")>-1){var o="_downloads/"+n.substring(n.lastIndexOf("/")+1);e.getSavedFileInfo({filePath:o,success:function(e){o=plus.io.convertLocalFileSystemURL(o),t.upgradeFirmWare(o,r)},fail:function(e){console.log("没有找到文件---",e),t.downLoadFirmware(n,r)}})}else this.$showToast(this.manage["download-path-error"]||"下载路径解析格式错误")},uploadFirmwareVersion:function(e){this.$req.request({url:"/devDevice/app/upgradeDev",data:{devId:this.devObj.deviceId,firmwareId:e,isShowLoad:!1},success:function(e){0==e.code&&(console,log("上传蓝牙固见版本成功"))}})}},onLoad:function(e){t=!0,this.upgradeTitle=this.manage["upgrading"]||"正在升级中...",this.firmwareVersion=this.manage["getting"]||"正在获取中...",e.source&&(this.source=e.source),e.devObj&&(this.devObj=JSON.parse(e.devObj),this.getDevSystemVersion()),this.$setTitle(this.manage["upgrade-bluetooth-firmware"]||"升级蓝牙固件")}};n.default=o}).call(this,r(2)["default"])},330:function(e,n,r){"use strict";r.r(n);var t=r(331),o=r.n(t);for(var i in t)["default"].indexOf(i)<0&&function(e){r.d(n,e,(function(){return t[e]}))}(i);n["default"]=o.a},331:function(e,n,r){}},[[324,"common/runtime","common/vendor"]]]);
//# sourceMappingURL=../../../../.sourcemap/mp-weixin/sub-package/pages/dev-manage/bt-version-upgrade.js.map