(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["sub-package1/pages/vis/vis"],{362:function(t,e,i){"use strict";(function(t,e){var s=i(4);i(26),i(27);s(i(25));var n=s(i(363));t.__webpack_require_UNI_MP_PLUGIN__=i,e(n.default)}).call(this,i(1)["default"],i(2)["createPage"])},363:function(t,e,i){"use strict";i.r(e);var s=i(364),n=i(366);for(var a in n)["default"].indexOf(a)<0&&function(t){i.d(e,t,(function(){return n[t]}))}(a);i(368),i(370);var o,r=i(39),u=Object(r["default"])(n["default"],s["render"],s["staticRenderFns"],!1,null,null,null,!1,s["components"],o);u.options.__file="sub-package1/pages/vis/vis.vue",e["default"]=u.exports},364:function(t,e,i){"use strict";i.r(e);var s=i(365);i.d(e,"render",(function(){return s["render"]})),i.d(e,"staticRenderFns",(function(){return s["staticRenderFns"]})),i.d(e,"recyclableRender",(function(){return s["recyclableRender"]})),i.d(e,"components",(function(){return s["components"]}))},365:function(t,e,i){"use strict";var s;i.r(e),i.d(e,"render",(function(){return n})),i.d(e,"staticRenderFns",(function(){return o})),i.d(e,"recyclableRender",(function(){return a})),i.d(e,"components",(function(){return s}));try{s={uniBasePage:function(){return i.e("components/uni-base-page/uni-base-page").then(i.bind(null,967))},uNavbar:function(){return i.e("uview-ui/components/u-navbar/u-navbar").then(i.bind(null,974))},uIcon:function(){return i.e("uview-ui/components/u-icon/u-icon").then(i.bind(null,981))}}}catch(r){if(-1===r.message.indexOf("Cannot find module")||-1===r.message.indexOf(".vue"))throw r;console.error(r.message),console.error("1. 排查组件名称拼写是否正确"),console.error("2. 排查组件是否符合 easycom 规范，文档：https://uniapp.dcloud.net.cn/collocation/pages?id=easycom"),console.error("3. 若组件不符合 easycom 规范，需手动引入，并在 components 中注册该组件")}var n=function(){var t=this,e=t.$createElement,i=(t._self._c,t.visAuditList.length);t.$mp.data=Object.assign({},{$root:{g0:i}})},a=!1,o=[];n._withStripped=!0},366:function(t,e,i){"use strict";i.r(e);var s=i(367),n=i.n(s);for(var a in s)["default"].indexOf(a)<0&&function(t){i.d(e,t,(function(){return s[t]}))}(a);e["default"]=n.a},367:function(t,e,i){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;for(var i=new Date,s=[],n=[],a=[],o=[],r=[],u=i.getFullYear();u<=i.getFullYear()+20;u++)s.push(""+u);for(var d=1;d<=12;d++)d<10&&(d="0"+d),n.push(""+d);for(var h=1;h<=31;h++)h<10&&(h="0"+h),a.push(""+h);for(var c=0;c<24;c++)c<10&&(c="0"+c),o.push(""+c);for(var m=0;m<60;m++)m<10&&(m="0"+m),r.push(""+m);var l={components:{},data:function(){return{visIndex:0,authorizedName:"",multiArray:[s,n,a,o,r],multiIndex:[0,(new Date).getMonth(),(new Date).getDate()-1,(new Date).getHours(),(new Date).getMinutes()],startDate:"",endDate:"",startTime:"",endTime:"",chooseYear:"",data:{},show:!1,visitTimesArr:[],visitTimes:"",index:0,usableCount:1,buildingList:[],doorList:[],currentIndex:null,roomId:"",devSn:"",optionId:"",phone:"",memo:"",tempPwdUsageCountList:[],tempPwdUsageTimeList:[],validTimeIndex:0,validTimeList:[],restrictNumber:[],startstr3:0,endstr3:0,visAuth:!0,visAudit:!1,visAuditList:[]}},computed:{vis:function(){return this.$t("vis")},appointment:function(){return this.$t("appointment")},title:function(){return this.$t("title")},common:function(){return this.$t("common")}},onReady:function(){var e=this;console.log("ces1"),t.setNavigationBarTitle({title:this.title["vis"]}),this.validTimeList=[],this.restrictNumber=[],this.tempPwdUsageTimeList=[];var i=this.$getUserInfo().tempPwdUsageTimeList||["1","2","4","8","16","32",this.vis["unlimited"]||"无限"];i.map((function(t,i){e.validTimeList.push(t.value),e.tempPwdUsageTimeList.push(t)})),this.tempPwdUsageCountList=this.$getUserInfo().tempPwdUsageCountList||["1","2","4","8","16","32",this.vis["unlimited"]||"无限"],this.tempPwdUsageCountList.map((function(t){"0"!==t?e.visitTimesArr.push(t):e.visitTimesArr.push(e.validTimeList[0])}))},onLoad:function(t){console.log("ces1",t),this.visitTimes=this.vis["select-times"]||"请选择限制次数";var e=this;this.authorizedName=this.vis["select-authorize"]||"请选择授权楼栋/门禁",void 0===t.name?this.authorizedName=this.vis["select-address"]||"请选择房屋地址/门禁":t.roomId?(this.currentIndex=0,this.authorizedName=t.name,this.roomId=t.roomId):t.devSn&&(this.currentIndex=1,this.authorizedName=t.name,this.devSn=t.devSn);this.chooseYear=this.multiArray[0][0];var i=new Date,s=this.getSystemTime(i)[0];this.startDate=s,this.startstr3=this.timestamp(this.startDate);var n=new Date((new Date).getTime()+72e5),a=this.getSystemTime(n)[0];this.endDate=a,this.endstr3=this.timestamp(this.endDate),this.$onfire.on("EventAddressChange",(function(t){console.log(t),e.authorizedName=t.name,void 0!==t.roomId&&(console.log(t,"roomCode"),e.roomId=t.roomId,e.currentIndex=0),void 0!==t.devSn&&(console.log(t,"devSn"),e.devSn=t.devSn,e.currentIndex=1)}))},onShow:function(){console.log("ces1"),1,this.visAuditList=[]},onPullDownRefresh:function(){1,this.visAuditList=[],setTimeout((function(){t.stopPullDownRefresh()}),1e3)},onReachBottom:function(){0},onUnload:function(){this.$onfire.un("EventAddressChange")},methods:{tabSwitch:function(t){this.visIndex=t,0===this.visIndex?(this.visAuth=!0,this.visAudit=!1):1===this.visIndex&&(this.visAudit=!0,this.visAuth=!1,1,this.visAuditList=[])},getPhoneNum:function(t){this.phone=t.detail.value},getRelationship:function(t){this.memo=t.detail.value},timestamp:function(t){var e=t,i=Date.parse(new Date(e));return i/1e3},bindPickerChange:function(t){this.multiIndex=t.detail.value;var e=this.multiIndex,i=this.multiArray[0][e[0]],s=this.multiArray[1][e[1]],n=this.multiArray[2][e[2]],a=this.multiArray[3][e[3]],o=this.multiArray[4][e[4]];if(0==t.currentTarget.id)this.startDate=i+"-"+s+"-"+n+" "+a+":"+o,this.startTime="".concat(i).concat(s).concat(n).concat(a).concat(o,"00");else if(1==t.currentTarget.id){this.endDate=i+"-"+s+"-"+n+" "+a+":"+o,this.endTime="".concat(i).concat(s).concat(n).concat(a).concat(o,"00"),this.startstr3=this.timestamp(this.startDate),this.endstr3=this.timestamp(this.endDate);this.startDate,this.endDate;this.startTime>this.endTime?(this.$showToast(this.vis["end-time-toast"]||"结束时间不能小于开始时间"),this.startDate=this.getSystemTime(new Date)[0],this.endDate=this.getSystemTime(new Date((new Date).getTime()+72e5))[0],this.startTime="",this.endTime=""):1*this.tempPwdUsageTimeList[0].key!==0&&this.endstr3-this.startstr3>1*this.tempPwdUsageTimeList[0].key&&(this.$showToast(this.vis["exceed-time-toast"]||"超出最大可选时长"),this.startDate=this.getSystemTime(new Date)[0],this.endDate=this.getSystemTime(new Date((new Date).getTime()+72e5))[0],this.startTime="",this.endTime="")}},getSystemTime:function(t){var e=t.getFullYear(),i=t.getMonth()+1,s=t.getDate();i>=1&&i<=9&&(i="0"+i),s>=1&&s<=9&&(s="0"+s);var n=t.getHours();n>=0&&n<=9&&(n="0"+n);var a=t.getMinutes();a>=0&&a<=9&&(a="0"+a);var o=e+"-"+i+"-"+s+" "+n+":"+a,r=e+i+s+n+a+"00",u=[o,r];return u},bindColumnChange:function(t){if(0==t.detail.column){if(this.chooseYear=this.multiArray[t.detail.column][t.detail.value],1==t.detail.column){var e=parseInt(this.data.multiArray[t.detail.column][t.detail.value]),i=[];if(1==e||3==e||5==e||7==e||8==e||10==e||12==e){for(var s=1;s<=31;s++)s<10&&(s="0"+s),i.push(""+s);this.multiArray[2]=i}else if(4==e||6==e||9==e||11==e){for(var n=1;n<=30;n++)n<10&&(n="0"+n),i.push(""+n);this.multiArray[2]=i}else if(2==e){var a=parseInt(this.chooseYear);if(a%400!=0&&a%100==0||a%4!=0){for(var o=1;o<=28;o++)o<10&&(o="0"+o),i.push(""+o);this.multiArray[2]=i}else{for(var r=1;r<=29;r++)r<10&&(r="0"+r),i.push(""+r);this.multiArray[2]=i}}}var u={multiArray:this.multiArray,multiIndex:this.multiIndex};u.multiIndex[t.detail.column]=t.detail.value,this.data=u}},goToAddress:function(){t.navigateTo({url:"vis-address"})},visitTimeChange:function(t){var e=t.target.value;this.index=e,this.visitTimesArr[e]===this.vis["unlimited"]?this.usableCount=0:this.usableCount=parseInt(this.visitTimesArr[e])},pagechange:function(t){if("touch"===t.detail.source){var e=this.currentIndex;e=(e+1)%2,this.currentIndex=e}},titleClick:function(t){this.currentIndex=t.currentTarget.dataset.idx},createPwd:function(){var e=this;console.log(this.roomId),console.log(this.devSn);var i=this.startDate+":00",s=this.endDate+":00";if(""!==this.roomId||""!==this.devSn)if(this.$checkPhoneNumber(this.phone)||""===this.phone){if(this.startTime>this.endTime)return this.$showToast(this.vis["end-time-toast"]||"结束时间不能小于开始时间"),this.startDate=this.getSystemTime(new Date)[0],this.endDate=this.getSystemTime(new Date((new Date).getTime()+72e5))[0],this.startTime="",void(this.endTime="");var n={};this.usableCount||(this.usableCount=0),n=0==this.currentIndex?{roomIds:this.roomId,remark:this.memo,phone:this.phone,accStartDateTime:i,accEndDateTime:s,accessNum:this.usableCount}:{devSn:this.devSn,remark:this.memo,phone:this.phone,accStartDateTime:i,accEndDateTime:s,accessNum:this.usableCount},this.$api("equipment.getVisitorQrCode",n).then((function(i){if(console.log(i),200==i.code){var s=i.data.tempPwd,n=i.data.tempCode,a=i.data.tempPwd,o=encodeURIComponent(e.authorizedName);if(0==e.currentIndex)var r=e.vis["msg-content-one"]+e.authorizedName+e.vis["msg-content-two"]+s+e.vis["msg-content-three"]+e.endDate+e.vis["msg-content-four"];else{r="";r="管理员已为您申请 "+e.authorizedName+" 临时开门密码，密码是 "+s+", 请在有效时间 "+e.endDate+" 之前使用，切勿将密码泄露于他人。"}var u=encodeURIComponent(r),d={pwd:s,qrcode:n,shareUrl:a,content:u,room:o,startDate:e.startDate,endDate:e.endDate,memo:e.memo,phone:e.phone,authorizedName:e.authorizedName,usableCount:e.usableCount,visitTime:e.visitTimesArr[e.index]};console.log(d),t.navigateTo({url:"../vis-pwd/vis-pwd?index="+JSON.stringify(d)})}else e.$showToast(i.msg)}))}else this.$showToast(this.common["correct-phone"]||"请输入正确手机号");else t.showToast({title:this.vis["authorize-toast"]||"请选择楼栋/门禁",icon:"none"})},goToVisHistory:function(){t.navigateTo({url:"/sub-package/pages/vis/vis-history"})},goToAuditHistory:function(){t.navigateTo({url:"/sub-package1/pages/audit-history/audit-history"})},goToAudit:function(e,i){t.navigateTo({url:"/sub-package1/pages/appointment-audit/appointment-audit?auditId="+i+"&auditObj="+JSON.stringify(e)})}}};e.default=l}).call(this,i(2)["default"])},368:function(t,e,i){"use strict";i.r(e);var s=i(369),n=i.n(s);for(var a in s)["default"].indexOf(a)<0&&function(t){i.d(e,t,(function(){return s[t]}))}(a);e["default"]=n.a},369:function(t,e,i){},370:function(t,e,i){"use strict";i.r(e);var s=i(371),n=i.n(s);for(var a in s)["default"].indexOf(a)<0&&function(t){i.d(e,t,(function(){return s[t]}))}(a);e["default"]=n.a},371:function(t,e,i){}},[[362,"common/runtime","common/vendor"]]]);
//# sourceMappingURL=../../../../.sourcemap/mp-weixin/sub-package1/pages/vis/vis.js.map