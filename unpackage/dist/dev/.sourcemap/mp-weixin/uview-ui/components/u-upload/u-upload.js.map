{"version":3,"sources":["webpack:///D:/Project/resource-lookup/uview-ui/components/u-upload/u-upload.vue?a93d","webpack:///D:/Project/resource-lookup/uview-ui/components/u-upload/u-upload.vue?5c48","webpack:///D:/Project/resource-lookup/uview-ui/components/u-upload/u-upload.vue?0e20","webpack:///D:/Project/resource-lookup/uview-ui/components/u-upload/u-upload.vue?9468","uni-app:///uview-ui/components/u-upload/u-upload.vue","webpack:///D:/Project/resource-lookup/uview-ui/components/u-upload/u-upload.vue?d7bb"],"names":["renderjs","component","options","__file","components","uIcon","uLineProgress","e","message","indexOf","console","error","render","_vm","this","_h","$createElement","l0","_self","_c","disabled","__map","lists","item","index","$orig","__get_orig","g0","showUploadList","$u","addUnit","width","g1","height","g2","length","g3","maxCount","customBtn","g4","$mp","data","Object","assign","$root","$scope","scopedSlotsCompiler","$setScopedSlotsParams","file","recyclableRender","staticRenderFns","_withStripped","name","props","type","default","action","showProgress","imageMode","header","Authorization","formData","sizeType","sourceType","previewFullImage","multiple","deletable","maxSize","fileList","uploadText","autoUpload","showTips","delBgColor","delColor","delIcon","toJson","beforeUpload","beforeRemove","limitType","mounted","isInCount","uploading","watch","immediate","handler","val","url","progress","methods","clear","reUpload","selectFile","camera","compressed","maxDuration","chooseFile","uni","count","success","fail","then","res","catch","showToast","title","icon","upload","retry","doRequest","duration","mask","getNewToken","refreshToken","method","client_id","client_secret","grant_type","refresh_token","uploadFile","beforeResponse","task","filePath","complete","uploadError","deleteItem","content","handlerDeleteItem","remove","doPreviewImage","urls","current","checkFileExt","fileExt","noArrowExt"],"mappings":"uIAAA,uIACIA,EADJ,QASIC,EAAY,qBACd,aACA,YACA,sBACA,EACA,KACA,WACA,MACA,EACA,gBACAD,GAGFC,EAAUC,QAAQC,OAAS,4CACZ,aAAAF,E,2CCvBf,wQ,kCCAA,IAAIG,EAAJ,0LACA,IACEA,EAAa,CACXC,MAAO,WACL,OAAO,iEAITC,cAAe,WACb,OAAO,qFAKX,MAAOC,GACP,IAC+C,IAA7CA,EAAEC,QAAQC,QAAQ,wBACa,IAA/BF,EAAEC,QAAQC,QAAQ,QAWlB,MAAMF,EATNG,QAAQC,MAAMJ,EAAEC,SAChBE,QAAQC,MAAM,mBACdD,QAAQC,MACN,uFAEFD,QAAQC,MACN,mDAMN,IAAIC,EAAS,WACX,IAAIC,EAAMC,KACNC,EAAKF,EAAIG,eAETC,GADKJ,EAAIK,MAAMC,GACTN,EAAIO,SAWV,KAVAP,EAAIQ,MAAMR,EAAIS,OAAO,SAAUC,EAAMC,GACnC,IAAIC,EAAQZ,EAAIa,WAAWH,GACvBI,EAAKd,EAAIe,eAAiBf,EAAIgB,GAAGC,QAAQjB,EAAIkB,OAAS,KACtDC,EAAKnB,EAAIe,eAAiBf,EAAIgB,GAAGC,QAAQjB,EAAIoB,QAAU,KAC3D,MAAO,CACLR,MAAOA,EACPE,GAAIA,EACJK,GAAIA,OAIRE,EAAMrB,EAAIO,SAA8B,KAAnBP,EAAIS,MAAMa,OAC/BC,GACDvB,EAAIO,UAAYP,EAAIwB,SAAWH,IAAOrB,EAAIyB,UACvCzB,EAAIgB,GAAGC,QAAQjB,EAAIkB,OACnB,KACFQ,GACD1B,EAAIO,UAAYP,EAAIwB,SAAWH,IAAOrB,EAAIyB,UACvCzB,EAAIgB,GAAGC,QAAQjB,EAAIoB,QACnB,KACNpB,EAAI2B,IAAIC,KAAOC,OAAOC,OACpB,GACA,CACEC,MAAO,CACL3B,GAAIA,EACJiB,GAAIA,EACJE,GAAIA,EACJG,GAAIA,KAIkC,cAAxC1B,EAAIgC,OAAOJ,KAAKK,qBAClBjC,EAAIkC,sBAAsB,OAAQ,CAChCC,KAAMnC,EAAIS,SAIZ2B,GAAmB,EACnBC,EAAkB,GACtBtC,EAAOuC,eAAgB,G,kCC3EvB,0HAA6pB,eAAG,G,sJCmChqB,QAIA,EAuCA,CACAC,gBACAC,OAEAzB,gBACA0B,aACAC,YAGAC,QACAF,YACAC,0BAGAlB,UACAiB,qBACAC,YAGAE,cACAH,aACAC,YAGAnC,UACAkC,aACAC,YAGAG,WACAJ,YACAC,sBAGAI,QACAL,YACAC,mBACA,OACAK,kGAKAC,UACAP,YACAC,mBACA,WAIAH,MACAE,YACAC,gBAGAO,UACAR,WACAC,mBACA,kCAGAQ,YACAT,WACAC,mBACA,2BAIAS,kBACAV,aACAC,YAGAU,UACAX,aACAC,YAGAW,WACAZ,aACAC,YAGAY,SACAb,qBACAC,0BAGAa,UACAd,WACAC,mBACA,WAIAc,YACAf,YACAC,gBAGAe,YACAhB,aACAC,YAGAgB,UACAjB,aACAC,YAGAjB,WACAgB,aACAC,YAGAxB,OACAuB,qBACAC,aAGAtB,QACAqB,qBACAC,aAGAiB,YACAlB,YACAC,mBAGAkB,UACAnB,YACAC,mBAGAmB,SACApB,YACAC,8BAGAoB,QACArB,aACAC,YAGAqB,cACAtB,cACAC,cAGAsB,cACAvB,cACAC,cAGAuB,WACAxB,WACAC,mBAGA,kDAKA/B,OACA8B,qBACAC,aAGAwB,qBACAtC,gBACA,OACAnB,SACA0D,aACAC,eAGAC,OACArB,qBACAnD,eACA,iBAEA0D,UACAe,aACAC,oBAAA,WACA1E,eACA2E,mBAIA,mBACA,gCACA,kCAGA,iBACAC,eACA3E,SACA4E,aACA9C,eAQAnB,kBACA,4CAGAkE,SAEAC,iBACA,eAGAC,oBACA,mBAGAC,sBAAA,WACA,mBAGA,KADAvC,KADA,IACAf,EACA,KADAA,SAAA4B,EACA,KADAA,SAAAE,EACA,KADAA,QAAAL,EACA,KADAA,SAAAxC,EACA,KADAA,MAAAyC,GACA,KADA6B,OACA,KADAC,WACA,KADAC,YACA,KADA/B,YAEA,OACA,aAEAgC,6BACAC,eACAC,kBACAlC,aACAD,WACAoC,UACAC,YAGAJ,EACAK,kBAEA,eACAC,+BAEA,qBAGA,UACA3F,oBACAA,uBAgFA4F,mBACA,iCAIAC,sBAAA,+DACA,mBACAP,aACAQ,QACAC,eAKAC,kBACA,mBAGAC,kBACA,yBACA,uBACA,4BACAX,eACAQ,eAEA,oBAEAI,qBAAA,mKAEA,0BAAAnE,SACAA,qBAAA,gBAGA,OAFAuD,qDACAA,yDACA,kEACA,uBAAAK,OAAA,6BAEA,gFAIAL,aACAQ,sBACAC,YACAI,aACAC,UACA,yDAlBA,IAqBAC,uBAAA,+HACA,OAAAC,mCAAA,SACAhB,WACAiB,cACAtD,QACA,oDAEAlB,MACAyE,eACAC,uBACAC,2BACAC,iBAEA/B,oCACA,kFAdA,IAiBAgC,sBAAA,6JAAA9F,oCACA,gEACA,kEAEAA,oBAAA,eACA,2EAIA,0CACA,yEAIA,oEASA,GAFA+F,wDACAnD,WAEA,gEACAmD,wBAEA,mBAEA,4BACA,oCACAA,OAAA,yCAEA,8BAMA,0BACA,4DAGA,oBACA,eAEAvB,eACAc,UAEAU,gBAEAlC,uBACAmC,wBACArE,YACAS,oBACAF,gBACAuC,oBACAF,gBACAtF,eAEA,gDACA+B,aACA,qCAIA,aACA,sBACA,oBACA,yBACA,eACA,YACA,oBAEA,sBACA,wBACA,oBACA,2CAdA,oBAmBA0D,iBACA,oBAEAuB,qBACA1B,gBACA,eACA,kBACA,4CAGAwB,gCACA,cAEA,8CAEA,2CAjGA,IAoGAG,0BACA,yBACA,uBACA,4BACA,iDACA,4BAGAC,uBAAA,WACA5B,aACAQ,WACAqB,qBACA3B,mBAAA,oIACAG,WAAA,oBAGA,oEAIA,GAFAkB,8CACA,UAEA,8DACAA,oBAEA,0BACA,mBAEA,wBACA,8BACA,MAEA,qBAGA,uBACA,+BAGA,mEAGA,sDA7BArB,MAiCA4B,8BAEA,oDACA,+EAEA,uBACA,oBACA,8DACA,wBAGAC,mBAEA,4BACA,uBACA,qDAIAC,6BAAA,WACA,0BACA,0DACAhC,gBACAiC,OACAC,UACAhC,mBACA,yCAEAC,gBACAH,aACAQ,eACAC,mBAMA0B,yBAEA,SAEA,KACA,SAeA,OARAC,qCAGAC,mCAEA,8BAEA,6CACA,KAGA,c,8DCtqBA,0HAAgwC,eAAG,G","file":"uview-ui/components/u-upload/u-upload.js","sourcesContent":["import { render, staticRenderFns, recyclableRender, components } from \"./u-upload.vue?vue&type=template&id=0d33af60&scoped=true&\"\nvar renderjs\nimport script from \"./u-upload.vue?vue&type=script&lang=js&\"\nexport * from \"./u-upload.vue?vue&type=script&lang=js&\"\nimport style0 from \"./u-upload.vue?vue&type=style&index=0&id=0d33af60&lang=scss&scoped=true&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../../../常用软件/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"0d33af60\",\n  null,\n  false,\n  components,\n  renderjs\n)\n\ncomponent.options.__file = \"uview-ui/components/u-upload/u-upload.vue\"\nexport default component.exports","export * from \"-!../../../../../常用软件/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/templateLoader.js??vue-loader-options!../../../../../常用软件/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--17-0!../../../../../常用软件/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/template.js!../../../../../常用软件/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-uni-app-loader/page-meta.js!../../../../../常用软件/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../常用软件/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./u-upload.vue?vue&type=template&id=0d33af60&scoped=true&\"","var components\ntry {\n  components = {\n    uIcon: function () {\n      return import(\n        /* webpackChunkName: \"uview-ui/components/u-icon/u-icon\" */ \"@/uview-ui/components/u-icon/u-icon.vue\"\n      )\n    },\n    uLineProgress: function () {\n      return import(\n        /* webpackChunkName: \"uview-ui/components/u-line-progress/u-line-progress\" */ \"@/uview-ui/components/u-line-progress/u-line-progress.vue\"\n      )\n    },\n  }\n} catch (e) {\n  if (\n    e.message.indexOf(\"Cannot find module\") !== -1 &&\n    e.message.indexOf(\".vue\") !== -1\n  ) {\n    console.error(e.message)\n    console.error(\"1. 排查组件名称拼写是否正确\")\n    console.error(\n      \"2. 排查组件是否符合 easycom 规范，文档：https://uniapp.dcloud.net.cn/collocation/pages?id=easycom\"\n    )\n    console.error(\n      \"3. 若组件不符合 easycom 规范，需手动引入，并在 components 中注册该组件\"\n    )\n  } else {\n    throw e\n  }\n}\nvar render = function () {\n  var _vm = this\n  var _h = _vm.$createElement\n  var _c = _vm._self._c || _h\n  var l0 = !_vm.disabled\n    ? _vm.__map(_vm.lists, function (item, index) {\n        var $orig = _vm.__get_orig(item)\n        var g0 = _vm.showUploadList ? _vm.$u.addUnit(_vm.width) : null\n        var g1 = _vm.showUploadList ? _vm.$u.addUnit(_vm.height) : null\n        return {\n          $orig: $orig,\n          g0: g0,\n          g1: g1,\n        }\n      })\n    : null\n  var g2 = !_vm.disabled ? _vm.lists.length : null\n  var g3 =\n    !_vm.disabled && _vm.maxCount > g2 && !_vm.customBtn\n      ? _vm.$u.addUnit(_vm.width)\n      : null\n  var g4 =\n    !_vm.disabled && _vm.maxCount > g2 && !_vm.customBtn\n      ? _vm.$u.addUnit(_vm.height)\n      : null\n  _vm.$mp.data = Object.assign(\n    {},\n    {\n      $root: {\n        l0: l0,\n        g2: g2,\n        g3: g3,\n        g4: g4,\n      },\n    }\n  )\n  if (_vm.$scope.data.scopedSlotsCompiler === \"augmented\") {\n    _vm.$setScopedSlotsParams(\"file\", {\n      file: _vm.lists,\n    })\n  }\n}\nvar recyclableRender = false\nvar staticRenderFns = []\nrender._withStripped = true\n\nexport { render, staticRenderFns, recyclableRender, components }","import mod from \"-!../../../../../常用软件/HBuilderX/plugins/uniapp-cli/node_modules/babel-loader/lib/index.js!../../../../../常用软件/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--13-1!../../../../../常用软件/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/script.js!../../../../../常用软件/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../常用软件/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./u-upload.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../../../常用软件/HBuilderX/plugins/uniapp-cli/node_modules/babel-loader/lib/index.js!../../../../../常用软件/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--13-1!../../../../../常用软件/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/script.js!../../../../../常用软件/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../常用软件/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./u-upload.vue?vue&type=script&lang=js&\"","<template>\r\n\t<view class=\"u-upload\" v-if=\"!disabled\">\r\n\t\t<view v-if=\"showUploadList\" class=\"u-list-item u-preview-wrap\" v-for=\"(item, index) in lists\" :key=\"index\"\r\n\t\t\t:style=\"{\r\n\t\t\t\twidth: $u.addUnit(width),\r\n\t\t\t\theight: $u.addUnit(height)\r\n\t\t\t}\">\r\n\t\t\t<view v-if=\"deletable\" class=\"u-delete-icon\" @tap.stop=\"deleteItem(index)\">\r\n\t\t\t\t<u-icon class=\"u-icon\" :name=\"delIcon\" size=\"30\" :color=\"delColor\"></u-icon>\r\n\t\t\t</view>\r\n\t\t\t<u-line-progress v-if=\"showProgress && item.progress > 0 && !item.error\" :show-percent=\"false\" height=\"16\"\r\n\t\t\t\tclass=\"u-progress\" :percent=\"item.progress\"></u-line-progress>\r\n\t\t\t<view @tap.stop=\"retry(index)\" v-if=\"item.error\" class=\"u-error-btn\">点击重试</view>\r\n\t\t\t<image @tap.stop=\"doPreviewImage(item.url || item.path, index)\" class=\"u-preview-image\" v-if=\"!item.isImage\"\r\n\t\t\t\t:src=\"item.url || item.path\" :mode=\"imageMode\"></image>\r\n\t\t</view>\r\n\t\t<slot name=\"file\" :file=\"lists\"></slot>\r\n\t\t<view style=\"display: inline-block;\" @tap=\"selectFile\" v-if=\"maxCount > lists.length\">\r\n\t\t\t<view class=\"addBtn\">\r\n\t\t\t\t<slot name=\"addBtn\"></slot>\r\n\t\t\t</view>\r\n\r\n\t\t\t<view v-if=\"!customBtn\" class=\"u-list-item u-add-wrap\" hover-class=\"u-add-wrap__hover\" hover-stay-time=\"150\"\r\n\t\t\t\t:style=\"{\r\n\t\t\t\t\twidth: $u.addUnit(width),\r\n\t\t\t\t\theight: $u.addUnit(height)\r\n\t\t\t\t}\">\r\n\t\t\t\t<u-icon name=\"plus\" class=\"u-add-btn\" size=\"40\"></u-icon>\r\n\t\t\t\t<view class=\"u-add-tips\">{{ uploadText }}</view>\r\n\t\t\t</view>\r\n\t\t</view>\r\n\t</view>\r\n</template>\r\n\r\n<script>\r\n\timport {\r\n\t\tIMG_URL,\r\n\t\tAPI_URL\r\n\t} from '@/env'\r\n\t/**\r\n\t * upload 图片上传\r\n\t * @description 该组件用于上传图片场景\r\n\t * @tutorial https://www.uviewui.com/components/upload.html\r\n\t * @property {String} action 服务器上传地址\r\n\t * @property {String Number} max-count 最大选择图片的数量（默认99）\r\n\t * @property {Boolean} custom-btn 如果需要自定义选择图片的按钮，设置为true（默认false）\r\n\t * @property {Boolean} show-progress 是否显示进度条（默认true）\r\n\t * @property {Boolean} disabled 是否启用(显示/移仓)组件（默认false）\r\n\t * @property {String} image-mode 预览图片等显示模式，可选值为uni的image的mode属性值（默认aspectFill）\r\n\t * @property {String} del-icon 右上角删除图标名称，只能为uView内置图标\r\n\t * @property {String} del-bg-color 右上角关闭按钮的背景颜色\r\n\t * @property {String | Number} index 在各个回调事件中的最后一个参数返回，用于区别是哪一个组件的事件\r\n\t * @property {String} del-color 右上角关闭按钮图标的颜色\r\n\t * @property {Object} header 上传携带的头信息，对象形式\r\n\t * @property {Object} form-data 上传额外携带的参数\r\n\t * @property {String} name 上传文件的字段名，供后端获取使用（默认file）\r\n\t * @property {Array<String>} size-type original 原图，compressed 压缩图，默认二者都有（默认['original', 'compressed']）\r\n\t * @property {Array<String>} source-type 选择图片的来源，album-从相册选图，camera-使用相机，默认二者都有（默认['album', 'camera']）\r\n\t * @property {Boolean} preview-full-image\t是否可以通过uni.previewImage预览已选择的图片（默认true）\r\n\t * @property {Boolean} multiple\t是否开启图片多选，部分安卓机型不支持（默认true）\r\n\t * @property {Boolean} deletable 是否显示删除图片的按钮（默认true）\r\n\t * @property {String Number} max-size 选择单个文件的最大大小，单位B(byte)，默认不限制（默认Number.MAX_VALUE）\r\n\t * @property {Array<Object>} file-list 默认显示的图片列表，数组元素为对象，必须提供url属性\r\n\t * @property {Boolean} upload-text 选择图片按钮的提示文字（默认“选择图片”）\r\n\t * @property {Boolean} auto-upload 选择完图片是否自动上传，见上方说明（默认true）\r\n\t * @property {Boolean} show-tips 特殊情况下是否自动提示toast，见上方说明（默认true）\r\n\t * @property {Boolean} show-upload-list 是否显示组件内部的图片预览（默认true）\r\n\t * @event {Function} on-oversize 图片大小超出最大允许大小\r\n\t * @event {Function} on-preview 全屏预览图片时触发\r\n\t * @event {Function} on-remove 移除图片时触发\r\n\t * @event {Function} on-success 图片上传成功时触发\r\n\t * @event {Function} on-change 图片上传后，无论成功或者失败都会触发\r\n\t * @event {Function} on-error 图片上传失败时触发\r\n\t * @event {Function} on-progress 图片上传过程中的进度变化过程触发\r\n\t * @event {Function} on-uploaded 所有图片上传完毕触发\r\n\t * @event {Function} on-choose-complete 每次选择图片后触发，只是让外部可以得知每次选择后，内部的文件列表\r\n\t * @example <u-upload :action=\"action\" :file-list=\"fileList\" ></u-upload>\r\n\t */\r\n\texport default {\r\n\t\tname: 'u-upload',\r\n\t\tprops: {\r\n\t\t\t//是否显示组件自带的图片预览功能\r\n\t\t\tshowUploadList: {\r\n\t\t\t\ttype: Boolean,\r\n\t\t\t\tdefault: true\r\n\t\t\t},\r\n\t\t\t// 后端地址\r\n\t\t\taction: {\r\n\t\t\t\ttype: String,\r\n\t\t\t\tdefault: '/image/web/add'\r\n\t\t\t},\r\n\t\t\t// 最大上传数量\r\n\t\t\tmaxCount: {\r\n\t\t\t\ttype: [String, Number],\r\n\t\t\t\tdefault: 52\r\n\t\t\t},\r\n\t\t\t//  是否显示进度条\r\n\t\t\tshowProgress: {\r\n\t\t\t\ttype: Boolean,\r\n\t\t\t\tdefault: false\r\n\t\t\t},\r\n\t\t\t// 是否启用\r\n\t\t\tdisabled: {\r\n\t\t\t\ttype: Boolean,\r\n\t\t\t\tdefault: false\r\n\t\t\t},\r\n\t\t\t// 预览上传的图片时的裁剪模式，和image组件mode属性一致\r\n\t\t\timageMode: {\r\n\t\t\t\ttype: String,\r\n\t\t\t\tdefault: 'aspectFill'\r\n\t\t\t},\r\n\t\t\t// 头部信息\r\n\t\t\theader: {\r\n\t\t\t\ttype: Object,\r\n\t\t\t\tdefault () {\r\n\t\t\t\t\treturn {\r\n\t\t\t\t\t\tAuthorization: `Bearer ${uni.getStorageSync('tokenInfo') ? uni.getStorageSync('tokenInfo') : ''}`\r\n\t\t\t\t\t};\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\t// 额外携带的参数\r\n\t\t\tformData: {\r\n\t\t\t\ttype: Object,\r\n\t\t\t\tdefault () {\r\n\t\t\t\t\treturn {};\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\t// 上传的文件字段名\r\n\t\t\tname: {\r\n\t\t\t\ttype: String,\r\n\t\t\t\tdefault: 'file'\r\n\t\t\t},\r\n\t\t\t// 所选的图片的尺寸, 可选值为original compressed\r\n\t\t\tsizeType: {\r\n\t\t\t\ttype: Array,\r\n\t\t\t\tdefault () {\r\n\t\t\t\t\treturn ['original', 'compressed'];\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tsourceType: {\r\n\t\t\t\ttype: Array,\r\n\t\t\t\tdefault () {\r\n\t\t\t\t\treturn ['album', 'camera'];\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\t// 是否在点击预览图后展示全屏图片预览\r\n\t\t\tpreviewFullImage: {\r\n\t\t\t\ttype: Boolean,\r\n\t\t\t\tdefault: true\r\n\t\t\t},\r\n\t\t\t// 是否开启图片多选，部分安卓机型不支持\r\n\t\t\tmultiple: {\r\n\t\t\t\ttype: Boolean,\r\n\t\t\t\tdefault: true\r\n\t\t\t},\r\n\t\t\t// 是否展示删除按钮\r\n\t\t\tdeletable: {\r\n\t\t\t\ttype: Boolean,\r\n\t\t\t\tdefault: true\r\n\t\t\t},\r\n\t\t\t// 文件大小限制，单位为byte\r\n\t\t\tmaxSize: {\r\n\t\t\t\ttype: [String, Number],\r\n\t\t\t\tdefault: Number.MAX_VALUE\r\n\t\t\t},\r\n\t\t\t// 显示已上传的文件列表\r\n\t\t\tfileList: {\r\n\t\t\t\ttype: Array,\r\n\t\t\t\tdefault () {\r\n\t\t\t\t\treturn [];\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\t// 上传区域的提示文字\r\n\t\t\tuploadText: {\r\n\t\t\t\ttype: String,\r\n\t\t\t\tdefault: '选择图片'\r\n\t\t\t},\r\n\t\t\t// 是否自动上传\r\n\t\t\tautoUpload: {\r\n\t\t\t\ttype: Boolean,\r\n\t\t\t\tdefault: true\r\n\t\t\t},\r\n\t\t\t// 是否显示toast消息提示\r\n\t\t\tshowTips: {\r\n\t\t\t\ttype: Boolean,\r\n\t\t\t\tdefault: true\r\n\t\t\t},\r\n\t\t\t// 是否通过slot自定义传入选择图标的按钮\r\n\t\t\tcustomBtn: {\r\n\t\t\t\ttype: Boolean,\r\n\t\t\t\tdefault: false\r\n\t\t\t},\r\n\t\t\t// 内部预览图片区域和选择图片按钮的区域宽度\r\n\t\t\twidth: {\r\n\t\t\t\ttype: [String, Number],\r\n\t\t\t\tdefault: 200\r\n\t\t\t},\r\n\t\t\t// 内部预览图片区域和选择图片按钮的区域高度\r\n\t\t\theight: {\r\n\t\t\t\ttype: [String, Number],\r\n\t\t\t\tdefault: 200\r\n\t\t\t},\r\n\t\t\t// 右上角关闭按钮的背景颜色\r\n\t\t\tdelBgColor: {\r\n\t\t\t\ttype: String,\r\n\t\t\t\tdefault: '#ffffff'\r\n\t\t\t},\r\n\t\t\t// 右上角关闭按钮的叉号图标的颜色\r\n\t\t\tdelColor: {\r\n\t\t\t\ttype: String,\r\n\t\t\t\tdefault: '#666666'\r\n\t\t\t},\r\n\t\t\t// 右上角删除图标名称，只能为uView内置图标\r\n\t\t\tdelIcon: {\r\n\t\t\t\ttype: String,\r\n\t\t\t\tdefault: '/static/quxiao.png' //close\r\n\t\t\t},\r\n\t\t\t// 如果上传后的返回值为json字符串，是否自动转json\r\n\t\t\ttoJson: {\r\n\t\t\t\ttype: Boolean,\r\n\t\t\t\tdefault: true\r\n\t\t\t},\r\n\t\t\t// 上传前的钩子，每个文件上传前都会执行\r\n\t\t\tbeforeUpload: {\r\n\t\t\t\ttype: Function,\r\n\t\t\t\tdefault: null\r\n\t\t\t},\r\n\t\t\t// 移除文件前的钩子\r\n\t\t\tbeforeRemove: {\r\n\t\t\t\ttype: Function,\r\n\t\t\t\tdefault: null\r\n\t\t\t},\r\n\t\t\t// 允许上传的图片后缀\r\n\t\t\tlimitType: {\r\n\t\t\t\ttype: Array,\r\n\t\t\t\tdefault () {\r\n\t\t\t\t\t// 支付宝小程序真机选择图片的后缀为\"image\"\r\n\t\t\t\t\t// https://opendocs.alipay.com/mini/api/media-image\r\n\t\t\t\t\treturn ['png', 'jpg', 'jpeg', 'webp', 'gif', 'image'];\r\n\t\t\t\t\treturn ['png', 'jpg', 'jpeg', 'gif', 'image'];\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\t// 在各个回调事件中的最后一个参数返回，用于区别是哪一个组件的事件\r\n\t\t\tindex: {\r\n\t\t\t\ttype: [Number, String],\r\n\t\t\t\tdefault: ''\r\n\t\t\t}\r\n\t\t},\r\n\t\tmounted() {},\r\n\t\tdata() {\r\n\t\t\treturn {\r\n\t\t\t\tlists: [],\r\n\t\t\t\tisInCount: true,\r\n\t\t\t\tuploading: false\r\n\t\t\t};\r\n\t\t},\r\n\t\twatch: {\r\n\t\t\tformData: function(val) {\r\n\t\t\t\tconsole.log(val);\r\n\t\t\t\tthis.formData = val;\r\n\t\t\t},\r\n\t\t\tfileList: {\r\n\t\t\t\timmediate: true,\r\n\t\t\t\thandler(val) {\r\n\t\t\t\t\tconsole.log(val);\r\n\t\t\t\t\tval.map(value => {\r\n\t\t\t\t\t\t// 首先检查内部是否已经添加过这张图片，因为外部绑定了一个对象给fileList的话(对象引用)，进行修改外部fileList\r\n\t\t\t\t\t\t// 时，会触发watch，导致重新把原来的图片再次添加到this.lists\r\n\t\t\t\t\t\t// 数组的some方法意思是，只要数组元素有任意一个元素条件符合，就返回true，而另一个数组的every方法的意思是数组所有元素都符合条件才返回true\r\n\t\t\t\t\t\tif(value.imageUrl != ''){\r\n\t\t\t\t\t\t\tlet tmp = this.lists.some(val => {\r\n\t\t\t\t\t\t\t\t\treturn val.imageUrl == value.imageUrl;\r\n\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t\t// 如果内部没有这个图片(tmp为false)，则添加到内部\r\n\t\t\t\t\t\t\t\t!tmp && this.lists.push({\r\n\t\t\t\t\t\t\t\t\turl: value.imageUrl,\r\n\t\t\t\t\t\t\t\t\terror: false,\r\n\t\t\t\t\t\t\t\t\tprogress: 100,\r\n\t\t\t\t\t\t\t\t\tdata: value\r\n\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\t// 监听lists的变化，发出事件\r\n\t\t\tlists(n) {\r\n\t\t\t\tthis.$emit('on-list-change', n, this.index);\r\n\t\t\t}\r\n\t\t},\r\n\t\tmethods: {\r\n\t\t\t// 清除列表\r\n\t\t\tclear() {\r\n\t\t\t\tthis.lists = [];\r\n\t\t\t},\r\n\t\t\t// 重新上传队列中上传失败的所有文件\r\n\t\t\treUpload() {\r\n\t\t\t\tthis.uploadFile();\r\n\t\t\t},\r\n\t\t\t// 选择图片\r\n\t\t\tselectFile() {\r\n\t\t\t\tif (this.disabled) return;\r\n\t\t\t\tconst {\r\n\t\t\t\t\tname = '', maxCount, multiple, maxSize, sizeType, lists, camera, compressed, maxDuration, sourceType\r\n\t\t\t\t} = this;\r\n\t\t\t\tlet chooseFile = null;\r\n\t\t\t\tconst newMaxCount = maxCount - lists.length;\r\n\t\t\t\t// 设置为只选择图片的时候使用 chooseImage 来实现\r\n\t\t\t\tchooseFile = new Promise((resolve, reject) => {\r\n\t\t\t\t\tuni.chooseImage({\r\n\t\t\t\t\t\tcount: multiple ? (newMaxCount > 9 ? 9 : newMaxCount) : 1,\r\n\t\t\t\t\t\tsourceType: sourceType,\r\n\t\t\t\t\t\tsizeType,\r\n\t\t\t\t\t\tsuccess: resolve,\r\n\t\t\t\t\t\tfail: reject\r\n\t\t\t\t\t});\r\n\t\t\t\t});\r\n\t\t\t\tchooseFile\r\n\t\t\t\t\t.then(res => {\r\n\t\t\t\t\t\tlet file = null;\r\n\t\t\t\t\t\tlet listOldLength = this.lists.length;\r\n\t\t\t\t\t\tres.tempFiles.map((val, index) => {\r\n\t\t\t\t\t\t\t// 检查文件后缀是否允许，如果不在this.limitType内，就会返回false\r\n\t\t\t\t\t\t\tif (!this.checkFileExt(val)) return;\r\n\r\n\t\t\t\t\t\t\t// 如果是非多选，index大于等于1或者超出最大限制数量时，不处理\r\n\t\t\t\t\t\t\tif (!multiple && index >= 1) return;\r\n\t\t\t\t\t\t\tconsole.log(val.size);\r\n\t\t\t\t\t\t\tconsole.log(maxSize);\r\n\t\t\t\t\t\t\t// #ifdef H5\r\n\t\t\t\t\t\t\tlists.push({\r\n\t\t\t\t\t\t\t\turl: val.path,\r\n\t\t\t\t\t\t\t\tprogress: 0,\r\n\t\t\t\t\t\t\t\terror: false,\r\n\t\t\t\t\t\t\t\tfile: val\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\tthis.$emit('on-choose-complete', this.lists, this.index);\r\n\t\t\t\t\t\t\tif (this.autoUpload) this.uploadFile(listOldLength);\r\n\t\t\t\t\t\t\t// #endif\r\n\t\t\t\t\t\t\t// #ifdef APP-PLUS\r\n\t\t\t\t\t\t\tif (val.size > maxSize) {\r\n\r\n\t\t\t\t\t\t\t\tconsole.log(\"超过大小\");\r\n\t\t\t\t\t\t\t\tif (maxCount <= lists.length) {\r\n\t\t\t\t\t\t\t\t\tthis.$emit('on-exceed', val, this.lists, this.index);\r\n\t\t\t\t\t\t\t\t\tthis.showToast('超出最大允许的文件个数');\r\n\t\t\t\t\t\t\t\t\treturn;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\tuni.compressImage({\r\n\t\t\t\t\t\t\t\t\tsrc: val.path,\r\n\t\t\t\t\t\t\t\t\tquality: 50,\r\n\t\t\t\t\t\t\t\t\tsuccess: (res) => {\r\n\t\t\t\t\t\t\t\t\t\tconsole.log(res);\r\n\t\t\t\t\t\t\t\t\t\tplus.io.resolveLocalFileSystemURL(res.tempFilePath, (\r\n\t\t\t\t\t\t\t\t\t\t\tentry) => {\r\n\t\t\t\t\t\t\t\t\t\t\tentry.file((file) => { // 可通过entry对象操作图片 \r\n\t\t\t\t\t\t\t\t\t\t\tconsole.log(file);\r\n\t\t\t\t\t\t\t\t\t\t\t\tif (file.size > maxSize) {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tthis.$emit('on-oversize', val,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tthis.lists, this.index);\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tthis.showToast(`文件大小不能超过${maxSize/1024/1024}M`);\r\n\r\n\t\t\t\t\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tlists.push({\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\turl: res\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t.tempFilePath,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tprogress: 0,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\terror: false,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tfile: val\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tthis.$emit(\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t'on-choose-complete',\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tthis.lists, this.index);\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tif (this.autoUpload) this\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t.uploadFile(listOldLength);\r\n\t\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t\t\t\t})\r\n\r\n\t\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\t\tfail: (err) => {\r\n\t\t\t\t\t\t\t\t\t\tconsole.log(err);\r\n\t\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\t\tcomplete: (res) => {\r\n\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t})\r\n\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\tif (maxCount <= lists.length) {\r\n\t\t\t\t\t\t\t\t\tthis.$emit('on-exceed', val, this.lists, this.index);\r\n\t\t\t\t\t\t\t\t\tthis.showToast('超出最大允许的文件个数');\r\n\t\t\t\t\t\t\t\t\treturn;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\tlists.push({\r\n\t\t\t\t\t\t\t\t\turl: val.path,\r\n\t\t\t\t\t\t\t\t\tprogress: 0,\r\n\t\t\t\t\t\t\t\t\terror: false,\r\n\t\t\t\t\t\t\t\t\tfile: val\r\n\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t\tthis.$emit('on-choose-complete', this.lists, this.index);\r\n\t\t\t\t\t\t\t\tif (this.autoUpload) this.uploadFile(listOldLength);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t// #endif\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t\t// 每次图片选择完，抛出一个事件，并将当前内部选择的图片数组抛出去\r\n\r\n\t\t\t\t\t})\r\n\t\t\t\t\t.catch(error => {\r\n\t\t\t\t\t\tthis.$emit('on-choose-fail', error);\r\n\t\t\t\t\t});\r\n\t\t\t},\r\n\t\t\t// 提示用户消息\r\n\t\t\tshowToast(message, force = false) {\r\n\t\t\t\tif (this.showTips || force) {\r\n\t\t\t\t\tuni.showToast({\r\n\t\t\t\t\t\ttitle: message,\r\n\t\t\t\t\t\ticon: 'none'\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\t// 该方法供用户通过ref调用，手动上传\r\n\t\t\tupload() {\r\n\t\t\t\tthis.uploadFile();\r\n\t\t\t},\r\n\t\t\t// 对失败的图片重新上传\r\n\t\t\tretry(index) {\r\n\t\t\t\tthis.lists[index].progress = 0;\r\n\t\t\t\tthis.lists[index].error = false;\r\n\t\t\t\tthis.lists[index].response = null;\r\n\t\t\t\tuni.showLoading({\r\n\t\t\t\t\ttitle: '重新上传'\r\n\t\t\t\t});\r\n\t\t\t\tthis.uploadFile(index);\r\n\t\t\t},\r\n\t\t\tasync doRequest() {\r\n\t\t\t\ttry {\r\n\t\t\t\t\tconst data = await this.getNewToken();\r\n\t\t\t\t\tif (data[1].data.code == 200) {\r\n\t\t\t\t\t\tuni.setStorageSync('tokenInfo', data[1].data.access_token);\r\n\t\t\t\t\t\tuni.setStorageSync('refreshToken', data[1].data.refresh_token);\r\n\t\t\t\t\t\tthis.header.Authorization = 'Bearer ' + data[1].data.access_token;\r\n\t\t\t\t\t\tconst res = await this.uploadFile();\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tthrow ('暂未登录,已阻止此次API请求~');\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t} catch (err) {\r\n\t\t\t\t\tuni.showToast({\r\n\t\t\t\t\t\ttitle: '登录会话已过期，请重新登录',\r\n\t\t\t\t\t\ticon: 'none',\r\n\t\t\t\t\t\tduration: 1000,\r\n\t\t\t\t\t\tmask: true,\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tasync getNewToken() {\r\n\t\t\t\tvar refreshToken = uni.getStorageSync('refreshToken')\r\n\t\t\t\treturn await uni.request({\r\n\t\t\t\t\tmethod: 'post',\r\n\t\t\t\t\theader: {\r\n\t\t\t\t\t\t'content-type': 'application/x-www-form-urlencoded'\r\n\t\t\t\t\t},\r\n\t\t\t\t\tdata: {\r\n\t\t\t\t\t\tclient_id: 'c2',\r\n\t\t\t\t\t\tclient_secret: 'secret',\r\n\t\t\t\t\t\tgrant_type: 'refresh_token',\r\n\t\t\t\t\t\trefresh_token: refreshToken\r\n\t\t\t\t\t},\r\n\t\t\t\t\turl: API_URL + '/auth/oauth/token',\r\n\t\t\t\t})\r\n\t\t\t},\r\n\t\t\t// 上传图片\r\n\t\t\tasync uploadFile(index = 0) {\r\n\t\t\t\tif (this.disabled) return;\r\n\t\t\t\tif (this.uploading) return;\r\n\t\t\t\t// 全部上传完成\r\n\t\t\t\tif (index >= this.lists.length) {\r\n\t\t\t\t\tthis.$emit('on-uploaded', this.lists, this.index);\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\t// 检查是否是已上传或者正在上传中\r\n\t\t\t\tif (this.lists[index].progress == 100) {\r\n\t\t\t\t\tif (this.autoUpload == false) this.uploadFile(index + 1);\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\t// 执行before-upload钩子\r\n\t\t\t\tif (this.beforeUpload && typeof(this.beforeUpload) === 'function') {\r\n\t\t\t\t\t// 执行回调，同时传入索引和文件列表当作参数\r\n\t\t\t\t\t// 在微信，支付宝等环境(H5正常)，会导致父组件定义的customBack()函数体中的this变成子组件的this\r\n\t\t\t\t\t// 通过bind()方法，绑定父组件的this，让this.customBack()的this为父组件的上下文\r\n\t\t\t\t\t// 因为upload组件可能会被嵌套在其他组件内，比如u-form，这时this.$parent其实为u-form的this，\r\n\t\t\t\t\t// 非页面的this，所以这里需要往上历遍，一直寻找到最顶端的$parent，这里用了this.$u.$parent.call(this)\r\n\t\t\t\t\t// 明白意思即可，无需纠结this.$u.$parent.call(this)的细节\r\n\t\t\t\t\tlet beforeResponse = this.beforeUpload.bind(this.$u.$parent.call(this))(index, this.lists, this\r\n\t\t\t\t\t\t.fileList);\r\n\t\t\t\t\t// 判断是否返回了promise\r\n\t\t\t\t\tif (!!beforeResponse && typeof beforeResponse.then === 'function') {\r\n\t\t\t\t\t\tawait beforeResponse.then(res => {\r\n\t\t\t\t\t\t\t// promise返回成功，不进行动作，继续上传\r\n\t\t\t\t\t\t}).catch(err => {\r\n\t\t\t\t\t\t\t// 进入catch回调的话，继续下一张\r\n\t\t\t\t\t\t\treturn this.uploadFile(index + 1);\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t} else if (beforeResponse === false) {\r\n\t\t\t\t\t\t// 如果返回false，继续下一张图片的上传\r\n\t\t\t\t\t\treturn this.uploadFile(index + 1);\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\t// 此处为返回\"true\"的情形，这里不写代码，就跳过此处，继续执行当前的上传逻辑\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\t// 检查上传地址\r\n\t\t\t\tif (!this.action) {\r\n\t\t\t\t\tthis.showToast('请配置上传地址', true);\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\tthis.lists[index].error = false;\r\n\t\t\t\tthis.uploading = true;\r\n\t\t\t\t// 创建上传对象\r\n\t\t\t\tuni.showLoading({\r\n\t\t\t\t\tmask:true\r\n\t\t\t\t})\r\n\t\t\t\tconst task = uni.uploadFile({\r\n\t\t\t\t\t// 这里可以手动配置一下baseUrl\r\n\t\t\t\t\turl: IMG_URL + this.action,\r\n\t\t\t\t\tfilePath: this.lists[index].url,\r\n\t\t\t\t\tname: this.name,\r\n\t\t\t\t\tformData: this.formData,\r\n\t\t\t\t\theader: this.header,\r\n\t\t\t\t\tsuccess: res => {\r\n\t\t\t\t\t\tuni.hideLoading()\r\n\t\t\t\t\t\tconsole.log(res);\r\n\t\t\t\t\t\t// 判断是否json字符串，将其转为json格式\r\n\t\t\t\t\t\tlet data = this.$u.test.jsonString(res.data) ? JSON.parse(res\r\n\t\t\t\t\t\t\t.data) : res.data;\r\n\t\t\t\t\t\tif (![200, 201, 204].includes(res.statusCode)) {\r\n\t\t\t\t\t\t\tthis.uploadError(index, data);\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t// 上传成功\r\n\t\t\t\t\t\t\tif (data.code == 401) {\r\n\t\t\t\t\t\t\t\tthis.lists[index].progress = 0;\r\n\t\t\t\t\t\t\t\tthis.lists[index].error = true;\r\n\t\t\t\t\t\t\t\tthis.lists[index].response = null;\r\n\t\t\t\t\t\t\t\tthis.doRequest()\r\n\t\t\t\t\t\t\t} else if (data.code != 200) {\r\n\t\t\t\t\t\t\t\tthis.uploadError(index, data);\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\tthis.lists[index].response = data;\r\n\t\t\t\t\t\t\t\tthis.lists[index].progress = 100;\r\n\t\t\t\t\t\t\t\tthis.lists[index].error = false;\r\n\t\t\t\t\t\t\t\tthis.$emit('on-success', data, index, this.lists, this.index);\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t},\r\n\t\t\t\t\tfail: e => {\r\n\t\t\t\t\t\tthis.uploadError(index, e);\r\n\t\t\t\t\t},\r\n\t\t\t\t\tcomplete: res => {\r\n\t\t\t\t\t\tuni.hideLoading();\r\n\t\t\t\t\t\tthis.uploading = false;\r\n\t\t\t\t\t\tthis.uploadFile(index + 1);\r\n\t\t\t\t\t\tthis.$emit('on-change', res, index, this.lists, this.index);\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t\ttask.onProgressUpdate(res => {\r\n\t\t\t\t\tif (res.progress > 0) {\r\n\t\t\t\t\t\t// this.lists[index].progress = res.progress;\r\n\t\t\t\t\t\tthis.$emit('on-progress', res, index, this.lists, this.index);\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t},\r\n\t\t\t// 上传失败\r\n\t\t\tuploadError(index, err) {\r\n\t\t\t\tthis.lists[index].progress = 0;\r\n\t\t\t\tthis.lists[index].error = true;\r\n\t\t\t\tthis.lists[index].response = null;\r\n\t\t\t\tthis.$emit('on-error', err, index, this.lists, this.index);\r\n\t\t\t\tthis.showToast('上传失败，请重试');\r\n\t\t\t},\r\n\t\t\t// 删除一个图片\r\n\t\t\tdeleteItem(index) {\r\n\t\t\t\tuni.showModal({\r\n\t\t\t\t\ttitle: '提示',\r\n\t\t\t\t\tcontent: '您确定要删除此项吗？',\r\n\t\t\t\t\tsuccess: async (res) => {\r\n\t\t\t\t\t\tif (res.confirm) {\r\n\t\t\t\t\t\t\t// 先检查是否有定义before-remove移除前钩子\r\n\t\t\t\t\t\t\t// 执行before-remove钩子\r\n\t\t\t\t\t\t\tif (this.beforeRemove && typeof(this.beforeRemove) === 'function') {\r\n\t\t\t\t\t\t\t\t// 此处钩子执行 原理同before-remove参数，见上方注释\r\n\t\t\t\t\t\t\t\tlet beforeResponse = this.beforeRemove.bind(this.$u.$parent.call(this))(index,\r\n\t\t\t\t\t\t\t\t\tthis.lists);\r\n\t\t\t\t\t\t\t\t// 判断是否返回了promise\r\n\t\t\t\t\t\t\t\tif (!!beforeResponse && typeof beforeResponse.then === 'function') {\r\n\t\t\t\t\t\t\t\t\tawait beforeResponse.then(res => {\r\n\t\t\t\t\t\t\t\t\t\t// promise返回成功，不进行动作，继续上传\r\n\t\t\t\t\t\t\t\t\t\tthis.handlerDeleteItem(index);\r\n\t\t\t\t\t\t\t\t\t}).catch(err => {\r\n\t\t\t\t\t\t\t\t\t\t// 如果进入promise的reject，终止删除操作\r\n\t\t\t\t\t\t\t\t\t\tthis.showToast('已终止移除');\r\n\t\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t\t} else if (beforeResponse === false) {\r\n\t\t\t\t\t\t\t\t\t// 返回false，终止删除\r\n\t\t\t\t\t\t\t\t\tthis.showToast('已终止移除');\r\n\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\t// 如果返回true，执行删除操作\r\n\t\t\t\t\t\t\t\t\tthis.handlerDeleteItem(index);\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t// 如果不存在before-remove钩子，\r\n\t\t\t\t\t\t\t\tthis.handlerDeleteItem(index);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t},\r\n\t\t\t// 执行移除图片的动作，上方代码只是判断是否可以移除\r\n\t\t\thandlerDeleteItem(index) {\r\n\t\t\t\t// 如果文件正在上传中，终止上传任务，进度在0 < progress < 100则意味着正在上传\r\n\t\t\t\tif (this.lists[index].process < 100 && this.lists[index].process > 0) {\r\n\t\t\t\t\ttypeof this.lists[index].uploadTask != 'undefined' && this.lists[index].uploadTask.abort();\r\n\t\t\t\t}\r\n\t\t\t\tthis.lists.splice(index, 1);\r\n\t\t\t\tthis.$forceUpdate();\r\n\t\t\t\tthis.$emit('on-remove', index, this.lists, this.fileList, this.index);\r\n\t\t\t\tthis.showToast('移除成功');\r\n\t\t\t},\r\n\t\t\t// 用户通过ref手动的形式，移除一张图片\r\n\t\t\tremove(index) {\r\n\t\t\t\t// 判断索引的合法范围\r\n\t\t\t\tif (index >= 0 && index < this.lists.length) {\r\n\t\t\t\t\tthis.lists.splice(index, 1);\r\n\t\t\t\t\tthis.$emit('on-list-change', this.lists, this.index);\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\t// 预览图片\r\n\t\t\tdoPreviewImage(url, index) {\r\n\t\t\t\tif (!this.previewFullImage) return;\r\n\t\t\t\tconst images = this.lists.map(item => item.url || item.path);\r\n\t\t\t\tuni.previewImage({\r\n\t\t\t\t\turls: images,\r\n\t\t\t\t\tcurrent: url,\r\n\t\t\t\t\tsuccess: () => {\r\n\t\t\t\t\t\tthis.$emit('on-preview', url, this.lists, this.index);\r\n\t\t\t\t\t},\r\n\t\t\t\t\tfail: () => {\r\n\t\t\t\t\t\tuni.showToast({\r\n\t\t\t\t\t\t\ttitle: '预览图片失败',\r\n\t\t\t\t\t\t\ticon: 'none'\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t},\r\n\t\t\t// 判断文件后缀是否允许\r\n\t\t\tcheckFileExt(file) {\r\n\t\t\t\t// 检查是否在允许的后缀中\r\n\t\t\t\tlet noArrowExt = false;\r\n\t\t\t\t// 获取后缀名\r\n\t\t\t\tlet fileExt = '';\r\n\t\t\t\tconst reg = /.+\\./;\r\n\t\t\t\t// 如果是H5，需要从name中判断\r\n\t\t\t\t// #ifdef H5\r\n\t\t\t\tfileExt = file.name.replace(reg, \"\").toLowerCase();\r\n\t\t\t\t// #endif\r\n\t\t\t\t// 非H5，需要从path中读取后缀\r\n\t\t\t\t// #ifndef H5\r\n\t\t\t\tfileExt = file.path.replace(reg, \"\").toLowerCase();\r\n\t\t\t\t// #endif\r\n\t\t\t\t// 使用数组的some方法，只要符合limitType中的一个，就返回true\r\n\t\t\t\tnoArrowExt = this.limitType.some(ext => {\r\n\t\t\t\t\t// 转为小写\r\n\t\t\t\t\treturn ext.toLowerCase() === fileExt;\r\n\t\t\t\t})\r\n\t\t\t\tif (!noArrowExt) this.showToast(`不允许选择${fileExt}格式的文件`);\r\n\t\t\t\treturn noArrowExt;\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n</script>\r\n\r\n<style lang=\"scss\" scoped>\r\n\t@import '../../libs/css/style.components.scss';\r\n\r\n\t.addBtn {\r\n\t\tmargin-bottom: 20rpx;\r\n\t\tmargin-right: 20rpx;\r\n\t}\r\n\r\n\t.u-upload {\r\n\t\t@include vue-flex;\r\n\t\tflex-wrap: wrap;\r\n\t\talign-items: center;\r\n\t\t// justify-content: space-between;\r\n\t\twidth: 100%;\r\n\t}\r\n\r\n\t.u-list-item {\r\n\t\twidth: 200rpx;\r\n\t\theight: 200rpx;\r\n\r\n\t\tmargin: 0 20rpx 20rpx 0rpx;\r\n\t\tposition: relative;\r\n\t\t/* #ifndef APP-NVUE */\r\n\t\tdisplay: flex;\r\n\t\t/* #endif */\r\n\t\talign-items: center;\r\n\t\tjustify-content: center;\r\n\t}\r\n\r\n\t.u-preview-wrap {\r\n\t\t// border: 1px solid rgb(235, 236, 238);\r\n\t}\r\n\r\n\t.u-add-wrap {\r\n\t\tflex-direction: column;\r\n\t\tcolor: $u-content-color;\r\n\t\tfont-size: 26rpx;\r\n\t}\r\n\r\n\t.u-add-tips {\r\n\t\tmargin-top: 20rpx;\r\n\t\tline-height: 40rpx;\r\n\t}\r\n\r\n\t.u-add-wrap__hover {\r\n\t\tbackground-color: rgb(235, 236, 238);\r\n\t}\r\n\r\n\t.u-preview-image {\r\n\t\tdisplay: block;\r\n\t\twidth: 100%;\r\n\t\theight: 100%;\r\n\t\t// border-radius: 10rpx;\r\n\t}\r\n\r\n\t.u-delete-icon {\r\n\t\tposition: absolute;\r\n\t\ttop: -10rpx;\r\n\t\tright: -10rpx;\r\n\t\tz-index: 10;\r\n\t\t// background-color: $u-type-error;\r\n\t\t// border-radius: 100rpx;\r\n\t\t// width: 44rpx;\r\n\t\t// height: 44rpx;\r\n\t\t@include vue-flex;\r\n\t\talign-items: center;\r\n\t\tjustify-content: center;\r\n\t}\r\n\r\n\t.u-icon {\r\n\t\t@include vue-flex;\r\n\t\talign-items: center;\r\n\t\tjustify-content: center;\r\n\t}\r\n\r\n\t.u-progress {\r\n\t\tposition: absolute;\r\n\t\tbottom: 10rpx;\r\n\t\tleft: 8rpx;\r\n\t\tright: 8rpx;\r\n\t\tz-index: 9;\r\n\t\twidth: auto;\r\n\t}\r\n\r\n\t.u-error-btn {\r\n\t\tcolor: #ffffff;\r\n\t\tbackground-color: $u-type-error;\r\n\t\tfont-size: 20rpx;\r\n\t\tpadding: 4px 0;\r\n\t\ttext-align: center;\r\n\t\tposition: absolute;\r\n\t\tbottom: 0;\r\n\t\tleft: 0;\r\n\t\tright: 0;\r\n\t\tz-index: 9;\r\n\t\tline-height: 1;\r\n\t}\r\n</style>\r\n","import mod from \"-!../../../../../常用软件/HBuilderX/plugins/uniapp-cli/node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../../../常用软件/HBuilderX/plugins/uniapp-cli/node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../../../../常用软件/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/stylePostLoader.js!../../../../../常用软件/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--8-oneOf-1-2!../../../../../常用软件/HBuilderX/plugins/uniapp-cli/node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-3!../../../../../常用软件/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/sass-loader/dist/cjs.js??ref--8-oneOf-1-4!../../../../../常用软件/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--8-oneOf-1-5!../../../../../常用软件/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../常用软件/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./u-upload.vue?vue&type=style&index=0&id=0d33af60&lang=scss&scoped=true&\"; export default mod; export * from \"-!../../../../../常用软件/HBuilderX/plugins/uniapp-cli/node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../../../常用软件/HBuilderX/plugins/uniapp-cli/node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../../../../常用软件/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/stylePostLoader.js!../../../../../常用软件/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--8-oneOf-1-2!../../../../../常用软件/HBuilderX/plugins/uniapp-cli/node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-3!../../../../../常用软件/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/sass-loader/dist/cjs.js??ref--8-oneOf-1-4!../../../../../常用软件/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--8-oneOf-1-5!../../../../../常用软件/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../常用软件/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./u-upload.vue?vue&type=style&index=0&id=0d33af60&lang=scss&scoped=true&\""],"sourceRoot":""}