(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["sub-package/pages/dev-manage/bt-version-upgrade"],{2439:function(e,r,n){"use strict";var i=n("81a6"),t=n.n(i);t.a},"472e":function(e,r,n){"use strict";n.d(r,"b",(function(){return t})),n.d(r,"c",(function(){return a})),n.d(r,"a",(function(){return i}));var i={uniBasePage:function(){return n.e("components/uni-base-page/uni-base-page").then(n.bind(null,"3c64"))}},t=function(){var e=this.$createElement;this._self._c},a=[]},"5dbb":function(e,r,n){"use strict";n.r(r);var i=n("f6c8"),t=n.n(i);for(var a in i)["default"].indexOf(a)<0&&function(e){n.d(r,e,(function(){return i[e]}))}(a);r["default"]=t.a},"60f8":function(e,r,n){"use strict";n.r(r);var i=n("472e"),t=n("5dbb");for(var a in t)["default"].indexOf(a)<0&&function(e){n.d(r,e,(function(){return t[e]}))}(a);n("2439");var o=n("f0c5"),s=Object(o["a"])(t["default"],i["b"],i["c"],!1,null,null,null,!1,i["a"],void 0);r["default"]=s.exports},"81a6":function(e,r,n){},cd67:function(e,r,n){"use strict";(function(e){var r=n("4ea4");n("27b1"),n("5c17");r(n("66fd"));var i=r(n("60f8"));wx.__webpack_require_UNI_MP_PLUGIN__=n,e(i.default)}).call(this,n("543d")["createPage"])},f6c8:function(e,r,n){"use strict";(function(e){Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var n="",i=!0,t={data:function(){return{firmwareList:[],savedFilePath:"",upgardeProgress:0,firmwareVersion:"正在获取中...",printMsg:"",preUpgradeVersion:"",upgradeTitle:"",modelValue:"",source:null}},computed:{manage:function(){return this.$t("manage")},sdk1:function(){return this.$t("sdk")},common:function(){return this.$t("common")}},methods:{getDevSystemVersion:function(r){var n=this;this.$sdkUtil.getDeviceConfig(this.devObj,(function(i){if(0===i.errorCode){var t=i.data;if(r)r.preUpgradeVersion==t.systemVersion?e.showModal({title:n.common["hint"]||"提示",content:n.sdk1["firmware-upgrade-succeed"]||"设备蓝牙固件升级成功",confirmText:n.common["confirm"]||"确定",showCancel:!1,isShowLoading:!1,success:function(r){e.navigateBack({delta:2})}}):e.showModal({title:n.common["hint"]||"提示",content:n.sdk1["abnormal-reboot-device"]||"升级重启异常，请断电重启设备",confirmText:n.common["confirm"]||"确定",showCancel:!1,success:function(r){e.navigateBack({delta:2})}});else{n.firmwareVersion=t.systemVersion;n.devObj.devSn,n.firmwareVersion,t.devType;n.modelValue=t.devType,n.getFirmwareVersion(n.devObj.devSn,n.firmwareVersion,n.modelValue)}}}))},getFirmwareVersion:function(e,r,n){var i=this;this.$req.request({url:"/platDevFirmware/app/listByDevSn",data:{devSn:e,versionNum:r,isShowLoad:!1,modelValue:n,source:this.source},success:function(e){i.firmwareList=e.data}})},clickUpgrade:function(r,n,i){var t=this;this.preUpgradeVersion=n,e.showModal({content:this.manage["if-upgrade"]+"【"+n+"】"+this.manage["version"]+"?",success:function(e){e.confirm&&t.searchLocalFirmware(r,i)}})},downLoadFirmware:function(e,r){var i=this;this.$showLoading(this.manage["downloading"]||"正在下载...");var t=plus.downloader.createDownload(e,{},(function(e,t){if(200==t){console.log("Download success: "+e.filename),n=e.filename;var a=plus.io.convertLocalFileSystemURL(n);i.$hideLoading(),i.upgradeFirmWare(a,r)}else console.log("Download failed: "+t)}));t.start()},upgradeFirmWare:function(e,r){var n=this.$refs.poster;n.show(),this.upgrade(e,r)},upgrade:function(e,r){var n=this,t=1,a=this.$refs.poster;this.$sdkUtil.upgradeDevice(this.devObj,e,(function(o){var s=o.errorCode;if(3===s){if(o.msg){var d=o.msg;n.printMsg=d}}else if(2===s){var u=o.data.progress;n.upgardeProgress=u,100==u&&(a.hide(),n.upgardeProgress=0,n.uploadFirmwareVersion(r),n.firmwareVersion=n.preUpgradeVersion,i=!0,1===t&&(t++,setTimeout((function(){n.getDevSystemVersion({preUpgradeVersion:n.preUpgradeVersion})}),5e3)))}else-2===s&&n.upgardeProgress<99&&!0===i?(i=!1,n.upgradeTitle="正在尝试重新升级...",setTimeout((function(){n.upgrade(e,r)}),2e3)):a.hide()}))},searchLocalFirmware:function(r,n){var i=this;if(r.indexOf("/")>-1){var t="_downloads/"+r.substring(r.lastIndexOf("/")+1);e.getSavedFileInfo({filePath:t,success:function(e){t=plus.io.convertLocalFileSystemURL(t),i.upgradeFirmWare(t,n)},fail:function(e){console.log("没有找到文件---",e),i.downLoadFirmware(r,n)}})}else this.$showToast(this.manage["download-path-error"]||"下载路径解析格式错误")},uploadFirmwareVersion:function(e){this.$req.request({url:"/devDevice/app/upgradeDev",data:{devId:this.devObj.deviceId,firmwareId:e,isShowLoad:!1},success:function(e){0==e.code&&(console,log("上传蓝牙固见版本成功"))}})}},onLoad:function(e){i=!0,this.upgradeTitle=this.manage["upgrading"]||"正在升级中...",this.firmwareVersion=this.manage["getting"]||"正在获取中...",e.source&&(this.source=e.source),e.devObj&&(this.devObj=JSON.parse(e.devObj),this.getDevSystemVersion()),this.$setTitle(this.manage["upgrade-bluetooth-firmware"]||"升级蓝牙固件")}};r.default=t}).call(this,n("543d")["default"])}},[["cd67","common/runtime","common/vendor"]]]);