(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["sub-package/pages/dev-manage/bt-version-upgrade"],{"0e3e":function(e,r,n){"use strict";(function(e){Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var n="",i=!0,t={data:function(){return{firmwareList:[],savedFilePath:"",upgardeProgress:0,firmwareVersion:"正在获取中...",printMsg:"",preUpgradeVersion:"",upgradeTitle:"",modelValue:"",source:null}},computed:{manage:function(){return this.$t("manage")},sdk1:function(){return this.$t("sdk")},common:function(){return this.$t("common")}},methods:{getDevSystemVersion:function(r){var n=this;this.$sdkUtil.getDeviceConfig(this.devObj,(function(i){if(0===i.errorCode){var t=i.data;if(r)r.preUpgradeVersion==t.systemVersion?e.showModal({title:n.common["hint"]||"提示",content:n.sdk1["firmware-upgrade-succeed"]||"设备蓝牙固件升级成功",confirmText:n.common["confirm"]||"确定",showCancel:!1,isShowLoading:!1,success:function(r){e.navigateBack({delta:2})}}):e.showModal({title:n.common["hint"]||"提示",content:n.sdk1["abnormal-reboot-device"]||"升级重启异常，请断电重启设备",confirmText:n.common["confirm"]||"确定",showCancel:!1,success:function(r){e.navigateBack({delta:2})}});else{n.firmwareVersion=t.systemVersion;n.devObj.devSn,n.firmwareVersion,t.devType;n.modelValue=t.devType,n.getFirmwareVersion(n.devObj.devSn,n.firmwareVersion,n.modelValue)}}}))},getFirmwareVersion:function(e,r,n){var i=this;this.$req.request({url:"/platDevFirmware/app/listByDevSn",data:{devSn:e,versionNum:r,isShowLoad:!1,modelValue:n,source:this.source},success:function(e){i.firmwareList=e.data}})},clickUpgrade:function(r,n,i){var t=this;this.preUpgradeVersion=n,e.showModal({content:this.manage["if-upgrade"]+"【"+n+"】"+this.manage["version"]+"?",success:function(e){e.confirm&&t.searchLocalFirmware(r,i)}})},downLoadFirmware:function(e,r){var i=this;this.$showLoading(this.manage["downloading"]||"正在下载...");var t=plus.downloader.createDownload(e,{},(function(e,t){if(200==t){console.log("Download success: "+e.filename),n=e.filename;var o=plus.io.convertLocalFileSystemURL(n);i.$hideLoading(),i.upgradeFirmWare(o,r)}else console.log("Download failed: "+t)}));t.start()},upgradeFirmWare:function(e,r){var n=this.$refs.poster;n.show(),this.upgrade(e,r)},upgrade:function(e,r){var n=this,t=1,o=this.$refs.poster;this.$sdkUtil.upgradeDevice(this.devObj,e,(function(a){var s=a.errorCode;if(3===s){if(a.msg){var u=a.msg;n.printMsg=u}}else if(2===s){var d=a.data.progress;n.upgardeProgress=d,100==d&&(o.hide(),n.upgardeProgress=0,n.uploadFirmwareVersion(r),n.firmwareVersion=n.preUpgradeVersion,i=!0,1===t&&(t++,setTimeout((function(){n.getDevSystemVersion({preUpgradeVersion:n.preUpgradeVersion})}),5e3)))}else-2===s&&n.upgardeProgress<99&&!0===i?(i=!1,n.upgradeTitle="正在尝试重新升级...",setTimeout((function(){n.upgrade(e,r)}),2e3)):o.hide()}))},searchLocalFirmware:function(r,n){var i=this;if(r.indexOf("/")>-1){var t="_downloads/"+r.substring(r.lastIndexOf("/")+1);e.getSavedFileInfo({filePath:t,success:function(e){t=plus.io.convertLocalFileSystemURL(t),i.upgradeFirmWare(t,n)},fail:function(e){console.log("没有找到文件---",e),i.downLoadFirmware(r,n)}})}else this.$showToast(this.manage["download-path-error"]||"下载路径解析格式错误")},uploadFirmwareVersion:function(e){this.$req.request({url:"/devDevice/app/upgradeDev",data:{devId:this.devObj.deviceId,firmwareId:e,isShowLoad:!1},success:function(e){0==e.code&&(console,log("上传蓝牙固见版本成功"))}})}},onLoad:function(e){i=!0,this.upgradeTitle=this.manage["upgrading"]||"正在升级中...",this.firmwareVersion=this.manage["getting"]||"正在获取中...",e.source&&(this.source=e.source),e.devObj&&(this.devObj=JSON.parse(e.devObj),this.getDevSystemVersion()),this.$setTitle(this.manage["upgrade-bluetooth-firmware"]||"升级蓝牙固件")}};r.default=t}).call(this,n("543d")["default"])},2498:function(e,r,n){"use strict";n.d(r,"b",(function(){return t})),n.d(r,"c",(function(){return o})),n.d(r,"a",(function(){return i}));var i={uniBasePage:function(){return n.e("components/uni-base-page/uni-base-page").then(n.bind(null,"10e9"))}},t=function(){var e=this,r=e.$createElement;e._self._c},o=[]},"84fe":function(e,r,n){"use strict";var i=n("979e"),t=n.n(i);t.a},"865e":function(e,r,n){"use strict";n.r(r);var i=n("2498"),t=n("8cb7");for(var o in t)"default"!==o&&function(e){n.d(r,e,(function(){return t[e]}))}(o);n("84fe");var a,s=n("f0c5"),u=Object(s["a"])(t["default"],i["b"],i["c"],!1,null,null,null,!1,i["a"],a);r["default"]=u.exports},"8cb7":function(e,r,n){"use strict";n.r(r);var i=n("0e3e"),t=n.n(i);for(var o in i)"default"!==o&&function(e){n.d(r,e,(function(){return i[e]}))}(o);r["default"]=t.a},"979e":function(e,r,n){},d58d:function(e,r,n){"use strict";(function(e){n("0fcb"),n("5c17");i(n("66fd"));var r=i(n("865e"));function i(e){return e&&e.__esModule?e:{default:e}}wx.__webpack_require_UNI_MP_PLUGIN__=n,e(r.default)}).call(this,n("543d")["createPage"])}},[["d58d","common/runtime","common/vendor"]]]);