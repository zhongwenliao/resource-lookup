(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/dev-manage/card-management"],{"10e2":function(t,e,d){"use strict";var a=d("6942"),i=d.n(a);i.a},"25bc":function(t,e,d){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var d={data:function(){return{devObj:{},deleteCardList:[],addCardList:[],cardNo:[],cardNum:"",exitBthShow1:!1,exitBthShow2:!1,timer:null,swipe_card_add:"",swipe_card_add_tips:"",swipe_card_delete:"",swipe_card_delete_tips:"",input_card_add:"",input_card_add_tips:"",input_card_delete:"",input_card_delete_tips:""}},computed:{manage:function(){return this.$t("manage")},sdk:function(){return this.$t("sdk")},mine:function(){return this.$t("mine")}},onLoad:function(t){this.$setTitle(this.manage["card-manage"]||"卡管理"),t.devObj&&(this.devObj=JSON.parse(t.devObj),1===this.devObj.isBtCardAddBlacklist?(this.swipe_card_add=this.manage["swipe-card-add-blacklist"]||"刷卡添加黑名单",this.swipe_card_add_tips=this.manage["swipe-card-add-tips-blacklist"]||"刷卡进行读取卡号添加黑名单",this.swipe_card_delete=this.manage["swipe-card-delete-blacklist"]||"刷卡删除黑名单",this.swipe_card_delete_tips=this.manage["swipe-card-delete-tips-blacklist"]||"刷卡进行读取卡号删除黑名单",this.input_card_add=this.manage["input-card-add-blacklist"]||"输入卡号加入黑名单",this.input_card_add_tips=this.manage["input-card-add-tips-blacklist"]||"手动输入卡号添加黑名单",this.input_card_delete=this.manage["input-card-delete-blacklist"]||"输入卡号移除黑名单",this.input_card_delete_tips=this.manage["input-card-delete-tips-blacklist"]||"手动输入卡号删除黑名单"):(this.swipe_card_add=this.manage["swipe-card-add"]||"刷卡添加卡号",this.swipe_card_add_tips=this.manage["swipe-card-add-tips"]||"刷卡进行读取卡号添加卡",this.swipe_card_delete=this.manage["swipe-card-delete"]||"刷卡删除卡号",this.swipe_card_delete_tips=this.manage["swipe-card-delete-tips"]||"刷卡进行读取卡号删除卡",this.input_card_add=this.manage["input-card-add"]||"输入卡号添卡",this.input_card_add_tips=this.manage["input-card-add-tips"]||"手动输入卡号添加卡",this.input_card_delete=this.manage["input-card-delete"]||"输入卡号删卡",this.input_card_delete_tips=this.manage["input-card-delete-tips"]||"手动输入卡号删除卡"))},methods:{syncServerCardData:function(){var t=this;t.$showToast(),Promise.all([t.getDeleteCard(),t.getAddCard()]).then((function(e){for(var d in e)"deleteCardData"in e[d]&&e[d]["deleteCardData"].length>0&&(t.deleteCardList=e[d]["deleteCardData"].map((function(t){return t.cardNo}))),"addCardData"in e[d]&&e[d]["addCardData"].length>0&&(t.addCardList=e[d]["addCardData"].map((function(t){return t.cardNo})));var a=t.addCardList.length,i=t.deleteCardList.length,s=t.deleteCardList.join(",");0==i&&0==a?t.$showToast(t.manage["no-update-data"]||"无更新数据"):0==i&&a>0?t.$sdkUtil.writeCard(t.devObj,t.addCardList,!0,(function(e){t.postCardList(t.addCardList,t.devObj.devSn)})):i>0&&0==a?t.$sdkUtil.deleteCard(t.devObj,s,(function(e){t.postCardList(t.deleteCardList,t.devObj.devSn)})):i>0&&a>0&&t.$sdkUtil.deleteCard(t.devObj,s,(function(e){t.$showToast(),setTimeout((function(){t.$sdkUtil.writeCard(t.devObj,t.addCardList,!0,(function(e){var d=t.addCardList.concat(t.deleteCardList);t.postCardList(d,t.devObj.devSn)}))}),3e3)}))}))},postCardList:function(t,e){var d=this;this.$req.request({url:"/persOfflineCard/app/operationComplete",data:{cardNos:t,devSn:e,isShowLoad:!1},success:function(t){0==t.code?d.$showToast(d.manage["sync-card-success"]||"同步服务器卡数据成功"):d.$showToast(t.mag)}})},getDeleteCard:function(){var t=this;return new Promise((function(e,d){t.$req.request({url:"/persOfflineCard/app/getNeedDelOfflineCardByDevSn",data:{devSn:t.devObj.devSn},success:function(t){e({deleteCardData:t.data})}})}))},getAddCard:function(){var t=this;return new Promise((function(e,d){t.$req.request({url:"/persOfflineCard/app/getNeedAddOfflineCardByDevSn",data:{devSn:t.devObj.devSn},success:function(t){e({addCardData:t.data})}})}))},swipeCardAdd:function(){var t=this;1==this.devObj.btCardAddType?this.$sdkUtil.swipeAddCardModel(this.devObj,(function(e){0==e.errorCode&&(t.$showToast(t.sdk["swipe-add-card-model"]||"已进入刷卡添卡模式，请刷卡"),t.exitBthShow1=!0)})):2==this.devObj.btCardAddType&&this.$sdkUtil.getSwipeAddCardno(this.devObj,(function(e){var d=e.data.cardNo,a=d.split(",");t.$sdkUtil.writeCard(t.devObj,a,!0)}))},swipeCardDelete:function(){var t=this;1==this.devObj.btCardAddType?this.$sdkUtil.swipeCardDeleteModel(this.devObj,(function(e){t.$showToast(t.sdk["swipe-delete-card-model"]||"已进入刷卡删卡模式，请刷卡"),t.exitBthShow2=!0})):2==this.devObj.btCardAddType&&(this.$showLog("新方法"),this.$sdkUtil.getSwipeAddCardno(this.devObj,(function(e){var d=e.data.cardNo;t.$sdkUtil.deleteCard(t.devObj,d)})))},exitCardAdd:function(){var t=this;this.$sdkUtil.existSwipeCardAddModel(this.devObj,(function(e){0==e.errorCode&&(t.$showToast(t.sdk["exit-swipe-add-card-model"]||"已退出刷卡添卡模式"),t.exitBthShow1=!1)}))},exitCardDelete:function(){var t=this;this.$sdkUtil.existSwipeCardDeleteModel(this.devObj,(function(e){0==e.errorCode&&(t.$showToast(t.sdk["exit-swipe-delete-card-model"]||"已退出刷卡删卡模式"),t.exitBthShow2=!1)}))},goToInputCard:function(e){t.navigateTo({url:"input-card?devObj="+JSON.stringify(this.devObj)+"&type="+e})},getReadCardList:function(){var e=this;this.$sdkUtil.getCardNumbersFromDevice(this.devObj,(function(d){var a=d.data.cardNo,i=d.data.cardNum;0==i?e.$showToast(e.sdk["no-card"]||"暂无卡数据"):t.navigateTo({url:"../../sub-package/pages/dev-manage/card-list?cardNum="+i+"&cardNo="+JSON.stringify(a)})}))},cleanFingerprint:function(){var t=this;this.$sdkUtil.cleanFingerprints(this.devObj,(function(e){t.$showToast("清空所有指纹数据成功")}))},cleanCard:function(){this.$sdkUtil.cleanCard(this.devObj)}}};e.default=d}).call(this,d("543d")["default"])},6942:function(t,e,d){},8649:function(t,e,d){"use strict";(function(t){d("0fcb"),d("5c17");a(d("66fd"));var e=a(d("971a6"));function a(t){return t&&t.__esModule?t:{default:t}}wx.__webpack_require_UNI_MP_PLUGIN__=d,t(e.default)}).call(this,d("543d")["createPage"])},"971a6":function(t,e,d){"use strict";d.r(e);var a=d("ea61"),i=d("d2f3");for(var s in i)"default"!==s&&function(t){d.d(e,t,(function(){return i[t]}))}(s);d("10e2");var n,r=d("f0c5"),c=Object(r["a"])(i["default"],a["b"],a["c"],!1,null,null,null,!1,a["a"],n);e["default"]=c.exports},d2f3:function(t,e,d){"use strict";d.r(e);var a=d("25bc"),i=d.n(a);for(var s in a)"default"!==s&&function(t){d.d(e,t,(function(){return a[t]}))}(s);e["default"]=i.a},ea61:function(t,e,d){"use strict";d.d(e,"b",(function(){return i})),d.d(e,"c",(function(){return s})),d.d(e,"a",(function(){return a}));var a={uniBasePage:function(){return d.e("components/uni-base-page/uni-base-page").then(d.bind(null,"10e9"))}},i=function(){var t=this,e=t.$createElement;t._self._c},s=[]}},[["8649","common/runtime","common/vendor"]]]);