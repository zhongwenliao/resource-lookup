(function(n,r){typeof exports=="object"&&typeof module!="undefined"?module.exports=r():typeof define=="function"&&define.amd?define(r):(n=typeof globalThis!="undefined"?globalThis:n||self,n.Loca=r())})(this,function(){"use strict";var runtime={exports:{}};function _instanceof$8(n,r){return r!=null&&typeof Symbol!="undefined"&&r[Symbol.hasInstance]?!!r[Symbol.hasInstance](n):n instanceof r}(function(n){var r=function(i){var s=function(O,k,F){return Object.defineProperty(O,k,{value:F,enumerable:!0,configurable:!0,writable:!0}),O[k]},a=function(O,k,F,q){var Y=k&&_instanceof$8(k.prototype,l)?k:l,fe=Object.create(Y.prototype),_e=new g(q||[]);return fe._invoke=p(O,F,_e),fe},o=function(O,k,F){try{return{type:"normal",arg:O.call(k,F)}}catch(q){return{type:"throw",arg:q}}},l=function(){},u=function(){},f=function(){},c=function(O){["next","throw","return"].forEach(function(k){s(O,k,function(F){return this._invoke(k,F)})})},h=function(O,k){function F(fe,_e,Pe,De){var tt=o(O[fe],O,_e);if(tt.type==="throw")De(tt.arg);else{var je=tt.arg,Fe=je.value;return Fe&&typeof Fe=="object"&&_.call(Fe,"__await")?k.resolve(Fe.__await).then(function(Ge){F("next",Ge,Pe,De)},function(Ge){F("throw",Ge,Pe,De)}):k.resolve(Fe).then(function(Ge){je.value=Ge,Pe(je)},function(Ge){return F("throw",Ge,Pe,De)})}}var q;function Y(fe,_e){function Pe(){return new k(function(De,tt){F(fe,_e,De,tt)})}return q=q?q.then(Pe,Pe):Pe()}this._invoke=Y},p=function(O,k,F){var q=W;return function(fe,_e){if(q===U)throw new Error("Generator is already running");if(q===M){if(fe==="throw")throw _e;return y()}for(F.method=fe,F.arg=_e;;){var Pe=F.delegate;if(Pe){var De=w(Pe,F);if(De){if(De===L)continue;return De}}if(F.method==="next")F.sent=F._sent=F.arg;else if(F.method==="throw"){if(q===W)throw q=M,F.arg;F.dispatchException(F.arg)}else F.method==="return"&&F.abrupt("return",F.arg);q=U;var tt=o(O,k,F);if(tt.type==="normal"){if(q=F.done?M:K,tt.arg===L)continue;return{value:tt.arg,done:F.done}}else tt.type==="throw"&&(q=M,F.method="throw",F.arg=tt.arg)}}},d=function(O){var k={tryLoc:O[0]};1 in O&&(k.catchLoc=O[1]),2 in O&&(k.finallyLoc=O[2],k.afterLoc=O[3]),this.tryEntries.push(k)},v=function(O){var k=O.completion||{};k.type="normal",delete k.arg,O.completion=k},g=function(O){this.tryEntries=[{tryLoc:"root"}],O.forEach(d,this),this.reset(!0)},m=function(O){if(O){var k=O[I];if(k)return k.call(O);if(typeof O.next=="function")return O;if(!isNaN(O.length)){var F=-1,q=function Y(){for(;++F<O.length;)if(_.call(O,F))return Y.value=O[F],Y.done=!1,Y;return Y.value=C,Y.done=!0,Y};return q.next=q}}return{next:y}},y=function(){return{value:C,done:!0}},b=Object.prototype,_=b.hasOwnProperty,C,A=typeof Symbol=="function"?Symbol:{},I=A.iterator||"@@iterator",D=A.asyncIterator||"@@asyncIterator",X=A.toStringTag||"@@toStringTag";try{s({},"")}catch(E){s=function(k,F,q){return k[F]=q}}i.wrap=a;var W="suspendedStart",K="suspendedYield",U="executing",M="completed",L={},P={};s(P,I,function(){return this});var $=Object.getPrototypeOf,R=$&&$($(m([])));R&&R!==b&&_.call(R,I)&&(P=R);var T=f.prototype=l.prototype=Object.create(P);u.prototype=f,s(T,"constructor",f),s(f,"constructor",u),u.displayName=s(f,X,"GeneratorFunction"),i.isGeneratorFunction=function(E){var O=typeof E=="function"&&E.constructor;return O?O===u||(O.displayName||O.name)==="GeneratorFunction":!1},i.mark=function(E){return Object.setPrototypeOf?Object.setPrototypeOf(E,f):(E.__proto__=f,s(E,X,"GeneratorFunction")),E.prototype=Object.create(T),E},i.awrap=function(E){return{__await:E}},c(h.prototype),s(h.prototype,D,function(){return this}),i.AsyncIterator=h,i.async=function(E,O,k,F,q){q===void 0&&(q=Promise);var Y=new h(a(E,O,k,F),q);return i.isGeneratorFunction(O)?Y:Y.next().then(function(fe){return fe.done?fe.value:Y.next()})};function w(E,O){var k=E.iterator[O.method];if(k===C){if(O.delegate=null,O.method==="throw"){if(E.iterator.return&&(O.method="return",O.arg=C,w(E,O),O.method==="throw"))return L;O.method="throw",O.arg=new TypeError("The iterator does not provide a 'throw' method")}return L}var F=o(k,E.iterator,O.arg);if(F.type==="throw")return O.method="throw",O.arg=F.arg,O.delegate=null,L;var q=F.arg;if(!q)return O.method="throw",O.arg=new TypeError("iterator result is not an object"),O.delegate=null,L;if(q.done)O[E.resultName]=q.value,O.next=E.nextLoc,O.method!=="return"&&(O.method="next",O.arg=C);else return q;return O.delegate=null,L}return c(T),s(T,X,"Generator"),s(T,I,function(){return this}),s(T,"toString",function(){return"[object Generator]"}),i.keys=function(E){var O=[];for(var k in E)O.push(k);return O.reverse(),function F(){for(;O.length;){var q=O.pop();if(q in E)return F.value=q,F.done=!1,F}return F.done=!0,F}},i.values=m,g.prototype={constructor:g,reset:function(O){if(this.prev=0,this.next=0,this.sent=this._sent=C,this.done=!1,this.delegate=null,this.method="next",this.arg=C,this.tryEntries.forEach(v),!O)for(var k in this)k.charAt(0)==="t"&&_.call(this,k)&&!isNaN(+k.slice(1))&&(this[k]=C)},stop:function(){this.done=!0;var O=this.tryEntries[0],k=O.completion;if(k.type==="throw")throw k.arg;return this.rval},dispatchException:function(O){var k=function(tt,je){return fe.type="throw",fe.arg=O,F.next=tt,je&&(F.method="next",F.arg=C),!!je};if(this.done)throw O;for(var F=this,q=this.tryEntries.length-1;q>=0;--q){var Y=this.tryEntries[q],fe=Y.completion;if(Y.tryLoc==="root")return k("end");if(Y.tryLoc<=this.prev){var _e=_.call(Y,"catchLoc"),Pe=_.call(Y,"finallyLoc");if(_e&&Pe){if(this.prev<Y.catchLoc)return k(Y.catchLoc,!0);if(this.prev<Y.finallyLoc)return k(Y.finallyLoc)}else if(_e){if(this.prev<Y.catchLoc)return k(Y.catchLoc,!0)}else if(Pe){if(this.prev<Y.finallyLoc)return k(Y.finallyLoc)}else throw new Error("try statement without catch or finally")}}},abrupt:function(O,k){for(var F=this.tryEntries.length-1;F>=0;--F){var q=this.tryEntries[F];if(q.tryLoc<=this.prev&&_.call(q,"finallyLoc")&&this.prev<q.finallyLoc){var Y=q;break}}Y&&(O==="break"||O==="continue")&&Y.tryLoc<=k&&k<=Y.finallyLoc&&(Y=null);var fe=Y?Y.completion:{};return fe.type=O,fe.arg=k,Y?(this.method="next",this.next=Y.finallyLoc,L):this.complete(fe)},complete:function(O,k){if(O.type==="throw")throw O.arg;return O.type==="break"||O.type==="continue"?this.next=O.arg:O.type==="return"?(this.rval=this.arg=O.arg,this.method="return",this.next="end"):O.type==="normal"&&k&&(this.next=k),L},finish:function(O){for(var k=this.tryEntries.length-1;k>=0;--k){var F=this.tryEntries[k];if(F.finallyLoc===O)return this.complete(F.completion,F.afterLoc),v(F),L}},catch:function(E){for(var O=this.tryEntries.length-1;O>=0;--O){var k=this.tryEntries[O];if(k.tryLoc===E){var F=k.completion;if(F.type==="throw"){var q=F.arg;v(k)}return q}}throw new Error("illegal catch attempt")},delegateYield:function(O,k,F){return this.delegate={iterator:m(O),resultName:k,nextLoc:F},this.method==="next"&&(this.arg=C),L}},i}(n.exports);try{regeneratorRuntime=r}catch(i){typeof globalThis=="object"?globalThis.regeneratorRuntime=r:Function("r","regeneratorRuntime = r")(r)}})(runtime);var regeneratorRuntime$1=runtime.exports,commonjsGlobal=typeof globalThis!="undefined"?globalThis:typeof window!="undefined"?window:typeof global!="undefined"?global:typeof self!="undefined"?self:{};function getAugmentedNamespace(n){var r=n.default;if(typeof r=="function"){var i=function(){return r.apply(this,arguments)};i.prototype=r.prototype}else i={};return Object.defineProperty(i,"__esModule",{value:!0}),Object.keys(n).forEach(function(s){var a=Object.getOwnPropertyDescriptor(n,s);Object.defineProperty(i,s,a.get?a:{enumerable:!0,get:function(){return n[s]}})}),i}var lbsLocaLayers_umd_tmp$1={exports:{}},uaParser={exports:{}};function _instanceof$7(n,r){return r!=null&&typeof Symbol!="undefined"&&r[Symbol.hasInstance]?!!r[Symbol.hasInstance](n):n instanceof r}var _typeof$5=function(n){return n&&typeof Symbol!="undefined"&&n.constructor===Symbol?"symbol":typeof n},hasRequiredUaParser;function requireUaParser(){return hasRequiredUaParser||(hasRequiredUaParser=1,function(n,r){(function(i,s){var a="0.7.31",o="",l="?",u="function",f="undefined",c="object",h="string",p="major",d="model",v="name",g="type",m="vendor",y="version",b="architecture",_="console",C="mobile",A="tablet",I="smarttv",D="wearable",X="embedded",W=255,K="Amazon",U="Apple",M="ASUS",L="BlackBerry",P="Browser",$="Chrome",R="Edge",T="Firefox",w="Google",E="Huawei",O="LG",k="Microsoft",F="Motorola",q="Opera",Y="Samsung",fe="Sony",_e="Xiaomi",Pe="Zebra",De="Facebook",tt=function(ht,ot){var mt={};for(var nt in ht)ot[nt]&&ot[nt].length%2===0?mt[nt]=ot[nt].concat(ht[nt]):mt[nt]=ht[nt];return mt},je=function(ht){for(var ot={},mt=0;mt<ht.length;mt++)ot[ht[mt].toUpperCase()]=ht[mt];return ot},Fe=function(ht,ot){return(typeof ht=="undefined"?"undefined":_typeof$5(ht))===h?Ge(ot).indexOf(Ge(ht))!==-1:!1},Ge=function(ht){return ht.toLowerCase()},Et=function(ht){return _typeof$5(ht)===h?ht.replace(/[^\d\.]/g,o).split(".")[0]:s},st=function(ht,ot){if(_typeof$5(ht)===h)return ht=ht.replace(/^\s\s*/,o).replace(/\s\s*$/,o),_typeof$5(ot)===f?ht:ht.substring(0,W)},at=function(ht,ot){for(var mt=0,nt,Ut,Dt,ft,Ct,St;mt<ot.length&&!Ct;){var zt=ot[mt],Nt=ot[mt+1];for(nt=Ut=0;nt<zt.length&&!Ct;)if(Ct=zt[nt++].exec(ht),Ct)for(Dt=0;Dt<Nt.length;Dt++)St=Ct[++Ut],ft=Nt[Dt],(typeof ft=="undefined"?"undefined":_typeof$5(ft))===c&&ft.length>0?ft.length===2?_typeof$5(ft[1])==u?this[ft[0]]=ft[1].call(this,St):this[ft[0]]=ft[1]:ft.length===3?_typeof$5(ft[1])===u&&!(ft[1].exec&&ft[1].test)?this[ft[0]]=St?ft[1].call(this,St,ft[2]):s:this[ft[0]]=St?St.replace(ft[1],ft[2]):s:ft.length===4&&(this[ft[0]]=St?ft[3].call(this,St.replace(ft[1],ft[2])):s):this[ft]=St||s;mt+=2}},$t=function(ht,ot){for(var mt in ot)if(_typeof$5(ot[mt])===c&&ot[mt].length>0){for(var nt=0;nt<ot[mt].length;nt++)if(Fe(ot[mt][nt],ht))return mt===l?s:mt}else if(Fe(ot[mt],ht))return mt===l?s:mt;return ht},kt={"1.0":"/8","1.2":"/1","1.3":"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"},Rt={ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0","2000":"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0","7":"NT 6.1","8":"NT 6.2","8.1":"NT 6.3","10":["NT 6.4","NT 10.0"],RT:"ARM"},Tt={browser:[[/\b(?:crmo|crios)\/([\w\.]+)/i],[y,[v,"Chrome"]],[/edg(?:e|ios|a)?\/([\w\.]+)/i],[y,[v,"Edge"]],[/(opera mini)\/([-\w\.]+)/i,/(opera [mobiletab]{3,6})\b.+version\/([-\w\.]+)/i,/(opera)(?:.+version\/|[\/ ]+)([\w\.]+)/i],[v,y],[/opios[\/ ]+([\w\.]+)/i],[y,[v,q+" Mini"]],[/\bopr\/([\w\.]+)/i],[y,[v,q]],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer)[\/ ]?([\w\.]*)/i,/(avant |iemobile|slim)(?:browser)?[\/ ]?([\w\.]*)/i,/(ba?idubrowser)[\/ ]?([\w\.]+)/i,/(?:ms|\()(ie) ([\w\.]+)/i,/(flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron|vivaldi|iridium|phantomjs|bowser|quark|qupzilla|falkon|rekonq|puffin|brave|whale|qqbrowserlite|qq)\/([-\w\.]+)/i,/(weibo)__([\d\.]+)/i],[v,y],[/(?:\buc? ?browser|(?:juc.+)ucweb)[\/ ]?([\w\.]+)/i],[y,[v,"UC"+P]],[/\bqbcore\/([\w\.]+)/i],[y,[v,"WeChat(Win) Desktop"]],[/micromessenger\/([\w\.]+)/i],[y,[v,"WeChat"]],[/konqueror\/([\w\.]+)/i],[y,[v,"Konqueror"]],[/trident.+rv[: ]([\w\.]{1,9})\b.+like gecko/i],[y,[v,"IE"]],[/yabrowser\/([\w\.]+)/i],[y,[v,"Yandex"]],[/(avast|avg)\/([\w\.]+)/i],[[v,/(.+)/,"$1 Secure "+P],y],[/\bfocus\/([\w\.]+)/i],[y,[v,T+" Focus"]],[/\bopt\/([\w\.]+)/i],[y,[v,q+" Touch"]],[/coc_coc\w+\/([\w\.]+)/i],[y,[v,"Coc Coc"]],[/dolfin\/([\w\.]+)/i],[y,[v,"Dolphin"]],[/coast\/([\w\.]+)/i],[y,[v,q+" Coast"]],[/miuibrowser\/([\w\.]+)/i],[y,[v,"MIUI "+P]],[/fxios\/([-\w\.]+)/i],[y,[v,T]],[/\bqihu|(qi?ho?o?|360)browser/i],[[v,"360 "+P]],[/(oculus|samsung|sailfish)browser\/([\w\.]+)/i],[[v,/(.+)/,"$1 "+P],y],[/(comodo_dragon)\/([\w\.]+)/i],[[v,/_/g," "],y],[/(electron)\/([\w\.]+) safari/i,/(tesla)(?: qtcarbrowser|\/(20\d\d\.[-\w\.]+))/i,/m?(qqbrowser|baiduboxapp|2345Explorer)[\/ ]?([\w\.]+)/i],[v,y],[/(metasr)[\/ ]?([\w\.]+)/i,/(lbbrowser)/i],[v],[/((?:fban\/fbios|fb_iab\/fb4a)(?!.+fbav)|;fbav\/([\w\.]+);)/i],[[v,De],y],[/safari (line)\/([\w\.]+)/i,/\b(line)\/([\w\.]+)\/iab/i,/(chromium|instagram)[\/ ]([-\w\.]+)/i],[v,y],[/\bgsa\/([\w\.]+) .*safari\//i],[y,[v,"GSA"]],[/headlesschrome(?:\/([\w\.]+)| )/i],[y,[v,$+" Headless"]],[/ wv\).+(chrome)\/([\w\.]+)/i],[[v,$+" WebView"],y],[/droid.+ version\/([\w\.]+)\b.+(?:mobile safari|safari)/i],[y,[v,"Android "+P]],[/(chrome|omniweb|arora|[tizenoka]{5} ?browser)\/v?([\w\.]+)/i],[v,y],[/version\/([\w\.]+) .*mobile\/\w+ (safari)/i],[y,[v,"Mobile Safari"]],[/version\/([\w\.]+) .*(mobile ?safari|safari)/i],[y,v],[/webkit.+?(mobile ?safari|safari)(\/[\w\.]+)/i],[v,[y,$t,kt]],[/(webkit|khtml)\/([\w\.]+)/i],[v,y],[/(navigator|netscape\d?)\/([-\w\.]+)/i],[[v,"Netscape"],y],[/mobile vr; rv:([\w\.]+)\).+firefox/i],[y,[v,T+" Reality"]],[/ekiohf.+(flow)\/([\w\.]+)/i,/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo browser|minimo|conkeror|klar)[\/ ]?([\w\.\+]+)/i,/(seamonkey|k-meleon|icecat|iceape|firebird|phoenix|palemoon|basilisk|waterfox)\/([-\w\.]+)$/i,/(firefox)\/([\w\.]+)/i,/(mozilla)\/([\w\.]+) .+rv\:.+gecko\/\d+/i,/(polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf|sleipnir|obigo|mosaic|(?:go|ice|up)[\. ]?browser)[-\/ ]?v?([\w\.]+)/i,/(links) \(([\w\.]+)/i],[v,y]],cpu:[[/(?:(amd|x(?:(?:86|64)[-_])?|wow|win)64)[;\)]/i],[[b,"amd64"]],[/(ia32(?=;))/i],[[b,Ge]],[/((?:i[346]|x)86)[;\)]/i],[[b,"ia32"]],[/\b(aarch64|arm(v?8e?l?|_?64))\b/i],[[b,"arm64"]],[/\b(arm(?:v[67])?ht?n?[fl]p?)\b/i],[[b,"armhf"]],[/windows (ce|mobile); ppc;/i],[[b,"arm"]],[/((?:ppc|powerpc)(?:64)?)(?: mac|;|\))/i],[[b,/ower/,o,Ge]],[/(sun4\w)[;\)]/i],[[b,"sparc"]],[/((?:avr32|ia64(?=;))|68k(?=\))|\barm(?=v(?:[1-7]|[5-7]1)l?|;|eabi)|(?=atmel )avr|(?:irix|mips|sparc)(?:64)?\b|pa-risc)/i],[[b,Ge]]],device:[[/\b(sch-i[89]0\d|shw-m380s|sm-[pt]\w{2,4}|gt-[pn]\d{2,4}|sgh-t8[56]9|nexus 10)/i],[d,[m,Y],[g,A]],[/\b((?:s[cgp]h|gt|sm)-\w+|galaxy nexus)/i,/samsung[- ]([-\w]+)/i,/sec-(sgh\w+)/i],[d,[m,Y],[g,C]],[/\((ip(?:hone|od)[\w ]*);/i],[d,[m,U],[g,C]],[/\((ipad);[-\w\),; ]+apple/i,/applecoremedia\/[\w\.]+ \((ipad)/i,/\b(ipad)\d\d?,\d\d?[;\]].+ios/i],[d,[m,U],[g,A]],[/\b((?:ag[rs][23]?|bah2?|sht?|btv)-a?[lw]\d{2})\b(?!.+d\/s)/i],[d,[m,E],[g,A]],[/(?:huawei|honor)([-\w ]+)[;\)]/i,/\b(nexus 6p|\w{2,4}-[atu]?[ln][01259x][012359][an]?)\b(?!.+d\/s)/i],[d,[m,E],[g,C]],[/\b(poco[\w ]+)(?: bui|\))/i,/\b; (\w+) build\/hm\1/i,/\b(hm[-_ ]?note?[_ ]?(?:\d\w)?) bui/i,/\b(redmi[\-_ ]?(?:note|k)?[\w_ ]+)(?: bui|\))/i,/\b(mi[-_ ]?(?:a\d|one|one[_ ]plus|note lte|max)?[_ ]?(?:\d?\w?)[_ ]?(?:plus|se|lite)?)(?: bui|\))/i],[[d,/_/g," "],[m,_e],[g,C]],[/\b(mi[-_ ]?(?:pad)(?:[\w_ ]+))(?: bui|\))/i],[[d,/_/g," "],[m,_e],[g,A]],[/; (\w+) bui.+ oppo/i,/\b(cph[12]\d{3}|p(?:af|c[al]|d\w|e[ar])[mt]\d0|x9007|a101op)\b/i],[d,[m,"OPPO"],[g,C]],[/vivo (\w+)(?: bui|\))/i,/\b(v[12]\d{3}\w?[at])(?: bui|;)/i],[d,[m,"Vivo"],[g,C]],[/\b(rmx[12]\d{3})(?: bui|;|\))/i],[d,[m,"Realme"],[g,C]],[/\b(milestone|droid(?:[2-4x]| (?:bionic|x2|pro|razr))?:?( 4g)?)\b[\w ]+build\//i,/\bmot(?:orola)?[- ](\w*)/i,/((?:moto[\w\(\) ]+|xt\d{3,4}|nexus 6)(?= bui|\)))/i],[d,[m,F],[g,C]],[/\b(mz60\d|xoom[2 ]{0,2}) build\//i],[d,[m,F],[g,A]],[/((?=lg)?[vl]k\-?\d{3}) bui| 3\.[-\w; ]{10}lg?-([06cv9]{3,4})/i],[d,[m,O],[g,A]],[/(lm(?:-?f100[nv]?|-[\w\.]+)(?= bui|\))|nexus [45])/i,/\blg[-e;\/ ]+((?!browser|netcast|android tv)\w+)/i,/\blg-?([\d\w]+) bui/i],[d,[m,O],[g,C]],[/(ideatab[-\w ]+)/i,/lenovo ?(s[56]000[-\w]+|tab(?:[\w ]+)|yt[-\d\w]{6}|tb[-\d\w]{6})/i],[d,[m,"Lenovo"],[g,A]],[/(?:maemo|nokia).*(n900|lumia \d+)/i,/nokia[-_ ]?([-\w\.]*)/i],[[d,/_/g," "],[m,"Nokia"],[g,C]],[/(pixel c)\b/i],[d,[m,w],[g,A]],[/droid.+; (pixel[\daxl ]{0,6})(?: bui|\))/i],[d,[m,w],[g,C]],[/droid.+ ([c-g]\d{4}|so[-gl]\w+|xq-a\w[4-7][12])(?= bui|\).+chrome\/(?![1-6]{0,1}\d\.))/i],[d,[m,fe],[g,C]],[/sony tablet [ps]/i,/\b(?:sony)?sgp\w+(?: bui|\))/i],[[d,"Xperia Tablet"],[m,fe],[g,A]],[/ (kb2005|in20[12]5|be20[12][59])\b/i,/(?:one)?(?:plus)? (a\d0\d\d)(?: b|\))/i],[d,[m,"OnePlus"],[g,C]],[/(alexa)webm/i,/(kf[a-z]{2}wi)( bui|\))/i,/(kf[a-z]+)( bui|\)).+silk\//i],[d,[m,K],[g,A]],[/((?:sd|kf)[0349hijorstuw]+)( bui|\)).+silk\//i],[[d,/(.+)/g,"Fire Phone $1"],[m,K],[g,C]],[/(playbook);[-\w\),; ]+(rim)/i],[d,m,[g,A]],[/\b((?:bb[a-f]|st[hv])100-\d)/i,/\(bb10; (\w+)/i],[d,[m,L],[g,C]],[/(?:\b|asus_)(transfo[prime ]{4,10} \w+|eeepc|slider \w+|nexus 7|padfone|p00[cj])/i],[d,[m,M],[g,A]],[/ (z[bes]6[027][012][km][ls]|zenfone \d\w?)\b/i],[d,[m,M],[g,C]],[/(nexus 9)/i],[d,[m,"HTC"],[g,A]],[/(htc)[-;_ ]{1,2}([\w ]+(?=\)| bui)|\w+)/i,/(zte)[- ]([\w ]+?)(?: bui|\/|\))/i,/(alcatel|geeksphone|nexian|panasonic|sony)[-_ ]?([-\w]*)/i],[m,[d,/_/g," "],[g,C]],[/droid.+; ([ab][1-7]-?[0178a]\d\d?)/i],[d,[m,"Acer"],[g,A]],[/droid.+; (m[1-5] note) bui/i,/\bmz-([-\w]{2,})/i],[d,[m,"Meizu"],[g,C]],[/\b(sh-?[altvz]?\d\d[a-ekm]?)/i],[d,[m,"Sharp"],[g,C]],[/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus|dell|meizu|motorola|polytron)[-_ ]?([-\w]*)/i,/(hp) ([\w ]+\w)/i,/(asus)-?(\w+)/i,/(microsoft); (lumia[\w ]+)/i,/(lenovo)[-_ ]?([-\w]+)/i,/(jolla)/i,/(oppo) ?([\w ]+) bui/i],[m,d,[g,C]],[/(archos) (gamepad2?)/i,/(hp).+(touchpad(?!.+tablet)|tablet)/i,/(kindle)\/([\w\.]+)/i,/(nook)[\w ]+build\/(\w+)/i,/(dell) (strea[kpr\d ]*[\dko])/i,/(le[- ]+pan)[- ]+(\w{1,9}) bui/i,/(trinity)[- ]*(t\d{3}) bui/i,/(gigaset)[- ]+(q\w{1,9}) bui/i,/(vodafone) ([\w ]+)(?:\)| bui)/i],[m,d,[g,A]],[/(surface duo)/i],[d,[m,k],[g,A]],[/droid [\d\.]+; (fp\du?)(?: b|\))/i],[d,[m,"Fairphone"],[g,C]],[/(u304aa)/i],[d,[m,"AT&T"],[g,C]],[/\bsie-(\w*)/i],[d,[m,"Siemens"],[g,C]],[/\b(rct\w+) b/i],[d,[m,"RCA"],[g,A]],[/\b(venue[\d ]{2,7}) b/i],[d,[m,"Dell"],[g,A]],[/\b(q(?:mv|ta)\w+) b/i],[d,[m,"Verizon"],[g,A]],[/\b(?:barnes[& ]+noble |bn[rt])([\w\+ ]*) b/i],[d,[m,"Barnes & Noble"],[g,A]],[/\b(tm\d{3}\w+) b/i],[d,[m,"NuVision"],[g,A]],[/\b(k88) b/i],[d,[m,"ZTE"],[g,A]],[/\b(nx\d{3}j) b/i],[d,[m,"ZTE"],[g,C]],[/\b(gen\d{3}) b.+49h/i],[d,[m,"Swiss"],[g,C]],[/\b(zur\d{3}) b/i],[d,[m,"Swiss"],[g,A]],[/\b((zeki)?tb.*\b) b/i],[d,[m,"Zeki"],[g,A]],[/\b([yr]\d{2}) b/i,/\b(dragon[- ]+touch |dt)(\w{5}) b/i],[[m,"Dragon Touch"],d,[g,A]],[/\b(ns-?\w{0,9}) b/i],[d,[m,"Insignia"],[g,A]],[/\b((nxa|next)-?\w{0,9}) b/i],[d,[m,"NextBook"],[g,A]],[/\b(xtreme\_)?(v(1[045]|2[015]|[3469]0|7[05])) b/i],[[m,"Voice"],d,[g,C]],[/\b(lvtel\-)?(v1[12]) b/i],[[m,"LvTel"],d,[g,C]],[/\b(ph-1) /i],[d,[m,"Essential"],[g,C]],[/\b(v(100md|700na|7011|917g).*\b) b/i],[d,[m,"Envizen"],[g,A]],[/\b(trio[-\w\. ]+) b/i],[d,[m,"MachSpeed"],[g,A]],[/\btu_(1491) b/i],[d,[m,"Rotor"],[g,A]],[/(shield[\w ]+) b/i],[d,[m,"Nvidia"],[g,A]],[/(sprint) (\w+)/i],[m,d,[g,C]],[/(kin\.[onetw]{3})/i],[[d,/\./g," "],[m,k],[g,C]],[/droid.+; (cc6666?|et5[16]|mc[239][23]x?|vc8[03]x?)\)/i],[d,[m,Pe],[g,A]],[/droid.+; (ec30|ps20|tc[2-8]\d[kx])\)/i],[d,[m,Pe],[g,C]],[/(ouya)/i,/(nintendo) ([wids3utch]+)/i],[m,d,[g,_]],[/droid.+; (shield) bui/i],[d,[m,"Nvidia"],[g,_]],[/(playstation [345portablevi]+)/i],[d,[m,fe],[g,_]],[/\b(xbox(?: one)?(?!; xbox))[\); ]/i],[d,[m,k],[g,_]],[/smart-tv.+(samsung)/i],[m,[g,I]],[/hbbtv.+maple;(\d+)/i],[[d,/^/,"SmartTV"],[m,Y],[g,I]],[/(nux; netcast.+smarttv|lg (netcast\.tv-201\d|android tv))/i],[[m,O],[g,I]],[/(apple) ?tv/i],[m,[d,U+" TV"],[g,I]],[/crkey/i],[[d,$+"cast"],[m,w],[g,I]],[/droid.+aft(\w)( bui|\))/i],[d,[m,K],[g,I]],[/\(dtv[\);].+(aquos)/i],[d,[m,"Sharp"],[g,I]],[/\b(roku)[\dx]*[\)\/]((?:dvp-)?[\d\.]*)/i,/hbbtv\/\d+\.\d+\.\d+ +\([\w ]*; *(\w[^;]*);([^;]*)/i],[[m,st],[d,st],[g,I]],[/\b(android tv|smart[- ]?tv|opera tv|tv; rv:)\b/i],[[g,I]],[/((pebble))app/i],[m,d,[g,D]],[/droid.+; (glass) \d/i],[d,[m,w],[g,D]],[/droid.+; (wt63?0{2,3})\)/i],[d,[m,Pe],[g,D]],[/(quest( 2)?)/i],[d,[m,De],[g,D]],[/(tesla)(?: qtcarbrowser|\/[-\w\.]+)/i],[m,[g,X]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+? mobile safari/i],[d,[g,C]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+?(?! mobile) safari/i],[d,[g,A]],[/\b((tablet|tab)[;\/]|focus\/\d(?!.+mobile))/i],[[g,A]],[/(phone|mobile(?:[;\/]| safari)|pda(?=.+windows ce))/i],[[g,C]],[/(android[-\w\. ]{0,9});.+buil/i],[d,[m,"Generic"]]],engine:[[/windows.+ edge\/([\w\.]+)/i],[y,[v,R+"HTML"]],[/webkit\/537\.36.+chrome\/(?!27)([\w\.]+)/i],[y,[v,"Blink"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m|goanna)\/([\w\.]+)/i,/ekioh(flow)\/([\w\.]+)/i,/(khtml|tasman|links)[\/ ]\(?([\w\.]+)/i,/(icab)[\/ ]([23]\.[\d\.]+)/i],[v,y],[/rv\:([\w\.]{1,9})\b.+(gecko)/i],[y,v]],os:[[/microsoft (windows) (vista|xp)/i],[v,y],[/(windows) nt 6\.2; (arm)/i,/(windows (?:phone(?: os)?|mobile))[\/ ]?([\d\.\w ]*)/i,/(windows)[\/ ]?([ntce\d\. ]+\w)(?!.+xbox)/i],[v,[y,$t,Rt]],[/(win(?=3|9|n)|win 9x )([nt\d\.]+)/i],[[v,"Windows"],[y,$t,Rt]],[/ip[honead]{2,4}\b(?:.*os ([\w]+) like mac|; opera)/i,/cfnetwork\/.+darwin/i],[[y,/_/g,"."],[v,"iOS"]],[/(mac os x) ?([\w\. ]*)/i,/(macintosh|mac_powerpc\b)(?!.+haiku)/i],[[v,"Mac OS"],[y,/_/g,"."]],[/droid ([\w\.]+)\b.+(android[- ]x86)/i],[y,v],[/(android|webos|qnx|bada|rim tablet os|maemo|meego|sailfish)[-\/ ]?([\w\.]*)/i,/(blackberry)\w*\/([\w\.]*)/i,/(tizen|kaios)[\/ ]([\w\.]+)/i,/\((series40);/i],[v,y],[/\(bb(10);/i],[y,[v,L]],[/(?:symbian ?os|symbos|s60(?=;)|series60)[-\/ ]?([\w\.]*)/i],[y,[v,"Symbian"]],[/mozilla\/[\d\.]+ \((?:mobile|tablet|tv|mobile; [\w ]+); rv:.+ gecko\/([\w\.]+)/i],[y,[v,T+" OS"]],[/web0s;.+rt(tv)/i,/\b(?:hp)?wos(?:browser)?\/([\w\.]+)/i],[y,[v,"webOS"]],[/crkey\/([\d\.]+)/i],[y,[v,$+"cast"]],[/(cros) [\w]+ ([\w\.]+\w)/i],[[v,"Chromium OS"],y],[/(nintendo|playstation) ([wids345portablevuch]+)/i,/(xbox); +xbox ([^\);]+)/i,/\b(joli|palm)\b ?(?:os)?\/?([\w\.]*)/i,/(mint)[\/\(\) ]?(\w*)/i,/(mageia|vectorlinux)[; ]/i,/([kxln]?ubuntu|debian|suse|opensuse|gentoo|arch(?= linux)|slackware|fedora|mandriva|centos|pclinuxos|red ?hat|zenwalk|linpus|raspbian|plan 9|minix|risc os|contiki|deepin|manjaro|elementary os|sabayon|linspire)(?: gnu\/linux)?(?: enterprise)?(?:[- ]linux)?(?:-gnu)?[-\/ ]?(?!chrom|package)([-\w\.]*)/i,/(hurd|linux) ?([\w\.]*)/i,/(gnu) ?([\w\.]*)/i,/\b([-frentopcghs]{0,5}bsd|dragonfly)[\/ ]?(?!amd|[ix346]{1,2}86)([\w\.]*)/i,/(haiku) (\w+)/i],[v,y],[/(sunos) ?([\w\.\d]*)/i],[[v,"Solaris"],y],[/((?:open)?solaris)[-\/ ]?([\w\.]*)/i,/(aix) ((\d)(?=\.|\)| )[\w\.])*/i,/\b(beos|os\/2|amigaos|morphos|openvms|fuchsia|hp-ux)/i,/(unix) ?([\w\.]*)/i],[v,y]]},bt=function(xt,ht){if((typeof xt=="undefined"?"undefined":_typeof$5(xt))===c&&(ht=xt,xt=s),!_instanceof$7(this,bt))return new bt(xt,ht).getResult();var ot=xt||((typeof i=="undefined"?"undefined":_typeof$5(i))!==f&&i.navigator&&i.navigator.userAgent?i.navigator.userAgent:o),mt=ht?tt(Tt,ht):Tt;return this.getBrowser=function(){var nt={};return nt[v]=s,nt[y]=s,at.call(nt,ot,mt.browser),nt.major=Et(nt.version),nt},this.getCPU=function(){var nt={};return nt[b]=s,at.call(nt,ot,mt.cpu),nt},this.getDevice=function(){var nt={};return nt[m]=s,nt[d]=s,nt[g]=s,at.call(nt,ot,mt.device),nt},this.getEngine=function(){var nt={};return nt[v]=s,nt[y]=s,at.call(nt,ot,mt.engine),nt},this.getOS=function(){var nt={};return nt[v]=s,nt[y]=s,at.call(nt,ot,mt.os),nt},this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS(),device:this.getDevice(),cpu:this.getCPU()}},this.getUA=function(){return ot},this.setUA=function(nt){return ot=(typeof nt=="undefined"?"undefined":_typeof$5(nt))===h&&nt.length>W?st(nt,W):nt,this},this.setUA(ot),this};bt.VERSION=a,bt.BROWSER=je([v,y,p]),bt.CPU=je([b]),bt.DEVICE=je([d,m,g,_,C,I,A,D,X]),bt.ENGINE=bt.OS=je([v,y]),n.exports&&(r=n.exports=bt),r.UAParser=bt;var Ot=(typeof i=="undefined"?"undefined":_typeof$5(i))!==f&&(i.jQuery||i.Zepto);if(Ot&&!Ot.ua){var Lt=new bt;Ot.ua=Lt.getResult(),Ot.ua.get=function(){return Lt.getUA()},Ot.ua.set=function(xt){Lt.setUA(xt);var ht=Lt.getResult();for(var ot in ht)Ot.ua[ot]=ht[ot]}}})(typeof window=="object"?window:commonjsGlobal)}(uaParser,uaParser.exports)),uaParser.exports}var chito={exports:{}},core={},animation={},eventemitter={};function _instanceof$6(n,r){return r!=null&&typeof Symbol!="undefined"&&r[Symbol.hasInstance]?!!r[Symbol.hasInstance](n):n instanceof r}var hasRequiredEventemitter;function requireEventemitter(){return hasRequiredEventemitter||(hasRequiredEventemitter=1,function(n){var r=function(u,f){if(!_instanceof$6(u,f))throw new TypeError("Cannot call a class as a function")},i=function(u){for(var f=-1,c=arguments.length<=1?0:arguments.length-1;++f<c;){var h=arguments.length<=f+1?void 0:arguments[f+1];for(var p in h)h.hasOwnProperty(p)&&(u[p]=h[p])}return u};Object.defineProperty(n,"__esModule",{value:!0});var s=function(){var l=function(f,c){for(var h=0;h<c.length;h++){var p=c[h];p.enumerable=p.enumerable||!1,p.configurable=!0,"value"in p&&(p.writable=!0),Object.defineProperty(f,p.key,p)}};return function(u,f,c){return f&&l(u.prototype,f),c&&l(u,c),u}}(),a=-1,o=function(){function l(){r(this,l),this.__events__={},this.__id__=++a}return s(l,[{key:"on",value:function(f,c,h){var p=this.__events__,d=p[f]=p[f]||[];h===this&&(h=void 0);for(var v=-1,g=d;++v<g;){var m=d[v],y=m.fn,b=m.ctx;if(y===c&&b===h)return this}var _={fn:c,ctx:h};return d.push(_),this}},{key:"once",value:function(f,c,h){function p(d){this.off(f,p),c.call(this,d)}return p.listener=c,this.on(f,p,h)}},{key:"off",value:function(f,c,h){var p=this.__events__;if(!f)return this.__events__={},this;if(!c)return delete p[f],this;var d=p[f];if(d)for(var v=d.length;--v>=0;){var g=d[v],m=g.fn,y=g.ctx;y===h&&(m===c||m===m.listener)&&(d.splice(v,1),m=function(){})}return this}},{key:"emit",value:function(f,c){var h=this.__events__[f];if(h)for(var p=i({},c,{target:this,type:f}),d=-1,v=h.length;++d<v;){var g=h[d],m=g.fn,y=g.ctx;m.call(y||this,p)}return this}},{key:"events",get:function(){return this.__events__}},{key:"id",get:function(){return this.__id__}}]),l}();n.default=o}(eventemitter)),eventemitter}var util={},hasRequiredUtil;function requireUtil(){return hasRequiredUtil||(hasRequiredUtil=1,function(n){var r=function(u,f){for(var c=u?f.length:0;c-- >0;){var h=f[c];u.splice(h,1)}return u},i=function(u,f){var c=[];if(!(u&&u.length))return c;if(typeof f=="function"){for(var h=-1,p=[],d=u.length;++h<d;){var v=u[h];f(v,h,u)&&(c.push(v),p.push(h))}r(u,p)}return c},s=function(u,f){for(var c in u)if(u.hasOwnProperty(c)){var h=u[c];f(h,c,u)}};Object.defineProperty(n,"__esModule",{value:!0});var a=function(){var l=function(f,c){var h=[],p=!0,d=!1,v=void 0;try{for(var g=f[Symbol.iterator](),m;!(p=(m=g.next()).done)&&(h.push(m.value),!(c&&h.length===c));p=!0);}catch(y){d=!0,v=y}finally{try{!p&&g.return&&g.return()}finally{if(d)throw v}}return h};return function(u,f){if(Array.isArray(u))return u;if(Symbol.iterator in Object(u))return l(u,f);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}();function o(l){var u=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!Array.isArray(l))return l;var f=u.type,c=f===void 0?"":f,h=u.range,p=h===void 0?[0,1]:h,d=u.min,v=d===void 0?Math.min.apply(Math,l):d,g=u.max,m=g===void 0?Math.max.apply(Math,l):g;c=c.toLowerCase();for(var y=[],b=m-v,_=-1,C=l.length;++_<C;){var A=l[_];A>m&&(A=m),A<v&&(A=v);var I=void 0;c!=="log"?I=(A-v)/b:I=Math.log10(A),y.push(I)}c==="log"&&(y=o(y));var D=a(p,2),X=D[0],W=D[1];if(X!==0||W!==1){for(var K=-1,U=y.length,M=W-X,L=[];++K<U;){var P=y[K],$=M*P+X;L.push($)}y=L}return y}n.default={remove:i,normalize:o,forInMap:s}}(util)),util}var animationframe={},hasRequiredAnimationframe;function requireAnimationframe(){if(hasRequiredAnimationframe)return animationframe;hasRequiredAnimationframe=1,Object.defineProperty(animationframe,"__esModule",{value:!0}),function(){if("performance"in window||(window.performance={}),Date.now=Date.now||function(){return new Date().getTime()},!("now"in window.performance)){var i=window.performance.timing&&window.performance.timing.navigationStart?window.performance.timing.navigationStart:Date.now();window.performance.now=function(){return Date.now()-i}}}();var n=function(){return typeof window!="undefined"&&(window.requestAnimationFrame||window.msRequestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame)||function(i){setTimeout(i,16)}}(),r=function(){return typeof window!="undefined"&&(window.cancelAnimationFrame||window.msCancelAnimationFrame||window.mozCancelAnimationFrame||window.webkitCancelAnimationFrame)||function(i){clearTimeout(i)}}();return animationframe.requestAnimationFrame=n,animationframe.cancelAnimationFrame=r,animationframe}var define={},hasRequiredDefine;function requireDefine(){if(hasRequiredDefine)return define;hasRequiredDefine=1,Object.defineProperty(define,"__esModule",{value:!0});var n={UPDATE:"update",START:"start",REPEAT:"repeat",REPEAT_COMPLETE:"repeatComplete",AFTER_UPDATE:"afterUpdate",COMPLETE:"complete",PAUSE:"pause",STOP:"stop",RESET:"reset"},r={DURATION:"duration",REPEAT:"repeat",DELAY:"delay",EASING:"easing",INTERVAL:"interval",YOYO:"yoyo",START:"startAt"},i={LINEAR:"Linear",QUADRATIC_IN:"QuadraticIn",QUADRATIC_OUT:"QuadraticOut",QUADRATIC_IN_OUT:"QuadraticInOut",CUBIC_IN:"CubicIn",CUBIC_OUT:"CubicOut",CUBIC_IN_OUT:"CubicInOut",QUARTIC_IN:"QuarticIn",QUARTIC_OUT:"QuarticOut",QUARTIC_IN_OUT:"QuarticInOut",QUINTIC_IN:"QuinticIn",QUINTIC_OUT:"QuinticOut",QUINTIC_IN_OUT:"QuinticInOut",SINUSOIDAL_IN:"SinusoidalIn",SINUSOIDAL_OUT:"SinusoidalOut",SINUSOIDAL_IN_OUT:"SinusoidalInOut",EXPONENTIAL_IN:"ExponentialIn",EXPONENTIAL_OUT:"ExponentialOut",EXPONENTIAL_IN_OUT:"ExponentialInOut",CIRCULAR_IN:"CircularIn",CIRCULAR_OUT:"CircularOut",CIRCULAR_IN_OUT:"CircularInOut",ELASTIC_IN:"ElasticIn",ELASTIC_OUT:"ElasticOut",ELASTIC_IN_OUT:"ElasticInOut",BACK_IN:"BackIn",BACK_OUT:"BackOut",BACK_IN_OUT:"BackInOut",BOUNCE_IN:"BounceIn",BOUNCE_OUT:"BounceOut",BOUNCE_IN_OUT:"BounceInOut"};return define.Ev=n,define.Attr=r,define.Easing=i,define}function _instanceof$5(n,r){return r!=null&&typeof Symbol!="undefined"&&r[Symbol.hasInstance]?!!r[Symbol.hasInstance](n):n instanceof r}var _typeof$4=function(n){return n&&typeof Symbol!="undefined"&&n.constructor===Symbol?"symbol":typeof n},hasRequiredAnimation;function requireAnimation(){return hasRequiredAnimation||(hasRequiredAnimation=1,function(n){var r=function(y){return y&&y.__esModule?y:{default:y}},i=function(y,b){if(!_instanceof$5(y,b))throw new TypeError("Cannot call a class as a function")},s=function(y,b){if(!y)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return b&&(typeof b=="object"||typeof b=="function")?b:y},a=function(y,b){if(typeof b!="function"&&b!==null)throw new TypeError("Super expression must either be null or a function, not "+(typeof b=="undefined"?"undefined":_typeof$4(b)));y.prototype=Object.create(b&&b.prototype,{constructor:{value:y,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(y,b):y.__proto__=b)};Object.defineProperty(n,"__esModule",{value:!0});var o=function(){var m=function(b,_){for(var C=0;C<_.length;C++){var A=_[C];A.enumerable=A.enumerable||!1,A.configurable=!0,"value"in A&&(A.writable=!0),Object.defineProperty(b,A.key,A)}};return function(y,b,_){return b&&m(y.prototype,b),_&&m(y,_),y}}(),l=requireEventemitter(),u=r(l),f=requireUtil(),c=r(f),h=requireAnimationframe(),p=requireDefine(),d=c.default.remove,v=c.default.forInMap,g=function(m){a(y,m);function y(b){i(this,y);var _=s(this,(y.__proto__||Object.getPrototypeOf(y)).call(this));return _._options={},_._savedClipMap={},_._clips=[],_._clipMap={},_._options=b||{},_}return o(y,[{key:"_startAni",value:function(){var _=this,C=function A(I){_._timer=(0,h.requestAnimationFrame)(A),_._update(I)};this._timer=(0,h.requestAnimationFrame)(C)}},{key:"_stopAni",value:function(){var _=this._timer;return _?((0,h.cancelAnimationFrame)(_),this._timer=null,!0):!1}},{key:"_update",value:function(_){var C=this._clips;this.emit(p.Ev.UPDATE,{timestamp:_});for(var A=0;A<C.length;){var I=C[A],D=I.update(_);D?A++:this._rmClip(I)}this._clips=C,this.emit(p.Ev.AFTER_UPDATE),C.length===0&&(this._stopAni(),this.emit(p.Ev.COMPLETE))}},{key:"start",value:function(){var _=this._clips,C=_.length;if(this._timer||C===0)return this;this.emit(p.Ev.START);for(var A=-1;++A<C;){var I=_[A];I.start()}return this._startAni(),this}},{key:"stop",value:function(){return this._stop(!1),this}},{key:"pause",value:function(){return this._stop(!0),this}},{key:"reset",value:function(){this._stop(!1,!0,!1);var _=this._savedClipMap,C=[];return v(_,function(A){A.stop(!0),C.push(A)}),this._clips=C,this.emit(p.Ev.RESET),this}},{key:"_stop",value:function(_,C){var A=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0;this._stopAni();var I=this._clips,D=I.length;if(D){for(var X=-1;++X<D;){var W=I[X];_?W.pause():W.stop(C)}A&&this.emit(_?p.Ev.PAUSE:p.Ev.STOP)}}},{key:"addClip",value:function(_){var C=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;Array.isArray(_)||(_=[_]);for(var A=-1,I=_.length;++A<I;){var D=_[A];this._hasSavedClip(D)||(this._addClip(D),this._addSavedClip(D),this._timer&&C&&D.start())}return this}},{key:"_addClip",value:function(_){var C=this._clips;C.indexOf(_)===-1&&(C.push(_),_._animation=this)}},{key:"_addSavedClip",value:function(_){var C=this._savedClipMap,A=_.id;C[A]!==_&&(C[A]=_,_._animation=this)}},{key:"removeClip",value:function(_){var C=this._savedClipMap;return _?(this._rmClip(_),this._rmSavedClip(_),_._animation=null):(v(C,function(A){A._animation=null}),this._clips=[],this._savedClipMap={}),this}},{key:"_rmClip",value:function(_){d(this._clips,function(C){return C===_})}},{key:"_rmSavedClip",value:function(_){this._hasSavedClip(_)&&delete this._savedClipMap[_.id]}},{key:"getClips",value:function(){return this._clips}},{key:"_hasSavedClip",value:function(_){var C=_.id,A=this._savedClipMap,I=A[C];return I&&I===_}},{key:"_hasClip",value:function(_){return this._clips.indexOf(_)!==-1}},{key:"destroy",value:function(){this.off(),this._stopAni(),this.removeClip()}}]),y}(u.default);g.Event=p.Ev,n.default=g}(animation)),animation}var clip={},easing={},hasRequiredEasing;function requireEasing(){return hasRequiredEasing||(hasRequiredEasing=1,function(n){Object.defineProperty(n,"__esModule",{value:!0});var r={Linear:function(s){return s},QuadraticIn:function(s){return s*s},QuadraticOut:function(s){return s*(2-s)},QuadraticInOut:function(s){return(s*=2)<1?.5*s*s:-.5*(--s*(s-2)-1)},CubicIn:function(s){return s*s*s},CubicOut:function(s){return--s*s*s+1},CubicInOut:function(s){return(s*=2)<1?.5*s*s*s:.5*((s-=2)*s*s+2)},QuarticIn:function(s){return s*s*s*s},QuarticOut:function(s){return 1- --s*s*s*s},QuarticInOut:function(s){return(s*=2)<1?.5*s*s*s*s:-.5*((s-=2)*s*s*s-2)},QuinticIn:function(s){return s*s*s*s*s},QuinticOut:function(s){return--s*s*s*s*s+1},QuinticInOut:function(s){return(s*=2)<1?.5*s*s*s*s*s:.5*((s-=2)*s*s*s*s+2)},SinusoidalIn:function(s){return 1-Math.cos(s*Math.PI/2)},SinusoidalOut:function(s){return Math.sin(s*Math.PI/2)},SinusoidalInOut:function(s){return .5*(1-Math.cos(Math.PI*s))},ExponentialIn:function(s){return s===0?0:Math.pow(1024,s-1)},ExponentialOut:function(s){return s===1?1:1-Math.pow(2,-10*s)},ExponentialInOut:function(s){return s===0?0:s===1?1:(s*=2)<1?.5*Math.pow(1024,s-1):.5*(-Math.pow(2,-10*(s-1))+2)},CircularIn:function(s){return 1-Math.sqrt(1-s*s)},CircularOut:function(s){return Math.sqrt(1- --s*s)},CircularInOut:function(s){return(s*=2)<1?-.5*(Math.sqrt(1-s*s)-1):.5*(Math.sqrt(1-(s-=2)*s)+1)},ElasticIn:function(s){var a,o=.1,l=.4;return s===0?0:s===1?1:(!o||o<1?(o=1,a=l/4):a=l*Math.asin(1/o)/(2*Math.PI),-(o*Math.pow(2,10*(s-=1))*Math.sin((s-a)*(2*Math.PI)/l)))},ElasticOut:function(s){var a,o=.1,l=.4;return s===0?0:s===1?1:(!o||o<1?(o=1,a=l/4):a=l*Math.asin(1/o)/(2*Math.PI),o*Math.pow(2,-10*s)*Math.sin((s-a)*(2*Math.PI)/l)+1)},ElasticInOut:function(s){var a,o=.1,l=.4;return s===0?0:s===1?1:(!o||o<1?(o=1,a=l/4):a=l*Math.asin(1/o)/(2*Math.PI),(s*=2)<1?-.5*(o*Math.pow(2,10*(s-=1))*Math.sin((s-a)*(2*Math.PI)/l)):o*Math.pow(2,-10*(s-=1))*Math.sin((s-a)*(2*Math.PI)/l)*.5+1)},BackIn:function(s){var a=1.70158;return s*s*((a+1)*s-a)},BackOut:function(s){var a=1.70158;return--s*s*((a+1)*s+a)+1},BackInOut:function(s){var a=2.5949095;return(s*=2)<1?.5*(s*s*((a+1)*s-a)):.5*((s-=2)*s*((a+1)*s+a)+2)},BounceIn:function(s){return 1-r.BounceOut(1-s)},BounceOut:function(s){return s<1/2.75?7.5625*s*s:s<2/2.75?7.5625*(s-=1.5/2.75)*s+.75:s<2.5/2.75?7.5625*(s-=2.25/2.75)*s+.9375:7.5625*(s-=2.625/2.75)*s+.984375},BounceInOut:function(s){return s<.5?r.BounceIn(s*2)*.5:r.BounceOut(s*2-1)*.5+.5}};n.default=r}(easing)),easing}var Interpolation={},hasRequiredInterpolation;function requireInterpolation(){return hasRequiredInterpolation||(hasRequiredInterpolation=1,function(n){Object.defineProperty(n,"__esModule",{value:!0});var r={Linear:function(s,a){var o=s.length-1,l=o*a,u=Math.floor(l),f=r.Utils.Linear;return a<0?f(s[0],s[1],l):a>1?f(s[o],s[o-1],o-l):f(s[u],s[u+1>o?o:u+1],l-u)},Bezier:function(s,a){for(var o=0,l=s.length-1,u=Math.pow,f=r.Utils.Bernstein,c=0;c<=l;c++)o+=u(1-a,l-c)*u(a,c)*s[c]*f(l,c);return o},CatmullRom:function(s,a){var o=s.length-1,l=o*a,u=Math.floor(l),f=r.Utils.CatmullRom;return s[0]===s[o]?(a<0&&(u=Math.floor(l=o*(1+a))),f(s[(u-1+o)%o],s[u],s[(u+1)%o],s[(u+2)%o],l-u)):a<0?s[0]-(f(s[0],s[0],s[1],s[1],-l)-s[0]):a>1?s[o]-(f(s[o],s[o],s[o-1],s[o-1],l-o)-s[o]):f(s[u?u-1:0],s[u],s[o<u+1?o:u+1],s[o<u+2?o:u+2],l-u)},Utils:{Linear:function(s,a,o){return(a-s)*o+s},Bernstein:function(s,a){var o=r.Utils.Factorial;return o(s)/o(a)/o(s-a)},Factorial:function(){var i=[1];return function(s){var a=1;if(i[s])return i[s];for(var o=s;o>1;o--)a*=o;return i[s]=a,a}}(),CatmullRom:function(s,a,o,l,u){var f=(o-s)*.5,c=(l-a)*.5,h=u*u,p=u*h;return(2*a-2*o+f+c)*p+(-3*a+3*o-2*f-c)*h+f*u+a}}};n.default=r}(Interpolation)),Interpolation}function _instanceof$4(n,r){return r!=null&&typeof Symbol!="undefined"&&r[Symbol.hasInstance]?!!r[Symbol.hasInstance](n):n instanceof r}var _typeof$3=function(n){return n&&typeof Symbol!="undefined"&&n.constructor===Symbol?"symbol":typeof n},hasRequiredClip;function requireClip(){return hasRequiredClip||(hasRequiredClip=1,function(n){var r=function(m){return m&&m.__esModule?m:{default:m}},i=function(m,y){if(!_instanceof$4(m,y))throw new TypeError("Cannot call a class as a function")},s=function(m,y){if(!m)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return y&&(typeof y=="object"||typeof y=="function")?y:m},a=function(m,y){if(typeof y!="function"&&y!==null)throw new TypeError("Super expression must either be null or a function, not "+(typeof y=="undefined"?"undefined":_typeof$3(y)));m.prototype=Object.create(y&&y.prototype,{constructor:{value:m,enumerable:!1,writable:!0,configurable:!0}}),y&&(Object.setPrototypeOf?Object.setPrototypeOf(m,y):m.__proto__=y)};Object.defineProperty(n,"__esModule",{value:!0});var o=function(){var g=function(y,b){for(var _=0;_<b.length;_++){var C=b[_];C.enumerable=C.enumerable||!1,C.configurable=!0,"value"in C&&(C.writable=!0),Object.defineProperty(y,C.key,C)}};return function(m,y,b){return y&&g(m.prototype,y),b&&g(m,b),m}}(),l=requireEventemitter(),u=r(l),f=requireEasing(),c=r(f),h=requireInterpolation(),p=r(h),d=requireDefine(),v=function(g){a(m,g),o(m,null,[{key:"registerPlugin",value:function(b){var _=b.type,C=this._plugins,A=C&&C[_];A||(this._plugins=C||{},this._plugins[_]=b)}}]);function m(y,b){i(this,m);var _=s(this,(m.__proto__||Object.getPrototypeOf(m)).call(this));return _._options={},_._attr={},_._startAt=0,_._stopped=!0,_._paused=!1,_._startTime=0,_._pauseStart=0,_._pauseTime=0,_._reversed=!1,_._chainClips=[],_._tracks=[],_._interpolation=p.default.Linear,_._options=y||{},_._attr=b,_._initOption(y),_._tracks=_._transform(b),_}return o(m,[{key:"_initOption",value:function(b){var _=b[d.Attr.EASING]||d.Easing.LINEAR;this._easing=c.default[_]?c.default[_]:_,this._delay=b[d.Attr.DELAY]||0;var C=b[d.Attr.DURATION];this._duration=typeof C=="undefined"?1e3:C,this._repeat_0=this._repeat=b[d.Attr.REPEAT]||1,this._interval=b[d.Attr.INTERVAL]||0,this._yoyo=b[d.Attr.YOYO]||!1,this._startAt=b[d.Attr.START]||0}},{key:"_transform",value:function(b){var _=this.constructor._plugins,C=[];for(var A in b)if(b.hasOwnProperty(A)){var I=b[A];for(var D in _){var X=_[D];if(X.test(I,A)){I=X.parse(I,A),I.__type__=X.type;break}}C.push({key:A,value:I})}return C}},{key:"start",value:function(b){var _=window.performance.now(),C=!1;if(this._paused)this._pauseTime+=_-this._pauseStart,this._paused=!1;else{if(!b&&!this._stopped)return this;C=!0,this._stopped=!1,this._startTime=_+this._delay}this.emit(d.Ev.START);var A=this._repeat;return A>1&&A===this._repeat_0&&C&&this.emit(d.Ev.REPEAT,{remain:0}),this}},{key:"stop",value:function(b){return this._stopped||(this._stopped=!0,this._paused=!1,this._pauseTime=0,this._pauseStart=0,this.emit(d.Ev.STOP),this.stopChain()),b&&(this._repeat=this._repeat_0),this}},{key:"pause",value:function(){return this._stopped||this._paused?this:(this._paused=!0,this._pauseStart=window.performance.now(),this.emit(d.Ev.PAUSE),this)}},{key:"update",value:function(b){if(this._stopped||this._paused||b&&b<this._startTime)return!0;var _=b-this._pauseTime,C=this._getProgress(_),A=C.progress,I=C.elapsed,D=this._updateAttr(A,I);return this.emit(d.Ev.UPDATE,{progress:A,keyframe:D,elapsed:I}),this._afterUpdate(_,I)}},{key:"_getProgress",value:function(b){var _=(b-this._startTime)/this._duration;_+=this._startAt,_=Math.min(_,1);var C=this._easing(this._reversed?1-_:_);return{progress:C,elapsed:_}}},{key:"_updateAttr",value:function(b,_){for(var C=this._tracks,A={},I=0,D=C.length;I<D;){var X=C[I++],W=X.key,K=X.value,U=K.__type__;if(U){var M=this.constructor._plugins[U];K=M.valueOf(K,b,_,W)}else K=this._interpolation(K,b);A[W]=K}return A}},{key:"_afterUpdate",value:function(b,_){if(_===1){var C=this._repeat,A=this._repeat_0;if(C>1)return isFinite(C)&&C--,this._startTime=b+this._interval,this._startAt=0,this._yoyo&&(this._reversed=!this._reversed),this._repeat=C,this.emit(d.Ev.REPEAT_COMPLETE,{repeat:C}),this.emit(d.Ev.REPEAT,{remain:A-C}),!0;this._stopped=!0,this._pauseTime=0,this._pauseStart=0,this._repeat=A,A>1&&this.emit(d.Ev.REPEAT_COMPLETE,{repeat:0}),this.emit(d.Ev.COMPLETE);for(var I=-1,D=this._chainClips,X=D.length,W=this._animation;++I<X;){var K=D[I];W&&W._addClip(K),K.start()}return!1}return!0}},{key:"chain",value:function(){for(var b=arguments.length,_=Array(b),C=0;C<b;C++)_[C]=arguments[C];return this._chainClips=_,this}},{key:"stopChain",value:function(){for(var b=-1,_=this._chainClips,C=_.length;++b<C;){var A=_[b];A.stop()}return this}},{key:"destroy",value:function(){this.off(),this._stopped=!0,this._paused=!1,this._startTime=0,this._pauseTime=0,this._pauseStart=0,this._chainClips=[];var b=this._animation;b&&b.removeClip(this),this._animation=null}}]),m}(u.default);v.Event=d.Ev,v.Attr=d.Attr,v.Easing=d.Easing,n.default=v}(clip)),clip}var hasRequiredCore;function requireCore(){return hasRequiredCore||(hasRequiredCore=1,function(n){var r=function(u){return u&&u.__esModule?u:{default:u}};Object.defineProperty(n,"__esModule",{value:!0}),n.Clip=n.Animation=void 0;var i=requireAnimation(),s=r(i),a=requireClip(),o=r(a);n.default={Animation:s.default,Clip:o.default},n.Animation=s.default,n.Clip=o.default}(core)),core}var color$2={},color$1={},colorhelper={},csscolorparser={},hasRequiredCsscolorparser;function requireCsscolorparser(){var n=function(f){return f=Math.round(f),f<0?0:f>255?255:f},r=function(f){return f<0?0:f>1?1:f},i=function(f){return f[f.length-1]==="%"?n(parseFloat(f)/100*255):n(parseInt(f))},s=function(f){return f[f.length-1]==="%"?r(parseFloat(f)/100):r(parseFloat(f))},a=function(f,c,h){return h<0?h+=1:h>1&&(h-=1),h*6<1?f+(c-f)*h*6:h*2<1?c:h*3<2?f+(c-f)*(.6666666666666666-h)*6:f},o=function(f){var c=f.replace(/ /g,"").toLowerCase();if(c in l)return l[c].slice();if(c[0]==="#"){if(c.length===4){var h=parseInt(c.substr(1),16);return h>=0&&h<=4095?[(h&3840)>>4|(h&3840)>>8,h&240|(h&240)>>4,h&15|(h&15)<<4,1]:null}else if(c.length===7){var h=parseInt(c.substr(1),16);return h>=0&&h<=16777215?[(h&16711680)>>16,(h&65280)>>8,h&255,1]:null}return null}var p=c.indexOf("("),d=c.indexOf(")");if(p!==-1&&d+1===c.length){var v=c.substr(0,p),g=c.substr(p+1,d-(p+1)).split(","),m=1;switch(v){case"rgba":if(g.length!==4)return null;m=s(g.pop());case"rgb":return g.length!==3?null:[i(g[0]),i(g[1]),i(g[2]),m];case"hsla":if(g.length!==4)return null;m=s(g.pop());case"hsl":if(g.length!==3)return null;var y=(parseFloat(g[0])%360+360)%360/360,b=s(g[1]),_=s(g[2]),C=_<=.5?_*(b+1):_+b-_*b,A=_*2-C;return[n(a(A,C,y+.3333333333333333)*255),n(a(A,C,y)*255),n(a(A,C,y-.3333333333333333)*255),m];default:return null}}return null};if(hasRequiredCsscolorparser)return csscolorparser;hasRequiredCsscolorparser=1;var l={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};try{csscolorparser.parseCSSColor=o}catch(u){}return csscolorparser}var hasRequiredColorhelper;function requireColorhelper(){return hasRequiredColorhelper||(hasRequiredColorhelper=1,function(n){var r=function(h){return h&&h.__esModule?h:{default:h}},i=function(h){return h=Math.round(h),h<0?0:h>255?255:h},s=function(h){return h<0?0:h>1?1:h};Object.defineProperty(n,"__esModule",{value:!0});var a=function(){var c=function(p,d){var v=[],g=!0,m=!1,y=void 0;try{for(var b=p[Symbol.iterator](),_;!(g=(_=b.next()).done)&&(v.push(_.value),!(d&&v.length===d));g=!0);}catch(C){m=!0,y=C}finally{try{!g&&b.return&&b.return()}finally{if(m)throw y}}return v};return function(h,p){if(Array.isArray(h))return h;if(Symbol.iterator in Object(h))return c(h,p);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),o=requireCsscolorparser(),l=r(o),u=l.default.parseCSSColor,f={isColor:function(h){if(typeof h=="string")return!!(0,l.default)(h);if(Array.isArray(h)){for(var p=0,d=h.length;p<d;){var v=h[p++];if(typeof v=="string"){if(!u(v))return!1}else return!1}return!0}return!1},toColorIncrease:function(h){return[h[0]||0,h[1]||0,h[2]||0,h[3]||0]},toNormal:function(h){if(Array.isArray(h)){for(var p=[],d=0,v=h.length;d<v;){var g=h[d++];if(typeof g=="string"){var m=u(g);if(m)p.push(m);else return null}else return null}return p}else return typeof h=="string"?u(h):null},toNormalArray:function(h){if(Array.isArray(h)){for(var p=[],d=0,v=h.length;d<v;){var g=h[d++];if(typeof g=="string"){var m=u(g);if(m)p.push(m);else return null}else return null}return p}else return typeof h=="string"?[u(h)]:null},linearGradient:function(h){var p=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,d=arguments.length>2&&arguments[2]!==void 0?arguments[2]:f.Utils.Linear,v=h.length-1,g=v*p,m=g>>0,y=d,b=function(D,X,W){var K=a(D,4),U=K[0],M=K[1],L=K[2],P=K[3],$=a(X,4),R=$[0],T=$[1],w=$[2],E=$[3],O=[y(U,R,W)>>0,y(M,T,W)>>0,y(L,w,W)>>0,y(P,E,W)];return O},_=h[m],C=h[m+1>v?v:m+1],A=g-m;return b(_,C,A)},mixColors:function(h,p){var d=this.toNormal(h);if(Array.isArray(p)&&d){var v=[i(d[0]+p[0]||0),i(d[1]+p[1]||0),i(d[2]+p[2]||0),s(d[3]+p[3]||0)],g=v[0],m=v[1],y=v[2],b=v[3],_=[g,m,y,b].join(",");return"rgba("+_+")"}else return h},toRGBA:function(h){if(h&&h.length>=3){var p=typeof h[3]=="undefined"?1:h[3],d=i(h[0]),v=i(h[1]),g=i(h[2]),m=s(p);return"rgba("+d+","+v+","+g+","+m+")"}else return"transparent"},Utils:{Linear:function(h,p,d){return(p-h)*d+h}}};n.default=f}(colorhelper)),colorhelper}var hasRequiredColor$1;function requireColor$1(){return hasRequiredColor$1||(hasRequiredColor$1=1,function(n){var r=function(f){return f&&f.__esModule?f:{default:f}};Object.defineProperty(n,"__esModule",{value:!0});var i=requireClip(),s=r(i),a=requireColorhelper(),o=r(a),l={type:"color",test:function(f,c){return o.default.isColor(f)},parse:function(f,c){return o.default.toNormalArray(f)},valueOf:function(f,c,h,p){var d=o.default.linearGradient(f,c);return d=o.default.toRGBA(d),d}};s.default.registerPlugin(l),n.default=l}(color$1)),color$1}var hasRequiredColor;function requireColor(){return hasRequiredColor||(hasRequiredColor=1,requireColor$1()),color$2}var coordinate2d$1={},coordinate2d={},vector={},hasRequiredVector;function requireVector(){return hasRequiredVector||(hasRequiredVector=1,function(n){Object.defineProperty(n,"__esModule",{value:!0});var r=typeof Float32Array=="undefined"?Array:Float32Array,i={create:function(){var a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,l=new r(2);return l[0]=a,l[1]=o,l},copy:function(a,o){return a[0]=o[0],a[1]=o[1],a},clone:function(a){var o=new r(2);return o[0]=a[0],o[1]=a[1],o},set:function(a,o,l){return a[0]=o,a[1]=l,a},add:function(a,o,l){return a[0]=o[0]+l[0],a[1]=o[1]+l[1],a},scaleAndAdd:function(a,o,l,u){return a[0]=o[0]+l[0]*u,a[1]=o[1]+l[1]*u,a},sub:function(a,o,l){return a[0]=o[0]-l[0],a[1]=o[1]-l[1],a},length:function(a){return Math.sqrt(this.lengthSquare(a))},lengthSquare:function(a){return a[0]*a[0]+a[1]*a[1]},multiply:function(a,o,l){return a[0]=o[0]*l[0],a[1]=o[1]*l[1],a},divide:function(a,o,l){return a[0]=o[0]/l[0],a[1]=o[1]/l[1],a},dot:function(a,o){return a[0]*o[0]+a[1]*o[1]},scale:function(a,o,l){return a[0]=o[0]*l,a[1]=o[1]*l,a},normalize:function(a,o){var l=this.len(o);return l===0?(a[0]=0,a[1]=0):(a[0]=o[0]/l,a[1]=o[1]/l),a},distance:function(a,o){return Math.sqrt(this.distanceSquare(a,o))},distanceSquare:function(a,o){return(a[0]-o[0])*(a[0]-o[0])+(a[1]-o[1])*(a[1]-o[1])},negate:function(a,o){return a[0]=-o[0],a[1]=-o[1],a},lerp:function(a,o,l,u){return a[0]=o[0]+u*(l[0]-o[0]),a[1]=o[1]+u*(l[1]-o[1]),a},applyTransform:function(a,o,l){var u=o[0],f=o[1];return a[0]=l[0]*u+l[2]*f+l[4],a[1]=l[1]*u+l[3]*f+l[5],a},min:function(a,o,l){return a[0]=Math.min(o[0],l[0]),a[1]=Math.min(o[1],l[1]),a},max:function(a,o,l){return a[0]=Math.max(o[0],l[0]),a[1]=Math.max(o[1],l[1]),a},getAngle:function(a,o){var l=0,u=a[0]-o[0];return u!=0&&(l=Math.atan2(a[1]-o[1],a[0]-o[0])),l}};i.len=i.length,i.lenSquare=i.lengthSquare,i.dist=i.distance,i.distSquare=i.distanceSquare,n.default=i}(vector)),vector}var hasRequiredCoordinate2d$1;function requireCoordinate2d$1(){return hasRequiredCoordinate2d$1||(hasRequiredCoordinate2d$1=1,function(n){var r=function(h){return h&&h.__esModule?h:{default:h}},i=function(h){for(var p=0,d=h.length,v=0,g=[],m=[],y=0;p<d-1;){var b=h[p],_=h[p+1],C=u.default.distance(b,_);v+=C,y=u.default.getAngle(_,b),g.push(b),m.push({length:v,segmentLength:C,segment:[b.slice(),_.slice()],path:g.slice(),angle:y}),p++}return m.sum=v,m};Object.defineProperty(n,"__esModule",{value:!0});var s=function(){var c=function(p,d){var v=[],g=!0,m=!1,y=void 0;try{for(var b=p[Symbol.iterator](),_;!(g=(_=b.next()).done)&&(v.push(_.value),!(d&&v.length===d));g=!0);}catch(C){m=!0,y=C}finally{try{!g&&b.return&&b.return()}finally{if(m)throw y}}return v};return function(h,p){if(Array.isArray(h))return h;if(Symbol.iterator in Object(h))return c(h,p);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),a=requireClip(),o=r(a),l=requireVector(),u=r(l),f={type:"coordinate-2d",test:function(h,p){var d=!1;if(Array.isArray(h))for(var v=-1,g=h.length;++v<g;){var m=h[v];if(Array.isArray(m)){var y=s(m,2),b=y[0],_=y[1],C=[+b,+_];b=C[0],_=C[1],d=typeof b=="number"&&typeof _=="number"&&isFinite(b)&&isFinite(_)}}return d},parse:function(h,p){for(var d=[],v=-1,g=h.length;++v<g;){var m=h[v],y=s(m,2),b=y[0],_=y[1],C=[+b,+_];b=C[0],_=C[1],d.push([b,_])}var A=i(d);return A},valueOf:function(h,p,d,v){for(var g=h.sum,m=g*p,y=-1,b=h.length,_=h[0];++y<b;){var C=h[y];if(m<=C.length){_=C;break}}var A=s(_.segment,2),I=A[0],D=A[1],X=0;y==0?X=m:X=m-h[y-1].length;var W=X/_.segmentLength,K=u.default.create(),U=u.default.create();return u.default.sub(K,D,I),u.default.scaleAndAdd(U,I,K,W),U.step=_,U}};o.default.registerPlugin(f),n.default=f}(coordinate2d)),coordinate2d}var hasRequiredCoordinate2d;function requireCoordinate2d(){return hasRequiredCoordinate2d||(hasRequiredCoordinate2d=1,requireCoordinate2d$1()),coordinate2d$1}var hasRequiredChito;function requireChito(){return hasRequiredChito||(hasRequiredChito=1,function(n){var r=requireCore(),i=r.Animation,s=r.Clip;requireColor(),requireCoordinate2d(),n.exports.default={Animation:i,Clip:s},n.exports.Animation=i,n.exports.Clip=s}(chito)),chito.exports}var bezier$1={};function _arrayLikeToArray$1(n,r){(r==null||r>n.length)&&(r=n.length);for(var i=0,s=new Array(r);i<r;i++)s[i]=n[i];return s}function _arrayWithoutHoles$1(n){if(Array.isArray(n))return _arrayLikeToArray$1(n)}function _classCallCheck$1(n,r){if(!(n instanceof r))throw new TypeError("Cannot call a class as a function")}function _defineProperties$1(n,r){for(var i=0;i<r.length;i++){var s=r[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(n,s.key,s)}}function _createClass$1(n,r,i){return r&&_defineProperties$1(n.prototype,r),i&&_defineProperties$1(n,i),n}function _instanceof$3(n,r){return r!=null&&typeof Symbol!="undefined"&&r[Symbol.hasInstance]?!!r[Symbol.hasInstance](n):n instanceof r}function _iterableToArray$1(n){if(typeof Symbol!="undefined"&&n[Symbol.iterator]!=null||n["@@iterator"]!=null)return Array.from(n)}function _nonIterableSpread$1(){throw new TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _toConsumableArray$1(n){return _arrayWithoutHoles$1(n)||_iterableToArray$1(n)||_unsupportedIterableToArray$1(n)||_nonIterableSpread$1()}function _unsupportedIterableToArray$1(n,r){if(!!n){if(typeof n=="string")return _arrayLikeToArray$1(n,r);var i=Object.prototype.toString.call(n).slice(8,-1);if(i==="Object"&&n.constructor&&(i=n.constructor.name),i==="Map"||i==="Set")return Array.from(i);if(i==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return _arrayLikeToArray$1(n,r)}}var hasRequiredBezier;function requireBezier(){var n=function(M){return M<0?-u(-M,.3333333333333333):u(M,.3333333333333333)};if(hasRequiredBezier)return bezier$1;hasRequiredBezier=1,Object.defineProperty(bezier$1,"__esModule",{value:!0}),bezier$1.Bezier=void 0;var r=Math.abs,i=Math.cos,s=Math.sin,a=Math.acos,o=Math.atan2,l=Math.sqrt,u=Math.pow,f=Math.PI,c=2*f,h=f/2,p=1e-6,d=Number.MAX_SAFE_INTEGER||9007199254740991,v=Number.MIN_SAFE_INTEGER||-9007199254740991,g={x:0,y:0,z:0},m={Tvalues:[-.06405689286260563,.06405689286260563,-.1911188674736163,.1911188674736163,-.3150426796961634,.3150426796961634,-.4337935076260451,.4337935076260451,-.5454214713888396,.5454214713888396,-.6480936519369755,.6480936519369755,-.7401241915785544,.7401241915785544,-.820001985973903,.820001985973903,-.8864155270044011,.8864155270044011,-.9382745520027328,.9382745520027328,-.9747285559713095,.9747285559713095,-.9951872199970213,.9951872199970213],Cvalues:[.12793819534675216,.12793819534675216,.1258374563468283,.1258374563468283,.12167047292780339,.12167047292780339,.1155056680537256,.1155056680537256,.10744427011596563,.10744427011596563,.09761865210411388,.09761865210411388,.08619016153195327,.08619016153195327,.0733464814110803,.0733464814110803,.05929858491543678,.05929858491543678,.04427743881741981,.04427743881741981,.028531388628933663,.028531388628933663,.0123412297999872,.0123412297999872],arcfn:function(M,L){var P=L(M),$=P.x*P.x+P.y*P.y;return typeof P.z!="undefined"&&($+=P.z*P.z),l($)},compute:function(M,L,P){if(M===0)return L[0].t=0,L[0];var $=L.length-1;if(M===1)return L[$].t=1,L[$];var R=1-M,T=L;if($===0)return L[0].t=M,L[0];if($===1){var w={x:R*T[0].x+M*T[1].x,y:R*T[0].y+M*T[1].y,t:M};return P&&(w.z=R*T[0].z+M*T[1].z),w}if($<4){var E=R*R,O=M*M,k,F,q,Y=0;$===2?(T=[T[0],T[1],T[2],g],k=E,F=R*M*2,q=O):$===3&&(k=E*R,F=E*M*3,q=R*O*3,Y=M*O);var fe={x:k*T[0].x+F*T[1].x+q*T[2].x+Y*T[3].x,y:k*T[0].y+F*T[1].y+q*T[2].y+Y*T[3].y,t:M};return P&&(fe.z=k*T[0].z+F*T[1].z+q*T[2].z+Y*T[3].z),fe}for(var _e=JSON.parse(JSON.stringify(L));_e.length>1;){for(var Pe=0;Pe<_e.length-1;Pe++)_e[Pe]={x:_e[Pe].x+(_e[Pe+1].x-_e[Pe].x)*M,y:_e[Pe].y+(_e[Pe+1].y-_e[Pe].y)*M},typeof _e[Pe].z!="undefined"&&(_e[Pe]=_e[Pe].z+(_e[Pe+1].z-_e[Pe].z)*M);_e.splice(_e.length-1,1)}return _e[0].t=M,_e[0]},computeWithRatios:function(M,L,P,$){var R=1-M,T=P,w=L,E=T[0],O=T[1],k=T[2],F=T[3],q;if(E*=R,O*=M,w.length===2)return q=E+O,{x:(E*w[0].x+O*w[1].x)/q,y:(E*w[0].y+O*w[1].y)/q,z:$?(E*w[0].z+O*w[1].z)/q:!1,t:M};if(E*=R,O*=2*R,k*=M*M,w.length===3)return q=E+O+k,{x:(E*w[0].x+O*w[1].x+k*w[2].x)/q,y:(E*w[0].y+O*w[1].y+k*w[2].y)/q,z:$?(E*w[0].z+O*w[1].z+k*w[2].z)/q:!1,t:M};if(E*=R,O*=1.5*R,k*=3*R,F*=M*M*M,w.length===4)return q=E+O+k+F,{x:(E*w[0].x+O*w[1].x+k*w[2].x+F*w[3].x)/q,y:(E*w[0].y+O*w[1].y+k*w[2].y+F*w[3].y)/q,z:$?(E*w[0].z+O*w[1].z+k*w[2].z+F*w[3].z)/q:!1,t:M}},derive:function(M,L){for(var P=[],$=M,R=$.length,T=R-1;R>1;R--,T--){for(var w=[],E=0,O=void 0;E<T;E++)O={x:T*($[E+1].x-$[E].x),y:T*($[E+1].y-$[E].y)},L&&(O.z=T*($[E+1].z-$[E].z)),w.push(O);P.push(w),$=w}return P},between:function(M,L,P){return L<=M&&M<=P||m.approximately(M,L)||m.approximately(M,P)},approximately:function(M,L,P){return r(M-L)<=(P||p)},length:function(M){for(var L=.5,P=m.Tvalues.length,$=0,R=0,T;R<P;R++)T=L*m.Tvalues[R]+L,$+=m.Cvalues[R]*m.arcfn(T,M);return L*$},map:function(M,L,P,$,R){var T=P-L,w=R-$,E=M-L,O=E/T;return $+w*O},lerp:function(M,L,P){var $={x:L.x+M*(P.x-L.x),y:L.y+M*(P.y-L.y)};return!!L.z&&!!P.z&&($.z=L.z+M*(P.z-L.z)),$},pointToString:function(M){var L=M.x+"/"+M.y;return typeof M.z!="undefined"&&(L+="/"+M.z),L},pointsToString:function(M){return"["+M.map(m.pointToString).join(", ")+"]"},copy:function(M){return JSON.parse(JSON.stringify(M))},angle:function(M,L,P){var $=L.x-M.x,R=L.y-M.y,T=P.x-M.x,w=P.y-M.y,E=$*w-R*T,O=$*T+R*w;return o(E,O)},round:function(M,L){var P=""+M,$=P.indexOf(".");return parseFloat(P.substring(0,$+1+L))},dist:function(M,L){var P=M.x-L.x,$=M.y-L.y;return l(P*P+$*$)},closest:function(M,L){var P=u(2,63),$,R;return M.forEach(function(T,w){R=m.dist(L,T),R<P&&(P=R,$=w)}),{mdist:P,mpos:$}},abcratio:function(M,L){if(L!==2&&L!==3)return!1;if(typeof M=="undefined")M=.5;else if(M===0||M===1)return M;var P=u(M,L)+u(1-M,L),$=P-1;return r($/P)},projectionratio:function(M,L){if(L!==2&&L!==3)return!1;if(typeof M=="undefined")M=.5;else if(M===0||M===1)return M;var P=u(1-M,L),$=u(M,L)+P;return P/$},lli8:function(M,L,P,$,R,T,w,E){var O=(M*$-L*P)*(R-w)-(M-P)*(R*E-T*w),k=(M*$-L*P)*(T-E)-(L-$)*(R*E-T*w),F=(M-P)*(T-E)-(L-$)*(R-w);return F==0?!1:{x:O/F,y:k/F}},lli4:function(M,L,P,$){var R=M.x,T=M.y,w=L.x,E=L.y,O=P.x,k=P.y,F=$.x,q=$.y;return m.lli8(R,T,w,E,O,k,F,q)},lli:function(M,L){return m.lli4(M,M.c,L,L.c)},makeline:function(M,L){var P=M.x,$=M.y,R=L.x,T=L.y,w=(R-P)/3,E=(T-$)/3;return new K(P,$,P+w,$+E,P+2*w,$+2*E,R,T)},findbbox:function(M){var L=d,P=d,$=v,R=v;return M.forEach(function(T){var w=T.bbox();L>w.x.min&&(L=w.x.min),P>w.y.min&&(P=w.y.min),$<w.x.max&&($=w.x.max),R<w.y.max&&(R=w.y.max)}),{x:{min:L,mid:(L+$)/2,max:$,size:$-L},y:{min:P,mid:(P+R)/2,max:R,size:R-P}}},shapeintersections:function(M,L,P,$,R){if(!m.bboxoverlap(L,$))return[];var T=[],w=[M.startcap,M.forward,M.back,M.endcap],E=[P.startcap,P.forward,P.back,P.endcap];return w.forEach(function(O){O.virtual||E.forEach(function(k){if(!k.virtual){var F=O.intersects(k,R);F.length>0&&(F.c1=O,F.c2=k,F.s1=M,F.s2=P,T.push(F))}})}),T},makeshape:function(M,L,P){var $=L.points.length,R=M.points.length,T=m.makeline(L.points[$-1],M.points[0]),w=m.makeline(M.points[R-1],L.points[0]),E={startcap:T,forward:M,back:L,endcap:w,bbox:m.findbbox([T,M,L,w])};return E.intersections=function(O){return m.shapeintersections(E,E.bbox,O,O.bbox,P)},E},getminmax:function(M,L,P){if(!P)return{min:0,max:0};var $=d,R=v,T,w;P.indexOf(0)===-1&&(P=[0].concat(P)),P.indexOf(1)===-1&&P.push(1);for(var E=0,O=P.length;E<O;E++)T=P[E],w=M.get(T),w[L]<$&&($=w[L]),w[L]>R&&(R=w[L]);return{min:$,mid:($+R)/2,max:R,size:R-$}},align:function(M,L){var P=L.p1.x,$=L.p1.y,R=-o(L.p2.y-$,L.p2.x-P),T=function(E){return{x:(E.x-P)*i(R)-(E.y-$)*s(R),y:(E.x-P)*s(R)+(E.y-$)*i(R)}};return M.map(T)},roots:function(M,L){L=L||{p1:{x:0,y:0},p2:{x:1,y:0}};var P=M.length-1,$=m.align(M,L),R=function(Vt){return 0<=Vt&&Vt<=1};if(P===2){var T=$[0].y,w=$[1].y,E=$[2].y,O=T-2*w+E;if(O!==0){var k=-l(w*w-T*E),F=-T+w,q=-(k+F)/O,Y=-(-k+F)/O;return[q,Y].filter(R)}else if(w!==E&&O===0)return[(2*w-E)/(2*w-2*E)].filter(R);return[]}var fe=$[0].y,_e=$[1].y,Pe=$[2].y,De=$[3].y,tt=-fe+3*_e-3*Pe+De,je=3*fe-6*_e+3*Pe,Fe=-3*fe+3*_e,Ge=fe;if(m.approximately(tt,0)){if(m.approximately(je,0))return m.approximately(Fe,0)?[]:[-Ge/Fe].filter(R);var Et=l(Fe*Fe-4*je*Ge),st=2*je;return[(Et-Fe)/st,(-Fe-Et)/st].filter(R)}je/=tt,Fe/=tt,Ge/=tt;var at=(3*Fe-je*je)/3,$t=at/3,kt=(2*je*je*je-9*je*Fe+27*Ge)/27,Rt=kt/2,Tt=Rt*Rt+$t*$t*$t,bt,Ot,Lt,xt,ht;if(Tt<0){var ot=-at/3,mt=ot*ot*ot,nt=l(mt),Ut=-kt/(2*nt),Dt=Ut<-1?-1:Ut>1?1:Ut,ft=a(Dt),Ct=n(nt),St=2*Ct;return Lt=St*i(ft/3)-je/3,xt=St*i((ft+c)/3)-je/3,ht=St*i((ft+2*c)/3)-je/3,[Lt,xt,ht].filter(R)}else{if(Tt===0)return bt=Rt<0?n(-Rt):-n(Rt),Lt=2*bt-je/3,xt=-bt-je/3,[Lt,xt].filter(R);var zt=l(Tt);return bt=n(-Rt+zt),Ot=n(Rt+zt),[bt-Ot-je/3].filter(R)}},droots:function(M){if(M.length===3){var L=M[0],P=M[1],$=M[2],R=L-2*P+$;if(R!==0){var T=-l(P*P-L*$),w=-L+P,E=-(T+w)/R,O=-(-T+w)/R;return[E,O]}else if(P!==$&&R===0)return[(2*P-$)/(2*(P-$))];return[]}if(M.length===2){var k=M[0],F=M[1];return k!==F?[k/(k-F)]:[]}return[]},curvature:function(M,L,P,$,R){var T,w,E,O,k=0,F=0,q=m.compute(M,L),Y=m.compute(M,P),fe=q.x*q.x+q.y*q.y;if($?(T=l(u(q.y*Y.z-Y.y*q.z,2)+u(q.z*Y.x-Y.z*q.x,2)+u(q.x*Y.y-Y.x*q.y,2)),w=u(fe+q.z*q.z,3/2)):(T=q.x*Y.y-q.y*Y.x,w=u(fe,3/2)),T===0||w===0)return{k:0,r:0};if(k=T/w,F=w/T,!R){var _e=m.curvature(M-.001,L,P,$,!0).k,Pe=m.curvature(M+.001,L,P,$,!0).k;O=(Pe-k+(k-_e))/2,E=(r(Pe-k)+r(k-_e))/2}return{k:k,r:F,dk:O,adk:E}},inflections:function(M){if(M.length<4)return[];var L=m.align(M,{p1:M[0],p2:M.slice(-1)[0]}),P=L[2].x*L[1].y,$=L[3].x*L[1].y,R=L[1].x*L[2].y,T=L[3].x*L[2].y,w=18*(-3*P+2*$+3*R-T),E=18*(3*P-$-3*R),O=18*(R-P);if(m.approximately(w,0)){if(!m.approximately(E,0)){var k=-O/E;if(0<=k&&k<=1)return[k]}return[]}var F=E*E-4*w*O,q=Math.sqrt(F),Y=2*w;return m.approximately(Y,0)?[]:[(q-E)/Y,-(E+q)/Y].filter(function(fe){return 0<=fe&&fe<=1})},bboxoverlap:function(M,L){for(var P=["x","y"],$=P.length,R=0,T,w,E,O;R<$;R++)if(T=P[R],w=M[T].mid,E=L[T].mid,O=(M[T].size+L[T].size)/2,r(w-E)>=O)return!1;return!0},expandbox:function(M,L){L.x.min<M.x.min&&(M.x.min=L.x.min),L.y.min<M.y.min&&(M.y.min=L.y.min),L.z&&L.z.min<M.z.min&&(M.z.min=L.z.min),L.x.max>M.x.max&&(M.x.max=L.x.max),L.y.max>M.y.max&&(M.y.max=L.y.max),L.z&&L.z.max>M.z.max&&(M.z.max=L.z.max),M.x.mid=(M.x.min+M.x.max)/2,M.y.mid=(M.y.min+M.y.max)/2,M.z&&(M.z.mid=(M.z.min+M.z.max)/2),M.x.size=M.x.max-M.x.min,M.y.size=M.y.max-M.y.min,M.z&&(M.z.size=M.z.max-M.z.min)},pairiteration:function(M,L,P){var $=M.bbox(),R=L.bbox(),T=1e5,w=P||.5;if($.x.size+$.y.size<w&&R.x.size+R.y.size<w)return[(T*(M._t1+M._t2)/2|0)/T+"/"+(T*(L._t1+L._t2)/2|0)/T];var E=M.split(.5),O=L.split(.5),k=[{left:E.left,right:O.left},{left:E.left,right:O.right},{left:E.right,right:O.right},{left:E.right,right:O.left}];k=k.filter(function(q){return m.bboxoverlap(q.left.bbox(),q.right.bbox())});var F=[];return k.length===0||(k.forEach(function(q){F=F.concat(m.pairiteration(q.left,q.right,w))}),F=F.filter(function(q,Y){return F.indexOf(q)===Y})),F},getccenter:function(M,L,P){var $=L.x-M.x,R=L.y-M.y,T=P.x-L.x,w=P.y-L.y,E=$*i(h)-R*s(h),O=$*s(h)+R*i(h),k=T*i(h)-w*s(h),F=T*s(h)+w*i(h),q=(M.x+L.x)/2,Y=(M.y+L.y)/2,fe=(L.x+P.x)/2,_e=(L.y+P.y)/2,Pe=q+E,De=Y+O,tt=fe+k,je=_e+F,Fe=m.lli8(q,Y,Pe,De,fe,_e,tt,je),Ge=m.dist(Fe,M),Et=o(M.y-Fe.y,M.x-Fe.x),st=o(L.y-Fe.y,L.x-Fe.x),at=o(P.y-Fe.y,P.x-Fe.x),$t;return Et<at?((Et>st||st>at)&&(Et+=c),Et>at&&($t=at,at=Et,Et=$t)):at<st&&st<Et?($t=at,at=Et,Et=$t):at+=c,Fe.s=Et,Fe.e=at,Fe.r=Ge,Fe},numberSort:function(M,L){return M-L}},y=function(){function U(L){_classCallCheck$1(this,U),this.curves=[],this._3d=!1,L&&(this.curves=L,this._3d=this.curves[0]._3d)}var M=U.prototype;return M.valueOf=function(){return this.toString()},M.toString=function(){return"["+this.curves.map(function(P){return m.pointsToString(P.points)}).join(", ")+"]"},M.addCurve=function(P){this.curves.push(P),this._3d=this._3d||P._3d},M.length=function(){return this.curves.map(function(P){return P.length()}).reduce(function(P,$){return P+$})},M.curve=function(P){return this.curves[P]},M.bbox=function(){for(var P=this.curves,$=P[0].bbox(),R=1;R<P.length;R++)m.expandbox($,P[R].bbox());return $},M.offset=function(P){var $=[];return this.curves.forEach(function(R){var T;(T=$).push.apply(T,_toConsumableArray$1(R.offset(P)))}),new U($)},U}(),b=Math.abs,_=Math.min,C=Math.max,A=Math.cos,I=Math.sin,D=Math.acos,X=Math.sqrt,W=Math.PI,K=function(){function U(L){_classCallCheck$1(this,U);var P=L&&L.forEach?L:Array.from(arguments).slice(),$=!1;if(typeof P[0]=="object"){$=P.length;var R=[];P.forEach(function(Pe){["x","y","z"].forEach(function(De){typeof Pe[De]!="undefined"&&R.push(Pe[De])})}),P=R}var T=!1,w=P.length;if($){if($>4){if(arguments.length!==1)throw new Error("Only new Bezier(point[]) is accepted for 4th and higher order curves");T=!0}}else if(w!==6&&w!==8&&w!==9&&w!==12&&arguments.length!==1)throw new Error("Only new Bezier(point[]) is accepted for 4th and higher order curves");for(var E=this._3d=!T&&(w===9||w===12)||L&&L[0]&&typeof L[0].z!="undefined",O=this.points=[],k=0,F=E?3:2;k<w;k+=F){var q={x:P[k],y:P[k+1]};E&&(q.z=P[k+2]),O.push(q)}var Y=this.order=O.length-1,fe=this.dims=["x","y"];E&&fe.push("z"),this.dimlen=fe.length;var _e=m.align(O,{p1:O[0],p2:O[Y]});this._linear=!_e.some(function(Pe){return b(Pe.y)>1e-4}),this._lut=[],this._t1=0,this._t2=1,this.update()}var M=U.prototype;return M.getUtils=function(){return U.getUtils()},M.valueOf=function(){return this.toString()},M.toString=function(){return m.pointsToString(this.points)},M.toSVG=function(){if(this._3d)return!1;for(var P=this.points,$=P[0].x,R=P[0].y,T=["M",$,R,this.order===2?"Q":"C"],w=1,E=P.length;w<E;w++)T.push(P[w].x),T.push(P[w].y);return T.join(" ")},M.setRatios=function(P){if(P.length!==this.points.length)throw new Error("incorrect number of ratio values");this.ratios=P,this._lut=[]},M.verify=function(){var P=this.coordDigest();P!==this._print&&(this._print=P,this.update())},M.coordDigest=function(){return this.points.map(function(P,$){return""+$+P.x+P.y+(P.z?P.z:0)}).join("")},M.update=function(){this._lut=[],this.dpoints=m.derive(this.points,this._3d),this.computedirection()},M.computedirection=function(){var P=this.points,$=m.angle(P[0],P[this.order],P[1]);this.clockwise=$>0},M.length=function(){return m.length(this.derivative.bind(this))},M.getABC=function(P,$){$=$||this.get(P);var R=this.points[0],T=this.points[this.order];return U.getABC(this.order,R,$,T,P)},M.getLUT=function(P){if(this.verify(),P=P||100,this._lut.length===P)return this._lut;this._lut=[],P--;for(var $=0,R,T;$<P;$++)T=$/(P-1),R=this.compute(T),R.t=T,this._lut.push(R);return this._lut},M.on=function(P,$){$=$||5;for(var R=this.getLUT(),T=[],w=0,E,O=0;w<R.length;w++)E=R[w],m.dist(E,P)<$&&(T.push(E),O+=w/R.length);return T.length?t/=T.length:!1},M.project=function(P){var $=this.getLUT(),R=$.length-1,T=m.closest($,P),w=T.mpos,E=(w-1)/R,O=(w+1)/R,k=.1/R,F=T.mdist,q=E,Y=q,fe;F+=1;for(var _e;q<O+k;q+=k)fe=this.compute(q),_e=m.dist(P,fe),_e<F&&(F=_e,Y=q);return Y=Y<0?0:Y>1?1:Y,fe=this.compute(Y),fe.t=Y,fe.d=F,fe},M.get=function(P){return this.compute(P)},M.point=function(P){return this.points[P]},M.compute=function(P){return this.ratios?m.computeWithRatios(P,this.points,this.ratios,this._3d):m.compute(P,this.points,this._3d,this.ratios)},M.raise=function(){for(var P=this.points,$=[P[0]],R=P.length,T=1,w,E;T<R;T++)w=P[T],E=P[T-1],$[T]={x:(R-T)/R*w.x+T/R*E.x,y:(R-T)/R*w.y+T/R*E.y};return $[R]=P[R-1],new U($)},M.derivative=function(P){return m.compute(P,this.dpoints[0])},M.dderivative=function(P){return m.compute(P,this.dpoints[1])},M.align=function(){var P=this.points;return new U(m.align(P,{p1:P[0],p2:P[P.length-1]}))},M.curvature=function(P){return m.curvature(P,this.dpoints[0],this.dpoints[1],this._3d)},M.inflections=function(){return m.inflections(this.points)},M.normal=function(P){return this._3d?this.__normal3(P):this.__normal2(P)},M.__normal2=function(P){var $=this.derivative(P),R=X($.x*$.x+$.y*$.y);return{x:-$.y/R,y:$.x/R}},M.__normal3=function(P){var $=this.derivative(P),R=this.derivative(P+.01),T=X($.x*$.x+$.y*$.y+$.z*$.z),w=X(R.x*R.x+R.y*R.y+R.z*R.z);$.x/=T,$.y/=T,$.z/=T,R.x/=w,R.y/=w,R.z/=w;var E={x:R.y*$.z-R.z*$.y,y:R.z*$.x-R.x*$.z,z:R.x*$.y-R.y*$.x},O=X(E.x*E.x+E.y*E.y+E.z*E.z);E.x/=O,E.y/=O,E.z/=O;var k=[E.x*E.x,E.x*E.y-E.z,E.x*E.z+E.y,E.x*E.y+E.z,E.y*E.y,E.y*E.z-E.x,E.x*E.z-E.y,E.y*E.z+E.x,E.z*E.z],F={x:k[0]*$.x+k[1]*$.y+k[2]*$.z,y:k[3]*$.x+k[4]*$.y+k[5]*$.z,z:k[6]*$.x+k[7]*$.y+k[8]*$.z};return F},M.hull=function(P){var $=this.points,R=[],T=[],w=0;for(T[w++]=$[0],T[w++]=$[1],T[w++]=$[2],this.order===3&&(T[w++]=$[3]);$.length>1;){R=[];for(var E=0,O=void 0,k=$.length-1;E<k;E++)O=m.lerp(P,$[E],$[E+1]),T[w++]=O,R.push(O);$=R}return T},M.split=function(P,$){if(P===0&&!!$)return this.split($).left;if($===1)return this.split(P).right;var R=this.hull(P),T={left:this.order===2?new U([R[0],R[3],R[5]]):new U([R[0],R[4],R[7],R[9]]),right:this.order===2?new U([R[5],R[4],R[2]]):new U([R[9],R[8],R[6],R[3]]),span:R};return T.left._t1=m.map(0,0,1,this._t1,this._t2),T.left._t2=m.map(P,0,1,this._t1,this._t2),T.right._t1=m.map(P,0,1,this._t1,this._t2),T.right._t2=m.map(1,0,1,this._t1,this._t2),$?($=m.map($,P,1,0,1),T.right.split($).left):T},M.extrema=function(){var P={},$=[];return this.dims.forEach(function(R){var T=function(O){return O[R]},w=this.dpoints[0].map(T);P[R]=m.droots(w),this.order===3&&(w=this.dpoints[1].map(T),P[R]=P[R].concat(m.droots(w))),P[R]=P[R].filter(function(E){return E>=0&&E<=1}),$=$.concat(P[R].sort(m.numberSort))}.bind(this)),P.values=$.sort(m.numberSort).filter(function(R,T){return $.indexOf(R)===T}),P},M.bbox=function(){var P=this.extrema(),$={};return this.dims.forEach(function(R){$[R]=m.getminmax(this,R,P[R])}.bind(this)),$},M.overlaps=function(P){var $=this.bbox(),R=P.bbox();return m.bboxoverlap($,R)},M.offset=function(P,$){if(typeof $!="undefined"){var R=this.get(P),T=this.normal(P),w={c:R,n:T,x:R.x+T.x*$,y:R.y+T.y*$};return this._3d&&(w.z=R.z+T.z*$),w}if(this._linear){var E=this.normal(0),O=this.points.map(function(k){var F={x:k.x+P*E.x,y:k.y+P*E.y};return k.z&&E.z&&(F.z=k.z+P*E.z),F});return[new U(O)]}return this.reduce().map(function(k){return k._linear?k.offset(P)[0]:k.scale(P)})},M.simple=function(){if(this.order===3){var P=m.angle(this.points[0],this.points[3],this.points[1]),$=m.angle(this.points[0],this.points[3],this.points[2]);if(P>0&&$<0||P<0&&$>0)return!1}var R=this.normal(0),T=this.normal(1),w=R.x*T.x+R.y*T.y;return this._3d&&(w+=R.z*T.z),b(D(w))<W/3},M.reduce=function(){var P,$=0,R=0,T=.01,w,E=[],O=[],k=this.extrema().values;for(k.indexOf(0)===-1&&(k=[0].concat(k)),k.indexOf(1)===-1&&k.push(1),$=k[0],P=1;P<k.length;P++)R=k[P],w=this.split($,R),w._t1=$,w._t2=R,E.push(w),$=R;return E.forEach(function(F){for($=0,R=0;R<=1;)for(R=$+T;R<=1+T;R+=T)if(w=F.split($,R),!w.simple()){if(R-=T,b($-R)<T)return[];w=F.split($,R),w._t1=m.map($,0,1,F._t1,F._t2),w._t2=m.map(R,0,1,F._t1,F._t2),O.push(w),$=R;break}$<1&&(w=F.split($,1),w._t1=m.map($,0,1,F._t1,F._t2),w._t2=F._t2,O.push(w))}),O},M.scale=function(P){var $=this.order,R=!1;if(typeof P=="function"&&(R=P),R&&$===2)return this.raise().scale(R);var T=this.clockwise,w=R?R(0):P,E=R?R(1):P,O=[this.offset(0,10),this.offset(1,10)],k=this.points,F=[],q=m.lli4(O[0],O[0].c,O[1],O[1].c);if(!q)throw new Error("cannot scale this curve. Try reducing it first.");if([0,1].forEach(function(fe){var _e=F[fe*$]=m.copy(k[fe*$]);_e.x+=(fe?E:w)*O[fe].n.x,_e.y+=(fe?E:w)*O[fe].n.y}),!R){var Y=this;return[0,1].forEach(function(fe){if(!($===2&&!!fe)){var _e=F[fe*$],Pe=Y.derivative(fe),De={x:_e.x+Pe.x,y:_e.y+Pe.y};F[fe+1]=m.lli4(_e,De,q,k[fe+1])}}),new U(F)}return[0,1].forEach(function(fe){if(!($===2&&!!fe)){var _e=k[fe+1],Pe={x:_e.x-q.x,y:_e.y-q.y},De=R?R((fe+1)/$):P;R&&!T&&(De=-De);var tt=X(Pe.x*Pe.x+Pe.y*Pe.y);Pe.x/=tt,Pe.y/=tt,F[fe+1]={x:_e.x+De*Pe.x,y:_e.y+De*Pe.y}}}),new U(F)},M.outline=function(P,$,R,T){var w=function(at,$t,kt,Rt,Tt){return function(bt){var Ot=Rt/kt,Lt=(Rt+Tt)/kt,xt=$t-at;return m.map(bt,0,1,at+Ot*xt,at+Lt*xt)}};$=typeof $=="undefined"?P:$;var E=this.reduce(),O=E.length,k=[],F=[],q,Y=0,fe=this.length(),_e=typeof R!="undefined"&&typeof T!="undefined";E.forEach(function(st){var at=st.length();_e?(k.push(st.scale(w(P,R,fe,Y,at))),F.push(st.scale(w(-$,-T,fe,Y,at)))):(k.push(st.scale(P)),F.push(st.scale(-$))),Y+=at}),F=F.map(function(st){return q=st.points,q[3]?st.points=[q[3],q[2],q[1],q[0]]:st.points=[q[2],q[1],q[0]],st}).reverse();var Pe=k[0].points[0],De=k[O-1].points[k[O-1].points.length-1],tt=F[O-1].points[F[O-1].points.length-1],je=F[0].points[0],Fe=m.makeline(tt,Pe),Ge=m.makeline(De,je),Et=[Fe].concat(k).concat([Ge]).concat(F);return new y(Et)},M.outlineshapes=function(P,$,R){$=$||P;for(var T=this.outline(P,$).curves,w=[],E=1,O=T.length;E<O/2;E++){var k=m.makeshape(T[E],T[O-E],R);k.startcap.virtual=E>1,k.endcap.virtual=E<O/2-1,w.push(k)}return w},M.intersects=function(P,$){return P?P.p1&&P.p2?this.lineIntersects(P):(_instanceof$3(P,U)&&(P=P.reduce()),this.curveintersects(this.reduce(),P,$)):this.selfintersects($)},M.lineIntersects=function(P){var $=this,R=_(P.p1.x,P.p2.x),T=_(P.p1.y,P.p2.y),w=C(P.p1.x,P.p2.x),E=C(P.p1.y,P.p2.y);return m.roots(this.points,P).filter(function(O){var k=$.get(O);return m.between(k.x,R,w)&&m.between(k.y,T,E)})},M.selfintersects=function(P){for(var $=this.reduce(),R=$.length-2,T=[],w=0,E,O,k;w<R;w++){var F;O=$.slice(w,w+1),k=$.slice(w+2),E=this.curveintersects(O,k,P),(F=T).push.apply(F,_toConsumableArray$1(E))}return T},M.curveintersects=function(P,$,R){var T=[];P.forEach(function(E){$.forEach(function(O){E.overlaps(O)&&T.push({left:E,right:O})})});var w=[];return T.forEach(function(E){var O=m.pairiteration(E.left,E.right,R);O.length>0&&(w=w.concat(O))}),w},M.arcs=function(P){return P=P||.5,this._iterate(P,[])},M._error=function(P,$,R,T){var w=(T-R)/4,E=this.get(R+w),O=this.get(T-w),k=m.dist(P,$),F=m.dist(P,E),q=m.dist(P,O);return b(F-k)+b(q-k)},M._iterate=function(P,$){var R=0,T=1,w;do{w=0,T=1;var E=this.get(R),O=void 0,k=void 0,F=void 0,q=void 0,Y=!1,fe=!1,_e=void 0,Pe=T,De=1;do{fe=Y,q=F,Pe=(R+T)/2,O=this.get(Pe),k=this.get(T),F=m.getccenter(E,O,k),F.interval={start:R,end:T};var tt=this._error(F,E,R,T);if(Y=tt<=P,_e=fe&&!Y,_e||(De=T),Y){if(T>=1){if(F.interval.end=De=1,q=F,T>1){var je={x:F.x+F.r*A(F.e),y:F.y+F.r*I(F.e)};F.e+=m.angle({x:F.x,y:F.y},je,this.get(1))}break}T=T+(T-R)/2}else T=Pe}while(!_e&&w++<100);if(w>=100)break;q=q||F,$.push(q),R=De}while(T<1);return $},U.quadraticFromPoints=function(P,$,R,T){if(typeof T=="undefined"&&(T=.5),T===0)return new U($,$,R);if(T===1)return new U(P,$,$);var w=U.getABC(2,P,$,R,T);return new U(P,w.A,R)},U.cubicFromPoints=function(P,$,R,T,w){typeof T=="undefined"&&(T=.5);var E=U.getABC(3,P,$,R,T);typeof w=="undefined"&&(w=m.dist($,E.C));var O=w*(1-T)/T,k=m.dist(P,R),F=(R.x-P.x)/k,q=(R.y-P.y)/k,Y=w*F,fe=w*q,_e=O*F,Pe=O*q,De={x:$.x-Y,y:$.y-fe},tt={x:$.x+_e,y:$.y+Pe},je=E.A,Fe={x:je.x+(De.x-je.x)/(1-T),y:je.y+(De.y-je.y)/(1-T)},Ge={x:je.x+(tt.x-je.x)/T,y:je.y+(tt.y-je.y)/T},Et={x:P.x+(Fe.x-P.x)/T,y:P.y+(Fe.y-P.y)/T},st={x:R.x+(Ge.x-R.x)/(1-T),y:R.y+(Ge.y-R.y)/(1-T)};return new U(P,Et,st,R)},U.getUtils=function(){return m},U.getABC=function(){var P=arguments.length>0&&arguments[0]!==void 0?arguments[0]:2,$=arguments.length>1?arguments[1]:void 0,R=arguments.length>2?arguments[2]:void 0,T=arguments.length>3?arguments[3]:void 0,w=arguments.length>4&&arguments[4]!==void 0?arguments[4]:.5,E=m.projectionratio(w,P),O=1-E,k={x:E*$.x+O*T.x,y:E*$.y+O*T.y},F=m.abcratio(w,P),q={x:R.x+(R.x-k.x)/F,y:R.y+(R.y-k.y)/F};return{A:q,B:R,C:k,S:$,E:T}},_createClass$1(U,null,[{key:"PolyBezier",get:function(){return y}}]),U}();return bezier$1.Bezier=K,bezier$1}var src,hasRequiredSrc;function requireSrc(){var n=function(y,b){return 1-3*b+3*y},r=function(y,b){return 3*b-6*y},i=function(y){return 3*y},s=function(y,b,_){return((n(b,_)*y+r(b,_))*y+i(b))*y},a=function(y,b,_){return 3*n(b,_)*y*y+2*r(b,_)*y+i(b)},o=function(y,b,_,C,A){var I,D,X=0;do D=b+(_-b)/2,I=s(D,C,A)-y,I>0?_=D:b=D;while(Math.abs(I)>h&&++X<p);return D},l=function(y,b,_,C){for(var A=0;A<f;++A){var I=a(b,_,C);if(I===0)return b;var D=s(b,_,C)-y;b-=D/I}return b},u=function(y){return y};if(hasRequiredSrc)return src;hasRequiredSrc=1;var f=4,c=.001,h=1e-7,p=10,d=11,v=1/(d-1),g=typeof Float32Array=="function";return src=function(y,b,_,C){var A=function(W){for(var K=0,U=1,M=d-1;U!==M&&I[U]<=W;++U)K+=v;--U;var L=(W-I[U])/(I[U+1]-I[U]),P=K+L*v,$=a(P,y,_);return $>=c?l(W,P,y,_):$===0?P:o(W,K,K+v,y,_)};if(!(0<=y&&y<=1&&0<=_&&_<=1))throw new Error("bezier x values must be in [0, 1] range");if(y===b&&_===C)return u;for(var I=g?new Float32Array(d):new Array(d),D=0;D<d;++D)I[D]=s(D*v,y,_);return function(W){return W===0?0:W===1?1:s(A(W),b,C)}},src}var earcut={exports:{}},hasRequiredEarcut;function requireEarcut(){var n=function(w,E,O){O=O||2;var k=E&&E.length,F=k?E[0]*O:w.length,q=r(w,0,F,O,!0),Y=[];if(!q||q.next===q.prev)return Y;var fe,_e,Pe,De,tt,je,Fe;if(k&&(q=u(w,E,q,O)),w.length>80*O){fe=Pe=w[0],_e=De=w[1];for(var Ge=O;Ge<F;Ge+=O)tt=w[Ge],je=w[Ge+1],tt<fe&&(fe=tt),je<_e&&(_e=je),tt>Pe&&(Pe=tt),je>De&&(De=je);Fe=Math.max(Pe-fe,De-_e),Fe=Fe!==0?1/Fe:0}return R(q,Y,O,fe,_e,Fe),Y},r=function(w,E,O,k,F){var q,Y;if(F===$(w,E,O,k)>0)for(q=E;q<O;q+=k)Y=M(q,w[q],w[q+1],Y);else for(q=O-k;q>=E;q-=k)Y=M(q,w[q],w[q+1],Y);return Y&&C(Y,Y.next)&&(L(Y),Y=Y.next),Y},i=function(w,E){if(!w)return w;E||(E=w);var O=w,k;do if(k=!1,!O.steiner&&(C(O,O.next)||_(O.prev,O,O.next)===0)){if(L(O),O=E=O.prev,O===O.next)break;k=!0}else O=O.next;while(k||O!==E);return E},s=function(w){var E=w.prev,O=w,k=w.next;if(_(E,O,k)>=0)return!1;for(var F=w.next.next;F!==w.prev;){if(y(E.x,E.y,O.x,O.y,k.x,k.y,F.x,F.y)&&_(F.prev,F,F.next)>=0)return!1;F=F.next}return!0},a=function(w,E,O,k){var F=w.prev,q=w,Y=w.next;if(_(F,q,Y)>=0)return!1;for(var fe=F.x<q.x?F.x<Y.x?F.x:Y.x:q.x<Y.x?q.x:Y.x,_e=F.y<q.y?F.y<Y.y?F.y:Y.y:q.y<Y.y?q.y:Y.y,Pe=F.x>q.x?F.x>Y.x?F.x:Y.x:q.x>Y.x?q.x:Y.x,De=F.y>q.y?F.y>Y.y?F.y:Y.y:q.y>Y.y?q.y:Y.y,tt=g(fe,_e,E,O,k),je=g(Pe,De,E,O,k),Fe=w.prevZ,Ge=w.nextZ;Fe&&Fe.z>=tt&&Ge&&Ge.z<=je;){if(Fe!==w.prev&&Fe!==w.next&&y(F.x,F.y,q.x,q.y,Y.x,Y.y,Fe.x,Fe.y)&&_(Fe.prev,Fe,Fe.next)>=0||(Fe=Fe.prevZ,Ge!==w.prev&&Ge!==w.next&&y(F.x,F.y,q.x,q.y,Y.x,Y.y,Ge.x,Ge.y)&&_(Ge.prev,Ge,Ge.next)>=0))return!1;Ge=Ge.nextZ}for(;Fe&&Fe.z>=tt;){if(Fe!==w.prev&&Fe!==w.next&&y(F.x,F.y,q.x,q.y,Y.x,Y.y,Fe.x,Fe.y)&&_(Fe.prev,Fe,Fe.next)>=0)return!1;Fe=Fe.prevZ}for(;Ge&&Ge.z<=je;){if(Ge!==w.prev&&Ge!==w.next&&y(F.x,F.y,q.x,q.y,Y.x,Y.y,Ge.x,Ge.y)&&_(Ge.prev,Ge,Ge.next)>=0)return!1;Ge=Ge.nextZ}return!0},o=function(w,E,O){var k=w;do{var F=k.prev,q=k.next.next;!C(F,q)&&A(F,k,k.next,q)&&W(F,q)&&W(q,F)&&(E.push(F.i/O),E.push(k.i/O),E.push(q.i/O),L(k),L(k.next),k=w=q),k=k.next}while(k!==w);return i(k)},l=function(w,E,O,k,F,q){var Y=w;do{for(var fe=Y.next.next;fe!==Y.prev;){if(Y.i!==fe.i&&b(Y,fe)){var _e=U(Y,fe);Y=i(Y,Y.next),_e=i(_e,_e.next),R(Y,E,O,k,F,q),R(_e,E,O,k,F,q);return}fe=fe.next}Y=Y.next}while(Y!==w)},u=function(w,E,O,k){var F=[],q,Y,fe,_e,Pe;for(q=0,Y=E.length;q<Y;q++)fe=E[q]*k,_e=q<Y-1?E[q+1]*k:w.length,Pe=r(w,fe,_e,k,!1),Pe===Pe.next&&(Pe.steiner=!0),F.push(m(Pe));for(F.sort(f),q=0;q<F.length;q++)O=c(F[q],O),O=i(O,O.next);return O},f=function(w,E){return w.x-E.x},c=function(w,E){var O=h(w,E);if(!O)return E;var k=U(O,w),F=i(O,O.next);return i(k,k.next),E===O?F:E},h=function(w,E){var O=E,k=w.x,F=w.y,q=-1/0,Y;do{if(F<=O.y&&F>=O.next.y&&O.next.y!==O.y){var fe=O.x+(F-O.y)*(O.next.x-O.x)/(O.next.y-O.y);if(fe<=k&&fe>q){if(q=fe,fe===k){if(F===O.y)return O;if(F===O.next.y)return O.next}Y=O.x<O.next.x?O:O.next}}O=O.next}while(O!==E);if(!Y)return null;if(k===q)return Y;var _e=Y,Pe=Y.x,De=Y.y,tt=1/0,je;O=Y;do k>=O.x&&O.x>=Pe&&k!==O.x&&y(F<De?k:q,F,Pe,De,F<De?q:k,F,O.x,O.y)&&(je=Math.abs(F-O.y)/(k-O.x),W(O,w)&&(je<tt||je===tt&&(O.x>Y.x||O.x===Y.x&&p(Y,O)))&&(Y=O,tt=je)),O=O.next;while(O!==_e);return Y},p=function(w,E){return _(w.prev,w,E.prev)<0&&_(E.next,w,w.next)<0},d=function(w,E,O,k){var F=w;do F.z===null&&(F.z=g(F.x,F.y,E,O,k)),F.prevZ=F.prev,F.nextZ=F.next,F=F.next;while(F!==w);F.prevZ.nextZ=null,F.prevZ=null,v(F)},v=function(w){var E,O,k,F,q,Y,fe,_e,Pe=1;do{for(O=w,w=null,q=null,Y=0;O;){for(Y++,k=O,fe=0,E=0;E<Pe&&(fe++,k=k.nextZ,!!k);E++);for(_e=Pe;fe>0||_e>0&&k;)fe!==0&&(_e===0||!k||O.z<=k.z)?(F=O,O=O.nextZ,fe--):(F=k,k=k.nextZ,_e--),q?q.nextZ=F:w=F,F.prevZ=q,q=F;O=k}q.nextZ=null,Pe*=2}while(Y>1);return w},g=function(w,E,O,k,F){return w=32767*(w-O)*F,E=32767*(E-k)*F,w=(w|w<<8)&16711935,w=(w|w<<4)&252645135,w=(w|w<<2)&858993459,w=(w|w<<1)&1431655765,E=(E|E<<8)&16711935,E=(E|E<<4)&252645135,E=(E|E<<2)&858993459,E=(E|E<<1)&1431655765,w|E<<1},m=function(w){var E=w,O=w;do(E.x<O.x||E.x===O.x&&E.y<O.y)&&(O=E),E=E.next;while(E!==w);return O},y=function(w,E,O,k,F,q,Y,fe){return(F-Y)*(E-fe)-(w-Y)*(q-fe)>=0&&(w-Y)*(k-fe)-(O-Y)*(E-fe)>=0&&(O-Y)*(q-fe)-(F-Y)*(k-fe)>=0},b=function(w,E){return w.next.i!==E.i&&w.prev.i!==E.i&&!X(w,E)&&(W(w,E)&&W(E,w)&&K(w,E)&&(_(w.prev,w,E.prev)||_(w,E.prev,E))||C(w,E)&&_(w.prev,w,w.next)>0&&_(E.prev,E,E.next)>0)},_=function(w,E,O){return(E.y-w.y)*(O.x-E.x)-(E.x-w.x)*(O.y-E.y)},C=function(w,E){return w.x===E.x&&w.y===E.y},A=function(w,E,O,k){var F=D(_(w,E,O)),q=D(_(w,E,k)),Y=D(_(O,k,w)),fe=D(_(O,k,E));return!!(F!==q&&Y!==fe||F===0&&I(w,O,E)||q===0&&I(w,k,E)||Y===0&&I(O,w,k)||fe===0&&I(O,E,k))},I=function(w,E,O){return E.x<=Math.max(w.x,O.x)&&E.x>=Math.min(w.x,O.x)&&E.y<=Math.max(w.y,O.y)&&E.y>=Math.min(w.y,O.y)},D=function(w){return w>0?1:w<0?-1:0},X=function(w,E){var O=w;do{if(O.i!==w.i&&O.next.i!==w.i&&O.i!==E.i&&O.next.i!==E.i&&A(O,O.next,w,E))return!0;O=O.next}while(O!==w);return!1},W=function(w,E){return _(w.prev,w,w.next)<0?_(w,E,w.next)>=0&&_(w,w.prev,E)>=0:_(w,E,w.prev)<0||_(w,w.next,E)<0},K=function(w,E){var O=w,k=!1,F=(w.x+E.x)/2,q=(w.y+E.y)/2;do O.y>q!=O.next.y>q&&O.next.y!==O.y&&F<(O.next.x-O.x)*(q-O.y)/(O.next.y-O.y)+O.x&&(k=!k),O=O.next;while(O!==w);return k},U=function(w,E){var O=new P(w.i,w.x,w.y),k=new P(E.i,E.x,E.y),F=w.next,q=E.prev;return w.next=E,E.prev=w,O.next=F,F.prev=O,k.next=O,O.prev=k,q.next=k,k.prev=q,k},M=function(w,E,O,k){var F=new P(w,E,O);return k?(F.next=k.next,F.prev=k,k.next.prev=F,k.next=F):(F.prev=F,F.next=F),F},L=function(w){w.next.prev=w.prev,w.prev.next=w.next,w.prevZ&&(w.prevZ.nextZ=w.nextZ),w.nextZ&&(w.nextZ.prevZ=w.prevZ)},P=function(w,E,O){this.i=w,this.x=E,this.y=O,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1},$=function(w,E,O,k){for(var F=0,q=E,Y=O-k;q<O;q+=k)F+=(w[Y]-w[q])*(w[q+1]+w[Y+1]),Y=q;return F};if(hasRequiredEarcut)return earcut.exports;hasRequiredEarcut=1,earcut.exports=n,earcut.exports.default=n;function R(T,w,E,O,k,F,q){if(!!T){!q&&F&&d(T,O,k,F);for(var Y=T,fe,_e;T.prev!==T.next;){if(fe=T.prev,_e=T.next,F?a(T,O,k,F):s(T)){w.push(fe.i/E),w.push(T.i/E),w.push(_e.i/E),L(T),T=_e.next,Y=_e.next;continue}if(T=_e,T===Y){q?q===1?(T=o(i(T),w,E),R(T,w,E,O,k,F,2)):q===2&&l(T,w,E,O,k,F):R(i(T),w,E,O,k,F,1);break}}}}return n.deviation=function(T,w,E,O){var k=w&&w.length,F=k?w[0]*E:T.length,q=Math.abs($(T,0,F,E));if(k)for(var Y=0,fe=w.length;Y<fe;Y++){var _e=w[Y]*E,Pe=Y<fe-1?w[Y+1]*E:T.length;q-=Math.abs($(T,_e,Pe,E))}var De=0;for(Y=0;Y<O.length;Y+=3){var tt=O[Y]*E,je=O[Y+1]*E,Fe=O[Y+2]*E;De+=Math.abs((T[tt]-T[Fe])*(T[je+1]-T[tt+1])-(T[tt]-T[je])*(T[Fe+1]-T[tt+1]))}return q===0&&De===0?0:Math.abs((De-q)/q)},n.flatten=function(T){for(var w=T[0][0].length,E={vertices:[],holes:[],dimensions:w},O=0,k=0;k<T.length;k++){for(var F=0;F<T[k].length;F++)for(var q=0;q<w;q++)E.vertices.push(T[k][F][q]);k>0&&(O+=T[k-1].length,E.holes.push(O))}return E},earcut.exports}var regl={exports:{}};function _instanceof$2(n,r){return r!=null&&typeof Symbol!="undefined"&&r[Symbol.hasInstance]?!!r[Symbol.hasInstance](n):n instanceof r}var _typeof$2=function(n){return n&&typeof Symbol!="undefined"&&n.constructor===Symbol?"symbol":typeof n},hasRequiredRegl;function requireRegl(){return hasRequiredRegl||(hasRequiredRegl=1,function(n,r){(function(i,s){n.exports=s()})(commonjsGlobal,function(){var i=function(S){return typeof atob!="undefined"?atob(S):"base64:"+S},s=function(S){var B=new Error("(regl) "+S);throw console.error(B),B},a=function(S,B){S||s(B)},o=function(S){return S?": "+S:""},l=function(S,B,Q){S in B||s("unknown parameter ("+S+")"+o(Q)+". possible values: "+Object.keys(B).join())},u=function(S,B){rr(S)||s("invalid parameter type"+o(B)+". must be a typed array")},f=function(S,B){switch(B){case"number":return typeof S=="number";case"object":return typeof S=="object";case"string":return typeof S=="string";case"boolean":return typeof S=="boolean";case"function":return typeof S=="function";case"undefined":return typeof S=="undefined";case"symbol":return(typeof S=="undefined"?"undefined":_typeof$2(S))==="symbol"}},c=function(S,B,Q){f(S,B)||s("invalid parameter type"+o(Q)+". expected "+B+", got "+(typeof S=="undefined"?"undefined":_typeof$2(S)))},h=function(S,B){S>=0&&(S|0)===S||s("invalid parameter type, ("+S+")"+o(B)+". must be a nonnegative integer")},p=function(S,B,Q){B.indexOf(S)<0&&s("invalid value"+o(Q)+". must be one of: "+B)},d=function(S){Object.keys(S).forEach(function(B){ca.indexOf(B)<0&&s('invalid regl constructor argument "'+B+'". must be one of '+ca)})},v=function(S,B){for(S=S+"";S.length<B;)S=" "+S;return S},g=function(){this.name="unknown",this.lines=[],this.index={},this.hasErrors=!1},m=function(S,B){this.number=S,this.line=B,this.errors=[]},y=function(S,B,Q){this.file=S,this.line=B,this.message=Q},b=function(){var S=new Error,B=(S.stack||S).toString(),Q=/compileProcedure.*\n\s*at.*\((.*)\)/.exec(B);if(Q)return Q[1];var ue=/compileProcedure.*\n\s*at\s+(.*)(\n|$)/.exec(B);return ue?ue[1]:"unknown"},_=function(){var S=new Error,B=(S.stack||S).toString(),Q=/at REGLCommand.*\n\s+at.*\((.*)\)/.exec(B);if(Q)return Q[1];var ue=/at REGLCommand.*\n\s+at\s+(.*)\n/.exec(B);return ue?ue[1]:"unknown"},C=function(S,B){var Q=S.split("\n"),ue=1,me=0,de={unknown:new g,0:new g};de.unknown.name=de[0].name=B||b(),de.unknown.lines.push(new m(0,""));for(var be=0;be<Q.length;++be){var Ae=Q[be],Le=/^\s*#\s*(\w+)\s+(.+)\s*$/.exec(Ae);if(Le)switch(Le[1]){case"line":var Oe=/(\d+)(\s+\d+)?/.exec(Le[2]);Oe&&(ue=Oe[1]|0,Oe[2]&&(me=Oe[2]|0,me in de||(de[me]=new g)));break;case"define":var ze=/SHADER_NAME(_B64)?\s+(.*)$/.exec(Le[2]);ze&&(de[me].name=ze[1]?i(ze[2]):ze[2]);break}de[me].lines.push(new m(ue++,Ae))}return Object.keys(de).forEach(function($e){var ke=de[$e];ke.lines.forEach(function(Ie){ke.index[Ie.number]=Ie})}),de},A=function(S){var B=[];return S.split("\n").forEach(function(Q){if(!(Q.length<5)){var ue=/^ERROR:\s+(\d+):(\d+):\s*(.*)$/.exec(Q);ue?B.push(new y(ue[1]|0,ue[2]|0,ue[3].trim())):Q.length>0&&B.push(new y("unknown",0,Q))}}),B},I=function(S,B){B.forEach(function(Q){var ue=S[Q.file];if(ue){var me=ue.index[Q.line];if(me){me.errors.push(Q),ue.hasErrors=!0;return}}S.unknown.hasErrors=!0,S.unknown.lines[0].errors.push(Q)})},D=function(S,B,Q,ue,me){if(!S.getShaderParameter(B,S.COMPILE_STATUS)){var de=S.getShaderInfoLog(B),be=ue===S.FRAGMENT_SHADER?"fragment":"vertex";P(Q,"string",be+" shader source must be a string",me);var Ae=C(Q,me),Le=A(de);I(Ae,Le),Object.keys(Ae).forEach(function(Oe){var ze=Ae[Oe];if(!ze.hasErrors)return;var $e=[""],ke=[""];function Ie(Ee,le){$e.push(Ee),ke.push(le||"")}Ie("file number "+Oe+": "+ze.name+"\n","color:red;text-decoration:underline;font-weight:bold"),ze.lines.forEach(function(Ee){if(Ee.errors.length>0){Ie(v(Ee.number,4)+"|  ","background-color:yellow; font-weight:bold"),Ie(Ee.line+Or,"color:red; background-color:yellow; font-weight:bold");var le=0;Ee.errors.forEach(function(se){var Se=se.message,Ye=/^\s*'(.*)'\s*:\s*(.*)$/.exec(Se);if(Ye){var ye=Ye[1];switch(Se=Ye[2],ye){case"assign":ye="=";break}le=Math.max(Ee.line.indexOf(ye,le),0)}else le=0;Ie(v("| ",6)),Ie(v("^^^",le+3)+Or,"font-weight:bold"),Ie(v("| ",6)),Ie(Se+Or,"font-weight:bold")}),Ie(v("| ",6)+Or)}else Ie(v(Ee.number,4)+"|  "),Ie(Ee.line+Or,"color:red")}),typeof document!="undefined"&&!window.chrome?(ke[0]=$e.join("%c"),console.log.apply(console,ke)):console.log($e.join(""))}),a.raise("Error compiling "+be+" shader, "+Ae[0].name)}},X=function(S,B,Q,ue,me){if(!S.getProgramParameter(B,S.LINK_STATUS)){var de=S.getProgramInfoLog(B),be=C(Q,me),Ae=C(ue,me),Le='Error linking program with vertex shader, "'+Ae[0].name+'", and fragment shader "'+be[0].name+'"';typeof document!="undefined"?console.log("%c"+Le+Or+"%c"+de,"color:red;text-decoration:underline;font-weight:bold","color:red"):console.log(Le+Or+de),a.raise(Le)}},W=function(S){S._commandRef=b()},K=function(S,B,Q,ue){W(S);function me(Le){return Le?ue.id(Le):0}S._fragId=me(S.static.frag),S._vertId=me(S.static.vert);function de(Le,Oe){Object.keys(Oe).forEach(function(ze){Le[ue.id(ze)]=!0})}var be=S._uniformSet={};de(be,B.static),de(be,B.dynamic);var Ae=S._attributeSet={};de(Ae,Q.static),de(Ae,Q.dynamic),S._hasCount="count"in S.static||"count"in S.dynamic||"elements"in S.static||"elements"in S.dynamic},U=function(S,B){var Q=_();s(S+" in command "+(B||b())+(Q==="unknown"?"":" called from "+Q))},M=function(S,B,Q){S||U(B,Q||b())},L=function(S,B,Q,ue){S in B||U("unknown parameter ("+S+")"+o(Q)+". possible values: "+Object.keys(B).join(),ue||b())},P=function(S,B,Q,ue){f(S,B)||U("invalid parameter type"+o(Q)+". expected "+B+", got "+(typeof S=="undefined"?"undefined":_typeof$2(S)),ue||b())},$=function(S){S()},R=function(S,B,Q){S.texture?p(S.texture._texture.internalformat,B,"unsupported texture format for attachment"):p(S.renderbuffer._renderbuffer.format,Q,"unsupported renderbuffer format for attachment")},T=function(S,B){return S===va||S===pa||S===ma?2:S===ga?4:ur[S]*B},w=function(S){return!(S&S-1)&&!!S},E=function(S,B,Q){var ue,me=B.width,de=B.height,be=B.channels;a(me>0&&me<=Q.maxTextureSize&&de>0&&de<=Q.maxTextureSize,"invalid texture shape"),(S.wrapS!==Ln||S.wrapT!==Ln)&&a(w(me)&&w(de),"incompatible wrap mode for texture, both width and height must be power of 2"),B.mipmask===1?me!==1&&de!==1&&a(S.minFilter!==us&&S.minFilter!==cs&&S.minFilter!==fs&&S.minFilter!==hs,"min filter requires mipmap"):(a(w(me)&&w(de),"texture must be a square power of 2 to support mipmapping"),a(B.mipmask===(me<<1)-1,"missing or incomplete mipmap data")),B.type===da&&(Q.extensions.indexOf("oes_texture_float_linear")<0&&a(S.minFilter===ha&&S.magFilter===ha,"filter not supported, must enable oes_texture_float_linear"),a(!S.genMipmaps,"mipmap generation not supported with float textures"));var Ae=B.images;for(ue=0;ue<16;++ue)if(Ae[ue]){var Le=me>>ue,Oe=de>>ue;a(B.mipmask&1<<ue,"missing mipmap data");var ze=Ae[ue];if(a(ze.width===Le&&ze.height===Oe,"invalid shape for mip images"),a(ze.format===B.format&&ze.internalformat===B.internalformat&&ze.type===B.type,"incompatible type for mip image"),!ze.compressed)if(ze.data){var $e=Math.ceil(T(ze.type,be)*Le/ze.unpackAlignment)*ze.unpackAlignment;a(ze.data.byteLength===$e*Oe,"invalid data for image, buffer size is inconsistent with image format")}else ze.element||ze.copy}else S.genMipmaps||a((B.mipmask&1<<ue)===0,"extra mipmap data");B.compressed&&a(!S.genMipmaps,"mipmap generation for compressed images not supported")},O=function(S,B,Q,ue){var me=S.width,de=S.height,be=S.channels;a(me>0&&me<=ue.maxTextureSize&&de>0&&de<=ue.maxTextureSize,"invalid texture shape"),a(me===de,"cube map must be square"),a(B.wrapS===Ln&&B.wrapT===Ln,"wrap mode not supported by cube map");for(var Ae=0;Ae<Q.length;++Ae){var Le=Q[Ae];a(Le.width===me&&Le.height===de,"inconsistent cube map face shape"),B.genMipmaps&&(a(!Le.compressed,"can not generate mipmap for compressed textures"),a(Le.mipmask===1,"can not specify mipmaps and generate mipmaps"));for(var Oe=Le.images,ze=0;ze<16;++ze){var $e=Oe[ze];if($e){var ke=me>>ze,Ie=de>>ze;a(Le.mipmask&1<<ze,"missing mipmap data"),a($e.width===ke&&$e.height===Ie,"invalid shape for mip images"),a($e.format===S.format&&$e.internalformat===S.internalformat&&$e.type===S.type,"incompatible type for mip image"),$e.compressed||($e.data?a($e.data.byteLength===ke*Ie*Math.max(T($e.type,be),$e.unpackAlignment),"invalid data for image, buffer size is inconsistent with image format"):$e.element||$e.copy)}}}},k=function(S,B){this.id=bs++,this.type=S,this.data=B},F=function(S){return S.replace(/\\/g,"\\\\").replace(/"/g,'\\"')},q=function(S){return"["+sn(S).join("][")+"]"},Y=function(S,B){return new k(S,q(B+""))},fe=function(S){return typeof S=="function"&&!S._reglType||_instanceof$2(S,k)},_e=function(){var S={"":0},B=[""];return{id:function(ue){var me=S[ue];return me||(me=S[ue]=B.length,B.push(ue),me)},str:function(ue){return B[ue]}}},Pe=function(S,B,Q){var ue=document.createElement("canvas");jt(ue.style,{border:0,margin:0,padding:0,top:0,left:0,width:"100%",height:"100%"}),S.appendChild(ue),S===document.body&&(ue.style.position="absolute",jt(S.style,{margin:0,padding:0}));function me(){var Ae=window.innerWidth,Le=window.innerHeight;if(S!==document.body){var Oe=ue.getBoundingClientRect();Ae=Oe.right-Oe.left,Le=Oe.bottom-Oe.top}ue.width=Q*Ae,ue.height=Q*Le}var de;S!==document.body&&typeof ResizeObserver=="function"?(de=new ResizeObserver(function(){setTimeout(me)}),de.observe(S)):window.addEventListener("resize",me,!1);function be(){de?de.disconnect():window.removeEventListener("resize",me),S.removeChild(ue)}return me(),{canvas:ue,onDestroy:be}},De=function(S,B){function Q(ue){try{return S.getContext(ue,B)}catch(me){return null}}return Q("webgl")||Q("experimental-webgl")||Q("webgl-experimental")},tt=function(S){return typeof S.nodeName=="string"&&typeof S.appendChild=="function"&&typeof S.getBoundingClientRect=="function"},je=function(S){return typeof S.drawArrays=="function"||typeof S.drawElements=="function"},Fe=function(S){return typeof S=="string"?S.split():(V(Array.isArray(S),"invalid extension array"),S)},Ge=function(S){return typeof S=="string"?(V(typeof document!="undefined","not supported outside of DOM"),document.querySelector(S)):S},Et=function(S){var B=S||{},Q,ue,me,de,be={},Ae=[],Le=[],Oe=typeof window=="undefined"?1:window.devicePixelRatio,ze=!1,$e=function(le){le&&V.raise(le)},ke=function(){};if(typeof B=="string"?(V(typeof document!="undefined","selector queries only supported in DOM enviroments"),Q=document.querySelector(B),V(Q,"invalid query string for element")):typeof B=="object"?tt(B)?Q=B:je(B)?(de=B,me=de.canvas):(V.constructor(B),"gl"in B?de=B.gl:"canvas"in B?me=Ge(B.canvas):"container"in B&&(ue=Ge(B.container)),"attributes"in B&&(be=B.attributes,V.type(be,"object","invalid context attributes")),"extensions"in B&&(Ae=Fe(B.extensions)),"optionalExtensions"in B&&(Le=Fe(B.optionalExtensions)),"onDone"in B&&(V.type(B.onDone,"function","invalid or missing onDone callback"),$e=B.onDone),"profile"in B&&(ze=!!B.profile),"pixelRatio"in B&&(Oe=+B.pixelRatio,V(Oe>0,"invalid pixel ratio"))):V.raise("invalid arguments to regl"),Q&&(Q.nodeName.toLowerCase()==="canvas"?me=Q:ue=Q),!de){if(!me){V(typeof document!="undefined","must manually specify webgl context outside of DOM environments");var Ie=Pe(ue||document.body,$e,Oe);if(!Ie)return null;me=Ie.canvas,ke=Ie.onDestroy}be.premultipliedAlpha===void 0&&(be.premultipliedAlpha=!0),de=De(me,be)}return de?{gl:de,canvas:me,container:ue,extensions:Ae,optionalExtensions:Le,pixelRatio:Oe,profile:ze,onDone:$e,onDestroy:ke}:(ke(),$e("webgl not supported, try upgrading your browser or graphics drivers http://get.webgl.org"),null)},st=function(S,B){var Q={};function ue(be){V.type(be,"string","extension name must be string");var Ae=be.toLowerCase(),Le;try{Le=Q[Ae]=S.getExtension(Ae)}catch(Oe){}return!!Le}for(var me=0;me<B.extensions.length;++me){var de=B.extensions[me];if(!ue(de))return B.onDestroy(),B.onDone('"'+de+'" extension is not supported by the current WebGL context, try upgrading your system or a different browser'),null}return B.optionalExtensions.forEach(ue),{extensions:Q,restore:function(){Object.keys(Q).forEach(function(Ae){if(Q[Ae]&&!ue(Ae))throw new Error("(regl): error restoring extension "+Ae)})}}},at=function(S,B){for(var Q=Array(S),ue=0;ue<S;++ue)Q[ue]=B(ue);return Q},$t=function(S){for(var B=16;B<=268435456;B*=16)if(S<=B)return B;return 0},kt=function(S){var B,Q;return B=(S>65535)<<4,S>>>=B,Q=(S>255)<<3,S>>>=Q,B|=Q,Q=(S>15)<<2,S>>>=Q,B|=Q,Q=(S>3)<<1,S>>>=Q,B|=Q,B|S>>1},Rt=function(){var S=at(8,function(){return[]});function B(de){var be=$t(de),Ae=S[kt(be)>>2];return Ae.length>0?Ae.pop():new ArrayBuffer(be)}function Q(de){S[kt(de.byteLength)>>2].push(de)}function ue(de,be){var Ae=null;switch(de){case ws:Ae=new Int8Array(B(be),0,be);break;case Ps:Ae=new Uint8Array(B(be),0,be);break;case As:Ae=new Int16Array(B(2*be),0,be);break;case Es:Ae=new Uint16Array(B(2*be),0,be);break;case $s:Ae=new Int32Array(B(4*be),0,be);break;case Os:Ae=new Uint32Array(B(4*be),0,be);break;case Ls:Ae=new Float32Array(B(4*be),0,be);break;default:return null}return Ae.length!==be?Ae.subarray(0,be):Ae}function me(de){Q(de.buffer)}return{alloc:B,free:Q,allocType:ue,freeType:me}},Tt=function(S){return!!S&&typeof S=="object"&&Array.isArray(S.shape)&&Array.isArray(S.stride)&&typeof S.offset=="number"&&S.shape.length===S.stride.length&&(Array.isArray(S.data)||rr(S.data))},bt=function(S,B,Q){for(var ue=0;ue<B;++ue)Q[ue]=S[ue]},Ot=function(S,B,Q,ue){for(var me=0,de=0;de<B;++de)for(var be=S[de],Ae=0;Ae<Q;++Ae)ue[me++]=be[Ae]},Lt=function(S,B,Q,ue,me,de){for(var be=de,Ae=0;Ae<B;++Ae)for(var Le=S[Ae],Oe=0;Oe<Q;++Oe)for(var ze=Le[Oe],$e=0;$e<ue;++$e)me[be++]=ze[$e]},xt=function(S,B,Q,ue){var me=1;if(B.length)for(var de=0;de<B.length;++de)me*=B[de];else me=0;var be=ue||Wt.allocType(Q,me);switch(B.length){case 0:break;case 1:bt(S,B[0],be);break;case 2:Ot(S,B[0],B[1],be);break;case 3:Lt(S,B[0],B[1],B[2],be,0);break;default:Ca(S,B,0,be,0)}return be},ht=function(S){for(var B=[],Q=S;Q.length;Q=Q[0])B.push(Q.length);return B},ot=function(S){return di[Object.prototype.toString.call(S)]|0},mt=function(S,B){for(var Q=0;Q<B.length;++Q)S[Q]=B[Q]},nt=function(S,B,Q,ue,me,de,be){for(var Ae=0,Le=0;Le<Q;++Le)for(var Oe=0;Oe<ue;++Oe)S[Ae++]=B[me*Le+de*Oe+be]},Ut=function(S,B,Q,ue){var me=0,de={};function be(le){this.id=me++,this.buffer=S.createBuffer(),this.type=le,this.usage=wa,this.byteLength=0,this.dimension=1,this.dtype=vi,this.persistentData=null,Q.profile&&(this.stats={size:0})}be.prototype.bind=function(){S.bindBuffer(this.type,this.buffer)},be.prototype.destroy=function(){ke(this)};var Ae=[];function Le(le,se){var Se=Ae.pop();return Se||(Se=new be(le)),Se.bind(),$e(Se,se,bl,0,1,!1),Se}function Oe(le){Ae.push(le)}function ze(le,se,Se){le.byteLength=se.byteLength,S.bufferData(le.type,se,Se)}function $e(le,se,Se,Ye,ye,rt){var Je;if(le.usage=Se,Array.isArray(se)){if(le.dtype=Ye||mi,se.length>0){var He;if(Array.isArray(se[0])){Je=Sa(se);for(var xe=1,pe=1;pe<Je.length;++pe)xe*=Je[pe];le.dimension=xe,He=pi(se,Je,le.dtype),ze(le,He,Se),rt?le.persistentData=He:Wt.freeType(He)}else if(typeof se[0]=="number"){le.dimension=ye;var Xe=Wt.allocType(le.dtype,se.length);mt(Xe,se),ze(le,Xe,Se),rt?le.persistentData=Xe:Wt.freeType(Xe)}else rr(se[0])?(le.dimension=se[0].length,le.dtype=Ye||ot(se[0])||mi,He=pi(se,[se.length,se[0].length],le.dtype),ze(le,He,Se),rt?le.persistentData=He:Wt.freeType(He)):V.raise("invalid buffer data")}}else if(rr(se))le.dtype=Ye||ot(se),le.dimension=ye,ze(le,se,Se),rt&&(le.persistentData=new Uint8Array(new Uint8Array(se.buffer)));else if(Tt(se)){Je=se.shape;var Ne=se.stride,Me=se.offset,Be=0,Ve=0,pt=0,dt=0;Je.length===1?(Be=Je[0],Ve=1,pt=Ne[0],dt=0):Je.length===2?(Be=Je[0],Ve=Je[1],pt=Ne[0],dt=Ne[1]):V.raise("invalid shape"),le.dtype=Ye||ot(se.data)||mi,le.dimension=Ve;var Ue=Wt.allocType(le.dtype,Be*Ve);nt(Ue,se.data,Be,Ve,pt,dt,Me),ze(le,Ue,Se),rt?le.persistentData=Ue:Wt.freeType(Ue)}else _instanceof$2(se,ArrayBuffer)?(le.dtype=vi,le.dimension=ye,ze(le,se,Se),rt&&(le.persistentData=new Uint8Array(new Uint8Array(se)))):V.raise("invalid buffer data")}function ke(le){B.bufferCount--,ue(le);var se=le.buffer;V(se,"buffer must not be deleted already"),S.deleteBuffer(se),le.buffer=null,delete de[le.id]}function Ie(le,se,Se,Ye){B.bufferCount++;var ye=new be(se);de[ye.id]=ye;function rt(xe){var pe=wa,Xe=null,Ne=0,Me=0,Be=1;return Array.isArray(xe)||rr(xe)||Tt(xe)||_instanceof$2(xe,ArrayBuffer)?Xe=xe:typeof xe=="number"?Ne=xe|0:xe&&(V.type(xe,"object","buffer arguments must be an object, a number or an array"),"data"in xe&&(V(Xe===null||Array.isArray(Xe)||rr(Xe)||Tt(Xe),"invalid data for buffer"),Xe=xe.data),"usage"in xe&&(V.parameter(xe.usage,Rn,"invalid buffer usage"),pe=Rn[xe.usage]),"type"in xe&&(V.parameter(xe.type,Lr,"invalid buffer type"),Me=Lr[xe.type]),"dimension"in xe&&(V.type(xe.dimension,"number","invalid dimension"),Be=xe.dimension|0),"length"in xe&&(V.nni(Ne,"buffer length must be a nonnegative integer"),Ne=xe.length|0)),ye.bind(),Xe?$e(ye,Xe,pe,Me,Be,Ye):(Ne&&S.bufferData(ye.type,Ne,pe),ye.dtype=Me||vi,ye.usage=pe,ye.dimension=Be,ye.byteLength=Ne),Q.profile&&(ye.stats.size=ye.byteLength*Sr[ye.dtype]),rt}function Je(xe,pe){V(pe+xe.byteLength<=ye.byteLength,"invalid buffer subdata call, buffer is too small.  Can't write data of size "+xe.byteLength+" starting from offset "+pe+" to a buffer of size "+ye.byteLength),S.bufferSubData(ye.type,pe,xe)}function He(xe,pe){var Xe=(pe||0)|0,Ne;if(ye.bind(),rr(xe)||_instanceof$2(xe,ArrayBuffer))Je(xe,Xe);else if(Array.isArray(xe)){if(xe.length>0)if(typeof xe[0]=="number"){var Me=Wt.allocType(ye.dtype,xe.length);mt(Me,xe),Je(Me,Xe),Wt.freeType(Me)}else if(Array.isArray(xe[0])||rr(xe[0])){Ne=Sa(xe);var Be=pi(xe,Ne,ye.dtype);Je(Be,Xe),Wt.freeType(Be)}else V.raise("invalid buffer data")}else if(Tt(xe)){Ne=xe.shape;var Ve=xe.stride,pt=0,dt=0,Ue=0,qe=0;Ne.length===1?(pt=Ne[0],dt=1,Ue=Ve[0],qe=0):Ne.length===2?(pt=Ne[0],dt=Ne[1],Ue=Ve[0],qe=Ve[1]):V.raise("invalid shape");var lt=Array.isArray(xe.data)?ye.dtype:ot(xe.data),vt=Wt.allocType(lt,pt*dt);nt(vt,xe.data,pt,dt,Ue,qe,xe.offset),Je(vt,Xe),Wt.freeType(vt)}else V.raise("invalid data for buffer subdata");return rt}return Se||rt(le),rt._reglType="buffer",rt._buffer=ye,rt.subdata=He,Q.profile&&(rt.stats=ye.stats),rt.destroy=function(){ke(ye)},rt}function Ee(){cr(de).forEach(function(le){le.buffer=S.createBuffer(),S.bindBuffer(le.type,le.buffer),S.bufferData(le.type,le.persistentData||le.byteLength,le.usage)})}return Q.profile&&(B.getTotalBufferSize=function(){var le=0;return Object.keys(de).forEach(function(se){le+=de[se].stats.size}),le}),{create:Ie,createStream:Le,destroyStream:Oe,clear:function(){cr(de).forEach(ke),Ae.forEach(ke)},getBuffer:function(se){return se&&_instanceof$2(se._buffer,be)?se._buffer:null},restore:Ee,_initBuffer:$e}},Dt=function(S,B,Q,ue){var me={},de=0,be={uint8:Wr,uint16:Yr};B.oes_element_index_uint&&(be.uint32=Mr);function Ae(Ee){this.id=de++,me[this.id]=this,this.buffer=Ee,this.primType=fn,this.vertCount=0,this.type=0}Ae.prototype.bind=function(){this.buffer.bind()};var Le=[];function Oe(Ee){var le=Le.pop();return le||(le=new Ae(Q.create(null,gi,!0,!1)._buffer)),$e(le,Ee,Ll,-1,-1,0,0),le}function ze(Ee){Le.push(Ee)}function $e(Ee,le,se,Se,Ye,ye,rt){Ee.buffer.bind();var Je;if(le){var He=rt;!rt&&(!rr(le)||Tt(le)&&!rr(le.data))&&(He=B.oes_element_index_uint?Mr:Yr),Q._initBuffer(Ee.buffer,le,se,He,3)}else S.bufferData(gi,ye,se),Ee.buffer.dtype=Je||Wr,Ee.buffer.usage=se,Ee.buffer.dimension=3,Ee.buffer.byteLength=ye;if(Je=rt,!rt){switch(Ee.buffer.dtype){case Wr:case Ol:Je=Wr;break;case Yr:case Pa:Je=Yr;break;case Mr:case Aa:Je=Mr;break;default:V.raise("unsupported type for element array")}Ee.buffer.dtype=Je}Ee.type=Je,V(Je!==Mr||!!B.oes_element_index_uint,"32 bit element buffers not supported, enable oes_element_index_uint first");var xe=Ye;xe<0&&(xe=Ee.buffer.byteLength,Je===Yr?xe>>=1:Je===Mr&&(xe>>=2)),Ee.vertCount=xe;var pe=Se;if(Se<0){pe=fn;var Xe=Ee.buffer.dimension;Xe===1&&(pe=El),Xe===2&&(pe=$l),Xe===3&&(pe=fn)}Ee.primType=pe}function ke(Ee){ue.elementsCount--,V(Ee.buffer!==null,"must not double destroy elements"),delete me[Ee.id],Ee.buffer.destroy(),Ee.buffer=null}function Ie(Ee,le){var se=Q.create(null,gi,!0),Se=new Ae(se._buffer);ue.elementsCount++;function Ye(ye){if(!ye)se(),Se.primType=fn,Se.vertCount=0,Se.type=Wr;else if(typeof ye=="number")se(ye),Se.primType=fn,Se.vertCount=ye|0,Se.type=Wr;else{var rt=null,Je=Ml,He=-1,xe=-1,pe=0,Xe=0;Array.isArray(ye)||rr(ye)||Tt(ye)?rt=ye:(V.type(ye,"object","invalid arguments for elements"),"data"in ye&&(rt=ye.data,V(Array.isArray(rt)||rr(rt)||Tt(rt),"invalid data for element buffer")),"usage"in ye&&(V.parameter(ye.usage,Rn,"invalid element buffer usage"),Je=Rn[ye.usage]),"primitive"in ye&&(V.parameter(ye.primitive,wr,"invalid element buffer primitive"),He=wr[ye.primitive]),"count"in ye&&(V(typeof ye.count=="number"&&ye.count>=0,"invalid vertex count for elements"),xe=ye.count|0),"type"in ye&&(V.parameter(ye.type,be,"invalid buffer type"),Xe=be[ye.type]),"length"in ye?pe=ye.length|0:(pe=xe,Xe===Yr||Xe===Pa?pe*=2:(Xe===Mr||Xe===Aa)&&(pe*=4))),$e(Se,rt,Je,He,xe,pe,Xe)}return Ye}return Ye(Ee),Ye._reglType="elements",Ye._elements=Se,Ye.subdata=function(ye,rt){return se.subdata(ye,rt),Ye},Ye.destroy=function(){ke(Se)},Ye}return{create:Ie,createStream:Oe,destroyStream:ze,getElements:function(le){return typeof le=="function"&&_instanceof$2(le._elements,Ae)?le._elements:null},clear:function(){cr(me).forEach(ke)}}},ft=function(S){for(var B=Wt.allocType(Rl,S.length),Q=0;Q<S.length;++Q)if(isNaN(S[Q]))B[Q]=65535;else if(S[Q]===1/0)B[Q]=31744;else if(S[Q]===-1/0)B[Q]=64512;else{Ea[0]=S[Q];var ue=Tl[0],me=ue>>>31<<15,de=(ue<<1>>>24)-127,be=ue>>13&(1<<10)-1;if(de<-24)B[Q]=me;else if(de<-14){var Ae=-14-de;B[Q]=me+(be+1024>>Ae)}else de>15?B[Q]=me+31744:B[Q]=me+(de+15<<10)+be}return B},Ct=function(S){return Array.isArray(S)||rr(S)},St=function(S){return"[object "+S+"]"},zt=function(S){return Array.isArray(S)&&(S.length===0||typeof S[0]=="number")},Nt=function(S){if(!Array.isArray(S))return!1;var B=S.length;return!(B===0||!Ct(S[0]))},Vt=function(S){return Object.prototype.toString.call(S)},$r=function(S){return Vt(S)===Ga},Ur=function(S){return Vt(S)===Ua},En=function(S){return Vt(S)===ja},si=function(S){return Vt(S)===qa},jr=function(S){return Vt(S)===Ha},Ko=function(S){return Vt(S)===Wa},li=function(S){if(!S)return!1;var B=Vt(S);return tu.indexOf(B)>=0?!0:zt(S)||Nt(S)||Tt(S)},aa=function(S){return di[Object.prototype.toString.call(S)]|0},Zo=function(S,B){var Q=B.length;switch(S.type){case Qr:case $i:case Oi:case hn:var ue=Wt.allocType(S.type,Q);ue.set(B),S.data=ue;break;case Xr:S.data=ft(B);break;default:V.raise("unsupported texture type, must specify a typed array")}},oa=function(S,B){return Wt.allocType(S.type===Xr?hn:S.type,B)},sa=function(S,B){S.type===Xr?(S.data=ft(B),Wt.freeType(B)):S.data=B},Jo=function(S,B,Q,ue,me,de){for(var be=S.width,Ae=S.height,Le=S.channels,Oe=be*Ae*Le,ze=oa(S,Oe),$e=0,ke=0;ke<Ae;++ke)for(var Ie=0;Ie<be;++Ie)for(var Ee=0;Ee<Le;++Ee)ze[$e++]=B[Q*Ie+ue*ke+me*Ee+de];sa(S,ze)},$n=function(S,B,Q,ue,me,de){var be;if(typeof nr[S]!="undefined"?be=nr[S]:be=pr[S]*Kr[B],de&&(be*=6),me){for(var Ae=0,Le=Q;Le>=1;)Ae+=be*Le*Le,Le/=2;return Ae}else return be*Q*ue},es=function(S,B,Q,ue,me,de,be){var Ae={"don't care":Dn,"dont care":Dn,nice:Yl,fast:Wl},Le={repeat:Vl,clamp:Li,mirror:Gl},Oe={nearest:Mi,linear:ql},ze=jt({mipmap:Ri,"nearest mipmap nearest":Ti,"linear mipmap nearest":Ba,"nearest mipmap linear":Na,"linear mipmap linear":Ri},Oe),$e={none:0,browser:Va},ke={uint8:Qr,rgba4:Il,rgb565:Fl,"rgb5 a1":zl},Ie={alpha:_i,luminance:cn,"luminance alpha":zn,rgb:In,rgba:Tr,rgba4:Oa,"rgb5 a1":bi,rgb565:La},Ee={};B.ext_srgb&&(Ie.srgb=Ci,Ie.srgba=Si),B.oes_texture_float&&(ke.float32=ke.float=hn),B.oes_texture_half_float&&(ke.float16=ke["half float"]=Xr),B.webgl_depth_texture&&(jt(Ie,{depth:xi,"depth stencil":Fn}),jt(ke,{uint16:$i,uint32:Oi,"depth stencil":Dl})),B.webgl_compressed_texture_s3tc&&jt(Ee,{"rgb s3tc dxt1":wi,"rgba s3tc dxt1":Pi,"rgba s3tc dxt3":Ai,"rgba s3tc dxt5":Ei}),B.webgl_compressed_texture_atc&&jt(Ee,{"rgb atc":Ma,"rgba atc explicit alpha":Ta,"rgba atc interpolated alpha":Ra}),B.webgl_compressed_texture_pvrtc&&jt(Ee,{"rgb pvrtc 4bppv1":ka,"rgb pvrtc 2bppv1":Ia,"rgba pvrtc 4bppv1":za,"rgba pvrtc 2bppv1":Fa}),B.webgl_compressed_texture_etc1&&(Ee["rgb etc1"]=Da);var le=Array.prototype.slice.call(S.getParameter(kl));Object.keys(Ee).forEach(function(H){var he=Ee[H];le.indexOf(he)>=0&&(Ie[H]=he)});var se=Object.keys(Ie);Q.textureFormats=se;var Se=[];Object.keys(Ie).forEach(function(H){var he=Ie[H];Se[he]=H});var Ye=[];Object.keys(ke).forEach(function(H){var he=ke[H];Ye[he]=H});var ye=[];Object.keys(Oe).forEach(function(H){var he=Oe[H];ye[he]=H});var rt=[];Object.keys(ze).forEach(function(H){var he=ze[H];rt[he]=H});var Je=[];Object.keys(Le).forEach(function(H){var he=Le[H];Je[he]=H});var He=se.reduce(function(H,he){var ae=Ie[he];return ae===cn||ae===_i||ae===cn||ae===zn||ae===xi||ae===Fn||B.ext_srgb&&(ae===Ci||ae===Si)?H[ae]=ae:ae===bi||he.indexOf("rgba")>=0?H[ae]=Tr:H[ae]=In,H},{});function xe(){this.internalformat=Tr,this.format=Tr,this.type=Qr,this.compressed=!1,this.premultiplyAlpha=!1,this.flipY=!1,this.unpackAlignment=1,this.colorSpace=Va,this.width=0,this.height=0,this.channels=0}function pe(H,he){H.internalformat=he.internalformat,H.format=he.format,H.type=he.type,H.compressed=he.compressed,H.premultiplyAlpha=he.premultiplyAlpha,H.flipY=he.flipY,H.unpackAlignment=he.unpackAlignment,H.colorSpace=he.colorSpace,H.width=he.width,H.height=he.height,H.channels=he.channels}function Xe(H,he){if(!(typeof he!="object"||!he)){if("premultiplyAlpha"in he&&(V.type(he.premultiplyAlpha,"boolean","invalid premultiplyAlpha"),H.premultiplyAlpha=he.premultiplyAlpha),"flipY"in he&&(V.type(he.flipY,"boolean","invalid texture flip"),H.flipY=he.flipY),"alignment"in he&&(V.oneOf(he.alignment,[1,2,4,8],"invalid texture unpack alignment"),H.unpackAlignment=he.alignment),"colorSpace"in he&&(V.parameter(he.colorSpace,$e,"invalid colorSpace"),H.colorSpace=$e[he.colorSpace]),"type"in he){var ae=he.type;V(B.oes_texture_float||!(ae==="float"||ae==="float32"),"you must enable the OES_texture_float extension in order to use floating point textures."),V(B.oes_texture_half_float||!(ae==="half float"||ae==="float16"),"you must enable the OES_texture_half_float extension in order to use 16-bit floating point textures."),V(B.webgl_depth_texture||!(ae==="uint16"||ae==="uint32"||ae==="depth stencil"),"you must enable the WEBGL_depth_texture extension in order to use depth/stencil textures."),V.parameter(ae,ke,"invalid texture type"),H.type=ke[ae]}var Ze=H.width,_t=H.height,G=H.channels,z=!1;"shape"in he?(V(Array.isArray(he.shape)&&he.shape.length>=2,"shape must be an array"),Ze=he.shape[0],_t=he.shape[1],he.shape.length===3&&(G=he.shape[2],V(G>0&&G<=4,"invalid number of channels"),z=!0),V(Ze>=0&&Ze<=Q.maxTextureSize,"invalid width"),V(_t>=0&&_t<=Q.maxTextureSize,"invalid height")):("radius"in he&&(Ze=_t=he.radius,V(Ze>=0&&Ze<=Q.maxTextureSize,"invalid radius")),"width"in he&&(Ze=he.width,V(Ze>=0&&Ze<=Q.maxTextureSize,"invalid width")),"height"in he&&(_t=he.height,V(_t>=0&&_t<=Q.maxTextureSize,"invalid height")),"channels"in he&&(G=he.channels,V(G>0&&G<=4,"invalid number of channels"),z=!0)),H.width=Ze|0,H.height=_t|0,H.channels=G|0;var J=!1;if("format"in he){var ne=he.format;V(B.webgl_depth_texture||!(ne==="depth"||ne==="depth stencil"),"you must enable the WEBGL_depth_texture extension in order to use depth/stencil textures."),V.parameter(ne,Ie,"invalid texture format");var ie=H.internalformat=Ie[ne];H.format=He[ie],ne in ke&&("type"in he||(H.type=ke[ne])),ne in Ee&&(H.compressed=!0),J=!0}!z&&J?H.channels=pr[H.format]:z&&!J?H.channels!==Bn[H.format]&&(H.format=H.internalformat=Bn[H.channels]):J&&z&&V(H.channels===pr[H.format],"number of channels inconsistent with specified format")}}function Ne(H){S.pixelStorei(Kl,H.flipY),S.pixelStorei(Zl,H.premultiplyAlpha),S.pixelStorei(Jl,H.colorSpace),S.pixelStorei(Ql,H.unpackAlignment)}function Me(){xe.call(this),this.xOffset=0,this.yOffset=0,this.data=null,this.needsFree=!1,this.element=null,this.needsCopy=!1}function Be(H,he){var ae=null;if(li(he)?ae=he:he&&(V.type(he,"object","invalid pixel data type"),Xe(H,he),"x"in he&&(H.xOffset=he.x|0),"y"in he&&(H.yOffset=he.y|0),li(he.data)&&(ae=he.data)),V(!H.compressed||_instanceof$2(ae,Uint8Array),"compressed texture data must be stored in a uint8array"),he.copy){V(!ae,"can not specify copy and data field for the same texture");var Ze=me.viewportWidth,_t=me.viewportHeight;H.width=H.width||Ze-H.xOffset,H.height=H.height||_t-H.yOffset,H.needsCopy=!0,V(H.xOffset>=0&&H.xOffset<Ze&&H.yOffset>=0&&H.yOffset<_t&&H.width>0&&H.width<=Ze&&H.height>0&&H.height<=_t,"copy texture read out of bounds")}else if(!ae)H.width=H.width||1,H.height=H.height||1,H.channels=H.channels||4;else if(rr(ae))H.channels=H.channels||4,H.data=ae,!("type"in he)&&H.type===Qr&&(H.type=aa(ae));else if(zt(ae))H.channels=H.channels||4,Zo(H,ae),H.alignment=1,H.needsFree=!0;else if(Tt(ae)){var G=ae.data;!Array.isArray(G)&&H.type===Qr&&(H.type=aa(G));var z=ae.shape,J=ae.stride,ne,ie,te,ee,re,j;z.length===3?(te=z[2],j=J[2]):(V(z.length===2,"invalid ndarray pixel data, must be 2 or 3D"),te=1,j=1),ne=z[0],ie=z[1],ee=J[0],re=J[1],H.alignment=1,H.width=ne,H.height=ie,H.channels=te,H.format=H.internalformat=Bn[te],H.needsFree=!0,Jo(H,G,ee,re,j,ae.offset)}else if($r(ae)||Ur(ae)||En(ae))$r(ae)||Ur(ae)?H.element=ae:H.element=ae.canvas,H.width=H.element.width,H.height=H.element.height,H.channels=4;else if(si(ae))H.element=ae,H.width=ae.width,H.height=ae.height,H.channels=4;else if(jr(ae))H.element=ae,H.width=ae.naturalWidth,H.height=ae.naturalHeight,H.channels=4;else if(Ko(ae))H.element=ae,H.width=ae.videoWidth,H.height=ae.videoHeight,H.channels=4;else if(Nt(ae)){var Z=H.width||ae[0].length,N=H.height||ae.length,oe=H.channels;Ct(ae[0][0])?oe=oe||ae[0][0].length:oe=oe||1;for(var ce=Tn.shape(ae),Ce=1,we=0;we<ce.length;++we)Ce*=ce[we];var Re=oa(H,Ce);Tn.flatten(ae,ce,"",Re),sa(H,Re),H.alignment=1,H.width=Z,H.height=N,H.channels=oe,H.format=H.internalformat=Bn[oe],H.needsFree=!0}H.type===hn?V(Q.extensions.indexOf("oes_texture_float")>=0,"oes_texture_float extension not enabled"):H.type===Xr&&V(Q.extensions.indexOf("oes_texture_half_float")>=0,"oes_texture_half_float extension not enabled")}function Ve(H,he,ae){var Ze=H.element,_t=H.data,G=H.internalformat,z=H.format,J=H.type,ne=H.width,ie=H.height;Ne(H),Ze?S.texImage2D(he,ae,z,z,J,Ze):H.compressed?S.compressedTexImage2D(he,ae,G,ne,ie,0,_t):H.needsCopy?(ue(),S.copyTexImage2D(he,ae,z,H.xOffset,H.yOffset,ne,ie,0)):S.texImage2D(he,ae,z,ne,ie,0,z,J,_t||null)}function pt(H,he,ae,Ze,_t){var G=H.element,z=H.data,J=H.internalformat,ne=H.format,ie=H.type,te=H.width,ee=H.height;Ne(H),G?S.texSubImage2D(he,_t,ae,Ze,ne,ie,G):H.compressed?S.compressedTexSubImage2D(he,_t,ae,Ze,J,te,ee,z):H.needsCopy?(ue(),S.copyTexSubImage2D(he,_t,ae,Ze,H.xOffset,H.yOffset,te,ee)):S.texSubImage2D(he,_t,ae,Ze,te,ee,ne,ie,z)}var dt=[];function Ue(){return dt.pop()||new Me}function qe(H){H.needsFree&&Wt.freeType(H.data),Me.call(H),dt.push(H)}function lt(){xe.call(this),this.genMipmaps=!1,this.mipmapHint=Dn,this.mipmask=0,this.images=Array(16)}function vt(H,he,ae){var Ze=H.images[0]=Ue();H.mipmask=1,Ze.width=H.width=he,Ze.height=H.height=ae,Ze.channels=H.channels=4}function wt(H,he){var ae=null;if(li(he))ae=H.images[0]=Ue(),pe(ae,H),Be(ae,he),H.mipmask=1;else if(Xe(H,he),Array.isArray(he.mipmap))for(var Ze=he.mipmap,_t=0;_t<Ze.length;++_t)ae=H.images[_t]=Ue(),pe(ae,H),ae.width>>=_t,ae.height>>=_t,Be(ae,Ze[_t]),H.mipmask|=1<<_t;else ae=H.images[0]=Ue(),pe(ae,H),Be(ae,he),H.mipmask=1;pe(H,H.images[0]),H.compressed&&(H.internalformat===wi||H.internalformat===Pi||H.internalformat===Ai||H.internalformat===Ei)&&V(H.width%4===0&&H.height%4===0,"for compressed texture formats, mipmap level 0 must have width and height that are a multiple of 4")}function Bt(H,he){for(var ae=H.images,Ze=0;Ze<ae.length;++Ze){if(!ae[Ze])return;Ve(ae[Ze],he,Ze)}}var Gt=[];function Pt(){var H=Gt.pop()||new lt;xe.call(H),H.mipmask=0;for(var he=0;he<16;++he)H.images[he]=null;return H}function Xt(H){for(var he=H.images,ae=0;ae<he.length;++ae)he[ae]&&qe(he[ae]),he[ae]=null;Gt.push(H)}function It(){this.minFilter=Mi,this.magFilter=Mi,this.wrapS=Li,this.wrapT=Li,this.anisotropic=1,this.genMipmaps=!1,this.mipmapHint=Dn}function Yt(H,he){if("min"in he){var ae=he.min;V.parameter(ae,ze),H.minFilter=ze[ae],eu.indexOf(H.minFilter)>=0&&!("faces"in he)&&(H.genMipmaps=!0)}if("mag"in he){var Ze=he.mag;V.parameter(Ze,Oe),H.magFilter=Oe[Ze]}var _t=H.wrapS,G=H.wrapT;if("wrap"in he){var z=he.wrap;typeof z=="string"?(V.parameter(z,Le),_t=G=Le[z]):Array.isArray(z)&&(V.parameter(z[0],Le),V.parameter(z[1],Le),_t=Le[z[0]],G=Le[z[1]])}else{if("wrapS"in he){var J=he.wrapS;V.parameter(J,Le),_t=Le[J]}if("wrapT"in he){var ne=he.wrapT;V.parameter(ne,Le),G=Le[ne]}}if(H.wrapS=_t,H.wrapT=G,"anisotropic"in he){var ie=he.anisotropic;V(typeof ie=="number"&&ie>=1&&ie<=Q.maxAnisotropic,"aniso samples must be between 1 and "),H.anisotropic=he.anisotropic}if("mipmap"in he){var te=!1;switch(_typeof$2(he.mipmap)){case"string":V.parameter(he.mipmap,Ae,"invalid mipmap hint"),H.mipmapHint=Ae[he.mipmap],H.genMipmaps=!0,te=!0;break;case"boolean":te=H.genMipmaps=he.mipmap;break;case"object":V(Array.isArray(he.mipmap),"invalid mipmap type"),H.genMipmaps=!1,te=!0;break;default:V.raise("invalid mipmap type")}te&&!("min"in he)&&(H.minFilter=Ti)}}function Qt(H,he){S.texParameteri(he,jl,H.minFilter),S.texParameteri(he,Ul,H.magFilter),S.texParameteri(he,Bl,H.wrapS),S.texParameteri(he,Nl,H.wrapT),B.ext_texture_filter_anisotropic&&S.texParameteri(he,Xl,H.anisotropic),H.genMipmaps&&(S.hint(Hl,H.mipmapHint),S.generateMipmap(he))}var Kt=0,Jt={},ir=Q.maxTextureUnits,qt=Array(ir).map(function(){return null});function yt(H){xe.call(this),this.mipmask=0,this.internalformat=Tr,this.id=Kt++,this.refCount=1,this.target=H,this.texture=S.createTexture(),this.unit=-1,this.bindCount=0,this.texInfo=new It,be.profile&&(this.stats={size:0})}function ar(H){S.activeTexture(dn),S.bindTexture(H.target,H.texture)}function Mt(){var H=qt[0];H?S.bindTexture(H.target,H.texture):S.bindTexture(gr,null)}function ut(H){var he=H.texture;V(he,"must not double destroy texture");var ae=H.unit,Ze=H.target;ae>=0&&(S.activeTexture(dn+ae),S.bindTexture(Ze,null),qt[ae]=null),S.deleteTexture(he),H.texture=null,H.params=null,H.pixels=null,H.refCount=0,delete Jt[H.id],de.textureCount--}jt(yt.prototype,{bind:function(){var he=this;he.bindCount+=1;var ae=he.unit;if(ae<0){for(var Ze=0;Ze<ir;++Ze){var _t=qt[Ze];if(_t){if(_t.bindCount>0)continue;_t.unit=-1}qt[Ze]=he,ae=Ze;break}ae>=ir&&V.raise("insufficient number of texture units"),be.profile&&de.maxTextureUnits<ae+1&&(de.maxTextureUnits=ae+1),he.unit=ae,S.activeTexture(dn+ae),S.bindTexture(he.target,he.texture)}return ae},unbind:function(){this.bindCount-=1},decRef:function(){--this.refCount<=0&&ut(this)}});function gt(H,he){var ae=new yt(gr);Jt[ae.id]=ae,de.textureCount++;function Ze(z,J){var ne=ae.texInfo;It.call(ne);var ie=Pt();return typeof z=="number"?typeof J=="number"?vt(ie,z|0,J|0):vt(ie,z|0,z|0):z?(V.type(z,"object","invalid arguments to regl.texture"),Yt(ne,z),wt(ie,z)):vt(ie,1,1),ne.genMipmaps&&(ie.mipmask=(ie.width<<1)-1),ae.mipmask=ie.mipmask,pe(ae,ie),V.texture2D(ne,ie,Q),ae.internalformat=ie.internalformat,Ze.width=ie.width,Ze.height=ie.height,ar(ae),Bt(ie,gr),Qt(ne,gr),Mt(),Xt(ie),be.profile&&(ae.stats.size=$n(ae.internalformat,ae.type,ie.width,ie.height,ne.genMipmaps,!1)),Ze.format=Se[ae.internalformat],Ze.type=Ye[ae.type],Ze.mag=ye[ne.magFilter],Ze.min=rt[ne.minFilter],Ze.wrapS=Je[ne.wrapS],Ze.wrapT=Je[ne.wrapT],Ze}function _t(z,J,ne,ie){V(!!z,"must specify image data");var te=J|0,ee=ne|0,re=ie|0,j=Ue();return pe(j,ae),j.width=0,j.height=0,Be(j,z),j.width=j.width||(ae.width>>re)-te,j.height=j.height||(ae.height>>re)-ee,V(ae.type===j.type&&ae.format===j.format&&ae.internalformat===j.internalformat,"incompatible format for texture.subimage"),V(te>=0&&ee>=0&&te+j.width<=ae.width&&ee+j.height<=ae.height,"texture.subimage write out of bounds"),V(ae.mipmask&1<<re,"missing mipmap data"),V(j.data||j.element||j.needsCopy,"missing image data"),ar(ae),pt(j,gr,te,ee,re),Mt(),qe(j),Ze}function G(z,J){var ne=z|0,ie=J|0||ne;if(ne===ae.width&&ie===ae.height)return Ze;Ze.width=ae.width=ne,Ze.height=ae.height=ie,ar(ae);for(var te=0;ae.mipmask>>te;++te){var ee=ne>>te,re=ie>>te;if(!ee||!re)break;S.texImage2D(gr,te,ae.format,ee,re,0,ae.format,ae.type,null)}return Mt(),be.profile&&(ae.stats.size=$n(ae.internalformat,ae.type,ne,ie,!1,!1)),Ze}return Ze(H,he),Ze.subimage=_t,Ze.resize=G,Ze._reglType="texture2d",Ze._texture=ae,be.profile&&(Ze.stats=ae.stats),Ze.destroy=function(){ae.decRef()},Ze}function At(H,he,ae,Ze,_t,G){var z=new yt(yi);Jt[z.id]=z,de.cubeCount++;var J=new Array(6);function ne(ee,re,j,Z,N,oe){var ce,Ce=z.texInfo;for(It.call(Ce),ce=0;ce<6;++ce)J[ce]=Pt();if(typeof ee=="number"||!ee){var we=ee|0||1;for(ce=0;ce<6;++ce)vt(J[ce],we,we)}else if(typeof ee=="object")if(re)wt(J[0],ee),wt(J[1],re),wt(J[2],j),wt(J[3],Z),wt(J[4],N),wt(J[5],oe);else if(Yt(Ce,ee),Xe(z,ee),"faces"in ee){var Re=ee.faces;for(V(Array.isArray(Re)&&Re.length===6,"cube faces must be a length 6 array"),ce=0;ce<6;++ce)V(typeof Re[ce]=="object"&&!!Re[ce],"invalid input for cube map face"),pe(J[ce],z),wt(J[ce],Re[ce])}else for(ce=0;ce<6;++ce)wt(J[ce],ee);else V.raise("invalid arguments to cube map");for(pe(z,J[0]),V.optional(function(){Q.npotTextureCube||V($a(z.width)&&$a(z.height),"your browser does not support non power or two texture dimensions")}),Ce.genMipmaps?z.mipmask=(J[0].width<<1)-1:z.mipmask=J[0].mipmask,V.textureCube(z,Ce,J,Q),z.internalformat=J[0].internalformat,ne.width=J[0].width,ne.height=J[0].height,ar(z),ce=0;ce<6;++ce)Bt(J[ce],kn+ce);for(Qt(Ce,yi),Mt(),be.profile&&(z.stats.size=$n(z.internalformat,z.type,ne.width,ne.height,Ce.genMipmaps,!0)),ne.format=Se[z.internalformat],ne.type=Ye[z.type],ne.mag=ye[Ce.magFilter],ne.min=rt[Ce.minFilter],ne.wrapS=Je[Ce.wrapS],ne.wrapT=Je[Ce.wrapT],ce=0;ce<6;++ce)Xt(J[ce]);return ne}function ie(ee,re,j,Z,N){V(!!re,"must specify image data"),V(typeof ee=="number"&&ee===(ee|0)&&ee>=0&&ee<6,"invalid face");var oe=j|0,ce=Z|0,Ce=N|0,we=Ue();return pe(we,z),we.width=0,we.height=0,Be(we,re),we.width=we.width||(z.width>>Ce)-oe,we.height=we.height||(z.height>>Ce)-ce,V(z.type===we.type&&z.format===we.format&&z.internalformat===we.internalformat,"incompatible format for texture.subimage"),V(oe>=0&&ce>=0&&oe+we.width<=z.width&&ce+we.height<=z.height,"texture.subimage write out of bounds"),V(z.mipmask&1<<Ce,"missing mipmap data"),V(we.data||we.element||we.needsCopy,"missing image data"),ar(z),pt(we,kn+ee,oe,ce,Ce),Mt(),qe(we),ne}function te(ee){var re=ee|0;if(re!==z.width){ne.width=z.width=re,ne.height=z.height=re,ar(z);for(var j=0;j<6;++j)for(var Z=0;z.mipmask>>Z;++Z)S.texImage2D(kn+j,Z,z.format,re>>Z,re>>Z,0,z.format,z.type,null);return Mt(),be.profile&&(z.stats.size=$n(z.internalformat,z.type,ne.width,ne.height,!1,!0)),ne}}return ne(H,he,ae,Ze,_t,G),ne.subimage=ie,ne.resize=te,ne._reglType="textureCube",ne._texture=z,be.profile&&(ne.stats=z.stats),ne.destroy=function(){z.decRef()},ne}function er(){for(var H=0;H<ir;++H)S.activeTexture(dn+H),S.bindTexture(gr,null),qt[H]=null;cr(Jt).forEach(ut),de.cubeCount=0,de.textureCount=0}be.profile&&(de.getTotalTextureSize=function(){var H=0;return Object.keys(Jt).forEach(function(he){H+=Jt[he].stats.size}),H});function or(){for(var H=0;H<ir;++H){var he=qt[H];he&&(he.bindCount=0,he.unit=-1,qt[H]=null)}cr(Jt).forEach(function(ae){ae.texture=S.createTexture(),S.bindTexture(ae.target,ae.texture);for(var Ze=0;Ze<32;++Ze)if((ae.mipmask&1<<Ze)!==0)if(ae.target===gr)S.texImage2D(gr,Ze,ae.internalformat,ae.width>>Ze,ae.height>>Ze,0,ae.internalformat,ae.type,null);else for(var _t=0;_t<6;++_t)S.texImage2D(kn+_t,Ze,ae.internalformat,ae.width>>Ze,ae.height>>Ze,0,ae.internalformat,ae.type,null);Qt(ae.texInfo,ae.target)})}function Br(){for(var H=0;H<ir;++H){var he=qt[H];he&&(he.bindCount=0,he.unit=-1,qt[H]=null),S.activeTexture(dn+H),S.bindTexture(gr,null),S.bindTexture(yi,null)}}return{create2D:gt,createCube:At,clear:er,getTexture:function(he){return null},restore:or,refresh:Br}},la=function(S,B,Q){return mr[S]*B*Q},ts=function(S,B,Q,ue,me,de){var be={cur:null,next:null,dirty:!1,setFBO:null},Ae=["rgba"],Le=["rgba4","rgb565","rgb5 a1"];B.ext_srgb&&Le.push("srgba"),B.ext_color_buffer_half_float&&Le.push("rgba16f","rgb16f"),B.webgl_color_buffer_float&&Le.push("rgba32f");var Oe=["uint8"];B.oes_texture_half_float&&Oe.push("half float","float16"),B.oes_texture_float&&Oe.push("float","float32");function ze(Me,Be,Ve){this.target=Me,this.texture=Be,this.renderbuffer=Ve;var pt=0,dt=0;Be?(pt=Be.width,dt=Be.height):Ve&&(pt=Ve.width,dt=Ve.height),this.width=pt,this.height=dt}function $e(Me){Me&&(Me.texture&&Me.texture._texture.decRef(),Me.renderbuffer&&Me.renderbuffer._renderbuffer.decRef())}function ke(Me,Be,Ve){if(!!Me)if(Me.texture){var pt=Me.texture._texture,dt=Math.max(1,pt.width),Ue=Math.max(1,pt.height);V(dt===Be&&Ue===Ve,"inconsistent width/height for supplied texture"),pt.refCount+=1}else{var qe=Me.renderbuffer._renderbuffer;V(qe.width===Be&&qe.height===Ve,"inconsistent width/height for renderbuffer"),qe.refCount+=1}}function Ie(Me,Be){Be&&(Be.texture?S.framebufferTexture2D(br,Me,Be.target,Be.texture._texture.texture,0):S.framebufferRenderbuffer(br,Me,ki,Be.renderbuffer._renderbuffer.renderbuffer))}function Ee(Me){var Be=Rr,Ve=null,pt=null,dt=Me;typeof Me=="object"&&(dt=Me.data,"target"in Me&&(Be=Me.target|0)),V.type(dt,"function","invalid attachment data");var Ue=dt._reglType;return Ue==="texture2d"?(Ve=dt,V(Be===Rr)):Ue==="textureCube"?(Ve=dt,V(Be>=Vn&&Be<Vn+6,"invalid cube map target")):Ue==="renderbuffer"?(pt=dt,Be=ki):V.raise("invalid regl object for attachment"),new ze(Be,Ve,pt)}function le(Me,Be,Ve,pt,dt){if(Ve){var Ue=ue.create2D({width:Me,height:Be,format:pt,type:dt});return Ue._texture.refCount=0,new ze(Rr,Ue,null)}else{var qe=me.create({width:Me,height:Be,format:pt});return qe._renderbuffer.refCount=0,new ze(ki,null,qe)}}function se(Me){return Me&&(Me.texture||Me.renderbuffer)}function Se(Me,Be,Ve){Me&&(Me.texture?Me.texture.resize(Be,Ve):Me.renderbuffer&&Me.renderbuffer.resize(Be,Ve),Me.width=Be,Me.height=Ve)}var Ye=0,ye={};function rt(){this.id=Ye++,ye[this.id]=this,this.framebuffer=S.createFramebuffer(),this.width=0,this.height=0,this.colorAttachments=[],this.depthAttachment=null,this.stencilAttachment=null,this.depthStencilAttachment=null}function Je(Me){Me.colorAttachments.forEach($e),$e(Me.depthAttachment),$e(Me.stencilAttachment),$e(Me.depthStencilAttachment)}function He(Me){var Be=Me.framebuffer;V(Be,"must not double destroy framebuffer"),S.deleteFramebuffer(Be),Me.framebuffer=null,de.framebufferCount--,delete ye[Me.id]}function xe(Me){var Be;S.bindFramebuffer(br,Me.framebuffer);var Ve=Me.colorAttachments;for(Be=0;Be<Ve.length;++Be)Ie(no+Be,Ve[Be]);for(Be=Ve.length;Be<Q.maxColorAttachments;++Be)S.framebufferTexture2D(br,no+Be,Rr,null,0);S.framebufferTexture2D(br,oo,Rr,null,0),S.framebufferTexture2D(br,io,Rr,null,0),S.framebufferTexture2D(br,ao,Rr,null,0),Ie(io,Me.depthAttachment),Ie(ao,Me.stencilAttachment),Ie(oo,Me.depthStencilAttachment);var pt=S.checkFramebufferStatus(br);!S.isContextLost()&&pt!==so&&V.raise("framebuffer configuration not supported, status = "+Zr[pt]),S.bindFramebuffer(br,be.next?be.next.framebuffer:null),be.cur=be.next,S.getError()}function pe(Me,Be){var Ve=new rt;de.framebufferCount++;function pt(Ue,qe){var lt;V(be.next!==Ve,"can not update framebuffer which is currently in use");var vt=0,wt=0,Bt=!0,Gt=!0,Pt=null,Xt=!0,It="rgba",Yt="uint8",Qt=1,Kt=null,Jt=null,ir=null,qt=!1;if(typeof Ue=="number")vt=Ue|0,wt=qe|0||vt;else if(!Ue)vt=wt=1;else{V.type(Ue,"object","invalid arguments for framebuffer");var yt=Ue;if("shape"in yt){var ar=yt.shape;V(Array.isArray(ar)&&ar.length>=2,"invalid shape for framebuffer"),vt=ar[0],wt=ar[1]}else"radius"in yt&&(vt=wt=yt.radius),"width"in yt&&(vt=yt.width),"height"in yt&&(wt=yt.height);("color"in yt||"colors"in yt)&&(Pt=yt.color||yt.colors,Array.isArray(Pt)&&V(Pt.length===1||B.webgl_draw_buffers,"multiple render targets not supported")),Pt||("colorCount"in yt&&(Qt=yt.colorCount|0,V(Qt>0,"invalid color buffer count")),"colorTexture"in yt&&(Xt=!!yt.colorTexture,It="rgba4"),"colorType"in yt&&(Yt=yt.colorType,Xt?(V(B.oes_texture_float||!(Yt==="float"||Yt==="float32"),"you must enable OES_texture_float in order to use floating point framebuffer objects"),V(B.oes_texture_half_float||!(Yt==="half float"||Yt==="float16"),"you must enable OES_texture_half_float in order to use 16-bit floating point framebuffer objects")):Yt==="half float"||Yt==="float16"?(V(B.ext_color_buffer_half_float,"you must enable EXT_color_buffer_half_float to use 16-bit render buffers"),It="rgba16f"):(Yt==="float"||Yt==="float32")&&(V(B.webgl_color_buffer_float,"you must enable WEBGL_color_buffer_float in order to use 32-bit floating point renderbuffers"),It="rgba32f"),V.oneOf(Yt,Oe,"invalid color type")),"colorFormat"in yt&&(It=yt.colorFormat,Ae.indexOf(It)>=0?Xt=!0:Le.indexOf(It)>=0?Xt=!1:V.optional(function(){Xt?V.oneOf(yt.colorFormat,Ae,"invalid color format for texture"):V.oneOf(yt.colorFormat,Le,"invalid color format for renderbuffer")}))),("depthTexture"in yt||"depthStencilTexture"in yt)&&(qt=!!(yt.depthTexture||yt.depthStencilTexture),V(!qt||B.webgl_depth_texture,"webgl_depth_texture extension not supported")),"depth"in yt&&(typeof yt.depth=="boolean"?Bt=yt.depth:(Kt=yt.depth,Gt=!1)),"stencil"in yt&&(typeof yt.stencil=="boolean"?Gt=yt.stencil:(Jt=yt.stencil,Bt=!1)),"depthStencil"in yt&&(typeof yt.depthStencil=="boolean"?Bt=Gt=yt.depthStencil:(ir=yt.depthStencil,Bt=!1,Gt=!1))}var Mt=null,ut=null,gt=null,At=null;if(Array.isArray(Pt))Mt=Pt.map(Ee);else if(Pt)Mt=[Ee(Pt)];else for(Mt=new Array(Qt),lt=0;lt<Qt;++lt)Mt[lt]=le(vt,wt,Xt,It,Yt);V(B.webgl_draw_buffers||Mt.length<=1,"you must enable the WEBGL_draw_buffers extension in order to use multiple color buffers."),V(Mt.length<=Q.maxColorAttachments,"too many color attachments, not supported"),vt=vt||Mt[0].width,wt=wt||Mt[0].height,Kt?ut=Ee(Kt):Bt&&!Gt&&(ut=le(vt,wt,qt,"depth","uint32")),Jt?gt=Ee(Jt):Gt&&!Bt&&(gt=le(vt,wt,!1,"stencil","uint8")),ir?At=Ee(ir):!Kt&&!Jt&&Gt&&Bt&&(At=le(vt,wt,qt,"depth stencil","depth stencil")),V(!!Kt+!!Jt+!!ir<=1,"invalid framebuffer configuration, can specify exactly one depth/stencil attachment");var er=null;for(lt=0;lt<Mt.length;++lt)if(ke(Mt[lt],vt,wt),V(!Mt[lt]||Mt[lt].texture&&cu.indexOf(Mt[lt].texture._texture.format)>=0||Mt[lt].renderbuffer&&xu.indexOf(Mt[lt].renderbuffer._renderbuffer.format)>=0,"framebuffer color attachment "+lt+" is invalid"),Mt[lt]&&Mt[lt].texture){var or=Ii[Mt[lt].texture._texture.format]*Gn[Mt[lt].texture._texture.type];er===null?er=or:V(er===or,"all color attachments much have the same number of bits per pixel.")}return ke(ut,vt,wt),V(!ut||ut.texture&&ut.texture._texture.format===fu||ut.renderbuffer&&ut.renderbuffer._renderbuffer.format===vu,"invalid depth attachment for framebuffer object"),ke(gt,vt,wt),V(!gt||gt.renderbuffer&&gt.renderbuffer._renderbuffer.format===mu,"invalid stencil attachment for framebuffer object"),ke(At,vt,wt),V(!At||At.texture&&At.texture._texture.format===fo||At.renderbuffer&&At.renderbuffer._renderbuffer.format===fo,"invalid depth-stencil attachment for framebuffer object"),Je(Ve),Ve.width=vt,Ve.height=wt,Ve.colorAttachments=Mt,Ve.depthAttachment=ut,Ve.stencilAttachment=gt,Ve.depthStencilAttachment=At,pt.color=Mt.map(se),pt.depth=se(ut),pt.stencil=se(gt),pt.depthStencil=se(At),pt.width=Ve.width,pt.height=Ve.height,xe(Ve),pt}function dt(Ue,qe){V(be.next!==Ve,"can not resize a framebuffer which is currently in use");var lt=Math.max(Ue|0,1),vt=Math.max(qe|0||lt,1);if(lt===Ve.width&&vt===Ve.height)return pt;for(var wt=Ve.colorAttachments,Bt=0;Bt<wt.length;++Bt)Se(wt[Bt],lt,vt);return Se(Ve.depthAttachment,lt,vt),Se(Ve.stencilAttachment,lt,vt),Se(Ve.depthStencilAttachment,lt,vt),Ve.width=pt.width=lt,Ve.height=pt.height=vt,xe(Ve),pt}return pt(Me,Be),jt(pt,{resize:dt,_reglType:"framebuffer",_framebuffer:Ve,destroy:function(){He(Ve),Je(Ve)},use:function(qe){be.setFBO({framebuffer:pt},qe)}})}function Xe(Me){var Be=Array(6);function Ve(dt){var Ue;V(Be.indexOf(be.next)<0,"can not update framebuffer which is currently in use");var qe={color:null},lt=0,vt=null,wt="rgba",Bt="uint8",Gt=1;if(typeof dt=="number")lt=dt|0;else if(!dt)lt=1;else{V.type(dt,"object","invalid arguments for framebuffer");var Pt=dt;if("shape"in Pt){var Xt=Pt.shape;V(Array.isArray(Xt)&&Xt.length>=2,"invalid shape for framebuffer"),V(Xt[0]===Xt[1],"cube framebuffer must be square"),lt=Xt[0]}else"radius"in Pt&&(lt=Pt.radius|0),"width"in Pt?(lt=Pt.width|0,"height"in Pt&&V(Pt.height===lt,"must be square")):"height"in Pt&&(lt=Pt.height|0);("color"in Pt||"colors"in Pt)&&(vt=Pt.color||Pt.colors,Array.isArray(vt)&&V(vt.length===1||B.webgl_draw_buffers,"multiple render targets not supported")),vt||("colorCount"in Pt&&(Gt=Pt.colorCount|0,V(Gt>0,"invalid color buffer count")),"colorType"in Pt&&(V.oneOf(Pt.colorType,Oe,"invalid color type"),Bt=Pt.colorType),"colorFormat"in Pt&&(wt=Pt.colorFormat,V.oneOf(Pt.colorFormat,Ae,"invalid color format for texture"))),"depth"in Pt&&(qe.depth=Pt.depth),"stencil"in Pt&&(qe.stencil=Pt.stencil),"depthStencil"in Pt&&(qe.depthStencil=Pt.depthStencil)}var It;if(vt)if(Array.isArray(vt))for(It=[],Ue=0;Ue<vt.length;++Ue)It[Ue]=vt[Ue];else It=[vt];else{It=Array(Gt);var Yt={radius:lt,format:wt,type:Bt};for(Ue=0;Ue<Gt;++Ue)It[Ue]=ue.createCube(Yt)}for(qe.color=Array(It.length),Ue=0;Ue<It.length;++Ue){var Qt=It[Ue];V(typeof Qt=="function"&&Qt._reglType==="textureCube","invalid cube map"),lt=lt||Qt.width,V(Qt.width===lt&&Qt.height===lt,"invalid cube map shape"),qe.color[Ue]={target:Vn,data:It[Ue]}}for(Ue=0;Ue<6;++Ue){for(var Kt=0;Kt<It.length;++Kt)qe.color[Kt].target=Vn+Ue;Ue>0&&(qe.depth=Be[0].depth,qe.stencil=Be[0].stencil,qe.depthStencil=Be[0].depthStencil),Be[Ue]?Be[Ue](qe):Be[Ue]=pe(qe)}return jt(Ve,{width:lt,height:lt,color:It})}function pt(dt){var Ue,qe=dt|0;if(V(qe>0&&qe<=Q.maxCubeMapSize,"invalid radius for cube fbo"),qe===Ve.width)return Ve;var lt=Ve.color;for(Ue=0;Ue<lt.length;++Ue)lt[Ue].resize(qe);for(Ue=0;Ue<6;++Ue)Be[Ue].resize(qe);return Ve.width=Ve.height=qe,Ve}return Ve(Me),jt(Ve,{faces:Be,resize:pt,_reglType:"framebufferCube",destroy:function(){Be.forEach(function(Ue){Ue.destroy()})}})}function Ne(){be.cur=null,be.next=null,be.dirty=!0,cr(ye).forEach(function(Me){Me.framebuffer=S.createFramebuffer(),xe(Me)})}return jt(be,{getFramebuffer:function(Be){if(typeof Be=="function"&&Be._reglType==="framebuffer"){var Ve=Be._framebuffer;if(_instanceof$2(Ve,rt))return Ve}return null},create:pe,createCube:Xe,clear:function(){cr(ye).forEach(He)},restore:Ne})},ui=function(){this.state=0,this.x=0,this.y=0,this.z=0,this.w=0,this.buffer=null,this.size=0,this.normalized=!1,this.type=Cu,this.offset=0,this.stride=0,this.divisor=0},rs=function(S,B,Q,ue,me,de,be){for(var Ae=Q.maxAttributes,Le=new Array(Ae),Oe=0;Oe<Ae;++Oe)Le[Oe]=new ui;var ze=0,$e={},ke={Record:ui,scope:{},state:Le,currentVAO:null,targetVAO:null,restore:Ee()?Je:function(){},createVAO:He,getVAO:se,destroyBuffer:Ie,setVAO:Ee()?Se:Ye,clear:Ee()?ye:function(){}};function Ie(xe){for(var pe=0;pe<Le.length;++pe){var Xe=Le[pe];Xe.buffer===xe&&(S.disableVertexAttribArray(pe),Xe.buffer=null)}}function Ee(){return B.oes_vertex_array_object}function le(){return B.angle_instanced_arrays}function se(xe){return typeof xe=="function"&&xe._vao?xe._vao:null}function Se(xe){if(xe!==ke.currentVAO){var pe=Ee();xe?pe.bindVertexArrayOES(xe.vao):pe.bindVertexArrayOES(null),ke.currentVAO=xe}}function Ye(xe){if(xe!==ke.currentVAO){if(xe)xe.bindAttrs();else{for(var pe=le(),Xe=0;Xe<Le.length;++Xe){var Ne=Le[Xe];Ne.buffer?(S.enableVertexAttribArray(Xe),Ne.buffer.bind(),S.vertexAttribPointer(Xe,Ne.size,Ne.type,Ne.normalized,Ne.stride,Ne.offfset),pe&&Ne.divisor&&pe.vertexAttribDivisorANGLE(Xe,Ne.divisor)):(S.disableVertexAttribArray(Xe),S.vertexAttrib4f(Xe,Ne.x,Ne.y,Ne.z,Ne.w))}be.elements?S.bindBuffer(Un,be.elements.buffer.buffer):S.bindBuffer(Un,null)}ke.currentVAO=xe}}function ye(){cr($e).forEach(function(xe){xe.destroy()})}function rt(){this.id=++ze,this.attributes=[],this.elements=null,this.ownsElements=!1,this.count=0,this.offset=0,this.instances=-1,this.primitive=4;var xe=Ee();xe?this.vao=xe.createVertexArrayOES():this.vao=null,$e[this.id]=this,this.buffers=[]}rt.prototype.bindAttrs=function(){for(var xe=le(),pe=this.attributes,Xe=0;Xe<pe.length;++Xe){var Ne=pe[Xe];Ne.buffer?(S.enableVertexAttribArray(Xe),S.bindBuffer(co,Ne.buffer.buffer),S.vertexAttribPointer(Xe,Ne.size,Ne.type,Ne.normalized,Ne.stride,Ne.offset),xe&&Ne.divisor&&xe.vertexAttribDivisorANGLE(Xe,Ne.divisor)):(S.disableVertexAttribArray(Xe),S.vertexAttrib4f(Xe,Ne.x,Ne.y,Ne.z,Ne.w))}for(var Me=pe.length;Me<Ae;++Me)S.disableVertexAttribArray(Me);var Be=de.getElements(this.elements);Be?S.bindBuffer(Un,Be.buffer.buffer):S.bindBuffer(Un,null)},rt.prototype.refresh=function(){var xe=Ee();xe&&(xe.bindVertexArrayOES(this.vao),this.bindAttrs(),ke.currentVAO=null,xe.bindVertexArrayOES(null))},rt.prototype.destroy=function(){if(this.vao){var xe=Ee();this===ke.currentVAO&&(ke.currentVAO=null,xe.bindVertexArrayOES(null)),xe.deleteVertexArrayOES(this.vao),this.vao=null}this.ownsElements&&(this.elements.destroy(),this.elements=null,this.ownsElements=!1),$e[this.id]&&(delete $e[this.id],ue.vaoCount-=1)};function Je(){var xe=Ee();xe&&cr($e).forEach(function(pe){pe.refresh()})}function He(xe){var pe=new rt;ue.vaoCount+=1;function Xe(Ne){var Me;if(Array.isArray(Ne))Me=Ne,pe.elements&&pe.ownsElements&&pe.elements.destroy(),pe.elements=null,pe.ownsElements=!1,pe.offset=0,pe.count=0,pe.instances=-1,pe.primitive=4;else{if(V(typeof Ne=="object","invalid arguments for create vao"),V("attributes"in Ne,"must specify attributes for vao"),Ne.elements){var Be=Ne.elements;pe.ownsElements?typeof Be=="function"&&Be._reglType==="elements"?(pe.elements.destroy(),pe.ownsElements=!1):(pe.elements(Be),pe.ownsElements=!1):de.getElements(Ne.elements)?(pe.elements=Ne.elements,pe.ownsElements=!1):(pe.elements=de.create(Ne.elements),pe.ownsElements=!0)}else pe.elements=null,pe.ownsElements=!1;Me=Ne.attributes,pe.offset=0,pe.count=-1,pe.instances=-1,pe.primitive=4,pe.elements&&(pe.count=pe.elements._elements.vertCount,pe.primitive=pe.elements._elements.primType),"offset"in Ne&&(pe.offset=Ne.offset|0),"count"in Ne&&(pe.count=Ne.count|0),"instances"in Ne&&(pe.instances=Ne.instances|0),"primitive"in Ne&&(V(Ne.primitive in wr,"bad primitive type: "+Ne.primitive),pe.primitive=wr[Ne.primitive]),V.optional(function(){for(var Bt=Object.keys(Ne),Gt=0;Gt<Bt.length;++Gt)V(ho.indexOf(Bt[Gt])>=0,'invalid option for vao: "'+Bt[Gt]+'" valid options are '+ho)}),V(Array.isArray(Me),"attributes must be an array")}V(Me.length<Ae,"too many attributes"),V(Me.length>0,"must specify at least one attribute");var Ve={},pt=pe.attributes;pt.length=Me.length;for(var dt=0;dt<Me.length;++dt){var Ue=Me[dt],qe=pt[dt]=new ui,lt=Ue.data||Ue;if(Array.isArray(lt)||rr(lt)||Tt(lt)){var vt;pe.buffers[dt]&&(vt=pe.buffers[dt],rr(lt)&&vt._buffer.byteLength>=lt.byteLength?vt.subdata(lt):(vt.destroy(),pe.buffers[dt]=null)),pe.buffers[dt]||(vt=pe.buffers[dt]=me.create(Ue,co,!1,!0)),qe.buffer=me.getBuffer(vt),qe.size=qe.buffer.dimension|0,qe.normalized=!1,qe.type=qe.buffer.dtype,qe.offset=0,qe.stride=0,qe.divisor=0,qe.state=1,Ve[dt]=1}else me.getBuffer(Ue)?(qe.buffer=me.getBuffer(Ue),qe.size=qe.buffer.dimension|0,qe.normalized=!1,qe.type=qe.buffer.dtype,qe.offset=0,qe.stride=0,qe.divisor=0,qe.state=1):me.getBuffer(Ue.buffer)?(qe.buffer=me.getBuffer(Ue.buffer),qe.size=(+Ue.size||qe.buffer.dimension)|0,qe.normalized=!!Ue.normalized||!1,"type"in Ue?(V.parameter(Ue.type,Lr,"invalid buffer type"),qe.type=Lr[Ue.type]):qe.type=qe.buffer.dtype,qe.offset=(Ue.offset||0)|0,qe.stride=(Ue.stride||0)|0,qe.divisor=(Ue.divisor||0)|0,qe.state=1,V(qe.size>=1&&qe.size<=4,"size must be between 1 and 4"),V(qe.offset>=0,"invalid offset"),V(qe.stride>=0&&qe.stride<=255,"stride must be between 0 and 255"),V(qe.divisor>=0,"divisor must be positive"),V(!qe.divisor||!!B.angle_instanced_arrays,"ANGLE_instanced_arrays must be enabled to use divisor")):"x"in Ue?(V(dt>0,"first attribute must not be a constant"),qe.x=+Ue.x||0,qe.y=+Ue.y||0,qe.z=+Ue.z||0,qe.w=+Ue.w||0,qe.state=2):V(!1,"invalid attribute spec for location "+dt)}for(var wt=0;wt<pe.buffers.length;++wt)!Ve[wt]&&pe.buffers[wt]&&(pe.buffers[wt].destroy(),pe.buffers[wt]=null);return pe.refresh(),Xe}return Xe.destroy=function(){for(var Ne=0;Ne<pe.buffers.length;++Ne)pe.buffers[Ne]&&pe.buffers[Ne].destroy();pe.buffers.length=0,pe.ownsElements&&(pe.elements.destroy(),pe.elements=null,pe.ownsElements=!1),pe.destroy()},Xe._vao=pe,Xe._reglType="vao",Xe(xe)}return ke},ns=function(S,B,Q,ue){var me={},de={};function be(le,se,Se,Ye){this.name=le,this.id=se,this.location=Se,this.info=Ye}function Ae(le,se){for(var Se=0;Se<le.length;++Se)if(le[Se].id===se.id){le[Se].location=se.location;return}le.push(se)}function Le(le,se,Se){var Ye=le===po?me:de,ye=Ye[se];if(!ye){var rt=B.str(se);ye=S.createShader(le),S.shaderSource(ye,rt),S.compileShader(ye),V.shaderError(S,ye,rt,le,Se),Ye[se]=ye}return ye}var Oe={},ze=[],$e=0;function ke(le,se){this.id=$e++,this.fragId=le,this.vertId=se,this.program=null,this.uniforms=[],this.attributes=[],this.refCount=1,ue.profile&&(this.stats={uniformsCount:0,attributesCount:0})}function Ie(le,se,Se){var Ye,ye,rt=Le(po,le.fragId),Je=Le(Su,le.vertId),He=le.program=S.createProgram();if(S.attachShader(He,rt),S.attachShader(He,Je),Se)for(Ye=0;Ye<Se.length;++Ye){var xe=Se[Ye];S.bindAttribLocation(He,xe[0],xe[1])}S.linkProgram(He),V.linkError(S,He,B.str(le.fragId),B.str(le.vertId),se);var pe=S.getProgramParameter(He,wu);ue.profile&&(le.stats.uniformsCount=pe);var Xe=le.uniforms;for(Ye=0;Ye<pe;++Ye)if(ye=S.getActiveUniform(He,Ye),ye){if(ye.size>1)for(var Ne=0;Ne<ye.size;++Ne){var Me=ye.name.replace("[0]","["+Ne+"]");Ae(Xe,new be(Me,B.id(Me),S.getUniformLocation(He,Me),ye))}var Be=ye.name;ye.size>1&&(Be=Be.replace("[0]","")),Ae(Xe,new be(Be,B.id(Be),S.getUniformLocation(He,Be),ye))}var Ve=S.getProgramParameter(He,Pu);ue.profile&&(le.stats.attributesCount=Ve);var pt=le.attributes;for(Ye=0;Ye<Ve;++Ye)ye=S.getActiveAttrib(He,Ye),ye&&Ae(pt,new be(ye.name,B.id(ye.name),S.getAttribLocation(He,ye.name),ye))}ue.profile&&(Q.getMaxUniformsCount=function(){var le=0;return ze.forEach(function(se){se.stats.uniformsCount>le&&(le=se.stats.uniformsCount)}),le},Q.getMaxAttributesCount=function(){var le=0;return ze.forEach(function(se){se.stats.attributesCount>le&&(le=se.stats.attributesCount)}),le});function Ee(){me={},de={};for(var le=0;le<ze.length;++le)Ie(ze[le],null,ze[le].attributes.map(function(se){return[se.location,se.name]}))}return{clear:function(){var se=S.deleteShader.bind(S);cr(me).forEach(se),me={},cr(de).forEach(se),de={},ze.forEach(function(Se){S.deleteProgram(Se.program)}),ze.length=0,Oe={},Q.shaderCount=0},program:function(se,Se,Ye,ye){V.command(se>=0,"missing vertex shader",Ye),V.command(Se>=0,"missing fragment shader",Ye);var rt=Oe[Se];rt||(rt=Oe[Se]={});var Je=rt[se];if(Je&&(Je.refCount++,!ye))return Je;var He=new ke(Se,se);return Q.shaderCount++,Ie(He,Ye,ye),Je||(rt[se]=He),ze.push(He),jt(He,{destroy:function(){if(He.refCount--,He.refCount<=0){S.deleteProgram(He.program);var pe=ze.indexOf(He);ze.splice(pe,1),Q.shaderCount--}rt[He.vertId].refCount<=0&&(S.deleteShader(de[He.vertId]),delete de[He.vertId],delete Oe[He.fragId][He.vertId]),Object.keys(Oe[He.fragId]).length||(S.deleteShader(me[He.fragId]),delete me[He.fragId],delete Oe[He.fragId])}})},restore:Ee,shader:Le,frag:-1,vert:-1}},is=function(S,B,Q,ue,me,de,be){function Ae(ze){var $e;B.next===null?(V(me.preserveDrawingBuffer,'you must create a webgl context with "preserveDrawingBuffer":true in order to read pixels from the drawing buffer'),$e=pn):(V(B.next.colorAttachments[0].texture!==null,"You cannot read from a renderbuffer"),$e=B.next.colorAttachments[0].texture._texture.type,V.optional(function(){de.oes_texture_float?(V($e===pn||$e===jn,"Reading from a framebuffer is only allowed for the types 'uint8' and 'float'"),$e===jn&&V(be.readFloat,"Reading 'float' values is not permitted in your browser. For a fallback, please see: https://www.npmjs.com/package/glsl-read-float")):V($e===pn,"Reading from a framebuffer is only allowed for the type 'uint8'")}));var ke=0,Ie=0,Ee=ue.framebufferWidth,le=ue.framebufferHeight,se=null;rr(ze)?se=ze:ze&&(V.type(ze,"object","invalid arguments to regl.read()"),ke=ze.x|0,Ie=ze.y|0,V(ke>=0&&ke<ue.framebufferWidth,"invalid x offset for regl.read"),V(Ie>=0&&Ie<ue.framebufferHeight,"invalid y offset for regl.read"),Ee=(ze.width||ue.framebufferWidth-ke)|0,le=(ze.height||ue.framebufferHeight-Ie)|0,se=ze.data||null),se&&($e===pn?V(_instanceof$2(se,Uint8Array),"buffer must be 'Uint8Array' when reading from a framebuffer of type 'uint8'"):$e===jn&&V(_instanceof$2(se,Float32Array),"buffer must be 'Float32Array' when reading from a framebuffer of type 'float'")),V(Ee>0&&Ee+ke<=ue.framebufferWidth,"invalid width for read pixels"),V(le>0&&le+Ie<=ue.framebufferHeight,"invalid height for read pixels"),Q();var Se=Ee*le*4;return se||($e===pn?se=new Uint8Array(Se):$e===jn&&(se=se||new Float32Array(Se))),V.isTypedArray(se,"data buffer for regl.read() must be a typedarray"),V(se.byteLength>=Se,"data buffer for regl.read() too small"),S.pixelStorei(Eu,4),S.readPixels(ke,Ie,Ee,le,Au,$e,se),se}function Le(ze){var $e;return B.setFBO({framebuffer:ze.framebuffer},function(){$e=Ae(ze)}),$e}function Oe(ze){return!ze||!("framebuffer"in ze)?Ae(ze):Le(ze)}return Oe},qr=function(S){return Array.prototype.slice.call(S)},Hr=function(S){return qr(S).join("")},as=function(){var S=0,B=[],Q=[];function ue($e){for(var ke=0;ke<Q.length;++ke)if(Q[ke]===$e)return B[ke];var Ie="g"+S++;return B.push(Ie),Q.push($e),Ie}function me(){var $e=[];function ke(){$e.push.apply($e,qr(arguments))}var Ie=[];function Ee(){var le="v"+S++;return Ie.push(le),arguments.length>0&&($e.push(le,"="),$e.push.apply($e,qr(arguments)),$e.push(";")),le}return jt(ke,{def:Ee,toString:function(){return Hr([Ie.length>0?"var "+Ie.join(",")+";":"",Hr($e)])}})}function de(){var $e=me(),ke=me(),Ie=$e.toString,Ee=ke.toString;function le(se,Se){ke(se,Se,"=",$e.def(se,Se),";")}return jt(function(){$e.apply($e,qr(arguments))},{def:$e.def,entry:$e,exit:ke,save:le,set:function(Se,Ye,ye){le(Se,Ye),$e(Se,Ye,"=",ye,";")},toString:function(){return Ie()+Ee()}})}function be(){var $e=Hr(arguments),ke=de(),Ie=de(),Ee=ke.toString,le=Ie.toString;return jt(ke,{then:function(){return ke.apply(ke,qr(arguments)),this},else:function(){return Ie.apply(Ie,qr(arguments)),this},toString:function(){var Se=le();return Se&&(Se="else{"+Se+"}"),Hr(["if(",$e,"){",Ee(),"}",Se])}})}var Ae=me(),Le={};function Oe($e,ke){var Ie=[];function Ee(){var ye="a"+Ie.length;return Ie.push(ye),ye}ke=ke||0;for(var le=0;le<ke;++le)Ee();var se=de(),Se=se.toString,Ye=Le[$e]=jt(se,{arg:Ee,toString:function(){return Hr(["function(",Ie.join(),"){",Se(),"}"])}});return Ye}function ze(){var $e=['"use strict";',Ae,"return {"];Object.keys(Le).forEach(function(Ee){$e.push('"',Ee,'":',Le[Ee].toString(),",")}),$e.push("}");var ke=Hr($e).replace(/;/g,";\n").replace(/}/g,"}\n").replace(/{/g,"{\n"),Ie=Function.apply(null,B.concat(ke));return Ie.apply(null,Q)}return{global:Ae,link:ue,block:me,proc:Oe,scope:de,cond:be,compile:ze}},On=function(S){return Array.isArray(S)||rr(S)||Tt(S)},ua=function(S){return S.sort(function(B,Q){return B===xr?-1:Q===xr?1:B<Q?-1:1})},Zt=function(S,B,Q,ue){this.thisDep=S,this.contextDep=B,this.propDep=Q,this.append=ue},Cr=function(S){return S&&!(S.thisDep||S.contextDep||S.propDep)},Ht=function(S){return new Zt(!1,!1,!1,S)},sr=function(S,B){var Q=S.type;if(Q===Fi){var ue=S.data.length;return new Zt(!0,ue>=1,ue>=2,B)}else if(Q===qn){var me=S.data;return new Zt(me.thisDep,me.contextDep,me.propDep,B)}else{if(Q===mo)return new Zt(!1,!1,!1,B);if(Q===go){for(var de=!1,be=!1,Ae=!1,Le=0;Le<S.data.length;++Le){var Oe=S.data[Le];if(Oe.type===Di)Ae=!0;else if(Oe.type===Bi)be=!0;else if(Oe.type===Ni)de=!0;else if(Oe.type===Fi){de=!0;var ze=Oe.data;ze>=1&&(be=!0),ze>=2&&(Ae=!0)}else Oe.type===qn&&(de=de||Oe.data.thisDep,be=be||Oe.data.contextDep,Ae=Ae||Oe.data.propDep)}return new Zt(de,be,Ae,B)}else return new Zt(Q===Ni,Q===Bi,Q===Di,B)}},os=function(S,B,Q,ue,me,de,be,Ae,Le,Oe,ze,$e,ke,Ie,Ee){var le=Oe.Record,se={add:32774,subtract:32778,"reverse subtract":32779};Q.ext_blend_minmax&&(se.min=Uu,se.max=ju);var Se=Q.angle_instanced_arrays,Ye=Q.webgl_draw_buffers,ye=Q.oes_vertex_array_object,rt={dirty:!0,profile:Ee.profile},Je={},He=[],xe={},pe={};function Xe(G){return G.replace(".","_")}function Ne(G,z,J){var ne=Xe(G);He.push(G),Je[ne]=rt[ne]=!!J,xe[ne]=z}function Me(G,z,J){var ne=Xe(G);He.push(G),Array.isArray(J)?(rt[ne]=J.slice(),Je[ne]=J.slice()):rt[ne]=Je[ne]=J,pe[ne]=z}Ne(yo,zu),Ne(_o,Iu),Me(bo,"blendColor",[0,0,0,0]),Me(Vi,"blendEquationSeparate",[No,No]),Me(Gi,"blendFuncSeparate",[Bo,Do,Bo,Do]),Ne(xo,Du,!0),Me(Co,"depthFunc",Hu),Me(So,"depthRange",[0,1]),Me(wo,"depthMask",!0),Me(Ui,Ui,[!0,!0,!0,!0]),Ne(Po,ku),Me(Ao,"cullFace",Dr),Me(ji,ji,na),Me(qi,qi,1),Ne(Eo,Nu),Me(Hi,"polygonOffset",[0,0]),Ne($o,Vu),Ne(Oo,Gu),Me(Wi,"sampleCoverage",[1,!1]),Ne(Lo,Fu),Me(Mo,"stencilMask",-1),Me(Yi,"stencilFunc",[qu,0,-1]),Me(Xi,"stencilOpSeparate",[Pn,Ar,Ar,Ar]),Me(vn,"stencilOpSeparate",[Dr,Ar,Ar,Ar]),Ne(To,Bu),Me(Hn,"scissor",[0,0,S.drawingBufferWidth,S.drawingBufferHeight]),Me(xr,xr,[0,0,S.drawingBufferWidth,S.drawingBufferHeight]);var Be={gl:S,context:ke,strings:B,next:Je,current:rt,draw:$e,elements:de,buffer:me,shader:ze,attributes:Oe.state,vao:Oe,uniforms:Le,framebuffer:Ae,extensions:Q,timer:Ie,isBufferArgs:On},Ve={primTypes:wr,compareFuncs:an,blendFuncs:yr,blendEquations:se,stencilOps:Er,glTypes:Lr,orientationType:ia};V.optional(function(){Be.isArrayLike=Ct}),Ye&&(Ve.backBuffer=[Dr],Ve.drawBuffer=at(ue.maxDrawbuffers,function(G){return G===0?[0]:at(G,function(z){return Wu+z})}));var pt=0;function dt(){var G=as(),z=G.link,J=G.global;G.id=pt++,G.batchId="0";var ne=z(Be),ie=G.shared={props:"a0"};Object.keys(Be).forEach(function(Z){ie[Z]=J.def(ne,".",Z)}),V.optional(function(){G.CHECK=z(V),G.commandStr=V.guessCommand(),G.command=z(G.commandStr),G.assert=function(Z,N,oe){Z("if(!(",N,"))",this.CHECK,".commandRaise(",z(oe),",",this.command,");")},Ve.invalidBlendCombinations=Go});var te=G.next={},ee=G.current={};Object.keys(pe).forEach(function(Z){Array.isArray(rt[Z])&&(te[Z]=J.def(ie.next,".",Z),ee[Z]=J.def(ie.current,".",Z))});var re=G.constants={};Object.keys(Ve).forEach(function(Z){re[Z]=J.def(JSON.stringify(Ve[Z]))}),G.invoke=function(Z,N){switch(N.type){case Fi:var oe=["this",ie.context,ie.props,G.batchId];return Z.def(z(N.data),".call(",oe.slice(0,Math.max(N.data.length+1,4)),")");case Di:return Z.def(ie.props,N.data);case Bi:return Z.def(ie.context,N.data);case Ni:return Z.def("this",N.data);case qn:return N.data.append(G,Z),N.data.ref;case mo:return N.data.toString();case go:return N.data.map(function(ce){return G.invoke(Z,ce)})}},G.attribCache={};var j={};return G.scopeAttrib=function(Z){var N=B.id(Z);if(N in j)return j[N];var oe=Oe.scope[N];oe||(oe=Oe.scope[N]=new le);var ce=j[N]=z(oe);return ce},G}function Ue(G){var z=G.static,J=G.dynamic,ne;if(mn in z){var ie=!!z[mn];ne=Ht(function(ee,re){return ie}),ne.enable=ie}else if(mn in J){var te=J[mn];ne=sr(te,function(ee,re){return ee.invoke(re,te)})}return ne}function qe(G,z){var J=G.static,ne=G.dynamic;if(kr in J){var ie=J[kr];return ie?(ie=Ae.getFramebuffer(ie),V.command(ie,"invalid framebuffer object"),Ht(function(ee,re){var j=ee.link(ie),Z=ee.shared;re.set(Z.framebuffer,".next",j);var N=Z.context;return re.set(N,"."+tn,j+".width"),re.set(N,"."+rn,j+".height"),j})):Ht(function(ee,re){var j=ee.shared;re.set(j.framebuffer,".next","null");var Z=j.context;return re.set(Z,"."+tn,Z+"."+ko),re.set(Z,"."+rn,Z+"."+Io),"null"})}else if(kr in ne){var te=ne[kr];return sr(te,function(ee,re){var j=ee.invoke(re,te),Z=ee.shared,N=Z.framebuffer,oe=re.def(N,".getFramebuffer(",j,")");V.optional(function(){ee.assert(re,"!"+j+"||"+oe,"invalid framebuffer object")}),re.set(N,".next",oe);var ce=Z.context;return re.set(ce,"."+tn,oe+"?"+oe+".width:"+ce+"."+ko),re.set(ce,"."+rn,oe+"?"+oe+".height:"+ce+"."+Io),oe})}else return null}function lt(G,z,J){var ne=G.static,ie=G.dynamic;function te(j){if(j in ne){var Z=ne[j];V.commandType(Z,"object","invalid "+j,J.commandStr);var N=!0,oe=Z.x|0,ce=Z.y|0,Ce,we;return"width"in Z?(Ce=Z.width|0,V.command(Ce>=0,"invalid "+j,J.commandStr)):N=!1,"height"in Z?(we=Z.height|0,V.command(we>=0,"invalid "+j,J.commandStr)):N=!1,new Zt(!N&&z&&z.thisDep,!N&&z&&z.contextDep,!N&&z&&z.propDep,function(it,et){var Qe=it.shared.context,Ke=Ce;"width"in Z||(Ke=et.def(Qe,".",tn,"-",oe));var Te=we;return"height"in Z||(Te=et.def(Qe,".",rn,"-",ce)),[oe,ce,Ke,Te]})}else if(j in ie){var Re=ie[j],We=sr(Re,function(it,et){var Qe=it.invoke(et,Re);V.optional(function(){it.assert(et,Qe+"&&typeof "+Qe+'==="object"',"invalid "+j)});var Ke=it.shared.context,Te=et.def(Qe,".x|0"),ve=et.def(Qe,".y|0"),ct=et.def('"width" in ',Qe,"?",Qe,".width|0:","(",Ke,".",tn,"-",Te,")"),Ft=et.def('"height" in ',Qe,"?",Qe,".height|0:","(",Ke,".",rn,"-",ve,")");return V.optional(function(){it.assert(et,ct+">=0&&"+Ft+">=0","invalid "+j)}),[Te,ve,ct,Ft]});return z&&(We.thisDep=We.thisDep||z.thisDep,We.contextDep=We.contextDep||z.contextDep,We.propDep=We.propDep||z.propDep),We}else return z?new Zt(z.thisDep,z.contextDep,z.propDep,function(it,et){var Qe=it.shared.context;return[0,0,et.def(Qe,".",tn),et.def(Qe,".",rn)]}):null}var ee=te(xr);if(ee){var re=ee;ee=new Zt(ee.thisDep,ee.contextDep,ee.propDep,function(j,Z){var N=re.append(j,Z),oe=j.shared.context;return Z.set(oe,"."+$u,N[2]),Z.set(oe,"."+Ou,N[3]),N})}return{viewport:ee,scissor_box:te(Hn)}}function vt(G,z){var J=G.static,ne=typeof J[yn]=="string"&&typeof J[gn]=="string";if(ne){if(Object.keys(z.dynamic).length>0)return null;var ie=z.static,te=Object.keys(ie);if(te.length>0&&typeof ie[te[0]]=="number"){for(var ee=[],re=0;re<te.length;++re)V(typeof ie[te[re]]=="number","must specify all vertex attribute locations when using vaos"),ee.push([ie[te[re]]|0,te[re]]);return ee}}return null}function wt(G,z,J){var ne=G.static,ie=G.dynamic;function te(N){if(N in ne){var oe=B.id(ne[N]);V.optional(function(){ze.shader(Uo[N],oe,V.guessCommand())});var ce=Ht(function(){return oe});return ce.id=oe,ce}else if(N in ie){var Ce=ie[N];return sr(Ce,function(we,Re){var We=we.invoke(Re,Ce),it=Re.def(we.shared.strings,".id(",We,")");return V.optional(function(){Re(we.shared.shader,".shader(",Uo[N],",",it,",",we.command,");")}),it})}return null}var ee=te(yn),re=te(gn),j=null,Z;return Cr(ee)&&Cr(re)?(j=ze.program(re.id,ee.id,null,J),Z=Ht(function(N,oe){return N.link(j)})):Z=new Zt(ee&&ee.thisDep||re&&re.thisDep,ee&&ee.contextDep||re&&re.contextDep,ee&&ee.propDep||re&&re.propDep,function(N,oe){var ce=N.shared.shader,Ce;ee?Ce=ee.append(N,oe):Ce=oe.def(ce,".",yn);var we;re?we=re.append(N,oe):we=oe.def(ce,".",gn);var Re=ce+".program("+we+","+Ce;return V.optional(function(){Re+=","+N.command}),oe.def(Re+")")}),{frag:ee,vert:re,progVar:Z,program:j}}function Bt(G,z){var J=G.static,ne=G.dynamic,ie={},te=!1;function ee(){if(_n in J){var et=J[_n];return et!==null&&Oe.getVAO(et)===null&&(et=Oe.createVAO(et)),te=!0,ie.vao=et,Ht(function(Ke){var Te=Oe.getVAO(et);return Te?Ke.link(Te):"null"})}else if(_n in ne){te=!0;var Qe=ne[_n];return sr(Qe,function(Ke,Te){var ve=Ke.invoke(Te,Qe);return Te.def(Ke.shared.vao+".getVAO("+ve+")")})}return null}var re=ee(),j=!1;function Z(){if(Ir in J){var et=J[Ir];if(ie.elements=et,On(et)){var Qe=ie.elements=de.create(et,!0);et=de.getElements(Qe),j=!0}else et&&(et=de.getElements(et),j=!0,V.command(et,"invalid elements",z.commandStr));var Ke=Ht(function(ve,ct){if(et){var Ft=ve.link(et);return ve.ELEMENTS=Ft,Ft}return ve.ELEMENTS=null,null});return Ke.value=et,Ke}else if(Ir in ne){j=!0;var Te=ne[Ir];return sr(Te,function(ve,ct){var Ft=ve.shared,tr=Ft.isBufferArgs,hr=Ft.elements,Nr=ve.invoke(ct,Te),_r=ct.def("null"),Vr=ct.def(tr,"(",Nr,")"),on=ve.cond(Vr).then(_r,"=",hr,".createStream(",Nr,");").else(_r,"=",hr,".getElements(",Nr,");");return V.optional(function(){ve.assert(on.else,"!"+Nr+"||"+_r,"invalid elements")}),ct.entry(on),ct.exit(ve.cond(Vr).then(hr,".destroyStream(",_r,");")),ve.ELEMENTS=_r,_r})}else if(te)return new Zt(re.thisDep,re.contextDep,re.propDep,function(ve,ct){return ct.def(ve.shared.vao+".currentVAO?"+ve.shared.elements+".getElements("+ve.shared.vao+".currentVAO.elements):null")});return null}var N=Z();function oe(){if(zr in J){var et=J[zr];return ie.primitive=et,V.commandParameter(et,wr,"invalid primitve",z.commandStr),Ht(function(Ke,Te){return wr[et]})}else if(zr in ne){var Qe=ne[zr];return sr(Qe,function(Ke,Te){var ve=Ke.constants.primTypes,ct=Ke.invoke(Te,Qe);return V.optional(function(){Ke.assert(Te,ct+" in "+ve,"invalid primitive, must be one of "+Object.keys(wr))}),Te.def(ve,"[",ct,"]")})}else{if(j)return Cr(N)?N.value?Ht(function(Ke,Te){return Te.def(Ke.ELEMENTS,".primType")}):Ht(function(){return ra}):new Zt(N.thisDep,N.contextDep,N.propDep,function(Ke,Te){var ve=Ke.ELEMENTS;return Te.def(ve,"?",ve,".primType:",ra)});if(te)return new Zt(re.thisDep,re.contextDep,re.propDep,function(Ke,Te){return Te.def(Ke.shared.vao+".currentVAO?"+Ke.shared.vao+".currentVAO.primitive:"+ra)})}return null}function ce(et,Qe){if(et in J){var Ke=J[et]|0;return Qe?ie.offset=Ke:ie.instances=Ke,V.command(!Qe||Ke>=0,"invalid "+et,z.commandStr),Ht(function(ve,ct){return Qe&&(ve.OFFSET=Ke),Ke})}else if(et in ne){var Te=ne[et];return sr(Te,function(ve,ct){var Ft=ve.invoke(ct,Te);return Qe&&(ve.OFFSET=Ft,V.optional(function(){ve.assert(ct,Ft+">=0","invalid "+et)})),Ft})}else if(Qe){if(j)return Ht(function(ve,ct){return ve.OFFSET=0,0});if(te)return new Zt(re.thisDep,re.contextDep,re.propDep,function(ve,ct){return ct.def(ve.shared.vao+".currentVAO?"+ve.shared.vao+".currentVAO.offset:0")})}else if(te)return new Zt(re.thisDep,re.contextDep,re.propDep,function(ve,ct){return ct.def(ve.shared.vao+".currentVAO?"+ve.shared.vao+".currentVAO.instances:-1")});return null}var Ce=ce(Wn,!0);function we(){if(Fr in J){var et=J[Fr]|0;return ie.count=et,V.command(typeof et=="number"&&et>=0,"invalid vertex count",z.commandStr),Ht(function(){return et})}else if(Fr in ne){var Qe=ne[Fr];return sr(Qe,function(ct,Ft){var tr=ct.invoke(Ft,Qe);return V.optional(function(){ct.assert(Ft,"typeof "+tr+'==="number"&&'+tr+">=0&&"+tr+"===("+tr+"|0)","invalid vertex count")}),tr})}else if(j)if(Cr(N)){if(N)return Ce?new Zt(Ce.thisDep,Ce.contextDep,Ce.propDep,function(ct,Ft){var tr=Ft.def(ct.ELEMENTS,".vertCount-",ct.OFFSET);return V.optional(function(){ct.assert(Ft,tr+">=0","invalid vertex offset/element buffer too small")}),tr}):Ht(function(ct,Ft){return Ft.def(ct.ELEMENTS,".vertCount")});var Ke=Ht(function(){return-1});return V.optional(function(){Ke.MISSING=!0}),Ke}else{var Te=new Zt(N.thisDep||Ce.thisDep,N.contextDep||Ce.contextDep,N.propDep||Ce.propDep,function(ct,Ft){var tr=ct.ELEMENTS;return ct.OFFSET?Ft.def(tr,"?",tr,".vertCount-",ct.OFFSET,":-1"):Ft.def(tr,"?",tr,".vertCount:-1")});return V.optional(function(){Te.DYNAMIC=!0}),Te}else if(te){var ve=new Zt(re.thisDep,re.contextDep,re.propDep,function(ct,Ft){return Ft.def(ct.shared.vao,".currentVAO?",ct.shared.vao,".currentVAO.count:-1")});return ve}return null}var Re=oe(),We=we(),it=ce(Yn,!1);return{elements:N,primitive:Re,count:We,instances:it,offset:Ce,vao:re,vaoActive:te,elementsActive:j,static:ie}}function Gt(G,z){var J=G.static,ne=G.dynamic,ie={};return He.forEach(function(te){var ee=Xe(te);function re(j,Z){if(te in J){var N=j(J[te]);ie[ee]=Ht(function(){return N})}else if(te in ne){var oe=ne[te];ie[ee]=sr(oe,function(ce,Ce){return Z(ce,Ce,ce.invoke(Ce,oe))})}}switch(te){case Po:case _o:case yo:case Lo:case xo:case To:case Eo:case $o:case Oo:case wo:return re(function(j){return V.commandType(j,"boolean",te,z.commandStr),j},function(j,Z,N){return V.optional(function(){j.assert(Z,"typeof "+N+'==="boolean"',"invalid flag "+te,j.commandStr)}),N});case Co:return re(function(j){return V.commandParameter(j,an,"invalid "+te,z.commandStr),an[j]},function(j,Z,N){var oe=j.constants.compareFuncs;return V.optional(function(){j.assert(Z,N+" in "+oe,"invalid "+te+", must be one of "+Object.keys(an))}),Z.def(oe,"[",N,"]")});case So:return re(function(j){return V.command(Ct(j)&&j.length===2&&typeof j[0]=="number"&&typeof j[1]=="number"&&j[0]<=j[1],"depth range is 2d array",z.commandStr),j},function(j,Z,N){V.optional(function(){j.assert(Z,j.shared.isArrayLike+"("+N+")&&"+N+".length===2&&typeof "+N+'[0]==="number"&&typeof '+N+'[1]==="number"&&'+N+"[0]<="+N+"[1]","depth range must be a 2d array")});var oe=Z.def("+",N,"[0]"),ce=Z.def("+",N,"[1]");return[oe,ce]});case Gi:return re(function(j){V.commandType(j,"object","blend.func",z.commandStr);var Z="srcRGB"in j?j.srcRGB:j.src,N="srcAlpha"in j?j.srcAlpha:j.src,oe="dstRGB"in j?j.dstRGB:j.dst,ce="dstAlpha"in j?j.dstAlpha:j.dst;return V.commandParameter(Z,yr,ee+".srcRGB",z.commandStr),V.commandParameter(N,yr,ee+".srcAlpha",z.commandStr),V.commandParameter(oe,yr,ee+".dstRGB",z.commandStr),V.commandParameter(ce,yr,ee+".dstAlpha",z.commandStr),V.command(Go.indexOf(Z+", "+oe)===-1,"unallowed blending combination (srcRGB, dstRGB) = ("+Z+", "+oe+")",z.commandStr),[yr[Z],yr[oe],yr[N],yr[ce]]},function(j,Z,N){var oe=j.constants.blendFuncs;V.optional(function(){j.assert(Z,N+"&&typeof "+N+'==="object"',"invalid blend func, must be an object")});function ce(Qe,Ke){var Te=Z.def('"',Qe,Ke,'" in ',N,"?",N,".",Qe,Ke,":",N,".",Qe);return V.optional(function(){j.assert(Z,Te+" in "+oe,"invalid "+te+"."+Qe+Ke+", must be one of "+Object.keys(yr))}),Te}var Ce=ce("src","RGB"),we=ce("dst","RGB");V.optional(function(){var Qe=j.constants.invalidBlendCombinations;j.assert(Z,Qe+".indexOf("+Ce+'+", "+'+we+") === -1 ","unallowed blending combination for (srcRGB, dstRGB)")});var Re=Z.def(oe,"[",Ce,"]"),We=Z.def(oe,"[",ce("src","Alpha"),"]"),it=Z.def(oe,"[",we,"]"),et=Z.def(oe,"[",ce("dst","Alpha"),"]");return[Re,it,We,et]});case Vi:return re(function(j){if(typeof j=="string")return V.commandParameter(j,se,"invalid "+te,z.commandStr),[se[j],se[j]];if(typeof j=="object")return V.commandParameter(j.rgb,se,te+".rgb",z.commandStr),V.commandParameter(j.alpha,se,te+".alpha",z.commandStr),[se[j.rgb],se[j.alpha]];V.commandRaise("invalid blend.equation",z.commandStr)},function(j,Z,N){var oe=j.constants.blendEquations,ce=Z.def(),Ce=Z.def(),we=j.cond("typeof ",N,'==="string"');return V.optional(function(){function Re(We,it,et){j.assert(We,et+" in "+oe,"invalid "+it+", must be one of "+Object.keys(se))}Re(we.then,te,N),j.assert(we.else,N+"&&typeof "+N+'==="object"',"invalid "+te),Re(we.else,te+".rgb",N+".rgb"),Re(we.else,te+".alpha",N+".alpha")}),we.then(ce,"=",Ce,"=",oe,"[",N,"];"),we.else(ce,"=",oe,"[",N,".rgb];",Ce,"=",oe,"[",N,".alpha];"),Z(we),[ce,Ce]});case bo:return re(function(j){return V.command(Ct(j)&&j.length===4,"blend.color must be a 4d array",z.commandStr),at(4,function(Z){return+j[Z]})},function(j,Z,N){return V.optional(function(){j.assert(Z,j.shared.isArrayLike+"("+N+")&&"+N+".length===4","blend.color must be a 4d array")}),at(4,function(oe){return Z.def("+",N,"[",oe,"]")})});case Mo:return re(function(j){return V.commandType(j,"number",ee,z.commandStr),j|0},function(j,Z,N){return V.optional(function(){j.assert(Z,"typeof "+N+'==="number"',"invalid stencil.mask")}),Z.def(N,"|0")});case Yi:return re(function(j){V.commandType(j,"object",ee,z.commandStr);var Z=j.cmp||"keep",N=j.ref||0,oe="mask"in j?j.mask:-1;return V.commandParameter(Z,an,te+".cmp",z.commandStr),V.commandType(N,"number",te+".ref",z.commandStr),V.commandType(oe,"number",te+".mask",z.commandStr),[an[Z],N,oe]},function(j,Z,N){var oe=j.constants.compareFuncs;V.optional(function(){function Re(){j.assert(Z,Array.prototype.join.call(arguments,""),"invalid stencil.func")}Re(N+"&&typeof ",N,'==="object"'),Re('!("cmp" in ',N,")||(",N,".cmp in ",oe,")")});var ce=Z.def('"cmp" in ',N,"?",oe,"[",N,".cmp]",":",Ar),Ce=Z.def(N,".ref|0"),we=Z.def('"mask" in ',N,"?",N,".mask|0:-1");return[ce,Ce,we]});case Xi:case vn:return re(function(j){V.commandType(j,"object",ee,z.commandStr);var Z=j.fail||"keep",N=j.zfail||"keep",oe=j.zpass||"keep";return V.commandParameter(Z,Er,te+".fail",z.commandStr),V.commandParameter(N,Er,te+".zfail",z.commandStr),V.commandParameter(oe,Er,te+".zpass",z.commandStr),[te===vn?Dr:Pn,Er[Z],Er[N],Er[oe]]},function(j,Z,N){var oe=j.constants.stencilOps;V.optional(function(){j.assert(Z,N+"&&typeof "+N+'==="object"',"invalid "+te)});function ce(Ce){return V.optional(function(){j.assert(Z,'!("'+Ce+'" in '+N+")||("+N+"."+Ce+" in "+oe+")","invalid "+te+"."+Ce+", must be one of "+Object.keys(Er))}),Z.def('"',Ce,'" in ',N,"?",oe,"[",N,".",Ce,"]:",Ar)}return[te===vn?Dr:Pn,ce("fail"),ce("zfail"),ce("zpass")]});case Hi:return re(function(j){V.commandType(j,"object",ee,z.commandStr);var Z=j.factor|0,N=j.units|0;return V.commandType(Z,"number",ee+".factor",z.commandStr),V.commandType(N,"number",ee+".units",z.commandStr),[Z,N]},function(j,Z,N){V.optional(function(){j.assert(Z,N+"&&typeof "+N+'==="object"',"invalid "+te)});var oe=Z.def(N,".factor|0"),ce=Z.def(N,".units|0");return[oe,ce]});case Ao:return re(function(j){var Z=0;return j==="front"?Z=Pn:j==="back"&&(Z=Dr),V.command(!!Z,ee,z.commandStr),Z},function(j,Z,N){return V.optional(function(){j.assert(Z,N+'==="front"||'+N+'==="back"',"invalid cull.face")}),Z.def(N,'==="front"?',Pn,":",Dr)});case qi:return re(function(j){return V.command(typeof j=="number"&&j>=ue.lineWidthDims[0]&&j<=ue.lineWidthDims[1],"invalid line width, must be a positive number between "+ue.lineWidthDims[0]+" and "+ue.lineWidthDims[1],z.commandStr),j},function(j,Z,N){return V.optional(function(){j.assert(Z,"typeof "+N+'==="number"&&'+N+">="+ue.lineWidthDims[0]+"&&"+N+"<="+ue.lineWidthDims[1],"invalid line width")}),N});case ji:return re(function(j){return V.commandParameter(j,ia,ee,z.commandStr),ia[j]},function(j,Z,N){return V.optional(function(){j.assert(Z,N+'==="cw"||'+N+'==="ccw"',"invalid frontFace, must be one of cw,ccw")}),Z.def(N+'==="cw"?'+Fo+":"+na)});case Ui:return re(function(j){return V.command(Ct(j)&&j.length===4,"color.mask must be length 4 array",z.commandStr),j.map(function(Z){return!!Z})},function(j,Z,N){return V.optional(function(){j.assert(Z,j.shared.isArrayLike+"("+N+")&&"+N+".length===4","invalid color.mask")}),at(4,function(oe){return"!!"+N+"["+oe+"]"})});case Wi:return re(function(j){V.command(typeof j=="object"&&j,ee,z.commandStr);var Z="value"in j?j.value:1,N=!!j.invert;return V.command(typeof Z=="number"&&Z>=0&&Z<=1,"sample.coverage.value must be a number between 0 and 1",z.commandStr),[Z,N]},function(j,Z,N){V.optional(function(){j.assert(Z,N+"&&typeof "+N+'==="object"',"invalid sample.coverage")});var oe=Z.def('"value" in ',N,"?+",N,".value:1"),ce=Z.def("!!",N,".invert");return[oe,ce]})}}),ie}function Pt(G,z){var J=G.static,ne=G.dynamic,ie={};return Object.keys(J).forEach(function(te){var ee=J[te],re;if(typeof ee=="number"||typeof ee=="boolean")re=Ht(function(){return ee});else if(typeof ee=="function"){var j=ee._reglType;j==="texture2d"||j==="textureCube"?re=Ht(function(Z){return Z.link(ee)}):j==="framebuffer"||j==="framebufferCube"?(V.command(ee.color.length>0,'missing color attachment for framebuffer sent to uniform "'+te+'"',z.commandStr),re=Ht(function(Z){return Z.link(ee.color[0])})):V.commandRaise('invalid data for uniform "'+te+'"',z.commandStr)}else Ct(ee)?re=Ht(function(Z){var N=Z.global.def("[",at(ee.length,function(oe){return V.command(typeof ee[oe]=="number"||typeof ee[oe]=="boolean","invalid uniform "+te,Z.commandStr),ee[oe]}),"]");return N}):V.commandRaise('invalid or missing data for uniform "'+te+'"',z.commandStr);re.value=ee,ie[te]=re}),Object.keys(ne).forEach(function(te){var ee=ne[te];ie[te]=sr(ee,function(re,j){return re.invoke(j,ee)})}),ie}function Xt(G,z){var J=G.static,ne=G.dynamic,ie={};return Object.keys(J).forEach(function(te){var ee=J[te],re=B.id(te),j=new le;if(On(ee))j.state=en,j.buffer=me.getBuffer(me.create(ee,nn,!1,!0)),j.type=0;else{var Z=me.getBuffer(ee);if(Z)j.state=en,j.buffer=Z,j.type=0;else if(V.command(typeof ee=="object"&&ee,"invalid data for attribute "+te,z.commandStr),"constant"in ee){var N=ee.constant;j.buffer="null",j.state=zi,typeof N=="number"?j.x=N:(V.command(Ct(N)&&N.length>0&&N.length<=4,"invalid constant for attribute "+te,z.commandStr),Jr.forEach(function(it,et){et<N.length&&(j[it]=N[et])}))}else{On(ee.buffer)?Z=me.getBuffer(me.create(ee.buffer,nn,!1,!0)):Z=me.getBuffer(ee.buffer),V.command(!!Z,'missing buffer for attribute "'+te+'"',z.commandStr);var oe=ee.offset|0;V.command(oe>=0,'invalid offset for attribute "'+te+'"',z.commandStr);var ce=ee.stride|0;V.command(ce>=0&&ce<256,'invalid stride for attribute "'+te+'", must be integer betweeen [0, 255]',z.commandStr);var Ce=ee.size|0;V.command(!("size"in ee)||Ce>0&&Ce<=4,'invalid size for attribute "'+te+'", must be 1,2,3,4',z.commandStr);var we=!!ee.normalized,Re=0;"type"in ee&&(V.commandParameter(ee.type,Lr,"invalid type for attribute "+te,z.commandStr),Re=Lr[ee.type]);var We=ee.divisor|0;V.optional(function(){"divisor"in ee&&(V.command(We===0||Se,'cannot specify divisor for attribute "'+te+'", instancing not supported',z.commandStr),V.command(We>=0,'invalid divisor for attribute "'+te+'"',z.commandStr));var it=z.commandStr,et=["buffer","offset","divisor","normalized","type","size","stride"];Object.keys(ee).forEach(function(Qe){V.command(et.indexOf(Qe)>=0,'unknown parameter "'+Qe+'" for attribute pointer "'+te+'" (valid parameters are '+et+")",it)})}),j.buffer=Z,j.state=en,j.size=Ce,j.normalized=we,j.type=Re||Z.dtype,j.offset=oe,j.stride=ce,j.divisor=We}}ie[te]=Ht(function(it,et){var Qe=it.attribCache;if(re in Qe)return Qe[re];var Ke={isStream:!1};return Object.keys(j).forEach(function(Te){Ke[Te]=j[Te]}),j.buffer&&(Ke.buffer=it.link(j.buffer),Ke.type=Ke.type||Ke.buffer+".dtype"),Qe[re]=Ke,Ke})}),Object.keys(ne).forEach(function(te){var ee=ne[te];function re(j,Z){var N=j.invoke(Z,ee),oe=j.shared,ce=j.constants,Ce=oe.isBufferArgs,we=oe.buffer;V.optional(function(){j.assert(Z,N+"&&(typeof "+N+'==="object"||typeof '+N+'==="function")&&('+Ce+"("+N+")||"+we+".getBuffer("+N+")||"+we+".getBuffer("+N+".buffer)||"+Ce+"("+N+'.buffer)||("constant" in '+N+"&&(typeof "+N+'.constant==="number"||'+oe.isArrayLike+"("+N+".constant))))",'invalid dynamic attribute "'+te+'"')});var Re={isStream:Z.def(!1)},We=new le;We.state=en,Object.keys(We).forEach(function(Ke){Re[Ke]=Z.def(""+We[Ke])});var it=Re.buffer,et=Re.type;Z("if(",Ce,"(",N,")){",Re.isStream,"=true;",it,"=",we,".createStream(",nn,",",N,");",et,"=",it,".dtype;","}else{",it,"=",we,".getBuffer(",N,");","if(",it,"){",et,"=",it,".dtype;",'}else if("constant" in ',N,"){",Re.state,"=",zi,";","if(typeof "+N+'.constant === "number"){',Re[Jr[0]],"=",N,".constant;",Jr.slice(1).map(function(Ke){return Re[Ke]}).join("="),"=0;","}else{",Jr.map(function(Ke,Te){return Re[Ke]+"="+N+".constant.length>"+Te+"?"+N+".constant["+Te+"]:0;"}).join(""),"}}else{","if(",Ce,"(",N,".buffer)){",it,"=",we,".createStream(",nn,",",N,".buffer);","}else{",it,"=",we,".getBuffer(",N,".buffer);","}",et,'="type" in ',N,"?",ce.glTypes,"[",N,".type]:",it,".dtype;",Re.normalized,"=!!",N,".normalized;");function Qe(Ke){Z(Re[Ke],"=",N,".",Ke,"|0;")}return Qe("size"),Qe("offset"),Qe("stride"),Qe("divisor"),Z("}}"),Z.exit("if(",Re.isStream,"){",we,".destroyStream(",it,");","}"),Re}ie[te]=sr(ee,re)}),ie}function It(G){var z=G.static,J=G.dynamic,ne={};return Object.keys(z).forEach(function(ie){var te=z[ie];ne[ie]=Ht(function(ee,re){return typeof te=="number"||typeof te=="boolean"?""+te:ee.link(te)})}),Object.keys(J).forEach(function(ie){var te=J[ie];ne[ie]=sr(te,function(ee,re){return ee.invoke(re,te)})}),ne}function Yt(G,z,J,ne,ie){var te=G.static,ee=G.dynamic;V.optional(function(){var Qe=[kr,gn,yn,Ir,zr,Wn,Fr,Yn,mn,_n].concat(He);function Ke(Te){Object.keys(Te).forEach(function(ve){V.command(Qe.indexOf(ve)>=0,'unknown parameter "'+ve+'"',ie.commandStr)})}Ke(te),Ke(ee)});var re=vt(G,z),j=qe(G),Z=lt(G,j,ie),N=Bt(G,ie),oe=Gt(G,ie),ce=wt(G,ie,re);function Ce(Qe){var Ke=Z[Qe];Ke&&(oe[Qe]=Ke)}Ce(xr),Ce(Xe(Hn));var we=Object.keys(oe).length>0,Re={framebuffer:j,draw:N,shader:ce,state:oe,dirty:we,scopeVAO:null,drawVAO:null,useVAO:!1,attributes:{}};if(Re.profile=Ue(G),Re.uniforms=Pt(J,ie),Re.drawVAO=Re.scopeVAO=N.vao,!Re.drawVAO&&ce.program&&!re&&Q.angle_instanced_arrays&&N.static.elements){var We=!0,it=ce.program.attributes.map(function(Qe){var Ke=z.static[Qe];return We=We&&!!Ke,Ke});if(We&&it.length>0){var et=Oe.getVAO(Oe.createVAO({attributes:it,elements:N.static.elements}));Re.drawVAO=new Zt(null,null,null,function(Qe,Ke){return Qe.link(et)}),Re.useVAO=!0}}return re?Re.useVAO=!0:Re.attributes=Xt(z,ie),Re.context=It(ne),Re}function Qt(G,z,J){var ne=G.shared,ie=ne.context,te=G.scope();Object.keys(J).forEach(function(ee){z.save(ie,"."+ee);var re=J[ee],j=re.append(G,z);Array.isArray(j)?te(ie,".",ee,"=[",j.join(),"];"):te(ie,".",ee,"=",j,";")}),z(te)}function Kt(G,z,J,ne){var ie=G.shared,te=ie.gl,ee=ie.framebuffer,re;Ye&&(re=z.def(ie.extensions,".webgl_draw_buffers"));var j=G.constants,Z=j.drawBuffer,N=j.backBuffer,oe;J?oe=J.append(G,z):oe=z.def(ee,".next"),ne||z("if(",oe,"!==",ee,".cur){"),z("if(",oe,"){",te,".bindFramebuffer(",Vo,",",oe,".framebuffer);"),Ye&&z(re,".drawBuffersWEBGL(",Z,"[",oe,".colorAttachments.length]);"),z("}else{",te,".bindFramebuffer(",Vo,",null);"),Ye&&z(re,".drawBuffersWEBGL(",N,");"),z("}",ee,".cur=",oe,";"),ne||z("}")}function Jt(G,z,J){var ne=G.shared,ie=ne.gl,te=G.current,ee=G.next,re=ne.current,j=ne.next,Z=G.cond(re,".dirty");He.forEach(function(N){var oe=Xe(N);if(!(oe in J.state)){var ce,Ce;if(oe in ee){ce=ee[oe],Ce=te[oe];var we=at(rt[oe].length,function(We){return Z.def(ce,"[",We,"]")});Z(G.cond(we.map(function(We,it){return We+"!=="+Ce+"["+it+"]"}).join("||")).then(ie,".",pe[oe],"(",we,");",we.map(function(We,it){return Ce+"["+it+"]="+We}).join(";"),";"))}else{ce=Z.def(j,".",oe);var Re=G.cond(ce,"!==",re,".",oe);Z(Re),oe in xe?Re(G.cond(ce).then(ie,".enable(",xe[oe],");").else(ie,".disable(",xe[oe],");"),re,".",oe,"=",ce,";"):Re(ie,".",pe[oe],"(",ce,");",re,".",oe,"=",ce,";")}}}),Object.keys(J.state).length===0&&Z(re,".dirty=false;"),z(Z)}function ir(G,z,J,ne){var ie=G.shared,te=G.current,ee=ie.current,re=ie.gl;ua(Object.keys(J)).forEach(function(j){var Z=J[j];if(!(ne&&!ne(Z))){var N=Z.append(G,z);if(xe[j]){var oe=xe[j];Cr(Z)?N?z(re,".enable(",oe,");"):z(re,".disable(",oe,");"):z(G.cond(N).then(re,".enable(",oe,");").else(re,".disable(",oe,");")),z(ee,".",j,"=",N,";")}else if(Ct(N)){var ce=te[j];z(re,".",pe[j],"(",N,");",N.map(function(Ce,we){return ce+"["+we+"]="+Ce}).join(";"),";")}else z(re,".",pe[j],"(",N,");",ee,".",j,"=",N,";")}})}function qt(G,z){Se&&(G.instancing=z.def(G.shared.extensions,".angle_instanced_arrays"))}function yt(G,z,J,ne,ie){var te=G.shared,ee=G.stats,re=te.current,j=te.timer,Z=J.profile;function N(){return typeof performance=="undefined"?"Date.now()":"performance.now()"}var oe,ce;function Ce(Qe){oe=z.def(),Qe(oe,"=",N(),";"),typeof ie=="string"?Qe(ee,".count+=",ie,";"):Qe(ee,".count++;"),Ie&&(ne?(ce=z.def(),Qe(ce,"=",j,".getNumPendingQueries();")):Qe(j,".beginQuery(",ee,");"))}function we(Qe){Qe(ee,".cpuTime+=",N(),"-",oe,";"),Ie&&(ne?Qe(j,".pushScopeStats(",ce,",",j,".getNumPendingQueries(),",ee,");"):Qe(j,".endQuery();"))}function Re(Qe){var Ke=z.def(re,".profile");z(re,".profile=",Qe,";"),z.exit(re,".profile=",Ke,";")}var We;if(Z){if(Cr(Z)){Z.enable?(Ce(z),we(z.exit),Re("true")):Re("false");return}We=Z.append(G,z),Re(We)}else We=z.def(re,".profile");var it=G.block();Ce(it),z("if(",We,"){",it,"}");var et=G.block();we(et),z.exit("if(",We,"){",et,"}")}function ar(G,z,J,ne,ie){var te=G.shared;function ee(j){switch(j){case Xn:case Zn:case ti:return 2;case Qn:case Jn:case ri:return 3;case Kn:case ei:case ni:return 4;default:return 1}}function re(j,Z,N){var oe=te.gl,ce=z.def(j,".location"),Ce=z.def(te.attributes,"[",ce,"]"),we=N.state,Re=N.buffer,We=[N.x,N.y,N.z,N.w],it=["buffer","normalized","offset","stride"];function et(){z("if(!",Ce,".buffer){",oe,".enableVertexAttribArray(",ce,");}");var Ke=N.type,Te;if(N.size?Te=z.def(N.size,"||",Z):Te=Z,z("if(",Ce,".type!==",Ke,"||",Ce,".size!==",Te,"||",it.map(function(ct){return Ce+"."+ct+"!=="+N[ct]}).join("||"),"){",oe,".bindBuffer(",nn,",",Re,".buffer);",oe,".vertexAttribPointer(",[ce,Te,Ke,N.normalized,N.stride,N.offset],");",Ce,".type=",Ke,";",Ce,".size=",Te,";",it.map(function(ct){return Ce+"."+ct+"="+N[ct]+";"}).join(""),"}"),Se){var ve=N.divisor;z("if(",Ce,".divisor!==",ve,"){",G.instancing,".vertexAttribDivisorANGLE(",[ce,ve],");",Ce,".divisor=",ve,";}")}}function Qe(){z("if(",Ce,".buffer){",oe,".disableVertexAttribArray(",ce,");",Ce,".buffer=null;","}if(",Jr.map(function(Ke,Te){return Ce+"."+Ke+"!=="+We[Te]}).join("||"),"){",oe,".vertexAttrib4f(",ce,",",We,");",Jr.map(function(Ke,Te){return Ce+"."+Ke+"="+We[Te]+";"}).join(""),"}")}we===en?et():we===zi?Qe():(z("if(",we,"===",en,"){"),et(),z("}else{"),Qe(),z("}"))}ne.forEach(function(j){var Z=j.name,N=J.attributes[Z],oe;if(N){if(!ie(N))return;oe=N.append(G,z)}else{if(!ie(jo))return;var ce=G.scopeAttrib(Z);V.optional(function(){G.assert(z,ce+".state","missing attribute "+Z)}),oe={},Object.keys(new le).forEach(function(Ce){oe[Ce]=z.def(ce,".",Ce)})}re(G.link(j),ee(j.info.type),oe)})}function Mt(G,z,J,ne,ie,te){for(var ee=function(ce){var Ce=ne[ce],we=Ce.name,Re=Ce.info.type,We=Ce.info.size,it=J.uniforms[we];if(We>1){if(!it)return"continue";var et=we.replace("[0]","");if(Z[et])return"continue";Z[et]=1}var Qe=G.link(Ce),Ke=Qe+".location",Te;if(it){if(!ie(it))return"continue";if(Cr(it)){var ve=it.value;if(V.command(ve!==null&&typeof ve!="undefined",'missing uniform "'+we+'"',G.commandStr),Re===Sn||Re===wn){V.command(typeof ve=="function"&&(Re===Sn&&(ve._reglType==="texture2d"||ve._reglType==="framebuffer")||Re===wn&&(ve._reglType==="textureCube"||ve._reglType==="framebufferCube")),"invalid texture for uniform "+we,G.commandStr);var ct=G.link(ve._texture||ve.color[0]._texture);z(j,".uniform1i(",Ke,",",ct+".bind());"),z.exit(ct,".unbind();")}else if(Re===bn||Re===xn||Re===Cn){V.optional(function(){V.command(Ct(ve),"invalid matrix for uniform "+we,G.commandStr),V.command(Re===bn&&ve.length===4||Re===xn&&ve.length===9||Re===Cn&&ve.length===16,"invalid length for matrix uniform "+we,G.commandStr)});var Ft=G.global.def("new Float32Array(["+Array.prototype.slice.call(ve)+"])"),tr=2;Re===xn?tr=3:Re===Cn&&(tr=4),z(j,".uniformMatrix",tr,"fv(",Ke,",false,",Ft,");")}else{switch(Re){case Ji:We===1?V.commandType(ve,"number","uniform "+we,G.commandStr):V.command(Ct(ve)&&ve.length===We,"uniform "+we,G.commandStr),N="1f";break;case Xn:V.command(Ct(ve)&&ve.length&&ve.length%2===0&&ve.length<=We*2,"uniform "+we,G.commandStr),N="2f";break;case Qn:V.command(Ct(ve)&&ve.length&&ve.length%3===0&&ve.length<=We*3,"uniform "+we,G.commandStr),N="3f";break;case Kn:V.command(Ct(ve)&&ve.length&&ve.length%4===0&&ve.length<=We*4,"uniform "+we,G.commandStr),N="4f";break;case ta:We===1?V.commandType(ve,"boolean","uniform "+we,G.commandStr):V.command(Ct(ve)&&ve.length===We,"uniform "+we,G.commandStr),N="1i";break;case ea:We===1?V.commandType(ve,"number","uniform "+we,G.commandStr):V.command(Ct(ve)&&ve.length===We,"uniform "+we,G.commandStr),N="1i";break;case ti:V.command(Ct(ve)&&ve.length&&ve.length%2===0&&ve.length<=We*2,"uniform "+we,G.commandStr),N="2i";break;case Zn:V.command(Ct(ve)&&ve.length&&ve.length%2===0&&ve.length<=We*2,"uniform "+we,G.commandStr),N="2i";break;case ri:V.command(Ct(ve)&&ve.length&&ve.length%3===0&&ve.length<=We*3,"uniform "+we,G.commandStr),N="3i";break;case Jn:V.command(Ct(ve)&&ve.length&&ve.length%3===0&&ve.length<=We*3,"uniform "+we,G.commandStr),N="3i";break;case ni:V.command(Ct(ve)&&ve.length&&ve.length%4===0&&ve.length<=We*4,"uniform "+we,G.commandStr),N="4i";break;case ei:V.command(Ct(ve)&&ve.length&&ve.length%4===0&&ve.length<=We*4,"uniform "+we,G.commandStr),N="4i";break}We>1?(N+="v",ve=G.global.def("["+Array.prototype.slice.call(ve)+"]")):ve=Ct(ve)?Array.prototype.slice.call(ve):ve,z(j,".uniform",N,"(",Ke,",",ve,");")}return"continue"}else Te=it.append(G,z)}else{if(!ie(jo))return"continue";Te=z.def(re.uniforms,"[",B.id(we),"]")}Re===Sn?(V(!Array.isArray(Te),"must specify a scalar prop for textures"),z("if(",Te,"&&",Te,'._reglType==="framebuffer"){',Te,"=",Te,".color[0];","}")):Re===wn&&(V(!Array.isArray(Te),"must specify a scalar prop for cube maps"),z("if(",Te,"&&",Te,'._reglType==="framebufferCube"){',Te,"=",Te,".color[0];","}")),V.optional(function(){function dr(lr,ai){G.assert(z,lr,'bad data or missing for uniform "'+we+'".  '+ai)}function Gr(lr,ai){ai===1&&V(!Array.isArray(Te),"must not specify an array type for uniform"),dr("Array.isArray("+Te+") && typeof "+Te+'[0]===" '+lr+'" || typeof '+Te+'==="'+lr+'"',"invalid type, expected "+lr)}function vr(lr,ai,oi){Array.isArray(Te)?V(Te.length&&Te.length%lr===0&&Te.length<=lr*oi,"must have length of "+(oi===1?"":"n * ")+lr):dr(re.isArrayLike+"("+Te+")&&"+Te+".length && "+Te+".length % "+lr+" === 0 && "+Te+".length<="+lr*oi,"invalid vector, should have length of "+(oi===1?"":"n * ")+lr,G.commandStr)}function Qo(lr){V(!Array.isArray(Te),"must not specify a value type"),dr("typeof "+Te+'==="function"&&'+Te+'._reglType==="texture'+(lr===zo?"2d":"Cube")+'"',"invalid texture type",G.commandStr)}switch(Re){case ea:Gr("number",We);break;case Zn:vr(2,"number",We);break;case Jn:vr(3,"number",We);break;case ei:vr(4,"number",We);break;case Ji:Gr("number",We);break;case Xn:vr(2,"number",We);break;case Qn:vr(3,"number",We);break;case Kn:vr(4,"number",We);break;case ta:Gr("boolean",We);break;case ti:vr(2,"boolean",We);break;case ri:vr(3,"boolean",We);break;case ni:vr(4,"boolean",We);break;case bn:vr(4,"number",We);break;case xn:vr(9,"number",We);break;case Cn:vr(16,"number",We);break;case Sn:Qo(zo);break;case wn:Qo(Ru);break}});var hr=1;switch(Re){case Sn:case wn:var Nr=z.def(Te,"._texture");return z(j,".uniform1i(",Ke,",",Nr,".bind());"),z.exit(Nr,".unbind();"),"continue";case ea:case ta:N="1i";break;case Zn:case ti:N="2i",hr=2;break;case Jn:case ri:N="3i",hr=3;break;case ei:case ni:N="4i",hr=4;break;case Ji:N="1f";break;case Xn:N="2f",hr=2;break;case Qn:N="3f",hr=3;break;case Kn:N="4f",hr=4;break;case bn:N="Matrix2fv";break;case xn:N="Matrix3fv";break;case Cn:N="Matrix4fv";break}if(N.indexOf("Matrix")===-1&&We>1&&(N+="v",hr=1),N.charAt(0)==="M"){z(j,".uniform",N,"(",Ke,",");var _r=Math.pow(Re-bn+2,2),Vr=G.global.def("new Float32Array(",_r,")");Array.isArray(Te)?z("false,(",at(_r,function(dr){return Vr+"["+dr+"]="+Te[dr]}),",",Vr,")"):z("false,(Array.isArray(",Te,")||",Te," instanceof Float32Array)?",Te,":(",at(_r,function(dr){return Vr+"["+dr+"]="+Te+"["+dr+"]"}),",",Vr,")"),z(");")}else if(hr>1){for(var on=[],An=[],ii=0;ii<hr;++ii)Array.isArray(Te)?An.push(Te[ii]):An.push(z.def(Te+"["+ii+"]")),te&&on.push(z.def());te&&z("if(!",G.batchId,"||",on.map(function(dr,Gr){return dr+"!=="+An[Gr]}).join("||"),"){",on.map(function(dr,Gr){return dr+"="+An[Gr]+";"}).join("")),z(j,".uniform",N,"(",Ke,",",An.join(","),");"),te&&z("}")}else{if(V(!Array.isArray(Te),"uniform value must not be an array"),te){var Xo=z.def();z("if(!",G.batchId,"||",Xo,"!==",Te,"){",Xo,"=",Te,";")}z(j,".uniform",N,"(",Ke,",",Te,");"),te&&z("}")}},re=G.shared,j=re.gl,Z={},N,oe=0;oe<ne.length;++oe)ee(oe)}function ut(G,z,J,ne){var ie=G.shared,te=ie.gl,ee=ie.draw,re=ne.draw;function j(){var Te=re.elements,ve,ct=z;return Te?((Te.contextDep&&ne.contextDynamic||Te.propDep)&&(ct=J),ve=Te.append(G,ct),re.elementsActive&&ct("if("+ve+")"+te+".bindBuffer("+Zi+","+ve+".buffer.buffer);")):(ve=ct.def(),ct(ve,"=",ee,".",Ir,";","if(",ve,"){",te,".bindBuffer(",Zi,",",ve,".buffer.buffer);}","else if(",ie.vao,".currentVAO){",ve,"=",G.shared.elements+".getElements("+ie.vao,".currentVAO.elements);",ye?"":"if("+ve+")"+te+".bindBuffer("+Zi+","+ve+".buffer.buffer);","}")),ve}function Z(){var Te=re.count,ve,ct=z;return Te?((Te.contextDep&&ne.contextDynamic||Te.propDep)&&(ct=J),ve=Te.append(G,ct),V.optional(function(){Te.MISSING&&G.assert(z,"false","missing vertex count"),Te.DYNAMIC&&G.assert(ct,ve+">=0","missing vertex count")})):(ve=ct.def(ee,".",Fr),V.optional(function(){G.assert(ct,ve+">=0","missing vertex count")})),ve}var N=j();function oe(Te){var ve=re[Te];return ve?ve.contextDep&&ne.contextDynamic||ve.propDep?ve.append(G,J):ve.append(G,z):z.def(ee,".",Te)}var ce=oe(zr),Ce=oe(Wn),we=Z();if(typeof we=="number"){if(we===0)return}else J("if(",we,"){"),J.exit("}");var Re,We;Se&&(Re=oe(Yn),We=G.instancing);var it=N+".type",et=re.elements&&Cr(re.elements)&&!re.vaoActive;function Qe(){function Te(){J(We,".drawElementsInstancedANGLE(",[ce,we,it,Ce+"<<(("+it+"-"+vo+")>>1)",Re],");")}function ve(){J(We,".drawArraysInstancedANGLE(",[ce,Ce,we,Re],");")}N&&N!=="null"?et?Te():(J("if(",N,"){"),Te(),J("}else{"),ve(),J("}")):ve()}function Ke(){function Te(){J(te+".drawElements("+[ce,we,it,Ce+"<<(("+it+"-"+vo+")>>1)"]+");")}function ve(){J(te+".drawArrays("+[ce,Ce,we]+");")}N&&N!=="null"?et?Te():(J("if(",N,"){"),Te(),J("}else{"),ve(),J("}")):ve()}Se&&(typeof Re!="number"||Re>=0)?typeof Re=="string"?(J("if(",Re,">0){"),Qe(),J("}else if(",Re,"<0){"),Ke(),J("}")):Qe():Ke()}function gt(G,z,J,ne,ie){var te=dt(),ee=te.proc("body",ie);return V.optional(function(){te.commandStr=z.commandStr,te.command=te.link(z.commandStr)}),Se&&(te.instancing=ee.def(te.shared.extensions,".angle_instanced_arrays")),G(te,ee,J,ne),te.compile().body}function At(G,z,J,ne){qt(G,z),J.useVAO?J.drawVAO?z(G.shared.vao,".setVAO(",J.drawVAO.append(G,z),");"):z(G.shared.vao,".setVAO(",G.shared.vao,".targetVAO);"):(z(G.shared.vao,".setVAO(null);"),ar(G,z,J,ne.attributes,function(){return!0})),Mt(G,z,J,ne.uniforms,function(){return!0},!1),ut(G,z,z,J)}function er(G,z){var J=G.proc("draw",1);qt(G,J),Qt(G,J,z.context),Kt(G,J,z.framebuffer),Jt(G,J,z),ir(G,J,z.state),yt(G,J,z,!1,!0);var ne=z.shader.progVar.append(G,J);if(J(G.shared.gl,".useProgram(",ne,".program);"),z.shader.program)At(G,J,z,z.shader.program);else{J(G.shared.vao,".setVAO(null);");var ie=G.global.def("{}"),te=J.def(ne,".id"),ee=J.def(ie,"[",te,"]");J(G.cond(ee).then(ee,".call(this,a0);").else(ee,"=",ie,"[",te,"]=",G.link(function(re){return gt(At,G,z,re,1)}),"(",ne,");",ee,".call(this,a0);"))}Object.keys(z.state).length>0&&J(G.shared.current,".dirty=true;"),G.shared.vao&&J(G.shared.vao,".setVAO(null);")}function or(G,z,J,ne){G.batchId="a1",qt(G,z);function ie(){return!0}ar(G,z,J,ne.attributes,ie),Mt(G,z,J,ne.uniforms,ie,!1),ut(G,z,z,J)}function Br(G,z,J,ne){qt(G,z);var ie=J.contextDep,te=z.def(),ee="a0",re="a1",j=z.def();G.shared.props=j,G.batchId=te;var Z=G.scope(),N=G.scope();z(Z.entry,"for(",te,"=0;",te,"<",re,";++",te,"){",j,"=",ee,"[",te,"];",N,"}",Z.exit);function oe(it){return it.contextDep&&ie||it.propDep}function ce(it){return!oe(it)}if(J.needsContext&&Qt(G,N,J.context),J.needsFramebuffer&&Kt(G,N,J.framebuffer),ir(G,N,J.state,oe),J.profile&&oe(J.profile)&&yt(G,N,J,!1,!0),ne)J.useVAO?J.drawVAO?oe(J.drawVAO)?N(G.shared.vao,".setVAO(",J.drawVAO.append(G,N),");"):Z(G.shared.vao,".setVAO(",J.drawVAO.append(G,Z),");"):Z(G.shared.vao,".setVAO(",G.shared.vao,".targetVAO);"):(Z(G.shared.vao,".setVAO(null);"),ar(G,Z,J,ne.attributes,ce),ar(G,N,J,ne.attributes,oe)),Mt(G,Z,J,ne.uniforms,ce,!1),Mt(G,N,J,ne.uniforms,oe,!0),ut(G,Z,N,J);else{var Ce=G.global.def("{}"),we=J.shader.progVar.append(G,N),Re=N.def(we,".id"),We=N.def(Ce,"[",Re,"]");N(G.shared.gl,".useProgram(",we,".program);","if(!",We,"){",We,"=",Ce,"[",Re,"]=",G.link(function(it){return gt(or,G,J,it,2)}),"(",we,");}",We,".call(this,a0[",te,"],",te,");")}}function H(G,z){var J=G.proc("batch",2);G.batchId="0",qt(G,J);var ne=!1,ie=!0;Object.keys(z.context).forEach(function(Ce){ne=ne||z.context[Ce].propDep}),ne||(Qt(G,J,z.context),ie=!1);var te=z.framebuffer,ee=!1;te?(te.propDep?ne=ee=!0:te.contextDep&&ne&&(ee=!0),ee||Kt(G,J,te)):Kt(G,J,null),z.state.viewport&&z.state.viewport.propDep&&(ne=!0);function re(Ce){return Ce.contextDep&&ne||Ce.propDep}Jt(G,J,z),ir(G,J,z.state,function(Ce){return!re(Ce)}),(!z.profile||!re(z.profile))&&yt(G,J,z,!1,"a1"),z.contextDep=ne,z.needsContext=ie,z.needsFramebuffer=ee;var j=z.shader.progVar;if(j.contextDep&&ne||j.propDep)Br(G,J,z,null);else{var Z=j.append(G,J);if(J(G.shared.gl,".useProgram(",Z,".program);"),z.shader.program)Br(G,J,z,z.shader.program);else{J(G.shared.vao,".setVAO(null);");var N=G.global.def("{}"),oe=J.def(Z,".id"),ce=J.def(N,"[",oe,"]");J(G.cond(ce).then(ce,".call(this,a0,a1);").else(ce,"=",N,"[",oe,"]=",G.link(function(Ce){return gt(Br,G,z,Ce,2)}),"(",Z,");",ce,".call(this,a0,a1);"))}}Object.keys(z.state).length>0&&J(G.shared.current,".dirty=true;"),G.shared.vao&&J(G.shared.vao,".setVAO(null);")}function he(G,z){var J=G.proc("scope",3);G.batchId="a2";var ne=G.shared,ie=ne.current;Qt(G,J,z.context),z.framebuffer&&z.framebuffer.append(G,J),ua(Object.keys(z.state)).forEach(function(ee){var re=z.state[ee],j=re.append(G,J);Ct(j)?j.forEach(function(Z,N){J.set(G.next[ee],"["+N+"]",Z)}):J.set(ne.next,"."+ee,j)}),yt(G,J,z,!0,!0),[Ir,Wn,Fr,Yn,zr].forEach(function(ee){var re=z.draw[ee];!re||J.set(ne.draw,"."+ee,""+re.append(G,J))}),Object.keys(z.uniforms).forEach(function(ee){var re=z.uniforms[ee].append(G,J);Array.isArray(re)&&(re="["+re.join()+"]"),J.set(ne.uniforms,"["+B.id(ee)+"]",re)}),Object.keys(z.attributes).forEach(function(ee){var re=z.attributes[ee].append(G,J),j=G.scopeAttrib(ee);Object.keys(new le).forEach(function(Z){J.set(j,"."+Z,re[Z])})}),z.scopeVAO&&J.set(ne.vao,".targetVAO",z.scopeVAO.append(G,J));function te(ee){var re=z.shader[ee];re&&J.set(ne.shader,"."+ee,re.append(G,J))}te(gn),te(yn),Object.keys(z.state).length>0&&(J(ie,".dirty=true;"),J.exit(ie,".dirty=true;")),J("a1(",G.shared.context,",a0,",G.batchId,");")}function ae(G){if(!(typeof G!="object"||Ct(G))){for(var z=Object.keys(G),J=0;J<z.length;++J)if(fr.isDynamic(G[z[J]]))return!0;return!1}}function Ze(G,z,J){var ne=z.static[J];if(!ne||!ae(ne))return;var ie=G.global,te=Object.keys(ne),ee=!1,re=!1,j=!1,Z=G.global.def("{}");te.forEach(function(oe){var ce=ne[oe];if(fr.isDynamic(ce)){typeof ce=="function"&&(ce=ne[oe]=fr.unbox(ce));var Ce=sr(ce,null);ee=ee||Ce.thisDep,j=j||Ce.propDep,re=re||Ce.contextDep}else{switch(ie(Z,".",oe,"="),typeof ce=="undefined"?"undefined":_typeof$2(ce)){case"number":ie(ce);break;case"string":ie('"',ce,'"');break;case"object":Array.isArray(ce)&&ie("[",ce.join(),"]");break;default:ie(G.link(ce));break}ie(";")}});function N(oe,ce){te.forEach(function(Ce){var we=ne[Ce];if(!!fr.isDynamic(we)){var Re=oe.invoke(ce,we);ce(Z,".",Ce,"=",Re,";")}})}z.dynamic[J]=new fr.DynamicVariable(qn,{thisDep:ee,contextDep:re,propDep:j,ref:Z,append:N}),delete z.static[J]}function _t(G,z,J,ne,ie){var te=dt();te.stats=te.link(ie),Object.keys(z.static).forEach(function(re){Ze(te,z,re)}),Lu.forEach(function(re){Ze(te,G,re)});var ee=Yt(G,z,J,ne,te);return er(te,ee),he(te,ee),H(te,ee),jt(te.compile(),{destroy:function(){ee.shader.program.destroy()}})}return{next:Je,current:rt,procs:function(){var G=dt(),z=G.proc("poll"),J=G.proc("refresh"),ne=G.block();z(ne),J(ne);var ie=G.shared,te=ie.gl,ee=ie.next,re=ie.current;ne(re,".dirty=false;"),Kt(G,z),Kt(G,J,null,!0);var j;Se&&(j=G.link(Se)),Q.oes_vertex_array_object&&J(G.link(Q.oes_vertex_array_object),".bindVertexArrayOES(null);");for(var Z=0;Z<ue.maxAttributes;++Z){var N=J.def(ie.attributes,"[",Z,"]"),oe=G.cond(N,".buffer");oe.then(te,".enableVertexAttribArray(",Z,");",te,".bindBuffer(",nn,",",N,".buffer.buffer);",te,".vertexAttribPointer(",Z,",",N,".size,",N,".type,",N,".normalized,",N,".stride,",N,".offset);").else(te,".disableVertexAttribArray(",Z,");",te,".vertexAttrib4f(",Z,",",N,".x,",N,".y,",N,".z,",N,".w);",N,".buffer=null;"),J(oe),Se&&J(j,".vertexAttribDivisorANGLE(",Z,",",N,".divisor);")}return J(G.shared.vao,".currentVAO=null;",G.shared.vao,".setVAO(",G.shared.vao,".targetVAO);"),Object.keys(xe).forEach(function(ce){var Ce=xe[ce],we=ne.def(ee,".",ce),Re=G.block();Re("if(",we,"){",te,".enable(",Ce,")}else{",te,".disable(",Ce,")}",re,".",ce,"=",we,";"),J(Re),z("if(",we,"!==",re,".",ce,"){",Re,"}")}),Object.keys(pe).forEach(function(ce){var Ce=pe[ce],we=rt[ce],Re,We,it=G.block();if(it(te,".",Ce,"("),Ct(we)){var et=we.length;Re=G.global.def(ee,".",ce),We=G.global.def(re,".",ce),it(at(et,function(Qe){return Re+"["+Qe+"]"}),");",at(et,function(Qe){return We+"["+Qe+"]="+Re+"["+Qe+"];"}).join("")),z("if(",at(et,function(Qe){return Re+"["+Qe+"]!=="+We+"["+Qe+"]"}).join("||"),"){",it,"}")}else Re=ne.def(ee,".",ce),We=ne.def(re,".",ce),it(Re,");",re,".",ce,"=",Re,";"),z("if(",Re,"!==",We,"){",it,"}");J(it)}),G.compile()}(),compile:_t}},ss=function(){return{vaoCount:0,bufferCount:0,elementsCount:0,framebufferCount:0,shaderCount:0,textureCount:0,cubeCount:0,renderbufferCount:0,maxTextureUnits:0}},fa=function(S,B){for(var Q=0;Q<S.length;++Q)if(S[Q]===B)return Q;return-1},ls=function(S){var B=Et(S);if(!B)return null;var Q=B.gl,ue=Q.getContextAttributes(),me=Q.isContextLost(),de=st(Q,B);if(!de)return null;var be=_e(),Ae=ss(),Le=de.extensions,Oe=Qu(Q,Le),ze=_a(),$e=Q.drawingBufferWidth,ke=Q.drawingBufferHeight,Ie={tick:0,time:0,viewportWidth:$e,viewportHeight:ke,framebufferWidth:$e,framebufferHeight:ke,drawingBufferWidth:$e,drawingBufferHeight:ke,pixelRatio:B.pixelRatio},Ee={},le={elements:null,primitive:4,count:-1,offset:0,instances:-1},se=ul(Q,Le),Se=Ut(Q,Ae,B,rt),Ye=Dt(Q,Le,Se,Ae),ye=rs(Q,Le,se,Ae,Se,Ye,le);function rt(ut){return ye.destroyBuffer(ut)}var Je=ns(Q,be,Ae,B),He=es(Q,Le,se,function(){Xe.procs.poll()},Ie,Ae,B),xe=ru(Q,Le,se,Ae,B),pe=ts(Q,Le,se,He,xe,Ae),Xe=os(Q,be,Le,se,Se,Ye,He,pe,Ee,ye,Je,le,Ie,Oe,B),Ne=is(Q,pe,Xe.procs.poll,Ie,ue,Le,se),Me=Xe.next,Be=Q.canvas,Ve=[],pt=[],dt=[],Ue=[B.onDestroy],qe=null;function lt(){if(Ve.length===0){Oe&&Oe.update(),qe=null;return}qe=fi.next(lt),ir();for(var ut=Ve.length-1;ut>=0;--ut){var gt=Ve[ut];gt&&gt(Ie,null,0)}Q.flush(),Oe&&Oe.update()}function vt(){!qe&&Ve.length>0&&(qe=fi.next(lt))}function wt(){qe&&(fi.cancel(lt),qe=null)}function Bt(ut){ut.preventDefault(),me=!0,wt(),pt.forEach(function(gt){gt()})}function Gt(ut){Q.getError(),me=!1,de.restore(),Je.restore(),Se.restore(),He.restore(),xe.restore(),pe.restore(),ye.restore(),Oe&&Oe.restore(),Xe.procs.refresh(),vt(),dt.forEach(function(gt){gt()})}Be&&(Be.addEventListener(Ho,Bt,!1),Be.addEventListener(Wo,Gt,!1));function Pt(){Ve.length=0,wt(),Be&&(Be.removeEventListener(Ho,Bt),Be.removeEventListener(Wo,Gt)),Je.clear(),pe.clear(),xe.clear(),ye.clear(),He.clear(),Ye.clear(),Se.clear(),Oe&&Oe.clear(),Ue.forEach(function(ut){ut()})}function Xt(ut){V(!!ut,"invalid args to regl({...})"),V.type(ut,"object","invalid args to regl({...})");function gt(ie){var te=jt({},ie);delete te.uniforms,delete te.attributes,delete te.context,delete te.vao,"stencil"in te&&te.stencil.op&&(te.stencil.opBack=te.stencil.opFront=te.stencil.op,delete te.stencil.op);function ee(re){if(re in te){var j=te[re];delete te[re],Object.keys(j).forEach(function(Z){te[re+"."+Z]=j[Z]})}}return ee("blend"),ee("depth"),ee("cull"),ee("stencil"),ee("polygonOffset"),ee("scissor"),ee("sample"),"vao"in ie&&(te.vao=ie.vao),te}function At(ie,te){var ee={},re={};return Object.keys(ie).forEach(function(j){var Z=ie[j];if(fr.isDynamic(Z)){re[j]=fr.unbox(Z,j);return}else if(te&&Array.isArray(Z)){for(var N=0;N<Z.length;++N)if(fr.isDynamic(Z[N])){re[j]=fr.unbox(Z,j);return}}ee[j]=Z}),{dynamic:re,static:ee}}var er=At(ut.context||{},!0),or=At(ut.uniforms||{},!0),Br=At(ut.attributes||{},!1),H=At(gt(ut),!1),he={gpuTime:0,cpuTime:0,count:0},ae=Xe.compile(H,Br,or,er,he),Ze=ae.draw,_t=ae.batch,G=ae.scope,z=[];function J(ie){for(;z.length<ie;)z.push(null);return z}function ne(ie,te){var ee;if(me&&V.raise("context lost"),typeof ie=="function")return G.call(this,null,ie,0);if(typeof te=="function")if(typeof ie=="number")for(ee=0;ee<ie;++ee)G.call(this,null,te,ee);else if(Array.isArray(ie))for(ee=0;ee<ie.length;++ee)G.call(this,ie[ee],te,ee);else return G.call(this,ie,te,0);else if(typeof ie=="number"){if(ie>0)return _t.call(this,J(ie|0),ie|0)}else if(Array.isArray(ie)){if(ie.length)return _t.call(this,ie,ie.length)}else return Ze.call(this,ie)}return jt(ne,{stats:he,destroy:function(){ae.destroy()}})}var It=pe.setFBO=Xt({framebuffer:fr.define.call(null,Yo,"framebuffer")});function Yt(ut,gt){var At=0;Xe.procs.poll();var er=gt.color;er&&(Q.clearColor(+er[0]||0,+er[1]||0,+er[2]||0,+er[3]||0),At|=Ku),"depth"in gt&&(Q.clearDepth(+gt.depth),At|=Zu),"stencil"in gt&&(Q.clearStencil(gt.stencil|0),At|=Ju),V(!!At,"called regl.clear with no buffer specified"),Q.clear(At)}function Qt(ut){if(V(typeof ut=="object"&&ut,"regl.clear() takes an object as input"),"framebuffer"in ut)if(ut.framebuffer&&ut.framebuffer_reglType==="framebufferCube")for(var gt=0;gt<6;++gt)It(jt({framebuffer:ut.framebuffer.faces[gt]},ut),Yt);else It(ut,Yt);else Yt(null,ut)}function Kt(ut){V.type(ut,"function","regl.frame() callback must be a function"),Ve.push(ut);function gt(){var At=fa(Ve,ut);V(At>=0,"cannot cancel a frame twice");function er(){var or=fa(Ve,er);Ve[or]=Ve[Ve.length-1],Ve.length-=1,Ve.length<=0&&wt()}Ve[At]=er}return vt(),{cancel:gt}}function Jt(){var ut=Me.viewport,gt=Me.scissor_box;ut[0]=ut[1]=gt[0]=gt[1]=0,Ie.viewportWidth=Ie.framebufferWidth=Ie.drawingBufferWidth=ut[2]=gt[2]=Q.drawingBufferWidth,Ie.viewportHeight=Ie.framebufferHeight=Ie.drawingBufferHeight=ut[3]=gt[3]=Q.drawingBufferHeight}function ir(){Ie.tick+=1,Ie.time=yt(),Jt(),Xe.procs.poll()}function qt(){He.refresh(),Jt(),Xe.procs.refresh(),Oe&&Oe.update()}function yt(){return(_a()-ze)/1e3}qt();function ar(ut,gt){V.type(gt,"function","listener callback must be a function");var At;switch(ut){case"frame":return Kt(gt);case"lost":At=pt;break;case"restore":At=dt;break;case"destroy":At=Ue;break;default:V.raise("invalid event, must be one of frame,lost,restore,destroy")}return At.push(gt),{cancel:function(){for(var or=0;or<At.length;++or)if(At[or]===gt){At[or]=At[At.length-1],At.pop();return}}}}var Mt=jt(Xt,{clear:Qt,prop:fr.define.bind(null,Yo),context:fr.define.bind(null,tf),this:fr.define.bind(null,rf),draw:Xt({}),buffer:function(gt){return Se.create(gt,ef,!1,!1)},elements:function(gt){return Ye.create(gt,!1)},texture:He.create2D,cube:He.createCube,renderbuffer:xe.create,framebuffer:pe.create,framebufferCube:pe.createCube,vao:ye.createVAO,attributes:ue,frame:Kt,on:ar,limits:se,hasExtension:function(gt){return se.extensions.indexOf(gt.toLowerCase())>=0},read:Ne,destroy:Pt,_gl:Q,_refresh:qt,poll:function(){ir(),Oe&&Oe.update()},now:yt,stats:Ae});return B.onDone(null,Mt),Mt},rr=function(S){return _instanceof$2(S,Uint8Array)||_instanceof$2(S,Uint16Array)||_instanceof$2(S,Uint32Array)||_instanceof$2(S,Int8Array)||_instanceof$2(S,Int16Array)||_instanceof$2(S,Int32Array)||_instanceof$2(S,Float32Array)||_instanceof$2(S,Float64Array)||_instanceof$2(S,Uint8ClampedArray)},jt=function(S,B){for(var Q=Object.keys(B),ue=0;ue<Q.length;++ue)S[Q[ue]]=B[Q[ue]];return S},Or="\n",ca=["gl","canvas","container","attributes","pixelRatio","extensions","optionalExtensions","profile","onDone"],Ln=33071,ha=9728,us=9984,fs=9985,cs=9986,hs=9987,ds=5120,ps=5121,vs=5122,ms=5123,gs=5124,ys=5125,da=5126,pa=32819,va=32820,ma=33635,ga=34042,_s=36193,ur={};ur[ds]=ur[ps]=1,ur[vs]=ur[ms]=ur[_s]=ur[ma]=ur[pa]=ur[va]=2,ur[gs]=ur[ys]=ur[da]=ur[ga]=4;var V=jt(a,{optional:$,raise:s,commandRaise:U,command:M,parameter:l,commandParameter:L,constructor:d,type:c,commandType:P,isTypedArray:u,nni:h,oneOf:p,shaderError:D,linkError:X,callSite:_,saveCommandRef:W,saveDrawInfo:K,framebufferFormat:R,guessCommand:b,texture2D:E,textureCube:O}),bs=0,xs=0,Cs=5,Ss=6;function sn(ge){if(ge.length===0)return[];var S=ge.charAt(0),B=ge.charAt(ge.length-1);if(ge.length>1&&S===B&&(S==='"'||S==="'"))return['"'+F(ge.substr(1,ge.length-2))+'"'];var Q=/\[(false|true|null|\d+|'[^']*'|"[^"]*")\]/.exec(ge);if(Q)return sn(ge.substr(0,Q.index)).concat(sn(Q[1])).concat(sn(ge.substr(Q.index+Q[0].length)));var ue=ge.split(".");if(ue.length===1)return['"'+F(ge)+'"'];for(var me=[],de=0;de<ue.length;++de)me=me.concat(sn(ue[de]));return me}function ya(ge,S){if(typeof ge=="function")return new k(xs,ge);if(typeof ge=="number"||typeof ge=="boolean")return new k(Cs,ge);if(Array.isArray(ge))return new k(Ss,ge.map(function(B,Q){return ya(B,S+"["+Q+"]")}));if(_instanceof$2(ge,k))return ge;V(!1,"invalid option type in uniform "+S)}var fr={DynamicVariable:k,define:Y,isDynamic:fe,unbox:ya,accessor:q},fi={next:typeof requestAnimationFrame=="function"?function(ge){return requestAnimationFrame(ge)}:function(ge){return setTimeout(ge,16)},cancel:typeof cancelAnimationFrame=="function"?function(ge){return cancelAnimationFrame(ge)}:clearTimeout},_a=typeof performance!="undefined"&&performance.now?function(){return performance.now()}:function(){return+new Date},ws=5120,Ps=5121,As=5122,Es=5123,$s=5124,Os=5125,Ls=5126,Wt=Rt();Wt.zero=Rt();var Ms=3408,Ts=3410,Rs=3411,ks=3412,Is=3413,zs=3414,Fs=3415,Ds=33901,Bs=33902,Ns=3379,Vs=3386,Gs=34921,Us=36347,js=36348,qs=35661,Hs=35660,Ws=34930,Ys=36349,Xs=34076,Qs=34024,Ks=7936,Zs=7937,Js=7938,el=35724,tl=34047,rl=36063,nl=34852,Mn=3553,ba=34067,il=34069,al=33984,un=6408,ci=5126,xa=5121,hi=36160,ol=36053,sl=36064,ll=16384,ul=function(S,B){var Q=1;B.ext_texture_filter_anisotropic&&(Q=S.getParameter(tl));var ue=1,me=1;B.webgl_draw_buffers&&(ue=S.getParameter(nl),me=S.getParameter(rl));var de=!!B.oes_texture_float;if(de){var be=S.createTexture();S.bindTexture(Mn,be),S.texImage2D(Mn,0,un,1,1,0,un,ci,null);var Ae=S.createFramebuffer();if(S.bindFramebuffer(hi,Ae),S.framebufferTexture2D(hi,sl,Mn,be,0),S.bindTexture(Mn,null),S.checkFramebufferStatus(hi)!==ol)de=!1;else{S.viewport(0,0,1,1),S.clearColor(1,0,0,1),S.clear(ll);var Le=Wt.allocType(ci,4);S.readPixels(0,0,1,1,un,ci,Le),S.getError()?de=!1:(S.deleteFramebuffer(Ae),S.deleteTexture(be),de=Le[0]===1),Wt.freeType(Le)}}var Oe=typeof navigator!="undefined"&&(/MSIE/.test(navigator.userAgent)||/Trident\//.test(navigator.appVersion)||/Edge/.test(navigator.userAgent)),ze=!0;if(!Oe){var $e=S.createTexture(),ke=Wt.allocType(xa,36);S.activeTexture(al),S.bindTexture(ba,$e),S.texImage2D(il,0,un,3,3,0,un,xa,ke),Wt.freeType(ke),S.bindTexture(ba,null),S.deleteTexture($e),ze=!S.getError()}return{colorBits:[S.getParameter(Ts),S.getParameter(Rs),S.getParameter(ks),S.getParameter(Is)],depthBits:S.getParameter(zs),stencilBits:S.getParameter(Fs),subpixelBits:S.getParameter(Ms),extensions:Object.keys(B).filter(function(Ie){return!!B[Ie]}),maxAnisotropic:Q,maxDrawbuffers:ue,maxColorAttachments:me,pointSizeDims:S.getParameter(Ds),lineWidthDims:S.getParameter(Bs),maxViewportDims:S.getParameter(Vs),maxCombinedTextureUnits:S.getParameter(qs),maxCubeMapSize:S.getParameter(Xs),maxRenderbufferSize:S.getParameter(Qs),maxTextureUnits:S.getParameter(Ws),maxTextureSize:S.getParameter(Ns),maxAttributes:S.getParameter(Gs),maxVertexUniforms:S.getParameter(Us),maxVertexTextureUnits:S.getParameter(Hs),maxVaryingVectors:S.getParameter(js),maxFragmentUniforms:S.getParameter(Ys),glsl:S.getParameter(el),renderer:S.getParameter(Zs),vendor:S.getParameter(Ks),version:S.getParameter(Js),readFloat:de,npotTextureCube:ze}},cr=function(S){return Object.keys(S).map(function(B){return S[B]})},Tn={shape:ht,flatten:xt};function Ca(ge,S,B,Q,ue){for(var me=1,de=B+1;de<S.length;++de)me*=S[de];var be=S[B];if(S.length-B===4){var Ae=S[B+1],Le=S[B+2],Oe=S[B+3];for(de=0;de<be;++de)Lt(ge[de],Ae,Le,Oe,Q,ue),ue+=me}else for(de=0;de<be;++de)Ca(ge[de],S,B+1,Q,ue),ue+=me}var di={"[object Int8Array]":5120,"[object Int16Array]":5122,"[object Int32Array]":5124,"[object Uint8Array]":5121,"[object Uint8ClampedArray]":5121,"[object Uint16Array]":5123,"[object Uint32Array]":5125,"[object Float32Array]":5126,"[object Float64Array]":5121,"[object ArrayBuffer]":5121},fl=5120,cl=5122,hl=5124,dl=5121,pl=5123,vl=5125,ml=5126,gl=5126,Lr={int8:fl,int16:cl,int32:hl,uint8:dl,uint16:pl,uint32:vl,float:ml,float32:gl},yl=35048,_l=35040,Rn={dynamic:yl,stream:_l,static:35044},pi=Tn.flatten,Sa=Tn.shape,wa=35044,bl=35040,vi=5121,mi=5126,Sr=[];Sr[5120]=1,Sr[5122]=2,Sr[5124]=4,Sr[5121]=1,Sr[5123]=2,Sr[5125]=4,Sr[5126]=4;var xl=0,Cl=0,Sl=1,wl=1,Pl=4,Al=4,wr={points:xl,point:Cl,lines:Sl,line:wl,triangles:Pl,triangle:Al,"line loop":2,"line strip":3,"triangle strip":5,"triangle fan":6},El=0,$l=1,fn=4,Ol=5120,Wr=5121,Pa=5122,Yr=5123,Aa=5124,Mr=5125,gi=34963,Ll=35040,Ml=35044,Ea=new Float32Array(1),Tl=new Uint32Array(Ea.buffer),Rl=5123,$a=function(S){return!(S&S-1)&&!!S},kl=34467,gr=3553,yi=34067,kn=34069,Tr=6408,_i=6406,In=6407,cn=6409,zn=6410,Oa=32854,bi=32855,La=36194,Il=32819,zl=32820,Fl=33635,Dl=34042,xi=6402,Fn=34041,Ci=35904,Si=35906,Xr=36193,wi=33776,Pi=33777,Ai=33778,Ei=33779,Ma=35986,Ta=35987,Ra=34798,ka=35840,Ia=35841,za=35842,Fa=35843,Da=36196,Qr=5121,$i=5123,Oi=5125,hn=5126,Bl=10242,Nl=10243,Vl=10497,Li=33071,Gl=33648,Ul=10240,jl=10241,Mi=9728,ql=9729,Ti=9984,Ba=9985,Na=9986,Ri=9987,Hl=33170,Dn=4352,Wl=4353,Yl=4354,Xl=34046,Ql=3317,Kl=37440,Zl=37441,Jl=37443,Va=37444,dn=33984,eu=[Ti,Na,Ba,Ri],Bn=[0,cn,zn,In,Tr],pr={};pr[cn]=pr[_i]=pr[xi]=1,pr[Fn]=pr[zn]=2,pr[In]=pr[Ci]=3,pr[Tr]=pr[Si]=4;var Ga=St("HTMLCanvasElement"),Ua=St("OffscreenCanvas"),ja=St("CanvasRenderingContext2D"),qa=St("ImageBitmap"),Ha=St("HTMLImageElement"),Wa=St("HTMLVideoElement"),tu=Object.keys(di).concat([Ga,Ua,ja,qa,Ha,Wa]),Kr=[];Kr[Qr]=1,Kr[hn]=4,Kr[Xr]=2,Kr[$i]=2,Kr[Oi]=4;var nr=[];nr[Oa]=2,nr[bi]=2,nr[La]=2,nr[Fn]=4,nr[wi]=.5,nr[Pi]=.5,nr[Ai]=1,nr[Ei]=1,nr[Ma]=.5,nr[Ta]=1,nr[Ra]=1,nr[ka]=.5,nr[Ia]=.25,nr[za]=.5,nr[Fa]=.25,nr[Da]=.5;var Pr=36161,Nn=32854,Ya=32855,Xa=36194,Qa=33189,Ka=36168,Za=34041,Ja=35907,eo=34836,to=34842,ro=34843,mr=[];mr[Nn]=2,mr[Ya]=2,mr[Xa]=2,mr[Qa]=2,mr[Ka]=1,mr[Za]=4,mr[Ja]=4,mr[eo]=16,mr[to]=8,mr[ro]=6;var ru=function(S,B,Q,ue,me){var de=function(Ee){this.id=$e++,this.refCount=1,this.renderbuffer=Ee,this.format=Nn,this.width=0,this.height=0,me.profile&&(this.stats={size:0})},be=function(Ee){var le=Ee.renderbuffer;V(le,"must not double destroy renderbuffer"),S.bindRenderbuffer(Pr,null),S.deleteRenderbuffer(le),Ee.renderbuffer=null,Ee.refCount=0,delete ke[Ee.id],ue.renderbufferCount--},Ae=function(Ee,le){var se=new de(S.createRenderbuffer());ke[se.id]=se,ue.renderbufferCount++;function Se(ye,rt){var Je=0,He=0,xe=Nn;if(typeof ye=="object"&&ye){var pe=ye;if("shape"in pe){var Xe=pe.shape;V(Array.isArray(Xe)&&Xe.length>=2,"invalid renderbuffer shape"),Je=Xe[0]|0,He=Xe[1]|0}else"radius"in pe&&(Je=He=pe.radius|0),"width"in pe&&(Je=pe.width|0),"height"in pe&&(He=pe.height|0);"format"in pe&&(V.parameter(pe.format,Oe,"invalid renderbuffer format"),xe=Oe[pe.format])}else typeof ye=="number"?(Je=ye|0,typeof rt=="number"?He=rt|0:He=Je):ye?V.raise("invalid arguments to renderbuffer constructor"):Je=He=1;if(V(Je>0&&He>0&&Je<=Q.maxRenderbufferSize&&He<=Q.maxRenderbufferSize,"invalid renderbuffer size"),!(Je===se.width&&He===se.height&&xe===se.format))return Se.width=se.width=Je,Se.height=se.height=He,se.format=xe,S.bindRenderbuffer(Pr,se.renderbuffer),S.renderbufferStorage(Pr,xe,Je,He),V(S.getError()===0,"invalid render buffer format"),me.profile&&(se.stats.size=la(se.format,se.width,se.height)),Se.format=ze[se.format],Se}function Ye(ye,rt){var Je=ye|0,He=rt|0||Je;return Je===se.width&&He===se.height||(V(Je>0&&He>0&&Je<=Q.maxRenderbufferSize&&He<=Q.maxRenderbufferSize,"invalid renderbuffer size"),Se.width=se.width=Je,Se.height=se.height=He,S.bindRenderbuffer(Pr,se.renderbuffer),S.renderbufferStorage(Pr,se.format,Je,He),V(S.getError()===0,"invalid render buffer format"),me.profile&&(se.stats.size=la(se.format,se.width,se.height))),Se}return Se(Ee,le),Se.resize=Ye,Se._reglType="renderbuffer",Se._renderbuffer=se,me.profile&&(Se.stats=se.stats),Se.destroy=function(){se.decRef()},Se},Le=function(){cr(ke).forEach(function(Ee){Ee.renderbuffer=S.createRenderbuffer(),S.bindRenderbuffer(Pr,Ee.renderbuffer),S.renderbufferStorage(Pr,Ee.format,Ee.width,Ee.height)}),S.bindRenderbuffer(Pr,null)},Oe={rgba4:Nn,rgb565:Xa,"rgb5 a1":Ya,depth:Qa,stencil:Ka,"depth stencil":Za};B.ext_srgb&&(Oe.srgba=Ja),B.ext_color_buffer_half_float&&(Oe.rgba16f=to,Oe.rgb16f=ro),B.webgl_color_buffer_float&&(Oe.rgba32f=eo);var ze=[];Object.keys(Oe).forEach(function(Ie){var Ee=Oe[Ie];ze[Ee]=Ie});var $e=0,ke={};return de.prototype.decRef=function(){--this.refCount<=0&&be(this)},me.profile&&(ue.getTotalRenderbufferSize=function(){var Ie=0;return Object.keys(ke).forEach(function(Ee){Ie+=ke[Ee].stats.size}),Ie}),{create:Ae,clear:function(){cr(ke).forEach(be)},restore:Le}},br=36160,ki=36161,Rr=3553,Vn=34069,no=36064,io=36096,ao=36128,oo=33306,so=36053,nu=36054,iu=36055,au=36057,ou=36061,su=36193,lu=5121,uu=5126,lo=6407,uo=6408,fu=6402,cu=[lo,uo],Ii=[];Ii[uo]=4,Ii[lo]=3;var Gn=[];Gn[lu]=1,Gn[uu]=4,Gn[su]=2;var hu=32854,du=32855,pu=36194,vu=33189,mu=36168,fo=34041,gu=35907,yu=34836,_u=34842,bu=34843,xu=[hu,du,pu,gu,_u,bu,yu],Zr={};Zr[so]="complete",Zr[nu]="incomplete attachment",Zr[au]="incomplete dimensions",Zr[iu]="incomplete, missing attachment",Zr[ou]="unsupported";var Cu=5126,co=34962,Un=34963,ho=["attributes","elements","offset","count","primitive","instances"],po=35632,Su=35633,wu=35718,Pu=35721,Au=6408,pn=5121,Eu=3333,jn=5126,Jr="xyzw".split(""),vo=5121,en=1,zi=2,Fi=0,Di=1,Bi=2,Ni=3,qn=4,mo=5,go=6,yo="dither",_o="blend.enable",bo="blend.color",Vi="blend.equation",Gi="blend.func",xo="depth.enable",Co="depth.func",So="depth.range",wo="depth.mask",Ui="colorMask",Po="cull.enable",Ao="cull.face",ji="frontFace",qi="lineWidth",Eo="polygonOffset.enable",Hi="polygonOffset.offset",$o="sample.alpha",Oo="sample.enable",Wi="sample.coverage",Lo="stencil.enable",Mo="stencil.mask",Yi="stencil.func",Xi="stencil.opFront",vn="stencil.opBack",To="scissor.enable",Hn="scissor.box",xr="viewport",mn="profile",kr="framebuffer",gn="vert",yn="frag",Ir="elements",zr="primitive",Fr="count",Wn="offset",Yn="instances",_n="vao",Qi="Width",Ki="Height",tn=kr+Qi,rn=kr+Ki,$u=xr+Qi,Ou=xr+Ki,Ro="drawingBuffer",ko=Ro+Qi,Io=Ro+Ki,Lu=[Gi,Vi,Yi,Xi,vn,Wi,xr,Hn,Hi],nn=34962,Zi=34963,Mu=35632,Tu=35633,zo=3553,Ru=34067,ku=2884,Iu=3042,zu=3024,Fu=2960,Du=2929,Bu=3089,Nu=32823,Vu=32926,Gu=32928,Ji=5126,Xn=35664,Qn=35665,Kn=35666,ea=5124,Zn=35667,Jn=35668,ei=35669,ta=35670,ti=35671,ri=35672,ni=35673,bn=35674,xn=35675,Cn=35676,Sn=35678,wn=35680,ra=4,Pn=1028,Dr=1029,Fo=2304,na=2305,Uu=32775,ju=32776,qu=519,Ar=7680,Do=0,Bo=1,No=32774,Hu=513,Vo=36160,Wu=36064,yr={"0":0,"1":1,zero:0,one:1,"src color":768,"one minus src color":769,"src alpha":770,"one minus src alpha":771,"dst color":774,"one minus dst color":775,"dst alpha":772,"one minus dst alpha":773,"constant color":32769,"one minus constant color":32770,"constant alpha":32771,"one minus constant alpha":32772,"src alpha saturate":776},Go=["constant color, constant alpha","one minus constant color, constant alpha","constant color, one minus constant alpha","one minus constant color, one minus constant alpha","constant alpha, constant color","constant alpha, one minus constant color","one minus constant alpha, constant color","one minus constant alpha, one minus constant color"],an={never:512,less:513,"<":513,equal:514,"=":514,"==":514,"===":514,lequal:515,"<=":515,greater:516,">":516,notequal:517,"!=":517,"!==":517,gequal:518,">=":518,always:519},Er={"0":0,zero:0,keep:7680,replace:7681,increment:7682,decrement:7683,"increment wrap":34055,"decrement wrap":34056,invert:5386},Uo={frag:Mu,vert:Tu},ia={cw:Fo,ccw:na},jo=new Zt(!1,!1,!1,function(){}),Yu=34918,Xu=34919,qo=35007,Qu=function(S,B){var Q=function(){return $e.pop()||B.ext_disjoint_timer_query.createQueryEXT()},ue=function(Ye){$e.push(Ye)},me=function(Ye){var ye=Q();B.ext_disjoint_timer_query.beginQueryEXT(qo,ye),ke.push(ye),Oe(ke.length-1,ke.length,Ye)},de=function(){B.ext_disjoint_timer_query.endQueryEXT(qo)},be=function(){this.startQueryIndex=-1,this.endQueryIndex=-1,this.sum=0,this.stats=null},Ae=function(){return Ie.pop()||new be},Le=function(Ye){Ie.push(Ye)},Oe=function(Ye,ye,rt){var Je=Ae();Je.startQueryIndex=Ye,Je.endQueryIndex=ye,Je.sum=0,Je.stats=rt,Ee.push(Je)},ze=function(){var Ye,ye,rt=ke.length;if(rt!==0){se.length=Math.max(se.length,rt+1),le.length=Math.max(le.length,rt+1),le[0]=0,se[0]=0;var Je=0;for(Ye=0,ye=0;ye<ke.length;++ye){var He=ke[ye];B.ext_disjoint_timer_query.getQueryObjectEXT(He,Xu)?(Je+=B.ext_disjoint_timer_query.getQueryObjectEXT(He,Yu),ue(He)):ke[Ye++]=He,le[ye+1]=Je,se[ye+1]=Ye}for(ke.length=Ye,Ye=0,ye=0;ye<Ee.length;++ye){var xe=Ee[ye],pe=xe.startQueryIndex,Xe=xe.endQueryIndex;xe.sum+=le[Xe]-le[pe];var Ne=se[pe],Me=se[Xe];Me===Ne?(xe.stats.gpuTime+=xe.sum/1e6,Le(xe)):(xe.startQueryIndex=Ne,xe.endQueryIndex=Me,Ee[Ye++]=xe)}Ee.length=Ye}};if(!B.ext_disjoint_timer_query)return null;var $e=[],ke=[],Ie=[],Ee=[],le=[],se=[];return{beginQuery:me,endQuery:de,pushScopeStats:Oe,update:ze,getNumPendingQueries:function(){return ke.length},clear:function(){$e.push.apply($e,ke);for(var Ye=0;Ye<$e.length;Ye++)B.ext_disjoint_timer_query.deleteQueryEXT($e[Ye]);ke.length=0,$e.length=0},restore:function(){ke.length=0,$e.length=0}}},Ku=16384,Zu=256,Ju=1024,ef=34962,Ho="webglcontextlost",Wo="webglcontextrestored",Yo=1,tf=2,rf=3;return ls})}(regl)),regl.exports}var EPSILON=1e-6,ARRAY_TYPE=typeof Float32Array!="undefined"?Float32Array:Array,RANDOM=Math.random;function setMatrixArrayType(n){ARRAY_TYPE=n}var degree=Math.PI/180;function toRadian(n){return n*degree}function equals$9(n,r){return Math.abs(n-r)<=EPSILON*Math.max(1,Math.abs(n),Math.abs(r))}Math.hypot||(Math.hypot=function(){for(var n=0,r=arguments.length;r--;)n+=arguments[r]*arguments[r];return Math.sqrt(n)});var common=Object.freeze({__proto__:null,EPSILON:EPSILON,get ARRAY_TYPE(){return ARRAY_TYPE},RANDOM:RANDOM,setMatrixArrayType:setMatrixArrayType,toRadian:toRadian,equals:equals$9});function create$8(){var n=new ARRAY_TYPE(4);return ARRAY_TYPE!=Float32Array&&(n[1]=0,n[2]=0),n[0]=1,n[3]=1,n}function clone$8(n){var r=new ARRAY_TYPE(4);return r[0]=n[0],r[1]=n[1],r[2]=n[2],r[3]=n[3],r}function copy$8(n,r){return n[0]=r[0],n[1]=r[1],n[2]=r[2],n[3]=r[3],n}function identity$5(n){return n[0]=1,n[1]=0,n[2]=0,n[3]=1,n}function fromValues$8(n,r,i,s){var a=new ARRAY_TYPE(4);return a[0]=n,a[1]=r,a[2]=i,a[3]=s,a}function set$8(n,r,i,s,a){return n[0]=r,n[1]=i,n[2]=s,n[3]=a,n}function transpose$2(n,r){if(n===r){var i=r[1];n[1]=r[2],n[2]=i}else n[0]=r[0],n[1]=r[2],n[2]=r[1],n[3]=r[3];return n}function invert$5(n,r){var i=r[0],s=r[1],a=r[2],o=r[3],l=i*o-a*s;return l?(l=1/l,n[0]=o*l,n[1]=-s*l,n[2]=-a*l,n[3]=i*l,n):null}function adjoint$2(n,r){var i=r[0];return n[0]=r[3],n[1]=-r[1],n[2]=-r[2],n[3]=i,n}function determinant$3(n){return n[0]*n[3]-n[2]*n[1]}function multiply$8(n,r,i){var s=r[0],a=r[1],o=r[2],l=r[3],u=i[0],f=i[1],c=i[2],h=i[3];return n[0]=s*u+o*f,n[1]=a*u+l*f,n[2]=s*c+o*h,n[3]=a*c+l*h,n}function rotate$4(n,r,i){var s=r[0],a=r[1],o=r[2],l=r[3],u=Math.sin(i),f=Math.cos(i);return n[0]=s*f+o*u,n[1]=a*f+l*u,n[2]=s*-u+o*f,n[3]=a*-u+l*f,n}function scale$8(n,r,i){var s=r[0],a=r[1],o=r[2],l=r[3],u=i[0],f=i[1];return n[0]=s*u,n[1]=a*u,n[2]=o*f,n[3]=l*f,n}function fromRotation$4(n,r){var i=Math.sin(r),s=Math.cos(r);return n[0]=s,n[1]=i,n[2]=-i,n[3]=s,n}function fromScaling$3(n,r){return n[0]=r[0],n[1]=0,n[2]=0,n[3]=r[1],n}function str$8(n){return"mat2("+n[0]+", "+n[1]+", "+n[2]+", "+n[3]+")"}function frob$3(n){return Math.hypot(n[0],n[1],n[2],n[3])}function LDU(n,r,i,s){return n[2]=s[2]/s[0],i[0]=s[0],i[1]=s[1],i[3]=s[3]-n[2]*i[1],[n,r,i]}function add$8(n,r,i){return n[0]=r[0]+i[0],n[1]=r[1]+i[1],n[2]=r[2]+i[2],n[3]=r[3]+i[3],n}function subtract$6(n,r,i){return n[0]=r[0]-i[0],n[1]=r[1]-i[1],n[2]=r[2]-i[2],n[3]=r[3]-i[3],n}function exactEquals$8(n,r){return n[0]===r[0]&&n[1]===r[1]&&n[2]===r[2]&&n[3]===r[3]}function equals$8(n,r){var i=n[0],s=n[1],a=n[2],o=n[3],l=r[0],u=r[1],f=r[2],c=r[3];return Math.abs(i-l)<=EPSILON*Math.max(1,Math.abs(i),Math.abs(l))&&Math.abs(s-u)<=EPSILON*Math.max(1,Math.abs(s),Math.abs(u))&&Math.abs(a-f)<=EPSILON*Math.max(1,Math.abs(a),Math.abs(f))&&Math.abs(o-c)<=EPSILON*Math.max(1,Math.abs(o),Math.abs(c))}function multiplyScalar$3(n,r,i){return n[0]=r[0]*i,n[1]=r[1]*i,n[2]=r[2]*i,n[3]=r[3]*i,n}function multiplyScalarAndAdd$3(n,r,i,s){return n[0]=r[0]+i[0]*s,n[1]=r[1]+i[1]*s,n[2]=r[2]+i[2]*s,n[3]=r[3]+i[3]*s,n}var mul$8=multiply$8,sub$6=subtract$6,mat2=Object.freeze({__proto__:null,create:create$8,clone:clone$8,copy:copy$8,identity:identity$5,fromValues:fromValues$8,set:set$8,transpose:transpose$2,invert:invert$5,adjoint:adjoint$2,determinant:determinant$3,multiply:multiply$8,rotate:rotate$4,scale:scale$8,fromRotation:fromRotation$4,fromScaling:fromScaling$3,str:str$8,frob:frob$3,LDU:LDU,add:add$8,subtract:subtract$6,exactEquals:exactEquals$8,equals:equals$8,multiplyScalar:multiplyScalar$3,multiplyScalarAndAdd:multiplyScalarAndAdd$3,mul:mul$8,sub:sub$6});function create$7(){var n=new ARRAY_TYPE(6);return ARRAY_TYPE!=Float32Array&&(n[1]=0,n[2]=0,n[4]=0,n[5]=0),n[0]=1,n[3]=1,n}function clone$7(n){var r=new ARRAY_TYPE(6);return r[0]=n[0],r[1]=n[1],r[2]=n[2],r[3]=n[3],r[4]=n[4],r[5]=n[5],r}function copy$7(n,r){return n[0]=r[0],n[1]=r[1],n[2]=r[2],n[3]=r[3],n[4]=r[4],n[5]=r[5],n}function identity$4(n){return n[0]=1,n[1]=0,n[2]=0,n[3]=1,n[4]=0,n[5]=0,n}function fromValues$7(n,r,i,s,a,o){var l=new ARRAY_TYPE(6);return l[0]=n,l[1]=r,l[2]=i,l[3]=s,l[4]=a,l[5]=o,l}function set$7(n,r,i,s,a,o,l){return n[0]=r,n[1]=i,n[2]=s,n[3]=a,n[4]=o,n[5]=l,n}function invert$4(n,r){var i=r[0],s=r[1],a=r[2],o=r[3],l=r[4],u=r[5],f=i*o-s*a;return f?(f=1/f,n[0]=o*f,n[1]=-s*f,n[2]=-a*f,n[3]=i*f,n[4]=(a*u-o*l)*f,n[5]=(s*l-i*u)*f,n):null}function determinant$2(n){return n[0]*n[3]-n[1]*n[2]}function multiply$7(n,r,i){var s=r[0],a=r[1],o=r[2],l=r[3],u=r[4],f=r[5],c=i[0],h=i[1],p=i[2],d=i[3],v=i[4],g=i[5];return n[0]=s*c+o*h,n[1]=a*c+l*h,n[2]=s*p+o*d,n[3]=a*p+l*d,n[4]=s*v+o*g+u,n[5]=a*v+l*g+f,n}function rotate$3(n,r,i){var s=r[0],a=r[1],o=r[2],l=r[3],u=r[4],f=r[5],c=Math.sin(i),h=Math.cos(i);return n[0]=s*h+o*c,n[1]=a*h+l*c,n[2]=s*-c+o*h,n[3]=a*-c+l*h,n[4]=u,n[5]=f,n}function scale$7(n,r,i){var s=r[0],a=r[1],o=r[2],l=r[3],u=r[4],f=r[5],c=i[0],h=i[1];return n[0]=s*c,n[1]=a*c,n[2]=o*h,n[3]=l*h,n[4]=u,n[5]=f,n}function translate$3(n,r,i){var s=r[0],a=r[1],o=r[2],l=r[3],u=r[4],f=r[5],c=i[0],h=i[1];return n[0]=s,n[1]=a,n[2]=o,n[3]=l,n[4]=s*c+o*h+u,n[5]=a*c+l*h+f,n}function fromRotation$3(n,r){var i=Math.sin(r),s=Math.cos(r);return n[0]=s,n[1]=i,n[2]=-i,n[3]=s,n[4]=0,n[5]=0,n}function fromScaling$2(n,r){return n[0]=r[0],n[1]=0,n[2]=0,n[3]=r[1],n[4]=0,n[5]=0,n}function fromTranslation$3(n,r){return n[0]=1,n[1]=0,n[2]=0,n[3]=1,n[4]=r[0],n[5]=r[1],n}function str$7(n){return"mat2d("+n[0]+", "+n[1]+", "+n[2]+", "+n[3]+", "+n[4]+", "+n[5]+")"}function frob$2(n){return Math.hypot(n[0],n[1],n[2],n[3],n[4],n[5],1)}function add$7(n,r,i){return n[0]=r[0]+i[0],n[1]=r[1]+i[1],n[2]=r[2]+i[2],n[3]=r[3]+i[3],n[4]=r[4]+i[4],n[5]=r[5]+i[5],n}function subtract$5(n,r,i){return n[0]=r[0]-i[0],n[1]=r[1]-i[1],n[2]=r[2]-i[2],n[3]=r[3]-i[3],n[4]=r[4]-i[4],n[5]=r[5]-i[5],n}function multiplyScalar$2(n,r,i){return n[0]=r[0]*i,n[1]=r[1]*i,n[2]=r[2]*i,n[3]=r[3]*i,n[4]=r[4]*i,n[5]=r[5]*i,n}function multiplyScalarAndAdd$2(n,r,i,s){return n[0]=r[0]+i[0]*s,n[1]=r[1]+i[1]*s,n[2]=r[2]+i[2]*s,n[3]=r[3]+i[3]*s,n[4]=r[4]+i[4]*s,n[5]=r[5]+i[5]*s,n}function exactEquals$7(n,r){return n[0]===r[0]&&n[1]===r[1]&&n[2]===r[2]&&n[3]===r[3]&&n[4]===r[4]&&n[5]===r[5]}function equals$7(n,r){var i=n[0],s=n[1],a=n[2],o=n[3],l=n[4],u=n[5],f=r[0],c=r[1],h=r[2],p=r[3],d=r[4],v=r[5];return Math.abs(i-f)<=EPSILON*Math.max(1,Math.abs(i),Math.abs(f))&&Math.abs(s-c)<=EPSILON*Math.max(1,Math.abs(s),Math.abs(c))&&Math.abs(a-h)<=EPSILON*Math.max(1,Math.abs(a),Math.abs(h))&&Math.abs(o-p)<=EPSILON*Math.max(1,Math.abs(o),Math.abs(p))&&Math.abs(l-d)<=EPSILON*Math.max(1,Math.abs(l),Math.abs(d))&&Math.abs(u-v)<=EPSILON*Math.max(1,Math.abs(u),Math.abs(v))}var mul$7=multiply$7,sub$5=subtract$5,mat2d=Object.freeze({__proto__:null,create:create$7,clone:clone$7,copy:copy$7,identity:identity$4,fromValues:fromValues$7,set:set$7,invert:invert$4,determinant:determinant$2,multiply:multiply$7,rotate:rotate$3,scale:scale$7,translate:translate$3,fromRotation:fromRotation$3,fromScaling:fromScaling$2,fromTranslation:fromTranslation$3,str:str$7,frob:frob$2,add:add$7,subtract:subtract$5,multiplyScalar:multiplyScalar$2,multiplyScalarAndAdd:multiplyScalarAndAdd$2,exactEquals:exactEquals$7,equals:equals$7,mul:mul$7,sub:sub$5});function create$6(){var n=new ARRAY_TYPE(9);return ARRAY_TYPE!=Float32Array&&(n[1]=0,n[2]=0,n[3]=0,n[5]=0,n[6]=0,n[7]=0),n[0]=1,n[4]=1,n[8]=1,n}function fromMat4$1(n,r){return n[0]=r[0],n[1]=r[1],n[2]=r[2],n[3]=r[4],n[4]=r[5],n[5]=r[6],n[6]=r[8],n[7]=r[9],n[8]=r[10],n}function clone$6(n){var r=new ARRAY_TYPE(9);return r[0]=n[0],r[1]=n[1],r[2]=n[2],r[3]=n[3],r[4]=n[4],r[5]=n[5],r[6]=n[6],r[7]=n[7],r[8]=n[8],r}function copy$6(n,r){return n[0]=r[0],n[1]=r[1],n[2]=r[2],n[3]=r[3],n[4]=r[4],n[5]=r[5],n[6]=r[6],n[7]=r[7],n[8]=r[8],n}function fromValues$6(n,r,i,s,a,o,l,u,f){var c=new ARRAY_TYPE(9);return c[0]=n,c[1]=r,c[2]=i,c[3]=s,c[4]=a,c[5]=o,c[6]=l,c[7]=u,c[8]=f,c}function set$6(n,r,i,s,a,o,l,u,f,c){return n[0]=r,n[1]=i,n[2]=s,n[3]=a,n[4]=o,n[5]=l,n[6]=u,n[7]=f,n[8]=c,n}function identity$3(n){return n[0]=1,n[1]=0,n[2]=0,n[3]=0,n[4]=1,n[5]=0,n[6]=0,n[7]=0,n[8]=1,n}function transpose$1(n,r){if(n===r){var i=r[1],s=r[2],a=r[5];n[1]=r[3],n[2]=r[6],n[3]=i,n[5]=r[7],n[6]=s,n[7]=a}else n[0]=r[0],n[1]=r[3],n[2]=r[6],n[3]=r[1],n[4]=r[4],n[5]=r[7],n[6]=r[2],n[7]=r[5],n[8]=r[8];return n}function invert$3(n,r){var i=r[0],s=r[1],a=r[2],o=r[3],l=r[4],u=r[5],f=r[6],c=r[7],h=r[8],p=h*l-u*c,d=-h*o+u*f,v=c*o-l*f,g=i*p+s*d+a*v;return g?(g=1/g,n[0]=p*g,n[1]=(-h*s+a*c)*g,n[2]=(u*s-a*l)*g,n[3]=d*g,n[4]=(h*i-a*f)*g,n[5]=(-u*i+a*o)*g,n[6]=v*g,n[7]=(-c*i+s*f)*g,n[8]=(l*i-s*o)*g,n):null}function adjoint$1(n,r){var i=r[0],s=r[1],a=r[2],o=r[3],l=r[4],u=r[5],f=r[6],c=r[7],h=r[8];return n[0]=l*h-u*c,n[1]=a*c-s*h,n[2]=s*u-a*l,n[3]=u*f-o*h,n[4]=i*h-a*f,n[5]=a*o-i*u,n[6]=o*c-l*f,n[7]=s*f-i*c,n[8]=i*l-s*o,n}function determinant$1(n){var r=n[0],i=n[1],s=n[2],a=n[3],o=n[4],l=n[5],u=n[6],f=n[7],c=n[8];return r*(c*o-l*f)+i*(-c*a+l*u)+s*(f*a-o*u)}function multiply$6(n,r,i){var s=r[0],a=r[1],o=r[2],l=r[3],u=r[4],f=r[5],c=r[6],h=r[7],p=r[8],d=i[0],v=i[1],g=i[2],m=i[3],y=i[4],b=i[5],_=i[6],C=i[7],A=i[8];return n[0]=d*s+v*l+g*c,n[1]=d*a+v*u+g*h,n[2]=d*o+v*f+g*p,n[3]=m*s+y*l+b*c,n[4]=m*a+y*u+b*h,n[5]=m*o+y*f+b*p,n[6]=_*s+C*l+A*c,n[7]=_*a+C*u+A*h,n[8]=_*o+C*f+A*p,n}function translate$2(n,r,i){var s=r[0],a=r[1],o=r[2],l=r[3],u=r[4],f=r[5],c=r[6],h=r[7],p=r[8],d=i[0],v=i[1];return n[0]=s,n[1]=a,n[2]=o,n[3]=l,n[4]=u,n[5]=f,n[6]=d*s+v*l+c,n[7]=d*a+v*u+h,n[8]=d*o+v*f+p,n}function rotate$2(n,r,i){var s=r[0],a=r[1],o=r[2],l=r[3],u=r[4],f=r[5],c=r[6],h=r[7],p=r[8],d=Math.sin(i),v=Math.cos(i);return n[0]=v*s+d*l,n[1]=v*a+d*u,n[2]=v*o+d*f,n[3]=v*l-d*s,n[4]=v*u-d*a,n[5]=v*f-d*o,n[6]=c,n[7]=h,n[8]=p,n}function scale$6(n,r,i){var s=i[0],a=i[1];return n[0]=s*r[0],n[1]=s*r[1],n[2]=s*r[2],n[3]=a*r[3],n[4]=a*r[4],n[5]=a*r[5],n[6]=r[6],n[7]=r[7],n[8]=r[8],n}function fromTranslation$2(n,r){return n[0]=1,n[1]=0,n[2]=0,n[3]=0,n[4]=1,n[5]=0,n[6]=r[0],n[7]=r[1],n[8]=1,n}function fromRotation$2(n,r){var i=Math.sin(r),s=Math.cos(r);return n[0]=s,n[1]=i,n[2]=0,n[3]=-i,n[4]=s,n[5]=0,n[6]=0,n[7]=0,n[8]=1,n}function fromScaling$1(n,r){return n[0]=r[0],n[1]=0,n[2]=0,n[3]=0,n[4]=r[1],n[5]=0,n[6]=0,n[7]=0,n[8]=1,n}function fromMat2d(n,r){return n[0]=r[0],n[1]=r[1],n[2]=0,n[3]=r[2],n[4]=r[3],n[5]=0,n[6]=r[4],n[7]=r[5],n[8]=1,n}function fromQuat$1(n,r){var i=r[0],s=r[1],a=r[2],o=r[3],l=i+i,u=s+s,f=a+a,c=i*l,h=s*l,p=s*u,d=a*l,v=a*u,g=a*f,m=o*l,y=o*u,b=o*f;return n[0]=1-p-g,n[3]=h-b,n[6]=d+y,n[1]=h+b,n[4]=1-c-g,n[7]=v-m,n[2]=d-y,n[5]=v+m,n[8]=1-c-p,n}function normalFromMat4(n,r){var i=r[0],s=r[1],a=r[2],o=r[3],l=r[4],u=r[5],f=r[6],c=r[7],h=r[8],p=r[9],d=r[10],v=r[11],g=r[12],m=r[13],y=r[14],b=r[15],_=i*u-s*l,C=i*f-a*l,A=i*c-o*l,I=s*f-a*u,D=s*c-o*u,X=a*c-o*f,W=h*m-p*g,K=h*y-d*g,U=h*b-v*g,M=p*y-d*m,L=p*b-v*m,P=d*b-v*y,$=_*P-C*L+A*M+I*U-D*K+X*W;return $?($=1/$,n[0]=(u*P-f*L+c*M)*$,n[1]=(f*U-l*P-c*K)*$,n[2]=(l*L-u*U+c*W)*$,n[3]=(a*L-s*P-o*M)*$,n[4]=(i*P-a*U+o*K)*$,n[5]=(s*U-i*L-o*W)*$,n[6]=(m*X-y*D+b*I)*$,n[7]=(y*A-g*X-b*C)*$,n[8]=(g*D-m*A+b*_)*$,n):null}function projection(n,r,i){return n[0]=2/r,n[1]=0,n[2]=0,n[3]=0,n[4]=-2/i,n[5]=0,n[6]=-1,n[7]=1,n[8]=1,n}function str$6(n){return"mat3("+n[0]+", "+n[1]+", "+n[2]+", "+n[3]+", "+n[4]+", "+n[5]+", "+n[6]+", "+n[7]+", "+n[8]+")"}function frob$1(n){return Math.hypot(n[0],n[1],n[2],n[3],n[4],n[5],n[6],n[7],n[8])}function add$6(n,r,i){return n[0]=r[0]+i[0],n[1]=r[1]+i[1],n[2]=r[2]+i[2],n[3]=r[3]+i[3],n[4]=r[4]+i[4],n[5]=r[5]+i[5],n[6]=r[6]+i[6],n[7]=r[7]+i[7],n[8]=r[8]+i[8],n}function subtract$4(n,r,i){return n[0]=r[0]-i[0],n[1]=r[1]-i[1],n[2]=r[2]-i[2],n[3]=r[3]-i[3],n[4]=r[4]-i[4],n[5]=r[5]-i[5],n[6]=r[6]-i[6],n[7]=r[7]-i[7],n[8]=r[8]-i[8],n}function multiplyScalar$1(n,r,i){return n[0]=r[0]*i,n[1]=r[1]*i,n[2]=r[2]*i,n[3]=r[3]*i,n[4]=r[4]*i,n[5]=r[5]*i,n[6]=r[6]*i,n[7]=r[7]*i,n[8]=r[8]*i,n}function multiplyScalarAndAdd$1(n,r,i,s){return n[0]=r[0]+i[0]*s,n[1]=r[1]+i[1]*s,n[2]=r[2]+i[2]*s,n[3]=r[3]+i[3]*s,n[4]=r[4]+i[4]*s,n[5]=r[5]+i[5]*s,n[6]=r[6]+i[6]*s,n[7]=r[7]+i[7]*s,n[8]=r[8]+i[8]*s,n}function exactEquals$6(n,r){return n[0]===r[0]&&n[1]===r[1]&&n[2]===r[2]&&n[3]===r[3]&&n[4]===r[4]&&n[5]===r[5]&&n[6]===r[6]&&n[7]===r[7]&&n[8]===r[8]}function equals$6(n,r){var i=n[0],s=n[1],a=n[2],o=n[3],l=n[4],u=n[5],f=n[6],c=n[7],h=n[8],p=r[0],d=r[1],v=r[2],g=r[3],m=r[4],y=r[5],b=r[6],_=r[7],C=r[8];return Math.abs(i-p)<=EPSILON*Math.max(1,Math.abs(i),Math.abs(p))&&Math.abs(s-d)<=EPSILON*Math.max(1,Math.abs(s),Math.abs(d))&&Math.abs(a-v)<=EPSILON*Math.max(1,Math.abs(a),Math.abs(v))&&Math.abs(o-g)<=EPSILON*Math.max(1,Math.abs(o),Math.abs(g))&&Math.abs(l-m)<=EPSILON*Math.max(1,Math.abs(l),Math.abs(m))&&Math.abs(u-y)<=EPSILON*Math.max(1,Math.abs(u),Math.abs(y))&&Math.abs(f-b)<=EPSILON*Math.max(1,Math.abs(f),Math.abs(b))&&Math.abs(c-_)<=EPSILON*Math.max(1,Math.abs(c),Math.abs(_))&&Math.abs(h-C)<=EPSILON*Math.max(1,Math.abs(h),Math.abs(C))}var mul$6=multiply$6,sub$4=subtract$4,mat3=Object.freeze({__proto__:null,create:create$6,fromMat4:fromMat4$1,clone:clone$6,copy:copy$6,fromValues:fromValues$6,set:set$6,identity:identity$3,transpose:transpose$1,invert:invert$3,adjoint:adjoint$1,determinant:determinant$1,multiply:multiply$6,translate:translate$2,rotate:rotate$2,scale:scale$6,fromTranslation:fromTranslation$2,fromRotation:fromRotation$2,fromScaling:fromScaling$1,fromMat2d:fromMat2d,fromQuat:fromQuat$1,normalFromMat4:normalFromMat4,projection:projection,str:str$6,frob:frob$1,add:add$6,subtract:subtract$4,multiplyScalar:multiplyScalar$1,multiplyScalarAndAdd:multiplyScalarAndAdd$1,exactEquals:exactEquals$6,equals:equals$6,mul:mul$6,sub:sub$4});function create$5(){var n=new ARRAY_TYPE(16);return ARRAY_TYPE!=Float32Array&&(n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[11]=0,n[12]=0,n[13]=0,n[14]=0),n[0]=1,n[5]=1,n[10]=1,n[15]=1,n}function clone$5(n){var r=new ARRAY_TYPE(16);return r[0]=n[0],r[1]=n[1],r[2]=n[2],r[3]=n[3],r[4]=n[4],r[5]=n[5],r[6]=n[6],r[7]=n[7],r[8]=n[8],r[9]=n[9],r[10]=n[10],r[11]=n[11],r[12]=n[12],r[13]=n[13],r[14]=n[14],r[15]=n[15],r}function copy$5(n,r){return n[0]=r[0],n[1]=r[1],n[2]=r[2],n[3]=r[3],n[4]=r[4],n[5]=r[5],n[6]=r[6],n[7]=r[7],n[8]=r[8],n[9]=r[9],n[10]=r[10],n[11]=r[11],n[12]=r[12],n[13]=r[13],n[14]=r[14],n[15]=r[15],n}function fromValues$5(n,r,i,s,a,o,l,u,f,c,h,p,d,v,g,m){var y=new ARRAY_TYPE(16);return y[0]=n,y[1]=r,y[2]=i,y[3]=s,y[4]=a,y[5]=o,y[6]=l,y[7]=u,y[8]=f,y[9]=c,y[10]=h,y[11]=p,y[12]=d,y[13]=v,y[14]=g,y[15]=m,y}function set$5(n,r,i,s,a,o,l,u,f,c,h,p,d,v,g,m,y){return n[0]=r,n[1]=i,n[2]=s,n[3]=a,n[4]=o,n[5]=l,n[6]=u,n[7]=f,n[8]=c,n[9]=h,n[10]=p,n[11]=d,n[12]=v,n[13]=g,n[14]=m,n[15]=y,n}function identity$2(n){return n[0]=1,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=1,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=1,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n}function transpose(n,r){if(n===r){var i=r[1],s=r[2],a=r[3],o=r[6],l=r[7],u=r[11];n[1]=r[4],n[2]=r[8],n[3]=r[12],n[4]=i,n[6]=r[9],n[7]=r[13],n[8]=s,n[9]=o,n[11]=r[14],n[12]=a,n[13]=l,n[14]=u}else n[0]=r[0],n[1]=r[4],n[2]=r[8],n[3]=r[12],n[4]=r[1],n[5]=r[5],n[6]=r[9],n[7]=r[13],n[8]=r[2],n[9]=r[6],n[10]=r[10],n[11]=r[14],n[12]=r[3],n[13]=r[7],n[14]=r[11],n[15]=r[15];return n}function invert$2(n,r){var i=r[0],s=r[1],a=r[2],o=r[3],l=r[4],u=r[5],f=r[6],c=r[7],h=r[8],p=r[9],d=r[10],v=r[11],g=r[12],m=r[13],y=r[14],b=r[15],_=i*u-s*l,C=i*f-a*l,A=i*c-o*l,I=s*f-a*u,D=s*c-o*u,X=a*c-o*f,W=h*m-p*g,K=h*y-d*g,U=h*b-v*g,M=p*y-d*m,L=p*b-v*m,P=d*b-v*y,$=_*P-C*L+A*M+I*U-D*K+X*W;return $?($=1/$,n[0]=(u*P-f*L+c*M)*$,n[1]=(a*L-s*P-o*M)*$,n[2]=(m*X-y*D+b*I)*$,n[3]=(d*D-p*X-v*I)*$,n[4]=(f*U-l*P-c*K)*$,n[5]=(i*P-a*U+o*K)*$,n[6]=(y*A-g*X-b*C)*$,n[7]=(h*X-d*A+v*C)*$,n[8]=(l*L-u*U+c*W)*$,n[9]=(s*U-i*L-o*W)*$,n[10]=(g*D-m*A+b*_)*$,n[11]=(p*A-h*D-v*_)*$,n[12]=(u*K-l*M-f*W)*$,n[13]=(i*M-s*K+a*W)*$,n[14]=(m*C-g*I-y*_)*$,n[15]=(h*I-p*C+d*_)*$,n):null}function adjoint(n,r){var i=r[0],s=r[1],a=r[2],o=r[3],l=r[4],u=r[5],f=r[6],c=r[7],h=r[8],p=r[9],d=r[10],v=r[11],g=r[12],m=r[13],y=r[14],b=r[15];return n[0]=u*(d*b-v*y)-p*(f*b-c*y)+m*(f*v-c*d),n[1]=-(s*(d*b-v*y)-p*(a*b-o*y)+m*(a*v-o*d)),n[2]=s*(f*b-c*y)-u*(a*b-o*y)+m*(a*c-o*f),n[3]=-(s*(f*v-c*d)-u*(a*v-o*d)+p*(a*c-o*f)),n[4]=-(l*(d*b-v*y)-h*(f*b-c*y)+g*(f*v-c*d)),n[5]=i*(d*b-v*y)-h*(a*b-o*y)+g*(a*v-o*d),n[6]=-(i*(f*b-c*y)-l*(a*b-o*y)+g*(a*c-o*f)),n[7]=i*(f*v-c*d)-l*(a*v-o*d)+h*(a*c-o*f),n[8]=l*(p*b-v*m)-h*(u*b-c*m)+g*(u*v-c*p),n[9]=-(i*(p*b-v*m)-h*(s*b-o*m)+g*(s*v-o*p)),n[10]=i*(u*b-c*m)-l*(s*b-o*m)+g*(s*c-o*u),n[11]=-(i*(u*v-c*p)-l*(s*v-o*p)+h*(s*c-o*u)),n[12]=-(l*(p*y-d*m)-h*(u*y-f*m)+g*(u*d-f*p)),n[13]=i*(p*y-d*m)-h*(s*y-a*m)+g*(s*d-a*p),n[14]=-(i*(u*y-f*m)-l*(s*y-a*m)+g*(s*f-a*u)),n[15]=i*(u*d-f*p)-l*(s*d-a*p)+h*(s*f-a*u),n}function determinant(n){var r=n[0],i=n[1],s=n[2],a=n[3],o=n[4],l=n[5],u=n[6],f=n[7],c=n[8],h=n[9],p=n[10],d=n[11],v=n[12],g=n[13],m=n[14],y=n[15],b=r*l-i*o,_=r*u-s*o,C=r*f-a*o,A=i*u-s*l,I=i*f-a*l,D=s*f-a*u,X=c*g-h*v,W=c*m-p*v,K=c*y-d*v,U=h*m-p*g,M=h*y-d*g,L=p*y-d*m;return b*L-_*M+C*U+A*K-I*W+D*X}function multiply$5(n,r,i){var s=r[0],a=r[1],o=r[2],l=r[3],u=r[4],f=r[5],c=r[6],h=r[7],p=r[8],d=r[9],v=r[10],g=r[11],m=r[12],y=r[13],b=r[14],_=r[15],C=i[0],A=i[1],I=i[2],D=i[3];return n[0]=C*s+A*u+I*p+D*m,n[1]=C*a+A*f+I*d+D*y,n[2]=C*o+A*c+I*v+D*b,n[3]=C*l+A*h+I*g+D*_,C=i[4],A=i[5],I=i[6],D=i[7],n[4]=C*s+A*u+I*p+D*m,n[5]=C*a+A*f+I*d+D*y,n[6]=C*o+A*c+I*v+D*b,n[7]=C*l+A*h+I*g+D*_,C=i[8],A=i[9],I=i[10],D=i[11],n[8]=C*s+A*u+I*p+D*m,n[9]=C*a+A*f+I*d+D*y,n[10]=C*o+A*c+I*v+D*b,n[11]=C*l+A*h+I*g+D*_,C=i[12],A=i[13],I=i[14],D=i[15],n[12]=C*s+A*u+I*p+D*m,n[13]=C*a+A*f+I*d+D*y,n[14]=C*o+A*c+I*v+D*b,n[15]=C*l+A*h+I*g+D*_,n}function translate$1(n,r,i){var s=i[0],a=i[1],o=i[2],l,u,f,c,h,p,d,v,g,m,y,b;return r===n?(n[12]=r[0]*s+r[4]*a+r[8]*o+r[12],n[13]=r[1]*s+r[5]*a+r[9]*o+r[13],n[14]=r[2]*s+r[6]*a+r[10]*o+r[14],n[15]=r[3]*s+r[7]*a+r[11]*o+r[15]):(l=r[0],u=r[1],f=r[2],c=r[3],h=r[4],p=r[5],d=r[6],v=r[7],g=r[8],m=r[9],y=r[10],b=r[11],n[0]=l,n[1]=u,n[2]=f,n[3]=c,n[4]=h,n[5]=p,n[6]=d,n[7]=v,n[8]=g,n[9]=m,n[10]=y,n[11]=b,n[12]=l*s+h*a+g*o+r[12],n[13]=u*s+p*a+m*o+r[13],n[14]=f*s+d*a+y*o+r[14],n[15]=c*s+v*a+b*o+r[15]),n}function scale$5(n,r,i){var s=i[0],a=i[1],o=i[2];return n[0]=r[0]*s,n[1]=r[1]*s,n[2]=r[2]*s,n[3]=r[3]*s,n[4]=r[4]*a,n[5]=r[5]*a,n[6]=r[6]*a,n[7]=r[7]*a,n[8]=r[8]*o,n[9]=r[9]*o,n[10]=r[10]*o,n[11]=r[11]*o,n[12]=r[12],n[13]=r[13],n[14]=r[14],n[15]=r[15],n}function rotate$1(n,r,i,s){var a=s[0],o=s[1],l=s[2],u=Math.hypot(a,o,l),f,c,h,p,d,v,g,m,y,b,_,C,A,I,D,X,W,K,U,M,L,P,$,R;return u<EPSILON?null:(u=1/u,a*=u,o*=u,l*=u,f=Math.sin(i),c=Math.cos(i),h=1-c,p=r[0],d=r[1],v=r[2],g=r[3],m=r[4],y=r[5],b=r[6],_=r[7],C=r[8],A=r[9],I=r[10],D=r[11],X=a*a*h+c,W=o*a*h+l*f,K=l*a*h-o*f,U=a*o*h-l*f,M=o*o*h+c,L=l*o*h+a*f,P=a*l*h+o*f,$=o*l*h-a*f,R=l*l*h+c,n[0]=p*X+m*W+C*K,n[1]=d*X+y*W+A*K,n[2]=v*X+b*W+I*K,n[3]=g*X+_*W+D*K,n[4]=p*U+m*M+C*L,n[5]=d*U+y*M+A*L,n[6]=v*U+b*M+I*L,n[7]=g*U+_*M+D*L,n[8]=p*P+m*$+C*R,n[9]=d*P+y*$+A*R,n[10]=v*P+b*$+I*R,n[11]=g*P+_*$+D*R,r!==n&&(n[12]=r[12],n[13]=r[13],n[14]=r[14],n[15]=r[15]),n)}function rotateX$3(n,r,i){var s=Math.sin(i),a=Math.cos(i),o=r[4],l=r[5],u=r[6],f=r[7],c=r[8],h=r[9],p=r[10],d=r[11];return r!==n&&(n[0]=r[0],n[1]=r[1],n[2]=r[2],n[3]=r[3],n[12]=r[12],n[13]=r[13],n[14]=r[14],n[15]=r[15]),n[4]=o*a+c*s,n[5]=l*a+h*s,n[6]=u*a+p*s,n[7]=f*a+d*s,n[8]=c*a-o*s,n[9]=h*a-l*s,n[10]=p*a-u*s,n[11]=d*a-f*s,n}function rotateY$3(n,r,i){var s=Math.sin(i),a=Math.cos(i),o=r[0],l=r[1],u=r[2],f=r[3],c=r[8],h=r[9],p=r[10],d=r[11];return r!==n&&(n[4]=r[4],n[5]=r[5],n[6]=r[6],n[7]=r[7],n[12]=r[12],n[13]=r[13],n[14]=r[14],n[15]=r[15]),n[0]=o*a-c*s,n[1]=l*a-h*s,n[2]=u*a-p*s,n[3]=f*a-d*s,n[8]=o*s+c*a,n[9]=l*s+h*a,n[10]=u*s+p*a,n[11]=f*s+d*a,n}function rotateZ$3(n,r,i){var s=Math.sin(i),a=Math.cos(i),o=r[0],l=r[1],u=r[2],f=r[3],c=r[4],h=r[5],p=r[6],d=r[7];return r!==n&&(n[8]=r[8],n[9]=r[9],n[10]=r[10],n[11]=r[11],n[12]=r[12],n[13]=r[13],n[14]=r[14],n[15]=r[15]),n[0]=o*a+c*s,n[1]=l*a+h*s,n[2]=u*a+p*s,n[3]=f*a+d*s,n[4]=c*a-o*s,n[5]=h*a-l*s,n[6]=p*a-u*s,n[7]=d*a-f*s,n}function fromTranslation$1(n,r){return n[0]=1,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=1,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=1,n[11]=0,n[12]=r[0],n[13]=r[1],n[14]=r[2],n[15]=1,n}function fromScaling(n,r){return n[0]=r[0],n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=r[1],n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=r[2],n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n}function fromRotation$1(n,r,i){var s=i[0],a=i[1],o=i[2],l=Math.hypot(s,a,o),u,f,c;return l<EPSILON?null:(l=1/l,s*=l,a*=l,o*=l,u=Math.sin(r),f=Math.cos(r),c=1-f,n[0]=s*s*c+f,n[1]=a*s*c+o*u,n[2]=o*s*c-a*u,n[3]=0,n[4]=s*a*c-o*u,n[5]=a*a*c+f,n[6]=o*a*c+s*u,n[7]=0,n[8]=s*o*c+a*u,n[9]=a*o*c-s*u,n[10]=o*o*c+f,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n)}function fromXRotation(n,r){var i=Math.sin(r),s=Math.cos(r);return n[0]=1,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=s,n[6]=i,n[7]=0,n[8]=0,n[9]=-i,n[10]=s,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n}function fromYRotation(n,r){var i=Math.sin(r),s=Math.cos(r);return n[0]=s,n[1]=0,n[2]=-i,n[3]=0,n[4]=0,n[5]=1,n[6]=0,n[7]=0,n[8]=i,n[9]=0,n[10]=s,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n}function fromZRotation(n,r){var i=Math.sin(r),s=Math.cos(r);return n[0]=s,n[1]=i,n[2]=0,n[3]=0,n[4]=-i,n[5]=s,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=1,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n}function fromRotationTranslation$1(n,r,i){var s=r[0],a=r[1],o=r[2],l=r[3],u=s+s,f=a+a,c=o+o,h=s*u,p=s*f,d=s*c,v=a*f,g=a*c,m=o*c,y=l*u,b=l*f,_=l*c;return n[0]=1-(v+m),n[1]=p+_,n[2]=d-b,n[3]=0,n[4]=p-_,n[5]=1-(h+m),n[6]=g+y,n[7]=0,n[8]=d+b,n[9]=g-y,n[10]=1-(h+v),n[11]=0,n[12]=i[0],n[13]=i[1],n[14]=i[2],n[15]=1,n}function fromQuat2(n,r){var i=new ARRAY_TYPE(3),s=-r[0],a=-r[1],o=-r[2],l=r[3],u=r[4],f=r[5],c=r[6],h=r[7],p=s*s+a*a+o*o+l*l;return p>0?(i[0]=(u*l+h*s+f*o-c*a)*2/p,i[1]=(f*l+h*a+c*s-u*o)*2/p,i[2]=(c*l+h*o+u*a-f*s)*2/p):(i[0]=(u*l+h*s+f*o-c*a)*2,i[1]=(f*l+h*a+c*s-u*o)*2,i[2]=(c*l+h*o+u*a-f*s)*2),fromRotationTranslation$1(n,r,i),n}function getTranslation$1(n,r){return n[0]=r[12],n[1]=r[13],n[2]=r[14],n}function getScaling(n,r){var i=r[0],s=r[1],a=r[2],o=r[4],l=r[5],u=r[6],f=r[8],c=r[9],h=r[10];return n[0]=Math.hypot(i,s,a),n[1]=Math.hypot(o,l,u),n[2]=Math.hypot(f,c,h),n}function getRotation(n,r){var i=new ARRAY_TYPE(3);getScaling(i,r);var s=1/i[0],a=1/i[1],o=1/i[2],l=r[0]*s,u=r[1]*a,f=r[2]*o,c=r[4]*s,h=r[5]*a,p=r[6]*o,d=r[8]*s,v=r[9]*a,g=r[10]*o,m=l+h+g,y=0;return m>0?(y=Math.sqrt(m+1)*2,n[3]=.25*y,n[0]=(p-v)/y,n[1]=(d-f)/y,n[2]=(u-c)/y):l>h&&l>g?(y=Math.sqrt(1+l-h-g)*2,n[3]=(p-v)/y,n[0]=.25*y,n[1]=(u+c)/y,n[2]=(d+f)/y):h>g?(y=Math.sqrt(1+h-l-g)*2,n[3]=(d-f)/y,n[0]=(u+c)/y,n[1]=.25*y,n[2]=(p+v)/y):(y=Math.sqrt(1+g-l-h)*2,n[3]=(u-c)/y,n[0]=(d+f)/y,n[1]=(p+v)/y,n[2]=.25*y),n}function fromRotationTranslationScale(n,r,i,s){var a=r[0],o=r[1],l=r[2],u=r[3],f=a+a,c=o+o,h=l+l,p=a*f,d=a*c,v=a*h,g=o*c,m=o*h,y=l*h,b=u*f,_=u*c,C=u*h,A=s[0],I=s[1],D=s[2];return n[0]=(1-(g+y))*A,n[1]=(d+C)*A,n[2]=(v-_)*A,n[3]=0,n[4]=(d-C)*I,n[5]=(1-(p+y))*I,n[6]=(m+b)*I,n[7]=0,n[8]=(v+_)*D,n[9]=(m-b)*D,n[10]=(1-(p+g))*D,n[11]=0,n[12]=i[0],n[13]=i[1],n[14]=i[2],n[15]=1,n}function fromRotationTranslationScaleOrigin(n,r,i,s,a){var o=r[0],l=r[1],u=r[2],f=r[3],c=o+o,h=l+l,p=u+u,d=o*c,v=o*h,g=o*p,m=l*h,y=l*p,b=u*p,_=f*c,C=f*h,A=f*p,I=s[0],D=s[1],X=s[2],W=a[0],K=a[1],U=a[2],M=(1-(m+b))*I,L=(v+A)*I,P=(g-C)*I,$=(v-A)*D,R=(1-(d+b))*D,T=(y+_)*D,w=(g+C)*X,E=(y-_)*X,O=(1-(d+m))*X;return n[0]=M,n[1]=L,n[2]=P,n[3]=0,n[4]=$,n[5]=R,n[6]=T,n[7]=0,n[8]=w,n[9]=E,n[10]=O,n[11]=0,n[12]=i[0]+W-(M*W+$*K+w*U),n[13]=i[1]+K-(L*W+R*K+E*U),n[14]=i[2]+U-(P*W+T*K+O*U),n[15]=1,n}function fromQuat(n,r){var i=r[0],s=r[1],a=r[2],o=r[3],l=i+i,u=s+s,f=a+a,c=i*l,h=s*l,p=s*u,d=a*l,v=a*u,g=a*f,m=o*l,y=o*u,b=o*f;return n[0]=1-p-g,n[1]=h+b,n[2]=d-y,n[3]=0,n[4]=h-b,n[5]=1-c-g,n[6]=v+m,n[7]=0,n[8]=d+y,n[9]=v-m,n[10]=1-c-p,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n}function frustum(n,r,i,s,a,o,l){var u=1/(i-r),f=1/(a-s),c=1/(o-l);return n[0]=o*2*u,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=o*2*f,n[6]=0,n[7]=0,n[8]=(i+r)*u,n[9]=(a+s)*f,n[10]=(l+o)*c,n[11]=-1,n[12]=0,n[13]=0,n[14]=l*o*2*c,n[15]=0,n}function perspectiveNO(n,r,i,s,a){var o=1/Math.tan(r/2),l;return n[0]=o/i,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=o,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[11]=-1,n[12]=0,n[13]=0,n[15]=0,a!=null&&a!==1/0?(l=1/(s-a),n[10]=(a+s)*l,n[14]=2*a*s*l):(n[10]=-1,n[14]=-2*s),n}var perspective=perspectiveNO;function perspectiveZO(n,r,i,s,a){var o=1/Math.tan(r/2),l;return n[0]=o/i,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=o,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[11]=-1,n[12]=0,n[13]=0,n[15]=0,a!=null&&a!==1/0?(l=1/(s-a),n[10]=a*l,n[14]=a*s*l):(n[10]=-1,n[14]=-s),n}function perspectiveFromFieldOfView(n,r,i,s){var a=Math.tan(r.upDegrees*Math.PI/180),o=Math.tan(r.downDegrees*Math.PI/180),l=Math.tan(r.leftDegrees*Math.PI/180),u=Math.tan(r.rightDegrees*Math.PI/180),f=2/(l+u),c=2/(a+o);return n[0]=f,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=c,n[6]=0,n[7]=0,n[8]=-((l-u)*f*.5),n[9]=(a-o)*c*.5,n[10]=s/(i-s),n[11]=-1,n[12]=0,n[13]=0,n[14]=s*i/(i-s),n[15]=0,n}function orthoNO(n,r,i,s,a,o,l){var u=1/(r-i),f=1/(s-a),c=1/(o-l);return n[0]=-2*u,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=-2*f,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=2*c,n[11]=0,n[12]=(r+i)*u,n[13]=(a+s)*f,n[14]=(l+o)*c,n[15]=1,n}var ortho=orthoNO;function orthoZO(n,r,i,s,a,o,l){var u=1/(r-i),f=1/(s-a),c=1/(o-l);return n[0]=-2*u,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=-2*f,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=c,n[11]=0,n[12]=(r+i)*u,n[13]=(a+s)*f,n[14]=o*c,n[15]=1,n}function lookAt(n,r,i,s){var a,o,l,u,f,c,h,p,d,v,g=r[0],m=r[1],y=r[2],b=s[0],_=s[1],C=s[2],A=i[0],I=i[1],D=i[2];return Math.abs(g-A)<EPSILON&&Math.abs(m-I)<EPSILON&&Math.abs(y-D)<EPSILON?identity$2(n):(h=g-A,p=m-I,d=y-D,v=1/Math.hypot(h,p,d),h*=v,p*=v,d*=v,a=_*d-C*p,o=C*h-b*d,l=b*p-_*h,v=Math.hypot(a,o,l),v?(v=1/v,a*=v,o*=v,l*=v):(a=0,o=0,l=0),u=p*l-d*o,f=d*a-h*l,c=h*o-p*a,v=Math.hypot(u,f,c),v?(v=1/v,u*=v,f*=v,c*=v):(u=0,f=0,c=0),n[0]=a,n[1]=u,n[2]=h,n[3]=0,n[4]=o,n[5]=f,n[6]=p,n[7]=0,n[8]=l,n[9]=c,n[10]=d,n[11]=0,n[12]=-(a*g+o*m+l*y),n[13]=-(u*g+f*m+c*y),n[14]=-(h*g+p*m+d*y),n[15]=1,n)}function targetTo(n,r,i,s){var a=r[0],o=r[1],l=r[2],u=s[0],f=s[1],c=s[2],h=a-i[0],p=o-i[1],d=l-i[2],v=h*h+p*p+d*d;v>0&&(v=1/Math.sqrt(v),h*=v,p*=v,d*=v);var g=f*d-c*p,m=c*h-u*d,y=u*p-f*h;return v=g*g+m*m+y*y,v>0&&(v=1/Math.sqrt(v),g*=v,m*=v,y*=v),n[0]=g,n[1]=m,n[2]=y,n[3]=0,n[4]=p*y-d*m,n[5]=d*g-h*y,n[6]=h*m-p*g,n[7]=0,n[8]=h,n[9]=p,n[10]=d,n[11]=0,n[12]=a,n[13]=o,n[14]=l,n[15]=1,n}function str$5(n){return"mat4("+n[0]+", "+n[1]+", "+n[2]+", "+n[3]+", "+n[4]+", "+n[5]+", "+n[6]+", "+n[7]+", "+n[8]+", "+n[9]+", "+n[10]+", "+n[11]+", "+n[12]+", "+n[13]+", "+n[14]+", "+n[15]+")"}function frob(n){return Math.hypot(n[0],n[1],n[2],n[3],n[4],n[5],n[6],n[7],n[8],n[9],n[10],n[11],n[12],n[13],n[14],n[15])}function add$5(n,r,i){return n[0]=r[0]+i[0],n[1]=r[1]+i[1],n[2]=r[2]+i[2],n[3]=r[3]+i[3],n[4]=r[4]+i[4],n[5]=r[5]+i[5],n[6]=r[6]+i[6],n[7]=r[7]+i[7],n[8]=r[8]+i[8],n[9]=r[9]+i[9],n[10]=r[10]+i[10],n[11]=r[11]+i[11],n[12]=r[12]+i[12],n[13]=r[13]+i[13],n[14]=r[14]+i[14],n[15]=r[15]+i[15],n}function subtract$3(n,r,i){return n[0]=r[0]-i[0],n[1]=r[1]-i[1],n[2]=r[2]-i[2],n[3]=r[3]-i[3],n[4]=r[4]-i[4],n[5]=r[5]-i[5],n[6]=r[6]-i[6],n[7]=r[7]-i[7],n[8]=r[8]-i[8],n[9]=r[9]-i[9],n[10]=r[10]-i[10],n[11]=r[11]-i[11],n[12]=r[12]-i[12],n[13]=r[13]-i[13],n[14]=r[14]-i[14],n[15]=r[15]-i[15],n}function multiplyScalar(n,r,i){return n[0]=r[0]*i,n[1]=r[1]*i,n[2]=r[2]*i,n[3]=r[3]*i,n[4]=r[4]*i,n[5]=r[5]*i,n[6]=r[6]*i,n[7]=r[7]*i,n[8]=r[8]*i,n[9]=r[9]*i,n[10]=r[10]*i,n[11]=r[11]*i,n[12]=r[12]*i,n[13]=r[13]*i,n[14]=r[14]*i,n[15]=r[15]*i,n}function multiplyScalarAndAdd(n,r,i,s){return n[0]=r[0]+i[0]*s,n[1]=r[1]+i[1]*s,n[2]=r[2]+i[2]*s,n[3]=r[3]+i[3]*s,n[4]=r[4]+i[4]*s,n[5]=r[5]+i[5]*s,n[6]=r[6]+i[6]*s,n[7]=r[7]+i[7]*s,n[8]=r[8]+i[8]*s,n[9]=r[9]+i[9]*s,n[10]=r[10]+i[10]*s,n[11]=r[11]+i[11]*s,n[12]=r[12]+i[12]*s,n[13]=r[13]+i[13]*s,n[14]=r[14]+i[14]*s,n[15]=r[15]+i[15]*s,n}function exactEquals$5(n,r){return n[0]===r[0]&&n[1]===r[1]&&n[2]===r[2]&&n[3]===r[3]&&n[4]===r[4]&&n[5]===r[5]&&n[6]===r[6]&&n[7]===r[7]&&n[8]===r[8]&&n[9]===r[9]&&n[10]===r[10]&&n[11]===r[11]&&n[12]===r[12]&&n[13]===r[13]&&n[14]===r[14]&&n[15]===r[15]}function equals$5(n,r){var i=n[0],s=n[1],a=n[2],o=n[3],l=n[4],u=n[5],f=n[6],c=n[7],h=n[8],p=n[9],d=n[10],v=n[11],g=n[12],m=n[13],y=n[14],b=n[15],_=r[0],C=r[1],A=r[2],I=r[3],D=r[4],X=r[5],W=r[6],K=r[7],U=r[8],M=r[9],L=r[10],P=r[11],$=r[12],R=r[13],T=r[14],w=r[15];return Math.abs(i-_)<=EPSILON*Math.max(1,Math.abs(i),Math.abs(_))&&Math.abs(s-C)<=EPSILON*Math.max(1,Math.abs(s),Math.abs(C))&&Math.abs(a-A)<=EPSILON*Math.max(1,Math.abs(a),Math.abs(A))&&Math.abs(o-I)<=EPSILON*Math.max(1,Math.abs(o),Math.abs(I))&&Math.abs(l-D)<=EPSILON*Math.max(1,Math.abs(l),Math.abs(D))&&Math.abs(u-X)<=EPSILON*Math.max(1,Math.abs(u),Math.abs(X))&&Math.abs(f-W)<=EPSILON*Math.max(1,Math.abs(f),Math.abs(W))&&Math.abs(c-K)<=EPSILON*Math.max(1,Math.abs(c),Math.abs(K))&&Math.abs(h-U)<=EPSILON*Math.max(1,Math.abs(h),Math.abs(U))&&Math.abs(p-M)<=EPSILON*Math.max(1,Math.abs(p),Math.abs(M))&&Math.abs(d-L)<=EPSILON*Math.max(1,Math.abs(d),Math.abs(L))&&Math.abs(v-P)<=EPSILON*Math.max(1,Math.abs(v),Math.abs(P))&&Math.abs(g-$)<=EPSILON*Math.max(1,Math.abs(g),Math.abs($))&&Math.abs(m-R)<=EPSILON*Math.max(1,Math.abs(m),Math.abs(R))&&Math.abs(y-T)<=EPSILON*Math.max(1,Math.abs(y),Math.abs(T))&&Math.abs(b-w)<=EPSILON*Math.max(1,Math.abs(b),Math.abs(w))}var mul$5=multiply$5,sub$3=subtract$3,mat4=Object.freeze({__proto__:null,create:create$5,clone:clone$5,copy:copy$5,fromValues:fromValues$5,set:set$5,identity:identity$2,transpose:transpose,invert:invert$2,adjoint:adjoint,determinant:determinant,multiply:multiply$5,translate:translate$1,scale:scale$5,rotate:rotate$1,rotateX:rotateX$3,rotateY:rotateY$3,rotateZ:rotateZ$3,fromTranslation:fromTranslation$1,fromScaling:fromScaling,fromRotation:fromRotation$1,fromXRotation:fromXRotation,fromYRotation:fromYRotation,fromZRotation:fromZRotation,fromRotationTranslation:fromRotationTranslation$1,fromQuat2:fromQuat2,getTranslation:getTranslation$1,getScaling:getScaling,getRotation:getRotation,fromRotationTranslationScale:fromRotationTranslationScale,fromRotationTranslationScaleOrigin:fromRotationTranslationScaleOrigin,fromQuat:fromQuat,frustum:frustum,perspectiveNO:perspectiveNO,perspective:perspective,perspectiveZO:perspectiveZO,perspectiveFromFieldOfView:perspectiveFromFieldOfView,orthoNO:orthoNO,ortho:ortho,orthoZO:orthoZO,lookAt:lookAt,targetTo:targetTo,str:str$5,frob:frob,add:add$5,subtract:subtract$3,multiplyScalar:multiplyScalar,multiplyScalarAndAdd:multiplyScalarAndAdd,exactEquals:exactEquals$5,equals:equals$5,mul:mul$5,sub:sub$3});function create$4(){var n=new ARRAY_TYPE(3);return ARRAY_TYPE!=Float32Array&&(n[0]=0,n[1]=0,n[2]=0),n}function clone$4(n){var r=new ARRAY_TYPE(3);return r[0]=n[0],r[1]=n[1],r[2]=n[2],r}function length$4(n){var r=n[0],i=n[1],s=n[2];return Math.hypot(r,i,s)}function fromValues$4(n,r,i){var s=new ARRAY_TYPE(3);return s[0]=n,s[1]=r,s[2]=i,s}function copy$4(n,r){return n[0]=r[0],n[1]=r[1],n[2]=r[2],n}function set$4(n,r,i,s){return n[0]=r,n[1]=i,n[2]=s,n}function add$4(n,r,i){return n[0]=r[0]+i[0],n[1]=r[1]+i[1],n[2]=r[2]+i[2],n}function subtract$2(n,r,i){return n[0]=r[0]-i[0],n[1]=r[1]-i[1],n[2]=r[2]-i[2],n}function multiply$4(n,r,i){return n[0]=r[0]*i[0],n[1]=r[1]*i[1],n[2]=r[2]*i[2],n}function divide$2(n,r,i){return n[0]=r[0]/i[0],n[1]=r[1]/i[1],n[2]=r[2]/i[2],n}function ceil$2(n,r){return n[0]=Math.ceil(r[0]),n[1]=Math.ceil(r[1]),n[2]=Math.ceil(r[2]),n}function floor$2(n,r){return n[0]=Math.floor(r[0]),n[1]=Math.floor(r[1]),n[2]=Math.floor(r[2]),n}function min$2(n,r,i){return n[0]=Math.min(r[0],i[0]),n[1]=Math.min(r[1],i[1]),n[2]=Math.min(r[2],i[2]),n}function max$2(n,r,i){return n[0]=Math.max(r[0],i[0]),n[1]=Math.max(r[1],i[1]),n[2]=Math.max(r[2],i[2]),n}function round$2(n,r){return n[0]=Math.round(r[0]),n[1]=Math.round(r[1]),n[2]=Math.round(r[2]),n}function scale$4(n,r,i){return n[0]=r[0]*i,n[1]=r[1]*i,n[2]=r[2]*i,n}function scaleAndAdd$2(n,r,i,s){return n[0]=r[0]+i[0]*s,n[1]=r[1]+i[1]*s,n[2]=r[2]+i[2]*s,n}function distance$2(n,r){var i=r[0]-n[0],s=r[1]-n[1],a=r[2]-n[2];return Math.hypot(i,s,a)}function squaredDistance$2(n,r){var i=r[0]-n[0],s=r[1]-n[1],a=r[2]-n[2];return i*i+s*s+a*a}function squaredLength$4(n){var r=n[0],i=n[1],s=n[2];return r*r+i*i+s*s}function negate$2(n,r){return n[0]=-r[0],n[1]=-r[1],n[2]=-r[2],n}function inverse$2(n,r){return n[0]=1/r[0],n[1]=1/r[1],n[2]=1/r[2],n}function normalize$4(n,r){var i=r[0],s=r[1],a=r[2],o=i*i+s*s+a*a;return o>0&&(o=1/Math.sqrt(o)),n[0]=r[0]*o,n[1]=r[1]*o,n[2]=r[2]*o,n}function dot$4(n,r){return n[0]*r[0]+n[1]*r[1]+n[2]*r[2]}function cross$2(n,r,i){var s=r[0],a=r[1],o=r[2],l=i[0],u=i[1],f=i[2];return n[0]=a*f-o*u,n[1]=o*l-s*f,n[2]=s*u-a*l,n}function lerp$4(n,r,i,s){var a=r[0],o=r[1],l=r[2];return n[0]=a+s*(i[0]-a),n[1]=o+s*(i[1]-o),n[2]=l+s*(i[2]-l),n}function hermite(n,r,i,s,a,o){var l=o*o,u=l*(2*o-3)+1,f=l*(o-2)+o,c=l*(o-1),h=l*(3-2*o);return n[0]=r[0]*u+i[0]*f+s[0]*c+a[0]*h,n[1]=r[1]*u+i[1]*f+s[1]*c+a[1]*h,n[2]=r[2]*u+i[2]*f+s[2]*c+a[2]*h,n}function bezier(n,r,i,s,a,o){var l=1-o,u=l*l,f=o*o,c=u*l,h=3*o*u,p=3*f*l,d=f*o;return n[0]=r[0]*c+i[0]*h+s[0]*p+a[0]*d,n[1]=r[1]*c+i[1]*h+s[1]*p+a[1]*d,n[2]=r[2]*c+i[2]*h+s[2]*p+a[2]*d,n}function random$3(n,r){r=r||1;var i=RANDOM()*2*Math.PI,s=RANDOM()*2-1,a=Math.sqrt(1-s*s)*r;return n[0]=Math.cos(i)*a,n[1]=Math.sin(i)*a,n[2]=s*r,n}function transformMat4$2(n,r,i){var s=r[0],a=r[1],o=r[2],l=i[3]*s+i[7]*a+i[11]*o+i[15];return l=l||1,n[0]=(i[0]*s+i[4]*a+i[8]*o+i[12])/l,n[1]=(i[1]*s+i[5]*a+i[9]*o+i[13])/l,n[2]=(i[2]*s+i[6]*a+i[10]*o+i[14])/l,n}function transformMat3$1(n,r,i){var s=r[0],a=r[1],o=r[2];return n[0]=s*i[0]+a*i[3]+o*i[6],n[1]=s*i[1]+a*i[4]+o*i[7],n[2]=s*i[2]+a*i[5]+o*i[8],n}function transformQuat$1(n,r,i){var s=i[0],a=i[1],o=i[2],l=i[3],u=r[0],f=r[1],c=r[2],h=a*c-o*f,p=o*u-s*c,d=s*f-a*u,v=a*d-o*p,g=o*h-s*d,m=s*p-a*h,y=l*2;return h*=y,p*=y,d*=y,v*=2,g*=2,m*=2,n[0]=u+h+v,n[1]=f+p+g,n[2]=c+d+m,n}function rotateX$2(n,r,i,s){var a=[],o=[];return a[0]=r[0]-i[0],a[1]=r[1]-i[1],a[2]=r[2]-i[2],o[0]=a[0],o[1]=a[1]*Math.cos(s)-a[2]*Math.sin(s),o[2]=a[1]*Math.sin(s)+a[2]*Math.cos(s),n[0]=o[0]+i[0],n[1]=o[1]+i[1],n[2]=o[2]+i[2],n}function rotateY$2(n,r,i,s){var a=[],o=[];return a[0]=r[0]-i[0],a[1]=r[1]-i[1],a[2]=r[2]-i[2],o[0]=a[2]*Math.sin(s)+a[0]*Math.cos(s),o[1]=a[1],o[2]=a[2]*Math.cos(s)-a[0]*Math.sin(s),n[0]=o[0]+i[0],n[1]=o[1]+i[1],n[2]=o[2]+i[2],n}function rotateZ$2(n,r,i,s){var a=[],o=[];return a[0]=r[0]-i[0],a[1]=r[1]-i[1],a[2]=r[2]-i[2],o[0]=a[0]*Math.cos(s)-a[1]*Math.sin(s),o[1]=a[0]*Math.sin(s)+a[1]*Math.cos(s),o[2]=a[2],n[0]=o[0]+i[0],n[1]=o[1]+i[1],n[2]=o[2]+i[2],n}function angle$1(n,r){var i=n[0],s=n[1],a=n[2],o=r[0],l=r[1],u=r[2],f=Math.sqrt(i*i+s*s+a*a),c=Math.sqrt(o*o+l*l+u*u),h=f*c,p=h&&dot$4(n,r)/h;return Math.acos(Math.min(Math.max(p,-1),1))}function zero$2(n){return n[0]=0,n[1]=0,n[2]=0,n}function str$4(n){return"vec3("+n[0]+", "+n[1]+", "+n[2]+")"}function exactEquals$4(n,r){return n[0]===r[0]&&n[1]===r[1]&&n[2]===r[2]}function equals$4(n,r){var i=n[0],s=n[1],a=n[2],o=r[0],l=r[1],u=r[2];return Math.abs(i-o)<=EPSILON*Math.max(1,Math.abs(i),Math.abs(o))&&Math.abs(s-l)<=EPSILON*Math.max(1,Math.abs(s),Math.abs(l))&&Math.abs(a-u)<=EPSILON*Math.max(1,Math.abs(a),Math.abs(u))}var sub$2=subtract$2,mul$4=multiply$4,div$2=divide$2,dist$2=distance$2,sqrDist$2=squaredDistance$2,len$4=length$4,sqrLen$4=squaredLength$4,forEach$2=function(){var n=create$4();return function(r,i,s,a,o,l){var u,f;for(i||(i=3),s||(s=0),a?f=Math.min(a*i+s,r.length):f=r.length,u=s;u<f;u+=i)n[0]=r[u],n[1]=r[u+1],n[2]=r[u+2],o(n,n,l),r[u]=n[0],r[u+1]=n[1],r[u+2]=n[2];return r}}(),vec3=Object.freeze({__proto__:null,create:create$4,clone:clone$4,length:length$4,fromValues:fromValues$4,copy:copy$4,set:set$4,add:add$4,subtract:subtract$2,multiply:multiply$4,divide:divide$2,ceil:ceil$2,floor:floor$2,min:min$2,max:max$2,round:round$2,scale:scale$4,scaleAndAdd:scaleAndAdd$2,distance:distance$2,squaredDistance:squaredDistance$2,squaredLength:squaredLength$4,negate:negate$2,inverse:inverse$2,normalize:normalize$4,dot:dot$4,cross:cross$2,lerp:lerp$4,hermite:hermite,bezier:bezier,random:random$3,transformMat4:transformMat4$2,transformMat3:transformMat3$1,transformQuat:transformQuat$1,rotateX:rotateX$2,rotateY:rotateY$2,rotateZ:rotateZ$2,angle:angle$1,zero:zero$2,str:str$4,exactEquals:exactEquals$4,equals:equals$4,sub:sub$2,mul:mul$4,div:div$2,dist:dist$2,sqrDist:sqrDist$2,len:len$4,sqrLen:sqrLen$4,forEach:forEach$2});function create$3(){var n=new ARRAY_TYPE(4);return ARRAY_TYPE!=Float32Array&&(n[0]=0,n[1]=0,n[2]=0,n[3]=0),n}function clone$3(n){var r=new ARRAY_TYPE(4);return r[0]=n[0],r[1]=n[1],r[2]=n[2],r[3]=n[3],r}function fromValues$3(n,r,i,s){var a=new ARRAY_TYPE(4);return a[0]=n,a[1]=r,a[2]=i,a[3]=s,a}function copy$3(n,r){return n[0]=r[0],n[1]=r[1],n[2]=r[2],n[3]=r[3],n}function set$3(n,r,i,s,a){return n[0]=r,n[1]=i,n[2]=s,n[3]=a,n}function add$3(n,r,i){return n[0]=r[0]+i[0],n[1]=r[1]+i[1],n[2]=r[2]+i[2],n[3]=r[3]+i[3],n}function subtract$1(n,r,i){return n[0]=r[0]-i[0],n[1]=r[1]-i[1],n[2]=r[2]-i[2],n[3]=r[3]-i[3],n}function multiply$3(n,r,i){return n[0]=r[0]*i[0],n[1]=r[1]*i[1],n[2]=r[2]*i[2],n[3]=r[3]*i[3],n}function divide$1(n,r,i){return n[0]=r[0]/i[0],n[1]=r[1]/i[1],n[2]=r[2]/i[2],n[3]=r[3]/i[3],n}function ceil$1(n,r){return n[0]=Math.ceil(r[0]),n[1]=Math.ceil(r[1]),n[2]=Math.ceil(r[2]),n[3]=Math.ceil(r[3]),n}function floor$1(n,r){return n[0]=Math.floor(r[0]),n[1]=Math.floor(r[1]),n[2]=Math.floor(r[2]),n[3]=Math.floor(r[3]),n}function min$1(n,r,i){return n[0]=Math.min(r[0],i[0]),n[1]=Math.min(r[1],i[1]),n[2]=Math.min(r[2],i[2]),n[3]=Math.min(r[3],i[3]),n}function max$1(n,r,i){return n[0]=Math.max(r[0],i[0]),n[1]=Math.max(r[1],i[1]),n[2]=Math.max(r[2],i[2]),n[3]=Math.max(r[3],i[3]),n}function round$1(n,r){return n[0]=Math.round(r[0]),n[1]=Math.round(r[1]),n[2]=Math.round(r[2]),n[3]=Math.round(r[3]),n}function scale$3(n,r,i){return n[0]=r[0]*i,n[1]=r[1]*i,n[2]=r[2]*i,n[3]=r[3]*i,n}function scaleAndAdd$1(n,r,i,s){return n[0]=r[0]+i[0]*s,n[1]=r[1]+i[1]*s,n[2]=r[2]+i[2]*s,n[3]=r[3]+i[3]*s,n}function distance$1(n,r){var i=r[0]-n[0],s=r[1]-n[1],a=r[2]-n[2],o=r[3]-n[3];return Math.hypot(i,s,a,o)}function squaredDistance$1(n,r){var i=r[0]-n[0],s=r[1]-n[1],a=r[2]-n[2],o=r[3]-n[3];return i*i+s*s+a*a+o*o}function length$3(n){var r=n[0],i=n[1],s=n[2],a=n[3];return Math.hypot(r,i,s,a)}function squaredLength$3(n){var r=n[0],i=n[1],s=n[2],a=n[3];return r*r+i*i+s*s+a*a}function negate$1(n,r){return n[0]=-r[0],n[1]=-r[1],n[2]=-r[2],n[3]=-r[3],n}function inverse$1(n,r){return n[0]=1/r[0],n[1]=1/r[1],n[2]=1/r[2],n[3]=1/r[3],n}function normalize$3(n,r){var i=r[0],s=r[1],a=r[2],o=r[3],l=i*i+s*s+a*a+o*o;return l>0&&(l=1/Math.sqrt(l)),n[0]=i*l,n[1]=s*l,n[2]=a*l,n[3]=o*l,n}function dot$3(n,r){return n[0]*r[0]+n[1]*r[1]+n[2]*r[2]+n[3]*r[3]}function cross$1(n,r,i,s){var a=i[0]*s[1]-i[1]*s[0],o=i[0]*s[2]-i[2]*s[0],l=i[0]*s[3]-i[3]*s[0],u=i[1]*s[2]-i[2]*s[1],f=i[1]*s[3]-i[3]*s[1],c=i[2]*s[3]-i[3]*s[2],h=r[0],p=r[1],d=r[2],v=r[3];return n[0]=p*c-d*f+v*u,n[1]=-(h*c)+d*l-v*o,n[2]=h*f-p*l+v*a,n[3]=-(h*u)+p*o-d*a,n}function lerp$3(n,r,i,s){var a=r[0],o=r[1],l=r[2],u=r[3];return n[0]=a+s*(i[0]-a),n[1]=o+s*(i[1]-o),n[2]=l+s*(i[2]-l),n[3]=u+s*(i[3]-u),n}function random$2(n,r){r=r||1;var i,s,a,o,l,u;do i=RANDOM()*2-1,s=RANDOM()*2-1,l=i*i+s*s;while(l>=1);do a=RANDOM()*2-1,o=RANDOM()*2-1,u=a*a+o*o;while(u>=1);var f=Math.sqrt((1-l)/u);return n[0]=r*i,n[1]=r*s,n[2]=r*a*f,n[3]=r*o*f,n}function transformMat4$1(n,r,i){var s=r[0],a=r[1],o=r[2],l=r[3];return n[0]=i[0]*s+i[4]*a+i[8]*o+i[12]*l,n[1]=i[1]*s+i[5]*a+i[9]*o+i[13]*l,n[2]=i[2]*s+i[6]*a+i[10]*o+i[14]*l,n[3]=i[3]*s+i[7]*a+i[11]*o+i[15]*l,n}function transformQuat(n,r,i){var s=r[0],a=r[1],o=r[2],l=i[0],u=i[1],f=i[2],c=i[3],h=c*s+u*o-f*a,p=c*a+f*s-l*o,d=c*o+l*a-u*s,v=-l*s-u*a-f*o;return n[0]=h*c+v*-l+p*-f-d*-u,n[1]=p*c+v*-u+d*-l-h*-f,n[2]=d*c+v*-f+h*-u-p*-l,n[3]=r[3],n}function zero$1(n){return n[0]=0,n[1]=0,n[2]=0,n[3]=0,n}function str$3(n){return"vec4("+n[0]+", "+n[1]+", "+n[2]+", "+n[3]+")"}function exactEquals$3(n,r){return n[0]===r[0]&&n[1]===r[1]&&n[2]===r[2]&&n[3]===r[3]}function equals$3(n,r){var i=n[0],s=n[1],a=n[2],o=n[3],l=r[0],u=r[1],f=r[2],c=r[3];return Math.abs(i-l)<=EPSILON*Math.max(1,Math.abs(i),Math.abs(l))&&Math.abs(s-u)<=EPSILON*Math.max(1,Math.abs(s),Math.abs(u))&&Math.abs(a-f)<=EPSILON*Math.max(1,Math.abs(a),Math.abs(f))&&Math.abs(o-c)<=EPSILON*Math.max(1,Math.abs(o),Math.abs(c))}var sub$1=subtract$1,mul$3=multiply$3,div$1=divide$1,dist$1=distance$1,sqrDist$1=squaredDistance$1,len$3=length$3,sqrLen$3=squaredLength$3,forEach$1=function(){var n=create$3();return function(r,i,s,a,o,l){var u,f;for(i||(i=4),s||(s=0),a?f=Math.min(a*i+s,r.length):f=r.length,u=s;u<f;u+=i)n[0]=r[u],n[1]=r[u+1],n[2]=r[u+2],n[3]=r[u+3],o(n,n,l),r[u]=n[0],r[u+1]=n[1],r[u+2]=n[2],r[u+3]=n[3];return r}}(),vec4=Object.freeze({__proto__:null,create:create$3,clone:clone$3,fromValues:fromValues$3,copy:copy$3,set:set$3,add:add$3,subtract:subtract$1,multiply:multiply$3,divide:divide$1,ceil:ceil$1,floor:floor$1,min:min$1,max:max$1,round:round$1,scale:scale$3,scaleAndAdd:scaleAndAdd$1,distance:distance$1,squaredDistance:squaredDistance$1,length:length$3,squaredLength:squaredLength$3,negate:negate$1,inverse:inverse$1,normalize:normalize$3,dot:dot$3,cross:cross$1,lerp:lerp$3,random:random$2,transformMat4:transformMat4$1,transformQuat:transformQuat,zero:zero$1,str:str$3,exactEquals:exactEquals$3,equals:equals$3,sub:sub$1,mul:mul$3,div:div$1,dist:dist$1,sqrDist:sqrDist$1,len:len$3,sqrLen:sqrLen$3,forEach:forEach$1});function create$2(){var n=new ARRAY_TYPE(4);return ARRAY_TYPE!=Float32Array&&(n[0]=0,n[1]=0,n[2]=0),n[3]=1,n}function identity$1(n){return n[0]=0,n[1]=0,n[2]=0,n[3]=1,n}function setAxisAngle(n,r,i){i=i*.5;var s=Math.sin(i);return n[0]=s*r[0],n[1]=s*r[1],n[2]=s*r[2],n[3]=Math.cos(i),n}function getAxisAngle(n,r){var i=Math.acos(r[3])*2,s=Math.sin(i/2);return s>EPSILON?(n[0]=r[0]/s,n[1]=r[1]/s,n[2]=r[2]/s):(n[0]=1,n[1]=0,n[2]=0),i}function getAngle(n,r){var i=dot$2(n,r);return Math.acos(2*i*i-1)}function multiply$2(n,r,i){var s=r[0],a=r[1],o=r[2],l=r[3],u=i[0],f=i[1],c=i[2],h=i[3];return n[0]=s*h+l*u+a*c-o*f,n[1]=a*h+l*f+o*u-s*c,n[2]=o*h+l*c+s*f-a*u,n[3]=l*h-s*u-a*f-o*c,n}function rotateX$1(n,r,i){i*=.5;var s=r[0],a=r[1],o=r[2],l=r[3],u=Math.sin(i),f=Math.cos(i);return n[0]=s*f+l*u,n[1]=a*f+o*u,n[2]=o*f-a*u,n[3]=l*f-s*u,n}function rotateY$1(n,r,i){i*=.5;var s=r[0],a=r[1],o=r[2],l=r[3],u=Math.sin(i),f=Math.cos(i);return n[0]=s*f-o*u,n[1]=a*f+l*u,n[2]=o*f+s*u,n[3]=l*f-a*u,n}function rotateZ$1(n,r,i){i*=.5;var s=r[0],a=r[1],o=r[2],l=r[3],u=Math.sin(i),f=Math.cos(i);return n[0]=s*f+a*u,n[1]=a*f-s*u,n[2]=o*f+l*u,n[3]=l*f-o*u,n}function calculateW(n,r){var i=r[0],s=r[1],a=r[2];return n[0]=i,n[1]=s,n[2]=a,n[3]=Math.sqrt(Math.abs(1-i*i-s*s-a*a)),n}function exp(n,r){var i=r[0],s=r[1],a=r[2],o=r[3],l=Math.sqrt(i*i+s*s+a*a),u=Math.exp(o),f=l>0?u*Math.sin(l)/l:0;return n[0]=i*f,n[1]=s*f,n[2]=a*f,n[3]=u*Math.cos(l),n}function ln(n,r){var i=r[0],s=r[1],a=r[2],o=r[3],l=Math.sqrt(i*i+s*s+a*a),u=l>0?Math.atan2(l,o)/l:0;return n[0]=i*u,n[1]=s*u,n[2]=a*u,n[3]=.5*Math.log(i*i+s*s+a*a+o*o),n}function pow(n,r,i){return ln(n,r),scale$2(n,n,i),exp(n,n),n}function slerp(n,r,i,s){var a=r[0],o=r[1],l=r[2],u=r[3],f=i[0],c=i[1],h=i[2],p=i[3],d,v,g,m,y;return v=a*f+o*c+l*h+u*p,v<0&&(v=-v,f=-f,c=-c,h=-h,p=-p),1-v>EPSILON?(d=Math.acos(v),g=Math.sin(d),m=Math.sin((1-s)*d)/g,y=Math.sin(s*d)/g):(m=1-s,y=s),n[0]=m*a+y*f,n[1]=m*o+y*c,n[2]=m*l+y*h,n[3]=m*u+y*p,n}function random$1(n){var r=RANDOM(),i=RANDOM(),s=RANDOM(),a=Math.sqrt(1-r),o=Math.sqrt(r);return n[0]=a*Math.sin(2*Math.PI*i),n[1]=a*Math.cos(2*Math.PI*i),n[2]=o*Math.sin(2*Math.PI*s),n[3]=o*Math.cos(2*Math.PI*s),n}function invert$1(n,r){var i=r[0],s=r[1],a=r[2],o=r[3],l=i*i+s*s+a*a+o*o,u=l?1/l:0;return n[0]=-i*u,n[1]=-s*u,n[2]=-a*u,n[3]=o*u,n}function conjugate$1(n,r){return n[0]=-r[0],n[1]=-r[1],n[2]=-r[2],n[3]=r[3],n}function fromMat3(n,r){var i=r[0]+r[4]+r[8],s;if(i>0)s=Math.sqrt(i+1),n[3]=.5*s,s=.5/s,n[0]=(r[5]-r[7])*s,n[1]=(r[6]-r[2])*s,n[2]=(r[1]-r[3])*s;else{var a=0;r[4]>r[0]&&(a=1),r[8]>r[a*3+a]&&(a=2);var o=(a+1)%3,l=(a+2)%3;s=Math.sqrt(r[a*3+a]-r[o*3+o]-r[l*3+l]+1),n[a]=.5*s,s=.5/s,n[3]=(r[o*3+l]-r[l*3+o])*s,n[o]=(r[o*3+a]+r[a*3+o])*s,n[l]=(r[l*3+a]+r[a*3+l])*s}return n}function fromEuler(n,r,i,s){var a=.5*Math.PI/180;r*=a,i*=a,s*=a;var o=Math.sin(r),l=Math.cos(r),u=Math.sin(i),f=Math.cos(i),c=Math.sin(s),h=Math.cos(s);return n[0]=o*f*h-l*u*c,n[1]=l*u*h+o*f*c,n[2]=l*f*c-o*u*h,n[3]=l*f*h+o*u*c,n}function str$2(n){return"quat("+n[0]+", "+n[1]+", "+n[2]+", "+n[3]+")"}var clone$2=clone$3,fromValues$2=fromValues$3,copy$2=copy$3,set$2=set$3,add$2=add$3,mul$2=multiply$2,scale$2=scale$3,dot$2=dot$3,lerp$2=lerp$3,length$2=length$3,len$2=length$2,squaredLength$2=squaredLength$3,sqrLen$2=squaredLength$2,normalize$2=normalize$3,exactEquals$2=exactEquals$3,equals$2=equals$3,rotationTo=function(){var n=create$4(),r=fromValues$4(1,0,0),i=fromValues$4(0,1,0);return function(s,a,o){var l=dot$4(a,o);return l<-.999999?(cross$2(n,r,a),len$4(n)<1e-6&&cross$2(n,i,a),normalize$4(n,n),setAxisAngle(s,n,Math.PI),s):l>.999999?(s[0]=0,s[1]=0,s[2]=0,s[3]=1,s):(cross$2(n,a,o),s[0]=n[0],s[1]=n[1],s[2]=n[2],s[3]=1+l,normalize$2(s,s))}}(),sqlerp=function(){var n=create$2(),r=create$2();return function(i,s,a,o,l,u){return slerp(n,s,l,u),slerp(r,a,o,u),slerp(i,n,r,2*u*(1-u)),i}}(),setAxes=function(){var n=create$6();return function(r,i,s,a){return n[0]=s[0],n[3]=s[1],n[6]=s[2],n[1]=a[0],n[4]=a[1],n[7]=a[2],n[2]=-i[0],n[5]=-i[1],n[8]=-i[2],normalize$2(r,fromMat3(r,n))}}(),quat=Object.freeze({__proto__:null,create:create$2,identity:identity$1,setAxisAngle:setAxisAngle,getAxisAngle:getAxisAngle,getAngle:getAngle,multiply:multiply$2,rotateX:rotateX$1,rotateY:rotateY$1,rotateZ:rotateZ$1,calculateW:calculateW,exp:exp,ln:ln,pow:pow,slerp:slerp,random:random$1,invert:invert$1,conjugate:conjugate$1,fromMat3:fromMat3,fromEuler:fromEuler,str:str$2,clone:clone$2,fromValues:fromValues$2,copy:copy$2,set:set$2,add:add$2,mul:mul$2,scale:scale$2,dot:dot$2,lerp:lerp$2,length:length$2,len:len$2,squaredLength:squaredLength$2,sqrLen:sqrLen$2,normalize:normalize$2,exactEquals:exactEquals$2,equals:equals$2,rotationTo:rotationTo,sqlerp:sqlerp,setAxes:setAxes});function create$1(){var n=new ARRAY_TYPE(8);return ARRAY_TYPE!=Float32Array&&(n[0]=0,n[1]=0,n[2]=0,n[4]=0,n[5]=0,n[6]=0,n[7]=0),n[3]=1,n}function clone$1(n){var r=new ARRAY_TYPE(8);return r[0]=n[0],r[1]=n[1],r[2]=n[2],r[3]=n[3],r[4]=n[4],r[5]=n[5],r[6]=n[6],r[7]=n[7],r}function fromValues$1(n,r,i,s,a,o,l,u){var f=new ARRAY_TYPE(8);return f[0]=n,f[1]=r,f[2]=i,f[3]=s,f[4]=a,f[5]=o,f[6]=l,f[7]=u,f}function fromRotationTranslationValues(n,r,i,s,a,o,l){var u=new ARRAY_TYPE(8);u[0]=n,u[1]=r,u[2]=i,u[3]=s;var f=a*.5,c=o*.5,h=l*.5;return u[4]=f*s+c*i-h*r,u[5]=c*s+h*n-f*i,u[6]=h*s+f*r-c*n,u[7]=-f*n-c*r-h*i,u}function fromRotationTranslation(n,r,i){var s=i[0]*.5,a=i[1]*.5,o=i[2]*.5,l=r[0],u=r[1],f=r[2],c=r[3];return n[0]=l,n[1]=u,n[2]=f,n[3]=c,n[4]=s*c+a*f-o*u,n[5]=a*c+o*l-s*f,n[6]=o*c+s*u-a*l,n[7]=-s*l-a*u-o*f,n}function fromTranslation(n,r){return n[0]=0,n[1]=0,n[2]=0,n[3]=1,n[4]=r[0]*.5,n[5]=r[1]*.5,n[6]=r[2]*.5,n[7]=0,n}function fromRotation(n,r){return n[0]=r[0],n[1]=r[1],n[2]=r[2],n[3]=r[3],n[4]=0,n[5]=0,n[6]=0,n[7]=0,n}function fromMat4(n,r){var i=create$2();getRotation(i,r);var s=new ARRAY_TYPE(3);return getTranslation$1(s,r),fromRotationTranslation(n,i,s),n}function copy$1(n,r){return n[0]=r[0],n[1]=r[1],n[2]=r[2],n[3]=r[3],n[4]=r[4],n[5]=r[5],n[6]=r[6],n[7]=r[7],n}function identity(n){return n[0]=0,n[1]=0,n[2]=0,n[3]=1,n[4]=0,n[5]=0,n[6]=0,n[7]=0,n}function set$1(n,r,i,s,a,o,l,u,f){return n[0]=r,n[1]=i,n[2]=s,n[3]=a,n[4]=o,n[5]=l,n[6]=u,n[7]=f,n}var getReal=copy$2;function getDual(n,r){return n[0]=r[4],n[1]=r[5],n[2]=r[6],n[3]=r[7],n}var setReal=copy$2;function setDual(n,r){return n[4]=r[0],n[5]=r[1],n[6]=r[2],n[7]=r[3],n}function getTranslation(n,r){var i=r[4],s=r[5],a=r[6],o=r[7],l=-r[0],u=-r[1],f=-r[2],c=r[3];return n[0]=(i*c+o*l+s*f-a*u)*2,n[1]=(s*c+o*u+a*l-i*f)*2,n[2]=(a*c+o*f+i*u-s*l)*2,n}function translate(n,r,i){var s=r[0],a=r[1],o=r[2],l=r[3],u=i[0]*.5,f=i[1]*.5,c=i[2]*.5,h=r[4],p=r[5],d=r[6],v=r[7];return n[0]=s,n[1]=a,n[2]=o,n[3]=l,n[4]=l*u+a*c-o*f+h,n[5]=l*f+o*u-s*c+p,n[6]=l*c+s*f-a*u+d,n[7]=-s*u-a*f-o*c+v,n}function rotateX(n,r,i){var s=-r[0],a=-r[1],o=-r[2],l=r[3],u=r[4],f=r[5],c=r[6],h=r[7],p=u*l+h*s+f*o-c*a,d=f*l+h*a+c*s-u*o,v=c*l+h*o+u*a-f*s,g=h*l-u*s-f*a-c*o;return rotateX$1(n,r,i),s=n[0],a=n[1],o=n[2],l=n[3],n[4]=p*l+g*s+d*o-v*a,n[5]=d*l+g*a+v*s-p*o,n[6]=v*l+g*o+p*a-d*s,n[7]=g*l-p*s-d*a-v*o,n}function rotateY(n,r,i){var s=-r[0],a=-r[1],o=-r[2],l=r[3],u=r[4],f=r[5],c=r[6],h=r[7],p=u*l+h*s+f*o-c*a,d=f*l+h*a+c*s-u*o,v=c*l+h*o+u*a-f*s,g=h*l-u*s-f*a-c*o;return rotateY$1(n,r,i),s=n[0],a=n[1],o=n[2],l=n[3],n[4]=p*l+g*s+d*o-v*a,n[5]=d*l+g*a+v*s-p*o,n[6]=v*l+g*o+p*a-d*s,n[7]=g*l-p*s-d*a-v*o,n}function rotateZ(n,r,i){var s=-r[0],a=-r[1],o=-r[2],l=r[3],u=r[4],f=r[5],c=r[6],h=r[7],p=u*l+h*s+f*o-c*a,d=f*l+h*a+c*s-u*o,v=c*l+h*o+u*a-f*s,g=h*l-u*s-f*a-c*o;return rotateZ$1(n,r,i),s=n[0],a=n[1],o=n[2],l=n[3],n[4]=p*l+g*s+d*o-v*a,n[5]=d*l+g*a+v*s-p*o,n[6]=v*l+g*o+p*a-d*s,n[7]=g*l-p*s-d*a-v*o,n}function rotateByQuatAppend(n,r,i){var s=i[0],a=i[1],o=i[2],l=i[3],u=r[0],f=r[1],c=r[2],h=r[3];return n[0]=u*l+h*s+f*o-c*a,n[1]=f*l+h*a+c*s-u*o,n[2]=c*l+h*o+u*a-f*s,n[3]=h*l-u*s-f*a-c*o,u=r[4],f=r[5],c=r[6],h=r[7],n[4]=u*l+h*s+f*o-c*a,n[5]=f*l+h*a+c*s-u*o,n[6]=c*l+h*o+u*a-f*s,n[7]=h*l-u*s-f*a-c*o,n}function rotateByQuatPrepend(n,r,i){var s=r[0],a=r[1],o=r[2],l=r[3],u=i[0],f=i[1],c=i[2],h=i[3];return n[0]=s*h+l*u+a*c-o*f,n[1]=a*h+l*f+o*u-s*c,n[2]=o*h+l*c+s*f-a*u,n[3]=l*h-s*u-a*f-o*c,u=i[4],f=i[5],c=i[6],h=i[7],n[4]=s*h+l*u+a*c-o*f,n[5]=a*h+l*f+o*u-s*c,n[6]=o*h+l*c+s*f-a*u,n[7]=l*h-s*u-a*f-o*c,n}function rotateAroundAxis(n,r,i,s){if(Math.abs(s)<EPSILON)return copy$1(n,r);var a=Math.hypot(i[0],i[1],i[2]);s=s*.5;var o=Math.sin(s),l=o*i[0]/a,u=o*i[1]/a,f=o*i[2]/a,c=Math.cos(s),h=r[0],p=r[1],d=r[2],v=r[3];n[0]=h*c+v*l+p*f-d*u,n[1]=p*c+v*u+d*l-h*f,n[2]=d*c+v*f+h*u-p*l,n[3]=v*c-h*l-p*u-d*f;var g=r[4],m=r[5],y=r[6],b=r[7];return n[4]=g*c+b*l+m*f-y*u,n[5]=m*c+b*u+y*l-g*f,n[6]=y*c+b*f+g*u-m*l,n[7]=b*c-g*l-m*u-y*f,n}function add$1(n,r,i){return n[0]=r[0]+i[0],n[1]=r[1]+i[1],n[2]=r[2]+i[2],n[3]=r[3]+i[3],n[4]=r[4]+i[4],n[5]=r[5]+i[5],n[6]=r[6]+i[6],n[7]=r[7]+i[7],n}function multiply$1(n,r,i){var s=r[0],a=r[1],o=r[2],l=r[3],u=i[4],f=i[5],c=i[6],h=i[7],p=r[4],d=r[5],v=r[6],g=r[7],m=i[0],y=i[1],b=i[2],_=i[3];return n[0]=s*_+l*m+a*b-o*y,n[1]=a*_+l*y+o*m-s*b,n[2]=o*_+l*b+s*y-a*m,n[3]=l*_-s*m-a*y-o*b,n[4]=s*h+l*u+a*c-o*f+p*_+g*m+d*b-v*y,n[5]=a*h+l*f+o*u-s*c+d*_+g*y+v*m-p*b,n[6]=o*h+l*c+s*f-a*u+v*_+g*b+p*y-d*m,n[7]=l*h-s*u-a*f-o*c+g*_-p*m-d*y-v*b,n}var mul$1=multiply$1;function scale$1(n,r,i){return n[0]=r[0]*i,n[1]=r[1]*i,n[2]=r[2]*i,n[3]=r[3]*i,n[4]=r[4]*i,n[5]=r[5]*i,n[6]=r[6]*i,n[7]=r[7]*i,n}var dot$1=dot$2;function lerp$1(n,r,i,s){var a=1-s;return dot$1(r,i)<0&&(s=-s),n[0]=r[0]*a+i[0]*s,n[1]=r[1]*a+i[1]*s,n[2]=r[2]*a+i[2]*s,n[3]=r[3]*a+i[3]*s,n[4]=r[4]*a+i[4]*s,n[5]=r[5]*a+i[5]*s,n[6]=r[6]*a+i[6]*s,n[7]=r[7]*a+i[7]*s,n}function invert(n,r){var i=squaredLength$1(r);return n[0]=-r[0]/i,n[1]=-r[1]/i,n[2]=-r[2]/i,n[3]=r[3]/i,n[4]=-r[4]/i,n[5]=-r[5]/i,n[6]=-r[6]/i,n[7]=r[7]/i,n}function conjugate(n,r){return n[0]=-r[0],n[1]=-r[1],n[2]=-r[2],n[3]=r[3],n[4]=-r[4],n[5]=-r[5],n[6]=-r[6],n[7]=r[7],n}var length$1=length$2,len$1=length$1,squaredLength$1=squaredLength$2,sqrLen$1=squaredLength$1;function normalize$1(n,r){var i=squaredLength$1(r);if(i>0){i=Math.sqrt(i);var s=r[0]/i,a=r[1]/i,o=r[2]/i,l=r[3]/i,u=r[4],f=r[5],c=r[6],h=r[7],p=s*u+a*f+o*c+l*h;n[0]=s,n[1]=a,n[2]=o,n[3]=l,n[4]=(u-s*p)/i,n[5]=(f-a*p)/i,n[6]=(c-o*p)/i,n[7]=(h-l*p)/i}return n}function str$1(n){return"quat2("+n[0]+", "+n[1]+", "+n[2]+", "+n[3]+", "+n[4]+", "+n[5]+", "+n[6]+", "+n[7]+")"}function exactEquals$1(n,r){return n[0]===r[0]&&n[1]===r[1]&&n[2]===r[2]&&n[3]===r[3]&&n[4]===r[4]&&n[5]===r[5]&&n[6]===r[6]&&n[7]===r[7]}function equals$1(n,r){var i=n[0],s=n[1],a=n[2],o=n[3],l=n[4],u=n[5],f=n[6],c=n[7],h=r[0],p=r[1],d=r[2],v=r[3],g=r[4],m=r[5],y=r[6],b=r[7];return Math.abs(i-h)<=EPSILON*Math.max(1,Math.abs(i),Math.abs(h))&&Math.abs(s-p)<=EPSILON*Math.max(1,Math.abs(s),Math.abs(p))&&Math.abs(a-d)<=EPSILON*Math.max(1,Math.abs(a),Math.abs(d))&&Math.abs(o-v)<=EPSILON*Math.max(1,Math.abs(o),Math.abs(v))&&Math.abs(l-g)<=EPSILON*Math.max(1,Math.abs(l),Math.abs(g))&&Math.abs(u-m)<=EPSILON*Math.max(1,Math.abs(u),Math.abs(m))&&Math.abs(f-y)<=EPSILON*Math.max(1,Math.abs(f),Math.abs(y))&&Math.abs(c-b)<=EPSILON*Math.max(1,Math.abs(c),Math.abs(b))}var quat2=Object.freeze({__proto__:null,create:create$1,clone:clone$1,fromValues:fromValues$1,fromRotationTranslationValues:fromRotationTranslationValues,fromRotationTranslation:fromRotationTranslation,fromTranslation:fromTranslation,fromRotation:fromRotation,fromMat4:fromMat4,copy:copy$1,identity:identity,set:set$1,getReal:getReal,getDual:getDual,setReal:setReal,setDual:setDual,getTranslation:getTranslation,translate:translate,rotateX:rotateX,rotateY:rotateY,rotateZ:rotateZ,rotateByQuatAppend:rotateByQuatAppend,rotateByQuatPrepend:rotateByQuatPrepend,rotateAroundAxis:rotateAroundAxis,add:add$1,multiply:multiply$1,mul:mul$1,scale:scale$1,dot:dot$1,lerp:lerp$1,invert:invert,conjugate:conjugate,length:length$1,len:len$1,squaredLength:squaredLength$1,sqrLen:sqrLen$1,normalize:normalize$1,str:str$1,exactEquals:exactEquals$1,equals:equals$1});function create(){var n=new ARRAY_TYPE(2);return ARRAY_TYPE!=Float32Array&&(n[0]=0,n[1]=0),n}function clone(n){var r=new ARRAY_TYPE(2);return r[0]=n[0],r[1]=n[1],r}function fromValues(n,r){var i=new ARRAY_TYPE(2);return i[0]=n,i[1]=r,i}function copy(n,r){return n[0]=r[0],n[1]=r[1],n}function set(n,r,i){return n[0]=r,n[1]=i,n}function add(n,r,i){return n[0]=r[0]+i[0],n[1]=r[1]+i[1],n}function subtract(n,r,i){return n[0]=r[0]-i[0],n[1]=r[1]-i[1],n}function multiply(n,r,i){return n[0]=r[0]*i[0],n[1]=r[1]*i[1],n}function divide(n,r,i){return n[0]=r[0]/i[0],n[1]=r[1]/i[1],n}function ceil(n,r){return n[0]=Math.ceil(r[0]),n[1]=Math.ceil(r[1]),n}function floor(n,r){return n[0]=Math.floor(r[0]),n[1]=Math.floor(r[1]),n}function min(n,r,i){return n[0]=Math.min(r[0],i[0]),n[1]=Math.min(r[1],i[1]),n}function max(n,r,i){return n[0]=Math.max(r[0],i[0]),n[1]=Math.max(r[1],i[1]),n}function round(n,r){return n[0]=Math.round(r[0]),n[1]=Math.round(r[1]),n}function scale(n,r,i){return n[0]=r[0]*i,n[1]=r[1]*i,n}function scaleAndAdd(n,r,i,s){return n[0]=r[0]+i[0]*s,n[1]=r[1]+i[1]*s,n}function distance(n,r){var i=r[0]-n[0],s=r[1]-n[1];return Math.hypot(i,s)}function squaredDistance(n,r){var i=r[0]-n[0],s=r[1]-n[1];return i*i+s*s}function length(n){var r=n[0],i=n[1];return Math.hypot(r,i)}function squaredLength(n){var r=n[0],i=n[1];return r*r+i*i}function negate(n,r){return n[0]=-r[0],n[1]=-r[1],n}function inverse(n,r){return n[0]=1/r[0],n[1]=1/r[1],n}function normalize(n,r){var i=r[0],s=r[1],a=i*i+s*s;return a>0&&(a=1/Math.sqrt(a)),n[0]=r[0]*a,n[1]=r[1]*a,n}function dot(n,r){return n[0]*r[0]+n[1]*r[1]}function cross(n,r,i){var s=r[0]*i[1]-r[1]*i[0];return n[0]=n[1]=0,n[2]=s,n}function lerp(n,r,i,s){var a=r[0],o=r[1];return n[0]=a+s*(i[0]-a),n[1]=o+s*(i[1]-o),n}function random(n,r){r=r||1;var i=RANDOM()*2*Math.PI;return n[0]=Math.cos(i)*r,n[1]=Math.sin(i)*r,n}function transformMat2(n,r,i){var s=r[0],a=r[1];return n[0]=i[0]*s+i[2]*a,n[1]=i[1]*s+i[3]*a,n}function transformMat2d(n,r,i){var s=r[0],a=r[1];return n[0]=i[0]*s+i[2]*a+i[4],n[1]=i[1]*s+i[3]*a+i[5],n}function transformMat3(n,r,i){var s=r[0],a=r[1];return n[0]=i[0]*s+i[3]*a+i[6],n[1]=i[1]*s+i[4]*a+i[7],n}function transformMat4(n,r,i){var s=r[0],a=r[1];return n[0]=i[0]*s+i[4]*a+i[12],n[1]=i[1]*s+i[5]*a+i[13],n}function rotate(n,r,i,s){var a=r[0]-i[0],o=r[1]-i[1],l=Math.sin(s),u=Math.cos(s);return n[0]=a*u-o*l+i[0],n[1]=a*l+o*u+i[1],n}function angle(n,r){var i=n[0],s=n[1],a=r[0],o=r[1],l=Math.sqrt(i*i+s*s)*Math.sqrt(a*a+o*o),u=l&&(i*a+s*o)/l;return Math.acos(Math.min(Math.max(u,-1),1))}function zero(n){return n[0]=0,n[1]=0,n}function str(n){return"vec2("+n[0]+", "+n[1]+")"}function exactEquals(n,r){return n[0]===r[0]&&n[1]===r[1]}function equals(n,r){var i=n[0],s=n[1],a=r[0],o=r[1];return Math.abs(i-a)<=EPSILON*Math.max(1,Math.abs(i),Math.abs(a))&&Math.abs(s-o)<=EPSILON*Math.max(1,Math.abs(s),Math.abs(o))}var len=length,sub=subtract,mul=multiply,div=divide,dist=distance,sqrDist=squaredDistance,sqrLen=squaredLength,forEach=function(){var n=create();return function(r,i,s,a,o,l){var u,f;for(i||(i=2),s||(s=0),a?f=Math.min(a*i+s,r.length):f=r.length,u=s;u<f;u+=i)n[0]=r[u],n[1]=r[u+1],o(n,n,l),r[u]=n[0],r[u+1]=n[1];return r}}(),vec2=Object.freeze({__proto__:null,create:create,clone:clone,fromValues:fromValues,copy:copy,set:set,add:add,subtract:subtract,multiply:multiply,divide:divide,ceil:ceil,floor:floor,min:min,max:max,round:round,scale:scale,scaleAndAdd:scaleAndAdd,distance:distance,squaredDistance:squaredDistance,length:length,squaredLength:squaredLength,negate:negate,inverse:inverse,normalize:normalize,dot:dot,cross:cross,lerp:lerp,random:random,transformMat2:transformMat2,transformMat2d:transformMat2d,transformMat3:transformMat3,transformMat4:transformMat4,rotate:rotate,angle:angle,zero:zero,str:str,exactEquals:exactEquals,equals:equals,len:len,sub:sub,mul:mul,div:div,dist:dist,sqrDist:sqrDist,sqrLen:sqrLen,forEach:forEach}),esm=Object.freeze({__proto__:null,glMatrix:common,mat2:mat2,mat2d:mat2d,mat3:mat3,mat4:mat4,quat:quat,quat2:quat2,vec2:vec2,vec3:vec3,vec4:vec4}),require$$6=getAugmentedNamespace(esm);function _instanceof$1(n,r){return r!=null&&typeof Symbol!="undefined"&&r[Symbol.hasInstance]?!!r[Symbol.hasInstance](n):n instanceof r}var _typeof$1=function(n){return n&&typeof Symbol!="undefined"&&n.constructor===Symbol?"symbol":typeof n};function ___$insertStyle(n){if(!!n&&typeof window!="undefined"){var r=document.createElement("style");return r.setAttribute("type","text/css"),r.innerHTML=n,document.head.appendChild(r),n}}function colorToString(n,r){var i=n.__state.conversionName.toString(),s=Math.round(n.r),a=Math.round(n.g),o=Math.round(n.b),l=n.a,u=Math.round(n.h),f=n.s.toFixed(1),c=n.v.toFixed(1);if(r||i==="THREE_CHAR_HEX"||i==="SIX_CHAR_HEX"){for(var h=n.hex.toString(16);h.length<6;)h="0"+h;return"#"+h}else{if(i==="CSS_RGB")return"rgb("+s+","+a+","+o+")";if(i==="CSS_RGBA")return"rgba("+s+","+a+","+o+","+l+")";if(i==="HEX")return"0x"+n.hex.toString(16);if(i==="RGB_ARRAY")return"["+s+","+a+","+o+"]";if(i==="RGBA_ARRAY")return"["+s+","+a+","+o+","+l+"]";if(i==="RGB_OBJ")return"{r:"+s+",g:"+a+",b:"+o+"}";if(i==="RGBA_OBJ")return"{r:"+s+",g:"+a+",b:"+o+",a:"+l+"}";if(i==="HSV_OBJ")return"{h:"+u+",s:"+f+",v:"+c+"}";if(i==="HSVA_OBJ")return"{h:"+u+",s:"+f+",v:"+c+",a:"+l+"}"}return"unknown format"}var ARR_EACH=Array.prototype.forEach,ARR_SLICE=Array.prototype.slice,Common={BREAK:{},extend:function(r){return this.each(ARR_SLICE.call(arguments,1),function(i){var s=this.isObject(i)?Object.keys(i):[];s.forEach(function(a){this.isUndefined(i[a])||(r[a]=i[a])}.bind(this))},this),r},defaults:function(r){return this.each(ARR_SLICE.call(arguments,1),function(i){var s=this.isObject(i)?Object.keys(i):[];s.forEach(function(a){this.isUndefined(r[a])&&(r[a]=i[a])}.bind(this))},this),r},compose:function(){var r=ARR_SLICE.call(arguments);return function(){for(var i=ARR_SLICE.call(arguments),s=r.length-1;s>=0;s--)i=[r[s].apply(this,i)];return i[0]}},each:function(r,i,s){if(!!r){if(ARR_EACH&&r.forEach&&r.forEach===ARR_EACH)r.forEach(i,s);else if(r.length===r.length+0){var a=void 0,o=void 0;for(a=0,o=r.length;a<o;a++)if(a in r&&i.call(s,r[a],a)===this.BREAK)return}else for(var l in r)if(i.call(s,r[l],l)===this.BREAK)return}},defer:function(r){setTimeout(r,0)},debounce:function(r,i,s){var a=void 0;return function(){var o=function(){a=null,s||r.apply(l,u)},l=this,u=arguments,f=s||!a;clearTimeout(a),a=setTimeout(o,i),f&&r.apply(l,u)}},toArray:function(r){return r.toArray?r.toArray():ARR_SLICE.call(r)},isUndefined:function(r){return r===void 0},isNull:function(r){return r===null},isNaN:function(n){var r=function(s){return n.apply(this,arguments)};return r.toString=function(){return n.toString()},r}(function(n){return isNaN(n)}),isArray:Array.isArray||function(n){return n.constructor===Array},isObject:function(r){return r===Object(r)},isNumber:function(r){return r===r+0},isString:function(r){return r===r+""},isBoolean:function(r){return r===!1||r===!0},isFunction:function(r){return _instanceof$1(r,Function)}},INTERPRETATIONS=[{litmus:Common.isString,conversions:{THREE_CHAR_HEX:{read:function(r){var i=r.match(/^#([A-F0-9])([A-F0-9])([A-F0-9])$/i);return i===null?!1:{space:"HEX",hex:parseInt("0x"+i[1].toString()+i[1].toString()+i[2].toString()+i[2].toString()+i[3].toString()+i[3].toString(),0)}},write:colorToString},SIX_CHAR_HEX:{read:function(r){var i=r.match(/^#([A-F0-9]{6})$/i);return i===null?!1:{space:"HEX",hex:parseInt("0x"+i[1].toString(),0)}},write:colorToString},CSS_RGB:{read:function(r){var i=r.match(/^rgb\(\s*(\S+)\s*,\s*(\S+)\s*,\s*(\S+)\s*\)/);return i===null?!1:{space:"RGB",r:parseFloat(i[1]),g:parseFloat(i[2]),b:parseFloat(i[3])}},write:colorToString},CSS_RGBA:{read:function(r){var i=r.match(/^rgba\(\s*(\S+)\s*,\s*(\S+)\s*,\s*(\S+)\s*,\s*(\S+)\s*\)/);return i===null?!1:{space:"RGB",r:parseFloat(i[1]),g:parseFloat(i[2]),b:parseFloat(i[3]),a:parseFloat(i[4])}},write:colorToString}}},{litmus:Common.isNumber,conversions:{HEX:{read:function(r){return{space:"HEX",hex:r,conversionName:"HEX"}},write:function(r){return r.hex}}}},{litmus:Common.isArray,conversions:{RGB_ARRAY:{read:function(r){return r.length!==3?!1:{space:"RGB",r:r[0],g:r[1],b:r[2]}},write:function(r){return[r.r,r.g,r.b]}},RGBA_ARRAY:{read:function(r){return r.length!==4?!1:{space:"RGB",r:r[0],g:r[1],b:r[2],a:r[3]}},write:function(r){return[r.r,r.g,r.b,r.a]}}}},{litmus:Common.isObject,conversions:{RGBA_OBJ:{read:function(r){return Common.isNumber(r.r)&&Common.isNumber(r.g)&&Common.isNumber(r.b)&&Common.isNumber(r.a)?{space:"RGB",r:r.r,g:r.g,b:r.b,a:r.a}:!1},write:function(r){return{r:r.r,g:r.g,b:r.b,a:r.a}}},RGB_OBJ:{read:function(r){return Common.isNumber(r.r)&&Common.isNumber(r.g)&&Common.isNumber(r.b)?{space:"RGB",r:r.r,g:r.g,b:r.b}:!1},write:function(r){return{r:r.r,g:r.g,b:r.b}}},HSVA_OBJ:{read:function(r){return Common.isNumber(r.h)&&Common.isNumber(r.s)&&Common.isNumber(r.v)&&Common.isNumber(r.a)?{space:"HSV",h:r.h,s:r.s,v:r.v,a:r.a}:!1},write:function(r){return{h:r.h,s:r.s,v:r.v,a:r.a}}},HSV_OBJ:{read:function(r){return Common.isNumber(r.h)&&Common.isNumber(r.s)&&Common.isNumber(r.v)?{space:"HSV",h:r.h,s:r.s,v:r.v}:!1},write:function(r){return{h:r.h,s:r.s,v:r.v}}}}}],result=void 0,toReturn=void 0,interpret=function(){toReturn=!1;var r=arguments.length>1?Common.toArray(arguments):arguments[0];return Common.each(INTERPRETATIONS,function(i){if(i.litmus(r))return Common.each(i.conversions,function(s,a){if(result=s.read(r),toReturn===!1&&result!==!1)return toReturn=result,result.conversionName=a,result.conversion=s,Common.BREAK}),Common.BREAK}),toReturn},tmpComponent=void 0,ColorMath={hsv_to_rgb:function(r,i,s){var a=Math.floor(r/60)%6,o=r/60-Math.floor(r/60),l=s*(1-i),u=s*(1-o*i),f=s*(1-(1-o)*i),c=[[s,f,l],[u,s,l],[l,s,f],[l,u,s],[f,l,s],[s,l,u]][a];return{r:c[0]*255,g:c[1]*255,b:c[2]*255}},rgb_to_hsv:function(r,i,s){var a=Math.min(r,i,s),o=Math.max(r,i,s),l=o-a,u=void 0,f=void 0;if(o!==0)f=l/o;else return{h:NaN,s:0,v:0};return r===o?u=(i-s)/l:i===o?u=2+(s-r)/l:u=4+(r-i)/l,u/=6,u<0&&(u+=1),{h:u*360,s:f,v:o/255}},rgb_to_hex:function(r,i,s){var a=this.hex_with_component(0,2,r);return a=this.hex_with_component(a,1,i),a=this.hex_with_component(a,0,s),a},component_from_hex:function(r,i){return r>>i*8&255},hex_with_component:function(r,i,s){return s<<(tmpComponent=i*8)|r&~(255<<tmpComponent)}},_$_typeof=typeof Symbol=="function"&&_typeof$1(Symbol.iterator)==="symbol"?function(r){return typeof r=="undefined"?"undefined":_typeof$1(r)}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n=="undefined"?"undefined":_typeof$1(n)},classCallCheck=function(r,i){if(!_instanceof$1(r,i))throw new TypeError("Cannot call a class as a function")},createClass=function(){var n=function(i,s){for(var a=0;a<s.length;a++){var o=s[a];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(i,o.key,o)}};return function(r,i,s){return i&&n(r.prototype,i),s&&n(r,s),r}}(),get=function n(r,i,s){r===null&&(r=Function.prototype);var a=Object.getOwnPropertyDescriptor(r,i);if(a===void 0){var o=Object.getPrototypeOf(r);return o===null?void 0:n(o,i,s)}else{if("value"in a)return a.value;var l=a.get;return l===void 0?void 0:l.call(s)}},inherits=function(r,i){if(typeof i!="function"&&i!==null)throw new TypeError("Super expression must either be null or a function, not "+(typeof i=="undefined"?"undefined":_typeof$1(i)));r.prototype=Object.create(i&&i.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),i&&(Object.setPrototypeOf?Object.setPrototypeOf(r,i):r.__proto__=i)},possibleConstructorReturn=function(r,i){if(!r)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return i&&(typeof i=="object"||typeof i=="function")?i:r},Color=function(){function n(){if(classCallCheck(this,n),this.__state=interpret.apply(this,arguments),this.__state===!1)throw new Error("Failed to interpret color arguments");this.__state.a=this.__state.a||1}return createClass(n,[{key:"toString",value:function(){return colorToString(this)}},{key:"toHexString",value:function(){return colorToString(this,!0)}},{key:"toOriginal",value:function(){return this.__state.conversion.write(this)}}]),n}();function defineRGBComponent(n,r,i){Object.defineProperty(n,r,{get:function(){return this.__state.space==="RGB"?this.__state[r]:(Color.recalculateRGB(this,r,i),this.__state[r])},set:function(a){this.__state.space!=="RGB"&&(Color.recalculateRGB(this,r,i),this.__state.space="RGB"),this.__state[r]=a}})}function defineHSVComponent(n,r){Object.defineProperty(n,r,{get:function(){return this.__state.space==="HSV"?this.__state[r]:(Color.recalculateHSV(this),this.__state[r])},set:function(s){this.__state.space!=="HSV"&&(Color.recalculateHSV(this),this.__state.space="HSV"),this.__state[r]=s}})}Color.recalculateRGB=function(n,r,i){if(n.__state.space==="HEX")n.__state[r]=ColorMath.component_from_hex(n.__state.hex,i);else if(n.__state.space==="HSV")Common.extend(n.__state,ColorMath.hsv_to_rgb(n.__state.h,n.__state.s,n.__state.v));else throw new Error("Corrupted color state")},Color.recalculateHSV=function(n){var r=ColorMath.rgb_to_hsv(n.r,n.g,n.b);Common.extend(n.__state,{s:r.s,v:r.v}),Common.isNaN(r.h)?Common.isUndefined(n.__state.h)&&(n.__state.h=0):n.__state.h=r.h},Color.COMPONENTS=["r","g","b","h","s","v","hex","a"],defineRGBComponent(Color.prototype,"r",2),defineRGBComponent(Color.prototype,"g",1),defineRGBComponent(Color.prototype,"b",0),defineHSVComponent(Color.prototype,"h"),defineHSVComponent(Color.prototype,"s"),defineHSVComponent(Color.prototype,"v"),Object.defineProperty(Color.prototype,"a",{get:function(){return this.__state.a},set:function(r){this.__state.a=r}}),Object.defineProperty(Color.prototype,"hex",{get:function(){return this.__state.space!=="HEX"&&(this.__state.hex=ColorMath.rgb_to_hex(this.r,this.g,this.b),this.__state.space="HEX"),this.__state.hex},set:function(r){this.__state.space="HEX",this.__state.hex=r}});var Controller=function(){function n(r,i){classCallCheck(this,n),this.initialValue=r[i],this.domElement=document.createElement("div"),this.object=r,this.property=i,this.__onChange=void 0,this.__onFinishChange=void 0}return createClass(n,[{key:"onChange",value:function(i){return this.__onChange=i,this}},{key:"onFinishChange",value:function(i){return this.__onFinishChange=i,this}},{key:"setValue",value:function(i){return this.object[this.property]=i,this.__onChange&&this.__onChange.call(this,i),this.updateDisplay(),this}},{key:"getValue",value:function(){return this.object[this.property]}},{key:"updateDisplay",value:function(){return this}},{key:"isModified",value:function(){return this.initialValue!==this.getValue()}}]),n}(),EVENT_MAP={HTMLEvents:["change"],MouseEvents:["click","mousemove","mousedown","mouseup","mouseover"],KeyboardEvents:["keydown"]},EVENT_MAP_INV={};Common.each(EVENT_MAP,function(n,r){Common.each(n,function(i){EVENT_MAP_INV[i]=r})});var CSS_VALUE_PIXELS=/(\d+(\.\d+)?)px/;function cssValueToPixels(n){if(n==="0"||Common.isUndefined(n))return 0;var r=n.match(CSS_VALUE_PIXELS);return Common.isNull(r)?0:parseFloat(r[1])}var dom={makeSelectable:function(r,i){r===void 0||r.style===void 0||(r.onselectstart=i?function(){return!1}:function(){},r.style.MozUserSelect=i?"auto":"none",r.style.KhtmlUserSelect=i?"auto":"none",r.unselectable=i?"on":"off")},makeFullscreen:function(r,i,s){var a=s,o=i;Common.isUndefined(o)&&(o=!0),Common.isUndefined(a)&&(a=!0),r.style.position="absolute",o&&(r.style.left=0,r.style.right=0),a&&(r.style.top=0,r.style.bottom=0)},fakeEvent:function(r,i,s,a){var o=s||{},l=EVENT_MAP_INV[i];if(!l)throw new Error("Event type "+i+" not supported.");var u=document.createEvent(l);switch(l){case"MouseEvents":{var f=o.x||o.clientX||0,c=o.y||o.clientY||0;u.initMouseEvent(i,o.bubbles||!1,o.cancelable||!0,window,o.clickCount||1,0,0,f,c,!1,!1,!1,!1,0,null);break}case"KeyboardEvents":{var h=u.initKeyboardEvent||u.initKeyEvent;Common.defaults(o,{cancelable:!0,ctrlKey:!1,altKey:!1,shiftKey:!1,metaKey:!1,keyCode:void 0,charCode:void 0}),h(i,o.bubbles||!1,o.cancelable,window,o.ctrlKey,o.altKey,o.shiftKey,o.metaKey,o.keyCode,o.charCode);break}default:{u.initEvent(i,o.bubbles||!1,o.cancelable||!0);break}}Common.defaults(u,a),r.dispatchEvent(u)},bind:function(r,i,s,a){var o=a||!1;return r.addEventListener?r.addEventListener(i,s,o):r.attachEvent&&r.attachEvent("on"+i,s),dom},unbind:function(r,i,s,a){var o=a||!1;return r.removeEventListener?r.removeEventListener(i,s,o):r.detachEvent&&r.detachEvent("on"+i,s),dom},addClass:function(r,i){if(r.className===void 0)r.className=i;else if(r.className!==i){var s=r.className.split(/ +/);s.indexOf(i)===-1&&(s.push(i),r.className=s.join(" ").replace(/^\s+/,"").replace(/\s+$/,""))}return dom},removeClass:function(r,i){if(i)if(r.className===i)r.removeAttribute("class");else{var s=r.className.split(/ +/),a=s.indexOf(i);a!==-1&&(s.splice(a,1),r.className=s.join(" "))}else r.className=void 0;return dom},hasClass:function(r,i){return new RegExp("(?:^|\\s+)"+i+"(?:\\s+|$)").test(r.className)||!1},getWidth:function(r){var i=getComputedStyle(r);return cssValueToPixels(i["border-left-width"])+cssValueToPixels(i["border-right-width"])+cssValueToPixels(i["padding-left"])+cssValueToPixels(i["padding-right"])+cssValueToPixels(i.width)},getHeight:function(r){var i=getComputedStyle(r);return cssValueToPixels(i["border-top-width"])+cssValueToPixels(i["border-bottom-width"])+cssValueToPixels(i["padding-top"])+cssValueToPixels(i["padding-bottom"])+cssValueToPixels(i.height)},getOffset:function(r){var i=r,s={left:0,top:0};if(i.offsetParent)do s.left+=i.offsetLeft,s.top+=i.offsetTop,i=i.offsetParent;while(i);return s},isActive:function(r){return r===document.activeElement&&(r.type||r.href)}},BooleanController=function(n){inherits(r,n);function r(i,s){classCallCheck(this,r);var a=possibleConstructorReturn(this,(r.__proto__||Object.getPrototypeOf(r)).call(this,i,s)),o=a;a.__prev=a.getValue(),a.__checkbox=document.createElement("input"),a.__checkbox.setAttribute("type","checkbox");function l(){o.setValue(!o.__prev)}return dom.bind(a.__checkbox,"change",l,!1),a.domElement.appendChild(a.__checkbox),a.updateDisplay(),a}return createClass(r,[{key:"setValue",value:function(s){var a=get(r.prototype.__proto__||Object.getPrototypeOf(r.prototype),"setValue",this).call(this,s);return this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue()),this.__prev=this.getValue(),a}},{key:"updateDisplay",value:function(){return this.getValue()===!0?(this.__checkbox.setAttribute("checked","checked"),this.__checkbox.checked=!0,this.__prev=!0):(this.__checkbox.checked=!1,this.__prev=!1),get(r.prototype.__proto__||Object.getPrototypeOf(r.prototype),"updateDisplay",this).call(this)}}]),r}(Controller),OptionController=function(n){inherits(r,n);function r(i,s,a){classCallCheck(this,r);var o=possibleConstructorReturn(this,(r.__proto__||Object.getPrototypeOf(r)).call(this,i,s)),l=a,u=o;if(o.__select=document.createElement("select"),Common.isArray(l)){var f={};Common.each(l,function(c){f[c]=c}),l=f}return Common.each(l,function(c,h){var p=document.createElement("option");p.innerHTML=h,p.setAttribute("value",c),u.__select.appendChild(p)}),o.updateDisplay(),dom.bind(o.__select,"change",function(){var c=this.options[this.selectedIndex].value;u.setValue(c)}),o.domElement.appendChild(o.__select),o}return createClass(r,[{key:"setValue",value:function(s){var a=get(r.prototype.__proto__||Object.getPrototypeOf(r.prototype),"setValue",this).call(this,s);return this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue()),a}},{key:"updateDisplay",value:function(){return dom.isActive(this.__select)?this:(this.__select.value=this.getValue(),get(r.prototype.__proto__||Object.getPrototypeOf(r.prototype),"updateDisplay",this).call(this))}}]),r}(Controller),StringController=function(n){inherits(r,n);function r(i,s){classCallCheck(this,r);var a=possibleConstructorReturn(this,(r.__proto__||Object.getPrototypeOf(r)).call(this,i,s)),o=a;function l(){o.setValue(o.__input.value)}function u(){o.__onFinishChange&&o.__onFinishChange.call(o,o.getValue())}return a.__input=document.createElement("input"),a.__input.setAttribute("type","text"),dom.bind(a.__input,"keyup",l),dom.bind(a.__input,"change",l),dom.bind(a.__input,"blur",u),dom.bind(a.__input,"keydown",function(f){f.keyCode===13&&this.blur()}),a.updateDisplay(),a.domElement.appendChild(a.__input),a}return createClass(r,[{key:"updateDisplay",value:function(){return dom.isActive(this.__input)||(this.__input.value=this.getValue()),get(r.prototype.__proto__||Object.getPrototypeOf(r.prototype),"updateDisplay",this).call(this)}}]),r}(Controller);function numDecimals(n){var r=n.toString();return r.indexOf(".")>-1?r.length-r.indexOf(".")-1:0}var NumberController=function(n){inherits(r,n);function r(i,s,a){classCallCheck(this,r);var o=possibleConstructorReturn(this,(r.__proto__||Object.getPrototypeOf(r)).call(this,i,s)),l=a||{};return o.__min=l.min,o.__max=l.max,o.__step=l.step,Common.isUndefined(o.__step)?o.initialValue===0?o.__impliedStep=1:o.__impliedStep=Math.pow(10,Math.floor(Math.log(Math.abs(o.initialValue))/Math.LN10))/10:o.__impliedStep=o.__step,o.__precision=numDecimals(o.__impliedStep),o}return createClass(r,[{key:"setValue",value:function(s){var a=s;return this.__min!==void 0&&a<this.__min?a=this.__min:this.__max!==void 0&&a>this.__max&&(a=this.__max),this.__step!==void 0&&a%this.__step!==0&&(a=Math.round(a/this.__step)*this.__step),get(r.prototype.__proto__||Object.getPrototypeOf(r.prototype),"setValue",this).call(this,a)}},{key:"min",value:function(s){return this.__min=s,this}},{key:"max",value:function(s){return this.__max=s,this}},{key:"step",value:function(s){return this.__step=s,this.__impliedStep=s,this.__precision=numDecimals(s),this}}]),r}(Controller);function roundToDecimal(n,r){var i=Math.pow(10,r);return Math.round(n*i)/i}var NumberControllerBox=function(n){inherits(r,n);function r(i,s,a){classCallCheck(this,r);var o=possibleConstructorReturn(this,(r.__proto__||Object.getPrototypeOf(r)).call(this,i,s,a));o.__truncationSuspended=!1;var l=o,u=void 0;function f(){var g=parseFloat(l.__input.value);Common.isNaN(g)||l.setValue(g)}function c(){l.__onFinishChange&&l.__onFinishChange.call(l,l.getValue())}function h(){c()}function p(g){var m=u-g.clientY;l.setValue(l.getValue()+m*l.__impliedStep),u=g.clientY}function d(){dom.unbind(window,"mousemove",p),dom.unbind(window,"mouseup",d),c()}function v(g){dom.bind(window,"mousemove",p),dom.bind(window,"mouseup",d),u=g.clientY}return o.__input=document.createElement("input"),o.__input.setAttribute("type","text"),dom.bind(o.__input,"change",f),dom.bind(o.__input,"blur",h),dom.bind(o.__input,"mousedown",v),dom.bind(o.__input,"keydown",function(g){g.keyCode===13&&(l.__truncationSuspended=!0,this.blur(),l.__truncationSuspended=!1,c())}),o.updateDisplay(),o.domElement.appendChild(o.__input),o}return createClass(r,[{key:"updateDisplay",value:function(){return this.__input.value=this.__truncationSuspended?this.getValue():roundToDecimal(this.getValue(),this.__precision),get(r.prototype.__proto__||Object.getPrototypeOf(r.prototype),"updateDisplay",this).call(this)}}]),r}(NumberController);function map(n,r,i,s,a){return s+(a-s)*((n-r)/(i-r))}var NumberControllerSlider=function(n){inherits(r,n);function r(i,s,a,o,l){classCallCheck(this,r);var u=possibleConstructorReturn(this,(r.__proto__||Object.getPrototypeOf(r)).call(this,i,s,{min:a,max:o,step:l})),f=u;u.__background=document.createElement("div"),u.__foreground=document.createElement("div"),dom.bind(u.__background,"mousedown",c),dom.bind(u.__background,"touchstart",d),dom.addClass(u.__background,"slider"),dom.addClass(u.__foreground,"slider-fg");function c(m){document.activeElement.blur(),dom.bind(window,"mousemove",h),dom.bind(window,"mouseup",p),h(m)}function h(m){m.preventDefault();var y=f.__background.getBoundingClientRect();return f.setValue(map(m.clientX,y.left,y.right,f.__min,f.__max)),!1}function p(){dom.unbind(window,"mousemove",h),dom.unbind(window,"mouseup",p),f.__onFinishChange&&f.__onFinishChange.call(f,f.getValue())}function d(m){m.touches.length===1&&(dom.bind(window,"touchmove",v),dom.bind(window,"touchend",g),v(m))}function v(m){var y=m.touches[0].clientX,b=f.__background.getBoundingClientRect();f.setValue(map(y,b.left,b.right,f.__min,f.__max))}function g(){dom.unbind(window,"touchmove",v),dom.unbind(window,"touchend",g),f.__onFinishChange&&f.__onFinishChange.call(f,f.getValue())}return u.updateDisplay(),u.__background.appendChild(u.__foreground),u.domElement.appendChild(u.__background),u}return createClass(r,[{key:"updateDisplay",value:function(){var s=(this.getValue()-this.__min)/(this.__max-this.__min);return this.__foreground.style.width=s*100+"%",get(r.prototype.__proto__||Object.getPrototypeOf(r.prototype),"updateDisplay",this).call(this)}}]),r}(NumberController),FunctionController=function(n){inherits(r,n);function r(i,s,a){classCallCheck(this,r);var o=possibleConstructorReturn(this,(r.__proto__||Object.getPrototypeOf(r)).call(this,i,s)),l=o;return o.__button=document.createElement("div"),o.__button.innerHTML=a===void 0?"Fire":a,dom.bind(o.__button,"click",function(u){return u.preventDefault(),l.fire(),!1}),dom.addClass(o.__button,"button"),o.domElement.appendChild(o.__button),o}return createClass(r,[{key:"fire",value:function(){this.__onChange&&this.__onChange.call(this),this.getValue().call(this.object),this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue())}}]),r}(Controller),ColorController=function(n){inherits(r,n);function r(i,s){classCallCheck(this,r);var a=possibleConstructorReturn(this,(r.__proto__||Object.getPrototypeOf(r)).call(this,i,s));a.__color=new Color(a.getValue()),a.__temp=new Color(0);var o=a;a.domElement=document.createElement("div"),dom.makeSelectable(a.domElement,!1),a.__selector=document.createElement("div"),a.__selector.className="selector",a.__saturation_field=document.createElement("div"),a.__saturation_field.className="saturation-field",a.__field_knob=document.createElement("div"),a.__field_knob.className="field-knob",a.__field_knob_border="2px solid ",a.__hue_knob=document.createElement("div"),a.__hue_knob.className="hue-knob",a.__hue_field=document.createElement("div"),a.__hue_field.className="hue-field",a.__input=document.createElement("input"),a.__input.type="text",a.__input_textShadow="0 1px 1px ",dom.bind(a.__input,"keydown",function(m){m.keyCode===13&&p.call(this)}),dom.bind(a.__input,"blur",p),dom.bind(a.__selector,"mousedown",function(){dom.addClass(this,"drag").bind(window,"mouseup",function(){dom.removeClass(o.__selector,"drag")})}),dom.bind(a.__selector,"touchstart",function(){dom.addClass(this,"drag").bind(window,"touchend",function(){dom.removeClass(o.__selector,"drag")})});var l=document.createElement("div");Common.extend(a.__selector.style,{width:"122px",height:"102px",padding:"3px",backgroundColor:"#222",boxShadow:"0px 1px 3px rgba(0,0,0,0.3)"}),Common.extend(a.__field_knob.style,{position:"absolute",width:"12px",height:"12px",border:a.__field_knob_border+(a.__color.v<.5?"#fff":"#000"),boxShadow:"0px 1px 3px rgba(0,0,0,0.5)",borderRadius:"12px",zIndex:1}),Common.extend(a.__hue_knob.style,{position:"absolute",width:"15px",height:"2px",borderRight:"4px solid #fff",zIndex:1}),Common.extend(a.__saturation_field.style,{width:"100px",height:"100px",border:"1px solid #555",marginRight:"3px",display:"inline-block",cursor:"pointer"}),Common.extend(l.style,{width:"100%",height:"100%",background:"none"}),linearGradient(l,"top","rgba(0,0,0,0)","#000"),Common.extend(a.__hue_field.style,{width:"15px",height:"100px",border:"1px solid #555",cursor:"ns-resize",position:"absolute",top:"3px",right:"3px"}),hueGradient(a.__hue_field),Common.extend(a.__input.style,{outline:"none",textAlign:"center",color:"#fff",border:0,fontWeight:"bold",textShadow:a.__input_textShadow+"rgba(0,0,0,0.7)"}),dom.bind(a.__saturation_field,"mousedown",u),dom.bind(a.__saturation_field,"touchstart",u),dom.bind(a.__field_knob,"mousedown",u),dom.bind(a.__field_knob,"touchstart",u),dom.bind(a.__hue_field,"mousedown",f),dom.bind(a.__hue_field,"touchstart",f);function u(m){v(m),dom.bind(window,"mousemove",v),dom.bind(window,"touchmove",v),dom.bind(window,"mouseup",c),dom.bind(window,"touchend",c)}function f(m){g(m),dom.bind(window,"mousemove",g),dom.bind(window,"touchmove",g),dom.bind(window,"mouseup",h),dom.bind(window,"touchend",h)}function c(){dom.unbind(window,"mousemove",v),dom.unbind(window,"touchmove",v),dom.unbind(window,"mouseup",c),dom.unbind(window,"touchend",c),d()}function h(){dom.unbind(window,"mousemove",g),dom.unbind(window,"touchmove",g),dom.unbind(window,"mouseup",h),dom.unbind(window,"touchend",h),d()}function p(){var m=interpret(this.value);m!==!1?(o.__color.__state=m,o.setValue(o.__color.toOriginal())):this.value=o.__color.toString()}function d(){o.__onFinishChange&&o.__onFinishChange.call(o,o.__color.toOriginal())}a.__saturation_field.appendChild(l),a.__selector.appendChild(a.__field_knob),a.__selector.appendChild(a.__saturation_field),a.__selector.appendChild(a.__hue_field),a.__hue_field.appendChild(a.__hue_knob),a.domElement.appendChild(a.__input),a.domElement.appendChild(a.__selector),a.updateDisplay();function v(m){m.type.indexOf("touch")===-1&&m.preventDefault();var y=o.__saturation_field.getBoundingClientRect(),b=m.touches&&m.touches[0]||m,_=b.clientX,C=b.clientY,A=(_-y.left)/(y.right-y.left),I=1-(C-y.top)/(y.bottom-y.top);return I>1?I=1:I<0&&(I=0),A>1?A=1:A<0&&(A=0),o.__color.v=I,o.__color.s=A,o.setValue(o.__color.toOriginal()),!1}function g(m){m.type.indexOf("touch")===-1&&m.preventDefault();var y=o.__hue_field.getBoundingClientRect(),b=m.touches&&m.touches[0]||m,_=b.clientY,C=1-(_-y.top)/(y.bottom-y.top);return C>1?C=1:C<0&&(C=0),o.__color.h=C*360,o.setValue(o.__color.toOriginal()),!1}return a}return createClass(r,[{key:"updateDisplay",value:function(){var s=interpret(this.getValue());if(s!==!1){var a=!1;Common.each(Color.COMPONENTS,function(u){if(!Common.isUndefined(s[u])&&!Common.isUndefined(this.__color.__state[u])&&s[u]!==this.__color.__state[u])return a=!0,{}},this),a&&Common.extend(this.__color.__state,s)}Common.extend(this.__temp.__state,this.__color.__state),this.__temp.a=1;var o=this.__color.v<.5||this.__color.s>.5?255:0,l=255-o;Common.extend(this.__field_knob.style,{marginLeft:100*this.__color.s-7+"px",marginTop:100*(1-this.__color.v)-7+"px",backgroundColor:this.__temp.toHexString(),border:this.__field_knob_border+"rgb("+o+","+o+","+o+")"}),this.__hue_knob.style.marginTop=(1-this.__color.h/360)*100+"px",this.__temp.s=1,this.__temp.v=1,linearGradient(this.__saturation_field,"left","#fff",this.__temp.toHexString()),this.__input.value=this.__color.toString(),Common.extend(this.__input.style,{backgroundColor:this.__color.toHexString(),color:"rgb("+o+","+o+","+o+")",textShadow:this.__input_textShadow+"rgba("+l+","+l+","+l+",.7)"})}}]),r}(Controller),vendors=["-moz-","-o-","-webkit-","-ms-",""];function linearGradient(n,r,i,s){n.style.background="",Common.each(vendors,function(a){n.style.cssText+="background: "+a+"linear-gradient("+r+", "+i+" 0%, "+s+" 100%); "})}function hueGradient(n){n.style.background="",n.style.cssText+="background: -moz-linear-gradient(top,  #ff0000 0%, #ff00ff 17%, #0000ff 34%, #00ffff 50%, #00ff00 67%, #ffff00 84%, #ff0000 100%);",n.style.cssText+="background: -webkit-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",n.style.cssText+="background: -o-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",n.style.cssText+="background: -ms-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",n.style.cssText+="background: linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);"}var css={load:function(r,i){var s=i||document,a=s.createElement("link");a.type="text/css",a.rel="stylesheet",a.href=r,s.getElementsByTagName("head")[0].appendChild(a)},inject:function(r,i){var s=i||document,a=document.createElement("style");a.type="text/css",a.innerHTML=r;var o=s.getElementsByTagName("head")[0];try{o.appendChild(a)}catch(l){}}},saveDialogContents='<div id="dg-save" class="dg dialogue">\n\n  Here\'s the new load parameter for your <code>GUI</code>\'s constructor:\n\n  <textarea id="dg-new-constructor"></textarea>\n\n  <div id="dg-save-locally">\n\n    <input id="dg-local-storage" type="checkbox"/> Automatically save\n    values to <code>localStorage</code> on exit.\n\n    <div id="dg-local-explain">The values saved to <code>localStorage</code> will\n      override those passed to <code>dat.GUI</code>\'s constructor. This makes it\n      easier to work incrementally, but <code>localStorage</code> is fragile,\n      and your friends may not see the same values you do.\n\n    </div>\n\n  </div>\n\n</div>',ControllerFactory=function(r,i){var s=r[i];return Common.isArray(arguments[2])||Common.isObject(arguments[2])?new OptionController(r,i,arguments[2]):Common.isNumber(s)?Common.isNumber(arguments[2])&&Common.isNumber(arguments[3])?Common.isNumber(arguments[4])?new NumberControllerSlider(r,i,arguments[2],arguments[3],arguments[4]):new NumberControllerSlider(r,i,arguments[2],arguments[3]):Common.isNumber(arguments[4])?new NumberControllerBox(r,i,{min:arguments[2],max:arguments[3],step:arguments[4]}):new NumberControllerBox(r,i,{min:arguments[2],max:arguments[3]}):Common.isString(s)?new StringController(r,i):Common.isFunction(s)?new FunctionController(r,i,""):Common.isBoolean(s)?new BooleanController(r,i):null};function requestAnimationFrame$1(n){setTimeout(n,1e3/60)}var requestAnimationFrame$1$1=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||requestAnimationFrame$1,CenteredDiv=function(){function n(){classCallCheck(this,n),this.backgroundElement=document.createElement("div"),Common.extend(this.backgroundElement.style,{backgroundColor:"rgba(0,0,0,0.8)",top:0,left:0,display:"none",zIndex:"1000",opacity:0,WebkitTransition:"opacity 0.2s linear",transition:"opacity 0.2s linear"}),dom.makeFullscreen(this.backgroundElement),this.backgroundElement.style.position="fixed",this.domElement=document.createElement("div"),Common.extend(this.domElement.style,{position:"fixed",display:"none",zIndex:"1001",opacity:0,WebkitTransition:"-webkit-transform 0.2s ease-out, opacity 0.2s linear",transition:"transform 0.2s ease-out, opacity 0.2s linear"}),document.body.appendChild(this.backgroundElement),document.body.appendChild(this.domElement);var r=this;dom.bind(this.backgroundElement,"click",function(){r.hide()})}return createClass(n,[{key:"show",value:function(){var i=this;this.backgroundElement.style.display="block",this.domElement.style.display="block",this.domElement.style.opacity=0,this.domElement.style.webkitTransform="scale(1.1)",this.layout(),Common.defer(function(){i.backgroundElement.style.opacity=1,i.domElement.style.opacity=1,i.domElement.style.webkitTransform="scale(1)"})}},{key:"hide",value:function(){var i=this,s=function a(){i.domElement.style.display="none",i.backgroundElement.style.display="none",dom.unbind(i.domElement,"webkitTransitionEnd",a),dom.unbind(i.domElement,"transitionend",a),dom.unbind(i.domElement,"oTransitionEnd",a)};dom.bind(this.domElement,"webkitTransitionEnd",s),dom.bind(this.domElement,"transitionend",s),dom.bind(this.domElement,"oTransitionEnd",s),this.backgroundElement.style.opacity=0,this.domElement.style.opacity=0,this.domElement.style.webkitTransform="scale(1.1)"}},{key:"layout",value:function(){this.domElement.style.left=window.innerWidth/2-dom.getWidth(this.domElement)/2+"px",this.domElement.style.top=window.innerHeight/2-dom.getHeight(this.domElement)/2+"px"}}]),n}(),styleSheet=___$insertStyle(".dg ul{list-style:none;margin:0;padding:0;width:100%;clear:both}.dg.ac{position:fixed;top:0;left:0;right:0;height:0;z-index:0}.dg:not(.ac) .main{overflow:hidden}.dg.main{-webkit-transition:opacity .1s linear;-o-transition:opacity .1s linear;-moz-transition:opacity .1s linear;transition:opacity .1s linear}.dg.main.taller-than-window{overflow-y:auto}.dg.main.taller-than-window .close-button{opacity:1;margin-top:-1px;border-top:1px solid #2c2c2c}.dg.main ul.closed .close-button{opacity:1 !important}.dg.main:hover .close-button,.dg.main .close-button.drag{opacity:1}.dg.main .close-button{-webkit-transition:opacity .1s linear;-o-transition:opacity .1s linear;-moz-transition:opacity .1s linear;transition:opacity .1s linear;border:0;line-height:19px;height:20px;cursor:pointer;text-align:center;background-color:#000}.dg.main .close-button.close-top{position:relative}.dg.main .close-button.close-bottom{position:absolute}.dg.main .close-button:hover{background-color:#111}.dg.a{float:right;margin-right:15px;overflow-y:visible}.dg.a.has-save>ul.close-top{margin-top:0}.dg.a.has-save>ul.close-bottom{margin-top:27px}.dg.a.has-save>ul.closed{margin-top:0}.dg.a .save-row{top:0;z-index:1002}.dg.a .save-row.close-top{position:relative}.dg.a .save-row.close-bottom{position:fixed}.dg li{-webkit-transition:height .1s ease-out;-o-transition:height .1s ease-out;-moz-transition:height .1s ease-out;transition:height .1s ease-out;-webkit-transition:overflow .1s linear;-o-transition:overflow .1s linear;-moz-transition:overflow .1s linear;transition:overflow .1s linear}.dg li:not(.folder){cursor:auto;height:27px;line-height:27px;padding:0 4px 0 5px}.dg li.folder{padding:0;border-left:4px solid rgba(0,0,0,0)}.dg li.title{cursor:pointer;margin-left:-4px}.dg .closed li:not(.title),.dg .closed ul li,.dg .closed ul li>*{height:0;overflow:hidden;border:0}.dg .cr{clear:both;padding-left:3px;height:27px;overflow:hidden}.dg .property-name{cursor:default;float:left;clear:left;width:40%;overflow:hidden;text-overflow:ellipsis}.dg .cr.function .property-name{width:100%}.dg .c{float:left;width:60%;position:relative}.dg .c input[type=text]{border:0;margin-top:4px;padding:3px;width:100%;float:right}.dg .has-slider input[type=text]{width:30%;margin-left:0}.dg .slider{float:left;width:66%;margin-left:-5px;margin-right:0;height:19px;margin-top:4px}.dg .slider-fg{height:100%}.dg .c input[type=checkbox]{margin-top:7px}.dg .c select{margin-top:5px}.dg .cr.function,.dg .cr.function .property-name,.dg .cr.function *,.dg .cr.boolean,.dg .cr.boolean *{cursor:pointer}.dg .cr.color{overflow:visible}.dg .selector{display:none;position:absolute;margin-left:-9px;margin-top:23px;z-index:10}.dg .c:hover .selector,.dg .selector.drag{display:block}.dg li.save-row{padding:0}.dg li.save-row .button{display:inline-block;padding:0px 6px}.dg.dialogue{background-color:#222;width:460px;padding:15px;font-size:13px;line-height:15px}#dg-new-constructor{padding:10px;color:#222;font-family:Monaco, monospace;font-size:10px;border:0;resize:none;box-shadow:inset 1px 1px 1px #888;word-wrap:break-word;margin:12px 0;display:block;width:440px;overflow-y:scroll;height:100px;position:relative}#dg-local-explain{display:none;font-size:11px;line-height:17px;border-radius:3px;background-color:#333;padding:8px;margin-top:10px}#dg-local-explain code{font-size:10px}#dat-gui-save-locally{display:none}.dg{color:#eee;font:11px 'Lucida Grande', sans-serif;text-shadow:0 -1px 0 #111}.dg.main::-webkit-scrollbar{width:5px;background:#1a1a1a}.dg.main::-webkit-scrollbar-corner{height:0;display:none}.dg.main::-webkit-scrollbar-thumb{border-radius:5px;background:#676767}.dg li:not(.folder){background:#1a1a1a;border-bottom:1px solid #2c2c2c}.dg li.save-row{line-height:25px;background:#dad5cb;border:0}.dg li.save-row select{margin-left:5px;width:108px}.dg li.save-row .button{margin-left:5px;margin-top:1px;border-radius:2px;font-size:9px;line-height:7px;padding:4px 4px 5px 4px;background:#c5bdad;color:#fff;text-shadow:0 1px 0 #b0a58f;box-shadow:0 -1px 0 #b0a58f;cursor:pointer}.dg li.save-row .button.gears{background:#c5bdad url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAsAAAANCAYAAAB/9ZQ7AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAQJJREFUeNpiYKAU/P//PwGIC/ApCABiBSAW+I8AClAcgKxQ4T9hoMAEUrxx2QSGN6+egDX+/vWT4e7N82AMYoPAx/evwWoYoSYbACX2s7KxCxzcsezDh3evFoDEBYTEEqycggWAzA9AuUSQQgeYPa9fPv6/YWm/Acx5IPb7ty/fw+QZblw67vDs8R0YHyQhgObx+yAJkBqmG5dPPDh1aPOGR/eugW0G4vlIoTIfyFcA+QekhhHJhPdQxbiAIguMBTQZrPD7108M6roWYDFQiIAAv6Aow/1bFwXgis+f2LUAynwoIaNcz8XNx3Dl7MEJUDGQpx9gtQ8YCueB+D26OECAAQDadt7e46D42QAAAABJRU5ErkJggg==) 2px 1px no-repeat;height:7px;width:8px}.dg li.save-row .button:hover{background-color:#bab19e;box-shadow:0 -1px 0 #b0a58f}.dg li.folder{border-bottom:0}.dg li.title{padding-left:16px;background:#000 url(data:image/gif;base64,R0lGODlhBQAFAJEAAP////Pz8////////yH5BAEAAAIALAAAAAAFAAUAAAIIlI+hKgFxoCgAOw==) 6px 10px no-repeat;cursor:pointer;border-bottom:1px solid rgba(255,255,255,0.2)}.dg .closed li.title{background-image:url(data:image/gif;base64,R0lGODlhBQAFAJEAAP////Pz8////////yH5BAEAAAIALAAAAAAFAAUAAAIIlGIWqMCbWAEAOw==)}.dg .cr.boolean{border-left:3px solid #806787}.dg .cr.color{border-left:3px solid}.dg .cr.function{border-left:3px solid #e61d5f}.dg .cr.number{border-left:3px solid #2FA1D6}.dg .cr.number input[type=text]{color:#2FA1D6}.dg .cr.string{border-left:3px solid #1ed36f}.dg .cr.string input[type=text]{color:#1ed36f}.dg .cr.function:hover,.dg .cr.boolean:hover{background:#111}.dg .c input[type=text]{background:#303030;outline:none}.dg .c input[type=text]:hover{background:#3c3c3c}.dg .c input[type=text]:focus{background:#494949;color:#fff}.dg .c .slider{background:#303030;cursor:ew-resize}.dg .c .slider-fg{background:#2FA1D6;max-width:100%}.dg .c .slider:hover{background:#3c3c3c}.dg .c .slider:hover .slider-fg{background:#44abda}\n");css.inject(styleSheet);var CSS_NAMESPACE="dg",HIDE_KEY_CODE=72,CLOSE_BUTTON_HEIGHT=20,DEFAULT_DEFAULT_PRESET_NAME="Default",SUPPORTS_LOCAL_STORAGE=function(){try{return!!window.localStorage}catch(n){return!1}}(),SAVE_DIALOGUE=void 0,autoPlaceVirgin=!0,autoPlaceContainer=void 0,hide=!1,hideableGuis=[],GUI=function n(r){var i=function(){var d=s.getRoot();d.width+=1,Common.defer(function(){d.width-=1})},s=this,a=r||{};this.domElement=document.createElement("div"),this.__ul=document.createElement("ul"),this.domElement.appendChild(this.__ul),dom.addClass(this.domElement,CSS_NAMESPACE),this.__folders={},this.__controllers=[],this.__rememberedObjects=[],this.__rememberedObjectIndecesToControllers=[],this.__listening=[],a=Common.defaults(a,{closeOnTop:!1,autoPlace:!0,width:n.DEFAULT_WIDTH}),a=Common.defaults(a,{resizable:a.autoPlace,hideable:a.autoPlace}),Common.isUndefined(a.load)?a.load={preset:DEFAULT_DEFAULT_PRESET_NAME}:a.preset&&(a.load.preset=a.preset),Common.isUndefined(a.parent)&&a.hideable&&hideableGuis.push(this),a.resizable=Common.isUndefined(a.parent)&&a.resizable,a.autoPlace&&Common.isUndefined(a.scrollable)&&(a.scrollable=!0);var o=SUPPORTS_LOCAL_STORAGE&&localStorage.getItem(getLocalStorageHash(this,"isLocal"))==="true",l=void 0,u=void 0;if(Object.defineProperties(this,{parent:{get:function(){return a.parent}},scrollable:{get:function(){return a.scrollable}},autoPlace:{get:function(){return a.autoPlace}},closeOnTop:{get:function(){return a.closeOnTop}},preset:{get:function(){return s.parent?s.getRoot().preset:a.load.preset},set:function(d){s.parent?s.getRoot().preset=d:a.load.preset=d,setPresetSelectIndex(this),s.revert()}},width:{get:function(){return a.width},set:function(d){a.width=d,setWidth(s,d)}},name:{get:function(){return a.name},set:function(d){a.name=d,u&&(u.innerHTML=a.name)}},closed:{get:function(){return a.closed},set:function(d){a.closed=d,a.closed?dom.addClass(s.__ul,n.CLASS_CLOSED):dom.removeClass(s.__ul,n.CLASS_CLOSED),this.onResize(),s.__closeButton&&(s.__closeButton.innerHTML=d?n.TEXT_OPEN:n.TEXT_CLOSED)}},load:{get:function(){return a.load}},useLocalStorage:{get:function(){return o},set:function(d){SUPPORTS_LOCAL_STORAGE&&(o=d,d?dom.bind(window,"unload",l):dom.unbind(window,"unload",l),localStorage.setItem(getLocalStorageHash(s,"isLocal"),d))}}}),Common.isUndefined(a.parent)){if(this.closed=a.closed||!1,dom.addClass(this.domElement,n.CLASS_MAIN),dom.makeSelectable(this.domElement,!1),SUPPORTS_LOCAL_STORAGE&&o){s.useLocalStorage=!0;var f=localStorage.getItem(getLocalStorageHash(this,"gui"));f&&(a.load=JSON.parse(f))}this.__closeButton=document.createElement("div"),this.__closeButton.innerHTML=n.TEXT_CLOSED,dom.addClass(this.__closeButton,n.CLASS_CLOSE_BUTTON),a.closeOnTop?(dom.addClass(this.__closeButton,n.CLASS_CLOSE_TOP),this.domElement.insertBefore(this.__closeButton,this.domElement.childNodes[0])):(dom.addClass(this.__closeButton,n.CLASS_CLOSE_BOTTOM),this.domElement.appendChild(this.__closeButton)),dom.bind(this.__closeButton,"click",function(){s.closed=!s.closed})}else{a.closed===void 0&&(a.closed=!0);var c=document.createTextNode(a.name);dom.addClass(c,"controller-name"),u=addRow(s,c);var h=function(d){return d.preventDefault(),s.closed=!s.closed,!1};dom.addClass(this.__ul,n.CLASS_CLOSED),dom.addClass(u,"title"),dom.bind(u,"click",h),a.closed||(this.closed=!1)}a.autoPlace&&(Common.isUndefined(a.parent)&&(autoPlaceVirgin&&(autoPlaceContainer=document.createElement("div"),dom.addClass(autoPlaceContainer,CSS_NAMESPACE),dom.addClass(autoPlaceContainer,n.CLASS_AUTO_PLACE_CONTAINER),document.body.appendChild(autoPlaceContainer),autoPlaceVirgin=!1),autoPlaceContainer.appendChild(this.domElement),dom.addClass(this.domElement,n.CLASS_AUTO_PLACE)),this.parent||setWidth(s,a.width)),this.__resizeHandler=function(){s.onResizeDebounced()},dom.bind(window,"resize",this.__resizeHandler),dom.bind(this.__ul,"webkitTransitionEnd",this.__resizeHandler),dom.bind(this.__ul,"transitionend",this.__resizeHandler),dom.bind(this.__ul,"oTransitionEnd",this.__resizeHandler),this.onResize(),a.resizable&&addResizeHandle(this),l=function(){SUPPORTS_LOCAL_STORAGE&&localStorage.getItem(getLocalStorageHash(s,"isLocal"))==="true"&&localStorage.setItem(getLocalStorageHash(s,"gui"),JSON.stringify(s.getSaveObject()))},this.saveToLocalStorageIfPossible=l,a.parent||i()};GUI.toggleHide=function(){hide=!hide,Common.each(hideableGuis,function(n){n.domElement.style.display=hide?"none":""})},GUI.CLASS_AUTO_PLACE="a",GUI.CLASS_AUTO_PLACE_CONTAINER="ac",GUI.CLASS_MAIN="main",GUI.CLASS_CONTROLLER_ROW="cr",GUI.CLASS_TOO_TALL="taller-than-window",GUI.CLASS_CLOSED="closed",GUI.CLASS_CLOSE_BUTTON="close-button",GUI.CLASS_CLOSE_TOP="close-top",GUI.CLASS_CLOSE_BOTTOM="close-bottom",GUI.CLASS_DRAG="drag",GUI.DEFAULT_WIDTH=245,GUI.TEXT_CLOSED="Close Controls",GUI.TEXT_OPEN="Open Controls",GUI._keydownHandler=function(n){document.activeElement.type!=="text"&&(n.which===HIDE_KEY_CODE||n.keyCode===HIDE_KEY_CODE)&&GUI.toggleHide()},dom.bind(window,"keydown",GUI._keydownHandler,!1),Common.extend(GUI.prototype,{add:function(r,i){return _add(this,r,i,{factoryArgs:Array.prototype.slice.call(arguments,2)})},addColor:function(r,i){return _add(this,r,i,{color:!0})},remove:function(r){this.__ul.removeChild(r.__li),this.__controllers.splice(this.__controllers.indexOf(r),1);var i=this;Common.defer(function(){i.onResize()})},destroy:function(){if(this.parent)throw new Error("Only the root GUI should be removed with .destroy(). For subfolders, use gui.removeFolder(folder) instead.");this.autoPlace&&autoPlaceContainer.removeChild(this.domElement);var r=this;Common.each(this.__folders,function(i){r.removeFolder(i)}),dom.unbind(window,"keydown",GUI._keydownHandler,!1),removeListeners(this)},addFolder:function(r){if(this.__folders[r]!==void 0)throw new Error('You already have a folder in this GUI by the name "'+r+'"');var i={name:r,parent:this};i.autoPlace=this.autoPlace,this.load&&this.load.folders&&this.load.folders[r]&&(i.closed=this.load.folders[r].closed,i.load=this.load.folders[r]);var s=new GUI(i);this.__folders[r]=s;var a=addRow(this,s.domElement);return dom.addClass(a,"folder"),s},removeFolder:function(r){this.__ul.removeChild(r.domElement.parentElement),delete this.__folders[r.name],this.load&&this.load.folders&&this.load.folders[r.name]&&delete this.load.folders[r.name],removeListeners(r);var i=this;Common.each(r.__folders,function(s){r.removeFolder(s)}),Common.defer(function(){i.onResize()})},open:function(){this.closed=!1},close:function(){this.closed=!0},hide:function(){this.domElement.style.display="none"},show:function(){this.domElement.style.display=""},onResize:function(){var r=this.getRoot();if(r.scrollable){var i=dom.getOffset(r.__ul).top,s=0;Common.each(r.__ul.childNodes,function(a){r.autoPlace&&a===r.__save_row||(s+=dom.getHeight(a))}),window.innerHeight-i-CLOSE_BUTTON_HEIGHT<s?(dom.addClass(r.domElement,GUI.CLASS_TOO_TALL),r.__ul.style.height=window.innerHeight-i-CLOSE_BUTTON_HEIGHT+"px"):(dom.removeClass(r.domElement,GUI.CLASS_TOO_TALL),r.__ul.style.height="auto")}r.__resize_handle&&Common.defer(function(){r.__resize_handle.style.height=r.__ul.offsetHeight+"px"}),r.__closeButton&&(r.__closeButton.style.width=r.width+"px")},onResizeDebounced:Common.debounce(function(){this.onResize()},50),remember:function(){if(Common.isUndefined(SAVE_DIALOGUE)&&(SAVE_DIALOGUE=new CenteredDiv,SAVE_DIALOGUE.domElement.innerHTML=saveDialogContents),this.parent)throw new Error("You can only call remember on a top level GUI.");var r=this;Common.each(Array.prototype.slice.call(arguments),function(i){r.__rememberedObjects.length===0&&addSaveMenu(r),r.__rememberedObjects.indexOf(i)===-1&&r.__rememberedObjects.push(i)}),this.autoPlace&&setWidth(this,this.width)},getRoot:function(){for(var r=this;r.parent;)r=r.parent;return r},getSaveObject:function(){var r=this.load;return r.closed=this.closed,this.__rememberedObjects.length>0&&(r.preset=this.preset,r.remembered||(r.remembered={}),r.remembered[this.preset]=getCurrentPreset(this)),r.folders={},Common.each(this.__folders,function(i,s){r.folders[s]=i.getSaveObject()}),r},save:function(){this.load.remembered||(this.load.remembered={}),this.load.remembered[this.preset]=getCurrentPreset(this),markPresetModified(this,!1),this.saveToLocalStorageIfPossible()},saveAs:function(r){this.load.remembered||(this.load.remembered={},this.load.remembered[DEFAULT_DEFAULT_PRESET_NAME]=getCurrentPreset(this,!0)),this.load.remembered[r]=getCurrentPreset(this),this.preset=r,addPresetOption(this,r,!0),this.saveToLocalStorageIfPossible()},revert:function(r){Common.each(this.__controllers,function(i){this.getRoot().load.remembered?recallSavedValue(r||this.getRoot(),i):i.setValue(i.initialValue),i.__onFinishChange&&i.__onFinishChange.call(i,i.getValue())},this),Common.each(this.__folders,function(i){i.revert(i)}),r||markPresetModified(this.getRoot(),!1)},listen:function(r){var i=this.__listening.length===0;this.__listening.push(r),i&&updateDisplays(this.__listening)},updateDisplay:function(){Common.each(this.__controllers,function(r){r.updateDisplay()}),Common.each(this.__folders,function(r){r.updateDisplay()})}});function addRow(n,r,i){var s=document.createElement("li");return r&&s.appendChild(r),i?n.__ul.insertBefore(s,i):n.__ul.appendChild(s),n.onResize(),s}function removeListeners(n){dom.unbind(window,"resize",n.__resizeHandler),n.saveToLocalStorageIfPossible&&dom.unbind(window,"unload",n.saveToLocalStorageIfPossible)}function markPresetModified(n,r){var i=n.__preset_select[n.__preset_select.selectedIndex];r?i.innerHTML=i.value+"*":i.innerHTML=i.value}function augmentController(n,r,i){if(i.__li=r,i.__gui=n,Common.extend(i,{options:function(l){if(arguments.length>1){var u=i.__li.nextElementSibling;return i.remove(),_add(n,i.object,i.property,{before:u,factoryArgs:[Common.toArray(arguments)]})}if(Common.isArray(l)||Common.isObject(l)){var f=i.__li.nextElementSibling;return i.remove(),_add(n,i.object,i.property,{before:f,factoryArgs:[l]})}},name:function(l){return i.__li.firstElementChild.firstElementChild.innerHTML=l,i},listen:function(){return i.__gui.listen(i),i},remove:function(){return i.__gui.remove(i),i}}),_instanceof$1(i,NumberControllerSlider)){var s=new NumberControllerBox(i.object,i.property,{min:i.__min,max:i.__max,step:i.__step});Common.each(["updateDisplay","onChange","onFinishChange","step","min","max"],function(o){var l=i[o],u=s[o];i[o]=s[o]=function(){var f=Array.prototype.slice.call(arguments);return u.apply(s,f),l.apply(i,f)}}),dom.addClass(r,"has-slider"),i.domElement.insertBefore(s.domElement,i.domElement.firstElementChild)}else if(_instanceof$1(i,NumberControllerBox)){var a=function(l){if(Common.isNumber(i.__min)&&Common.isNumber(i.__max)){var u=i.__li.firstElementChild.firstElementChild.innerHTML,f=i.__gui.__listening.indexOf(i)>-1;i.remove();var c=_add(n,i.object,i.property,{before:i.__li.nextElementSibling,factoryArgs:[i.__min,i.__max,i.__step]});return c.name(u),f&&c.listen(),c}return l};i.min=Common.compose(a,i.min),i.max=Common.compose(a,i.max)}else _instanceof$1(i,BooleanController)?(dom.bind(r,"click",function(){dom.fakeEvent(i.__checkbox,"click")}),dom.bind(i.__checkbox,"click",function(o){o.stopPropagation()})):_instanceof$1(i,FunctionController)?(dom.bind(r,"click",function(){dom.fakeEvent(i.__button,"click")}),dom.bind(r,"mouseover",function(){dom.addClass(i.__button,"hover")}),dom.bind(r,"mouseout",function(){dom.removeClass(i.__button,"hover")})):_instanceof$1(i,ColorController)&&(dom.addClass(r,"color"),i.updateDisplay=Common.compose(function(o){return r.style.borderLeftColor=i.__color.toString(),o},i.updateDisplay),i.updateDisplay());i.setValue=Common.compose(function(o){return n.getRoot().__preset_select&&i.isModified()&&markPresetModified(n.getRoot(),!0),o},i.setValue)}function recallSavedValue(n,r){var i=n.getRoot(),s=i.__rememberedObjects.indexOf(r.object);if(s!==-1){var a=i.__rememberedObjectIndecesToControllers[s];if(a===void 0&&(a={},i.__rememberedObjectIndecesToControllers[s]=a),a[r.property]=r,i.load&&i.load.remembered){var o=i.load.remembered,l=void 0;if(o[n.preset])l=o[n.preset];else if(o[DEFAULT_DEFAULT_PRESET_NAME])l=o[DEFAULT_DEFAULT_PRESET_NAME];else return;if(l[s]&&l[s][r.property]!==void 0){var u=l[s][r.property];r.initialValue=u,r.setValue(u)}}}}function _add(n,r,i,s){if(r[i]===void 0)throw new Error('Object "'+r+'" has no property "'+i+'"');var a=void 0;if(s.color)a=new ColorController(r,i);else{var o=[r,i].concat(s.factoryArgs);a=ControllerFactory.apply(n,o)}_instanceof$1(s.before,Controller)&&(s.before=s.before.__li),recallSavedValue(n,a),dom.addClass(a.domElement,"c");var l=document.createElement("span");dom.addClass(l,"property-name"),l.innerHTML=a.property;var u=document.createElement("div");u.appendChild(l),u.appendChild(a.domElement);var f=addRow(n,u,s.before);return dom.addClass(f,GUI.CLASS_CONTROLLER_ROW),_instanceof$1(a,ColorController)?dom.addClass(f,"color"):dom.addClass(f,_$_typeof(a.getValue())),augmentController(n,f,a),n.__controllers.push(a),a}function getLocalStorageHash(n,r){return document.location.href+"."+r}function addPresetOption(n,r,i){var s=document.createElement("option");s.innerHTML=r,s.value=r,n.__preset_select.appendChild(s),i&&(n.__preset_select.selectedIndex=n.__preset_select.length-1)}function showHideExplain(n,r){r.style.display=n.useLocalStorage?"block":"none"}function addSaveMenu(n){var r=n.__save_row=document.createElement("li");dom.addClass(n.domElement,"has-save"),n.__ul.insertBefore(r,n.__ul.firstChild),dom.addClass(r,"save-row");var i=document.createElement("span");i.innerHTML="&nbsp;",dom.addClass(i,"button gears");var s=document.createElement("span");s.innerHTML="Save",dom.addClass(s,"button"),dom.addClass(s,"save");var a=document.createElement("span");a.innerHTML="New",dom.addClass(a,"button"),dom.addClass(a,"save-as");var o=document.createElement("span");o.innerHTML="Revert",dom.addClass(o,"button"),dom.addClass(o,"revert");var l=n.__preset_select=document.createElement("select");if(n.load&&n.load.remembered?Common.each(n.load.remembered,function(p,d){addPresetOption(n,d,d===n.preset)}):addPresetOption(n,DEFAULT_DEFAULT_PRESET_NAME,!1),dom.bind(l,"change",function(){for(var p=0;p<n.__preset_select.length;p++)n.__preset_select[p].innerHTML=n.__preset_select[p].value;n.preset=this.value}),r.appendChild(l),r.appendChild(i),r.appendChild(s),r.appendChild(a),r.appendChild(o),SUPPORTS_LOCAL_STORAGE){var u=document.getElementById("dg-local-explain"),f=document.getElementById("dg-local-storage"),c=document.getElementById("dg-save-locally");c.style.display="block",localStorage.getItem(getLocalStorageHash(n,"isLocal"))==="true"&&f.setAttribute("checked","checked"),showHideExplain(n,u),dom.bind(f,"change",function(){n.useLocalStorage=!n.useLocalStorage,showHideExplain(n,u)})}var h=document.getElementById("dg-new-constructor");dom.bind(h,"keydown",function(p){p.metaKey&&(p.which===67||p.keyCode===67)&&SAVE_DIALOGUE.hide()}),dom.bind(i,"click",function(){h.innerHTML=JSON.stringify(n.getSaveObject(),void 0,2),SAVE_DIALOGUE.show(),h.focus(),h.select()}),dom.bind(s,"click",function(){n.save()}),dom.bind(a,"click",function(){var p=prompt("Enter a new preset name.");p&&n.saveAs(p)}),dom.bind(o,"click",function(){n.revert()})}function addResizeHandle(n){var r=function(l){return l.preventDefault(),n.width+=s-l.clientX,n.onResize(),s=l.clientX,!1},i=function(l){return l.preventDefault(),s=l.clientX,dom.addClass(n.__closeButton,GUI.CLASS_DRAG),dom.bind(window,"mousemove",r),dom.bind(window,"mouseup",a),!1},s=void 0;n.__resize_handle=document.createElement("div"),Common.extend(n.__resize_handle.style,{width:"6px",marginLeft:"-3px",height:"200px",cursor:"ew-resize",position:"absolute"});function a(){dom.removeClass(n.__closeButton,GUI.CLASS_DRAG),dom.unbind(window,"mousemove",r),dom.unbind(window,"mouseup",a)}dom.bind(n.__resize_handle,"mousedown",i),dom.bind(n.__closeButton,"mousedown",i),n.domElement.insertBefore(n.__resize_handle,n.domElement.firstElementChild)}function setWidth(n,r){n.domElement.style.width=r+"px",n.__save_row&&n.autoPlace&&(n.__save_row.style.width=r+"px"),n.__closeButton&&(n.__closeButton.style.width=r+"px")}function getCurrentPreset(n,r){var i={};return Common.each(n.__rememberedObjects,function(s,a){var o={},l=n.__rememberedObjectIndecesToControllers[a];Common.each(l,function(u,f){o[f]=r?u.initialValue:u.getValue()}),i[a]=o}),i}function setPresetSelectIndex(n){for(var r=0;r<n.__preset_select.length;r++)n.__preset_select[r].value===n.preset&&(n.__preset_select.selectedIndex=r)}function updateDisplays(n){n.length!==0&&requestAnimationFrame$1$1.call(window,function(){updateDisplays(n)}),Common.each(n,function(r){r.updateDisplay()})}var color={Color:Color,math:ColorMath,interpret:interpret},controllers={Controller:Controller,BooleanController:BooleanController,OptionController:OptionController,StringController:StringController,NumberController:NumberController,NumberControllerBox:NumberControllerBox,NumberControllerSlider:NumberControllerSlider,FunctionController:FunctionController,ColorController:ColorController},dom$1={dom:dom},gui={GUI:GUI},GUI$1=GUI,index={color:color,controllers:controllers,dom:dom$1,gui:gui,GUI:GUI$1},dat_gui_module=Object.freeze({__proto__:null,color:color,controllers:controllers,dom:dom$1,gui:gui,GUI:GUI$1,default:index}),require$$7=getAugmentedNamespace(dat_gui_module);function _arrayLikeToArray(n,r){(r==null||r>n.length)&&(r=n.length);for(var i=0,s=new Array(r);i<r;i++)s[i]=n[i];return s}function _arrayWithHoles(n){if(Array.isArray(n))return n}function _arrayWithoutHoles(n){if(Array.isArray(n))return _arrayLikeToArray(n)}function _assertThisInitialized(n){if(n===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return n}function _classCallCheck(n,r){if(!(n instanceof r))throw new TypeError("Cannot call a class as a function")}function isNativeReflectConstruct(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(n){return!1}}function _construct(n,r,i){return isNativeReflectConstruct()?_construct=Reflect.construct:_construct=function(s,a,o){var l=[null];l.push.apply(l,a);var u=Function.bind.apply(s,l),f=new u;return o&&_setPrototypeOf(f,o.prototype),f},_construct.apply(null,arguments)}function _defineProperties(n,r){for(var i=0;i<r.length;i++){var s=r[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(n,s.key,s)}}function _createClass(n,r,i){return r&&_defineProperties(n.prototype,r),i&&_defineProperties(n,i),n}function _defineProperty(n,r,i){return r in n?Object.defineProperty(n,r,{value:i,enumerable:!0,configurable:!0,writable:!0}):n[r]=i,n}function _get(n,r,i){return typeof Reflect!="undefined"&&Reflect.get?_get=Reflect.get:_get=function(s,a,o){var l=_superPropBase(s,a);if(l){var u=Object.getOwnPropertyDescriptor(l,a);return u.get?u.get.call(o):u.value}},_get(n,r,i||n)}function _getPrototypeOf(n){return _getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(r){return r.__proto__||Object.getPrototypeOf(r)},_getPrototypeOf(n)}function _inherits(n,r){if(typeof r!="function"&&r!==null)throw new TypeError("Super expression must either be null or a function");n.prototype=Object.create(r&&r.prototype,{constructor:{value:n,writable:!0,configurable:!0}}),r&&_setPrototypeOf(n,r)}function _instanceof(n,r){return r!=null&&typeof Symbol!="undefined"&&r[Symbol.hasInstance]?!!r[Symbol.hasInstance](n):n instanceof r}function _isNativeFunction(n){return Function.toString.call(n).indexOf("[native code]")!==-1}function _iterableToArray(n){if(typeof Symbol!="undefined"&&n[Symbol.iterator]!=null||n["@@iterator"]!=null)return Array.from(n)}function _iterableToArrayLimit(n,r){var i=n==null?null:typeof Symbol!="undefined"&&n[Symbol.iterator]||n["@@iterator"];if(i!=null){var s=[],a=!0,o=!1,l,u;try{for(i=i.call(n);!(a=(l=i.next()).done)&&(s.push(l.value),!(r&&s.length===r));a=!0);}catch(f){o=!0,u=f}finally{try{!a&&i.return!=null&&i.return()}finally{if(o)throw u}}return s}}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _possibleConstructorReturn(n,r){return r&&(_typeof(r)==="object"||typeof r=="function")?r:_assertThisInitialized(n)}function _setPrototypeOf(n,r){return _setPrototypeOf=Object.setPrototypeOf||function(i,s){return i.__proto__=s,i},_setPrototypeOf(n,r)}function _slicedToArray(n,r){return _arrayWithHoles(n)||_iterableToArrayLimit(n,r)||_unsupportedIterableToArray(n,r)||_nonIterableRest()}function _superPropBase(n,r){for(;!Object.prototype.hasOwnProperty.call(n,r)&&(n=_getPrototypeOf(n),n!==null););return n}function _toConsumableArray(n){return _arrayWithoutHoles(n)||_iterableToArray(n)||_unsupportedIterableToArray(n)||_nonIterableSpread()}var _typeof=function(n){return n&&typeof Symbol!="undefined"&&n.constructor===Symbol?"symbol":typeof n};function _unsupportedIterableToArray(n,r){if(n){if(typeof n=="string")return _arrayLikeToArray(n,r);var i=Object.prototype.toString.call(n).slice(8,-1);if(i==="Object"&&n.constructor&&(i=n.constructor.name),i==="Map"||i==="Set")return Array.from(i);if(i==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return _arrayLikeToArray(n,r)}}function _wrapNativeSuper(n){var r=typeof Map=="function"?new Map:void 0;return _wrapNativeSuper=function(i){if(i===null||!_isNativeFunction(i))return i;if(typeof i!="function")throw new TypeError("Super expression must either be null or a function");if(typeof r!="undefined"){if(r.has(i))return r.get(i);r.set(i,s)}function s(){return _construct(i,arguments,_getPrototypeOf(this).constructor)}return s.prototype=Object.create(i.prototype,{constructor:{value:s,enumerable:!1,writable:!0,configurable:!0}}),_setPrototypeOf(s,i)},_wrapNativeSuper(n)}function _isNativeReflectConstruct(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}function _createSuper(n){var r=_isNativeReflectConstruct();return function(){var i=_getPrototypeOf(n),s;if(r){var a=_getPrototypeOf(this).constructor;s=Reflect.construct(i,arguments,a)}else s=i.apply(this,arguments);return _possibleConstructorReturn(this,s)}}(function(module,exports){(function(n,r){r(exports,requireUaParser(),requireChito(),requireBezier(),requireSrc(),requireEarcut(),requireRegl(),require$$6,require$$7)})(commonjsGlobal,function(exports,uaParserJs,chito,bezierJs,BezierEasing,earcut,REGL,glMatrix,dat){var _interopDefaultLegacy=function(n){return n&&typeof n=="object"&&"default"in n?n:{default:n}},_interopNamespace=function(n){if(n&&n.i)return n;var r=Object.create(null);return n&&Object.keys(n).forEach(function(i){if(i!=="default"){var s=Object.getOwnPropertyDescriptor(n,i);Object.defineProperty(r,i,s.get?s:{Fr:!0,get:function(){return n[i]}})}}),r.default=n,Object.freeze(r)},getAugmentedNamespace=function(n){var r=n.default;if(typeof r=="function"){var i=function(){return r.apply(this,arguments)};i.prototype=r.prototype}else i={};return Object.defineProperty(i,"i",{value:!0}),Object.keys(n).forEach(function(s){var a=Object.getOwnPropertyDescriptor(n,s);Object.defineProperty(i,s,a.get?a:{Fr:!0,get:function(){return n[s]}})}),i},defaultCompare=function(n,r){return n<r?-1:n>r?1:0},polylabel=function(n,r,i){r=r||1;for(var s,a,o,l,u=0;u<n[0].length;u++){var f=n[0][u];(!u||f[0]<s)&&(s=f[0]),(!u||f[1]<a)&&(a=f[1]),(!u||f[0]>o)&&(o=f[0]),(!u||f[1]>l)&&(l=f[1])}var c=o-s,h=l-a,p=Math.min(c,h),d=p/2;if(p===0){var v=[s,a];return v.distance=0,v}for(var g=new Queue(void 0,compareMax),m=s;m<o;m+=p)for(var y=a;y<l;y+=p)g.push(new Cell(m+d,y+d,d,n));var b=getCentroidCell(n),_=new Cell(s+c/2,a+h/2,0,n);_.d>b.d&&(b=_);for(var C=g.length;g.length;){var A=g.pop();A.d>b.d&&(b=A,i&&console.log("found best %d after %d probes",Math.round(1e4*A.d)/1e4,C)),!(A.max-b.d<=r)&&(d=A.Eb/2,g.push(new Cell(A.x-d,A.y-d,d,n)),g.push(new Cell(A.x+d,A.y-d,d,n)),g.push(new Cell(A.x-d,A.y+d,d,n)),g.push(new Cell(A.x+d,A.y+d,d,n)),C+=4)}i&&(console.log("num probes: "+C),console.log("best distance: "+b.d));var I=[b.x,b.y];return I.distance=b.d,I},compareMax=function(n,r){return r.max-n.max},Cell=function(n,r,i,s){this.x=n,this.y=r,this.Eb=i,this.d=pointToPolygonDist(n,r,s),this.max=this.d+this.Eb*Math.SQRT2},pointToPolygonDist=function(n,r,i){for(var s=!1,a=1/0,o=0;o<i.length;o++)for(var l=i[o],u=0,f=l.length,c=f-1;u<f;c=u++){var h=l[u],p=l[c];h[1]>r!=p[1]>r&&n<(p[0]-h[0])*(r-h[1])/(p[1]-h[1])+h[0]&&(s=!s),a=Math.min(a,getSegDistSq(n,r,h,p))}return a===0?0:(s?1:-1)*Math.sqrt(a)},getCentroidCell=function(n){for(var r=0,i=0,s=0,a=n[0],o=0,l=a.length,u=l-1;o<l;u=o++){var f=a[o],c=a[u],h=f[0]*c[1]-c[0]*f[1];i+=(f[0]+c[0])*h,s+=(f[1]+c[1])*h,r+=h*3}return r===0?new Cell(a[0][0],a[0][1],0,n):new Cell(i/r,s/r,0,n)},getSegDistSq=function(n,r,i,s){var a=i[0],o=i[1],l=s[0]-a,u=s[1]-o;if(l!==0||u!==0){var f=((n-a)*l+(r-o)*u)/(l*l+u*u);f>1?(a=s[0],o=s[1]):f>0&&(a+=l*f,o+=u*f)}return l=n-a,u=r-o,l*l+u*u},encode=function(n,r){keys$1={},keysArr=[],keysNum=0,dim$1=0,e$1=1,analyze(n),e$1=Math.min(e$1,maxPrecision);for(var i=Math.ceil(Math.log(e$1)/Math.LN10),s=0;s<keysArr.length;s++)r.nP(1,keysArr[s]);return dim$1!==2&&r.tP(2,dim$1),i!==6&&r.tP(3,i),n.type==="FeatureCollection"?r.Az(4,writeFeatureCollection,n):n.type==="Feature"?r.Az(5,writeFeature,n):r.Az(6,writeGeometry,n),keys$1=null,r.finish()},analyzeMultiLine=function(n){for(var r=0;r<n.length;r++)analyzePoints(n[r])},analyzePoints=function(n){for(var r=0;r<n.length;r++)analyzePoint(n[r])},analyzePoint=function(n){dim$1=Math.max(dim$1,n.length);for(var r=0;r<n.length;r++)for(;Math.round(n[r]*e$1)/e$1!==n[r]&&e$1<maxPrecision;)e$1*=10},saveKey=function(n){keys$1[n]===void 0&&(keysArr.push(n),keys$1[n]=keysNum++)},writeFeatureCollection=function(n,r){for(var i=0;i<n.features.length;i++)r.Az(1,writeFeature,n.features[i]);writeProps(n,r,!0)},writeFeature=function(n,r){n.geometry!==null&&r.Az(1,writeGeometry,n.geometry),n.id!==void 0&&(typeof n.id=="number"&&n.id%1===0?r.iP(12,n.id):r.nP(11,n.id)),n.properties&&writeProps(n.properties,r),writeProps(n,r,!0)},writeProps=function(n,r,i){var s=[],a=0;for(var o in n)i&&isSpecialKey(o,n.type)||(r.Az(13,writeValue,n[o]),s.push(keys$1[o]),s.push(a++));r.Wz(i?15:14,s)},writeValue=function(n,r){if(n!==null){var i=typeof n=="undefined"?"undefined":_typeof(n);i==="string"?r.nP(1,n):i==="boolean"?r.oP(5,n):i==="object"?r.nP(6,JSON.stringify(n)):i==="number"&&(n%1!==0?r.rP(2,n):n>=0?r.tP(3,n):r.tP(4,-n))}},writePoint=function(n,r){for(var i=[],s=0;s<dim$1;s++)i.push(Math.round(n[s]*e$1));r.Nz(3,i)},writeLine=function(n,r){var i=[];populateLine(i,n),r.Nz(3,i)},writeMultiLine=function(n,r,i){var s=n.length,a;if(s!==1){var o=[];for(a=0;a<s;a++)o.push(n[a].length-(i?1:0));r.Wz(2,o)}var l=[];for(a=0;a<s;a++)populateLine(l,n[a],i);r.Nz(3,l)},writeMultiPolygon=function(n,r){var i=n.length,s,a;if(i!==1||n[0].length!==1){var o=[i];for(s=0;s<i;s++)for(o.push(n[s].length),a=0;a<n[s].length;a++)o.push(n[s][a].length-1);r.Wz(2,o)}var l=[];for(s=0;s<i;s++)for(a=0;a<n[s].length;a++)populateLine(l,n[s][a],!0);r.Nz(3,l)},populateLine=function(n,r,i){var s,a,o=r.length-(i?1:0),l=new Array(dim$1);for(a=0;a<dim$1;a++)l[a]=0;for(s=0;s<o;s++)for(a=0;a<dim$1;a++){var u=Math.round(r[s][a]*e$1)-l[a];n.push(u),l[a]+=u}},isSpecialKey=function(n,r){if(n==="type")return!0;if(r==="FeatureCollection"){if(n==="features")return!0}else if(r==="Feature"){if(n==="id"||n==="properties"||n==="geometry")return!0}else if(r==="GeometryCollection"){if(n==="geometries")return!0}else if(n==="coordinates")return!0;return!1},decode=function(n){dim=2,e=Math.pow(10,6),lengths=null,keys=[],values=[];var r=n.ez(readDataField,{});return keys=null,r},readDataField=function(n,r,i){n===1?keys.push(i.JC()):n===2?dim=i.YC():n===3?e=Math.pow(10,i.YC()):n===4?readFeatureCollection(i,r):n===5?readFeature(i,r):n===6&&readGeometry(i,r)},readFeatureCollection=function(n,r){return r.type="FeatureCollection",r.features=[],n.$C(readFeatureCollectionField,r)},readFeature=function(n,r){r.type="Feature";var i=n.$C(readFeatureField,r);return"geometry"in i||(i.geometry=null),i},readGeometry=function(n,r){return r.type="Point",n.$C(readGeometryField,r)},readFeatureCollectionField=function(n,r,i){n===1?r.features.push(readFeature(i,{})):n===13?values.push(readValue(i)):n===15&&readProps(i,r)},readFeatureField=function(n,r,i){n===1?r.geometry=readGeometry(i,{}):n===11?r.id=i.JC():n===12?r.id=i.ZC():n===13?values.push(readValue(i)):n===14?r.properties=readProps(i,{}):n===15&&readProps(i,r)},readGeometryField=function(n,r,i){n===1?r.type=geometryTypes[i.YC()]:n===2?lengths=i.KC():n===3?readCoords(r,i,r.type):n===4?(r.tz=r.tz||[],r.tz.push(readGeometry(i,{}))):n===13?values.push(readValue(i)):n===15&&readProps(i,r)},readCoords=function(n,r,i){i==="Point"?n.coordinates=readPoint(r):i==="MultiPoint"||i==="LineString"?n.coordinates=readLine(r):i==="MultiLineString"?n.coordinates=readMultiLine(r):i==="Polygon"?n.coordinates=readMultiLine(r,!0):i==="MultiPolygon"&&(n.coordinates=readMultiPolygon(r))},readValue=function(n){for(var r=n.YC()+n.Br,i=null;n.Br<r;){var s=n.YC(),a=s>>3;a===1?i=n.JC():a===2?i=n.iz():a===3?i=n.YC():a===4?i=-n.YC():a===5?i=n.nz():a===6&&(i=JSON.parse(n.JC()))}return i},readProps=function(n,r){for(var i=n.YC()+n.Br;n.Br<i;)r[keys[n.YC()]]=values[n.YC()];return values=[],r},readPoint=function(n){for(var r=n.YC()+n.Br,i=[];n.Br<r;)i.push(n.ZC()/e);return i},readLinePart=function(n,r,i,s){var a=0,o=[],l,u,f=[];for(u=0;u<dim;u++)f[u]=0;for(;i?a<i:n.Br<r;){for(l=[],u=0;u<dim;u++)f[u]+=n.ZC(),l[u]=f[u]/e;o.push(l),a++}return s&&o.push(o[0]),o},readLine=function(n){return readLinePart(n,n.YC()+n.Br)},readMultiLine=function(n,r){var i=n.YC()+n.Br;if(!lengths)return[readLinePart(n,i,null,r)];for(var s=[],a=0;a<lengths.length;a++)s.push(readLinePart(n,i,lengths[a],r));return lengths=null,s},readMultiPolygon=function(n){var r=n.YC()+n.Br;if(!lengths)return[[readLinePart(n,r,null,!0)]];for(var i=[],s=1,a=0;a<lengths[0];a++){for(var o=[],l=0;l<lengths[s];l++)o.push(readLinePart(n,r,lengths[s+1+l],!0));s+=lengths[s]+1,i.push(o)}return lengths=null,i},Pbf=function(n){this.rz=ArrayBuffer.isView&&ArrayBuffer.isView(n)?n:new Uint8Array(n||0),this.Br=0,this.type=0,this.length=this.rz.length},readVarintRemainder=function(n,r,i){var s=i.rz,a,o;if(o=s[i.Br++],a=(o&112)>>4,o<128||(o=s[i.Br++],a|=(o&127)<<3,o<128)||(o=s[i.Br++],a|=(o&127)<<10,o<128)||(o=s[i.Br++],a|=(o&127)<<17,o<128)||(o=s[i.Br++],a|=(o&127)<<24,o<128)||(o=s[i.Br++],a|=(o&1)<<31,o<128))return toNum(n,a,r);throw new Error("Expected varint not more than 10 bytes")},readPackedEnd=function(n){return n.type===Pbf.az?n.YC()+n.Br:n.Br+1},toNum=function(n,r,i){return i?r*4294967296+(n>>>0):(r>>>0)*4294967296+(n>>>0)},writeBigVarint=function(n,r){var i,s;if(n>=0?(i=n%4294967296|0,s=n/4294967296|0):(i=~(-n%4294967296),s=~(-n/4294967296),i^4294967295?i=i+1|0:(i=0,s=s+1|0)),n>=18446744073709552e3||n<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");r.hz(10),writeBigVarintLow(i,s,r),writeBigVarintHigh(s,r)},writeBigVarintLow=function(n,r,i){i.rz[i.Br++]=n&127|128,n>>>=7,i.rz[i.Br++]=n&127|128,n>>>=7,i.rz[i.Br++]=n&127|128,n>>>=7,i.rz[i.Br++]=n&127|128,n>>>=7,i.rz[i.Br]=n&127},writeBigVarintHigh=function(n,r){var i=(n&7)<<4;r.rz[r.Br++]|=i|((n>>>=3)?128:0),n&&(r.rz[r.Br++]=n&127|((n>>>=7)?128:0),n&&(r.rz[r.Br++]=n&127|((n>>>=7)?128:0),n&&(r.rz[r.Br++]=n&127|((n>>>=7)?128:0),n&&(r.rz[r.Br++]=n&127|((n>>>=7)?128:0),n&&(r.rz[r.Br++]=n&127)))))},makeRoomForExtraLength=function(n,r,i){var s=r<=16383?1:r<=2097151?2:r<=268435455?3:Math.floor(Math.log(r)/(Math.LN2*7));i.hz(s);for(var a=i.Br-1;a>=n;a--)i.rz[a+s]=i.rz[a]},writePackedVarint=function(n,r){for(var i=0;i<n.length;i++)r.lz(n[i])},writePackedSVarint=function(n,r){for(var i=0;i<n.length;i++)r.fz(n[i])},writePackedFloat=function(n,r){for(var i=0;i<n.length;i++)r.cz(n[i])},writePackedDouble=function(n,r){for(var i=0;i<n.length;i++)r.vz(n[i])},writePackedBoolean=function(n,r){for(var i=0;i<n.length;i++)r.dz(n[i])},writePackedFixed32=function(n,r){for(var i=0;i<n.length;i++)r.pz(n[i])},writePackedSFixed32=function(n,r){for(var i=0;i<n.length;i++)r.mz(n[i])},writePackedFixed64=function(n,r){for(var i=0;i<n.length;i++)r.gz(n[i])},writePackedSFixed64=function(n,r){for(var i=0;i<n.length;i++)r.bz(n[i])},readUInt32=function(n,r){return(n[r]|n[r+1]<<8|n[r+2]<<16)+n[r+3]*16777216},writeInt32=function(n,r,i){n[i]=r,n[i+1]=r>>>8,n[i+2]=r>>>16,n[i+3]=r>>>24},readInt32=function(n,r){return(n[r]|n[r+1]<<8|n[r+2]<<16)+(n[r+3]<<24)},readUtf8=function(n,r,i){for(var s="",a=r;a<i;){var o=n[a],l=null,u=o>239?4:o>223?3:o>191?2:1;if(a+u>i)break;var f,c,h;u===1?o<128&&(l=o):u===2?(f=n[a+1],(f&192)===128&&(l=(o&31)<<6|f&63,l<=127&&(l=null))):u===3?(f=n[a+1],c=n[a+2],(f&192)===128&&(c&192)===128&&(l=(o&15)<<12|(f&63)<<6|c&63,(l<=2047||l>=55296&&l<=57343)&&(l=null))):u===4&&(f=n[a+1],c=n[a+2],h=n[a+3],(f&192)===128&&(c&192)===128&&(h&192)===128&&(l=(o&15)<<18|(f&63)<<12|(c&63)<<6|h&63,(l<=65535||l>=1114112)&&(l=null))),l===null?(l=65533,u=1):l>65535&&(l-=65536,s+=String.fromCharCode(l>>>10&1023|55296),l=56320|l&1023),s+=String.fromCharCode(l),a+=u}return s},readUtf8TextDecoder=function(n,r,i){return utf8TextDecoder.decode(n.subarray(r,i))},writeUtf8=function(n,r,i){for(var s=0,a,o;s<r.length;s++){if(a=r.charCodeAt(s),a>55295&&a<57344)if(o)if(a<56320){n[i++]=239,n[i++]=191,n[i++]=189,o=a;continue}else a=o-55296<<10|a-56320|65536,o=null;else{a>56319||s+1===r.length?(n[i++]=239,n[i++]=191,n[i++]=189):o=a;continue}else o&&(n[i++]=239,n[i++]=191,n[i++]=189,o=null);a<128?n[i++]=a:(a<2048?n[i++]=a>>6|192:(a<65536?n[i++]=a>>12|224:(n[i++]=a>>18|240,n[i++]=a>>12&63|128),n[i++]=a>>6&63|128),n[i++]=a&63|128)}return i},feature=function(n,r,i){i===void 0&&(i={});var s={type:"Feature"};return(i.id===0||i.id)&&(s.id=i.id),i.bbox&&(s.bbox=i.bbox),s.properties=r||{},s.geometry=n,s},point$1=function(n,r,i){if(i===void 0&&(i={}),!n)throw new Error("coordinates is required");if(!Array.isArray(n))throw new Error("coordinates must be an Array");if(n.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!isNumber(n[0])||!isNumber(n[1]))throw new Error("coordinates must contain numbers");var s={type:"Point",coordinates:n};return feature(s,r,i)},multiPoint=function(n,r,i){i===void 0&&(i={});var s={type:"MultiPoint",coordinates:n};return feature(s,r,i)},isNumber=function(n){return!isNaN(n)&&n!==null&&!Array.isArray(n)},getMaximumPolygon=function(n){var r=0,i,s=!0,a=!1,o=void 0;try{for(var l=n[Symbol.iterator](),u;!(s=(u=l.next()).done);s=!0){var f=u.value,c=GeometryUtil.s$(f);c>r&&(r=c,i=f)}}catch(h){a=!0,o=h}finally{try{!s&&l.return!=null&&l.return()}finally{if(a)throw o}}return i},nestParse=function nestParse(nestString){function string2function(x){return x&&(Array.isArray(x)?x.map(function(n){return string2function(n)}):typeof x=="object"?Object.keys(x).reduce(function(n,r){return n[r]=string2function(x[r]),n},{}):typeof x=="string"&&(x.startsWith("(")||x.startsWith("function"))?eval(x):x)}return string2function(JSON.parse(nestString))},nestStringify=function n(r){function i(s){return s&&(Array.isArray(s)?s.map(function(a){return i(a)}):typeof s=="object"?Object.keys(s).reduce(function(a,o){return a[o]=i(s[o]),a},{}):typeof s=="function"?s.toString():s)}return JSON.stringify(i(r))},getABC=function n(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:2,i=arguments.length>1?arguments[1]:void 0,s=arguments.length>2?arguments[2]:void 0,a=arguments.length>3?arguments[3]:void 0,o=arguments.length>4&&arguments[4]!==void 0?arguments[4]:.5,l=bezierJs.Bezier.getUtils(),u=l.projectionratio(o,r),f=1-u,c={x:u*i.x+f*a.x,y:u*i.y+f*a.y,z:u*i.z+f*a.z},h=l.abcratio(o,r),p={x:s.x+(s.x-c.x)/h,y:s.y+(s.y-c.y)/h,z:s.y+(s.z-c.z)/h};return{rs:p,ps:s,Ju:c,bs:i,E:a}},cubicBezier=function n(r,i,s,a,o){typeof a=="undefined"&&(a=.5);var l;a===0&&(l=new bezierJs.Bezier(i,i,s)),a===1&&(l=new bezierJs.Bezier(r,i,i));var u=getABC(2,r,i,s,a);l=new bezierJs.Bezier(r,u.rs,s);var f=100;o&&(o<=3?f=4:f=Math.floor(o)+1);var c=l.getLUT(f);return c},Linear$1=function n(r,i,s){var a=(i-r)*s+r;return a},LinearSplit=function n(r,i){for(var s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,a=[],o=0;o<=s-1;o++){var l=r.x,u=r.y,f=r.z,c=i.x,h=i.y,p=i.z,d=o/(s-1),v={x:+Linear$1(l,c,d),y:+Linear$1(u,h,d),z:+Linear$1(f,p,d),t:d};a.push(v)}return a},Linear=function n(r,i,s){return(i-r)*s+r},linearGradient=function n(r){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:Linear,a=r.length-1,o=a*i,l=o>>0,u=s,f=function(d,v,g){var m=_slicedToArray(d,4),y=m[0],b=m[1],_=m[2],C=m[3],A=_slicedToArray(v,4),I=A[0],D=A[1],X=A[2],W=A[3],K=[u(y,I,g),u(b,D,g),u(_,X,g),u(C,W,g)];return K},c=r[l],h=r[l+1>a?a:l+1],p=o-l;return f(c,h,p)},svgToBlobUrl=function n(r){var i=r.outerHTML,s=new Blob([i],{type:"image/svg+xml;charset=utf-8"}),a=window.URL||window.webkitURL||window,o=a.createObjectURL(s);return o},concatImages=function n(r,i){var s=r.images,a=r.wx,o=a===void 0?[64,64]:a,l=o[0],u=o[1],f=s.reduce(function(b){return b+l},0),c=document.createElement("canvas");c.width=f,c.height=u;for(var h=c.getContext("2d"),p=0,d=0,v=[],g=0;g<s.length;g++){var m=s[g];h.drawImage(m,p,d,l,u);var y={width:l,height:u,xx:m,x:p,y:d};p+=l,v.push(y)}c.toBlob(function(b){var _=document.createElement("img"),C=URL.createObjectURL(b);_.onload=function(){URL.revokeObjectURL(C),i({blob:b,xx:_,canvas:c,Mx:v})},_.src=C})},concatSprites=function n(r,i,s){var a=r.images,o=r.wx,l=o===void 0?[64,64]:o;if(!Array.isArray(a))throw new Error("must be called with an array of iconSrcs to concatenate");var u=a.map(function(c){try{if(_instanceof(c,SVGSVGElement)){var h=svgToBlobUrl(c),p=new Image;return p.crossOrigin="anonymous",p.src=h,p}else{if(_instanceof(c,Image))return c.crossOrigin="anonymous",c;var d=new Image;return d.crossOrigin="anonymous",d.src=c,d}}catch(v){throw v}}).filter(function(c){return c&&_instanceof(c,Image)}),f=u.map(function(c){return new Promise(function(h,p){try{c.onerror=function(d){h(d)},c.onload=function(){h(c)},c.complete&&h(c)}catch(d){p(d)}})});return Promise.all(f).then(function(c){return c.filter(function(h){return _instanceof(h,Image)})}).then(function(c){c.length?concatImages({images:c,wx:l},function(h){i(h)}):i()}).catch(function(c){s&&s(c)})},getIconIndex=function n(r,i,s){var a=-1,o=r;if(i.has(o))a=i.get(o);else{if(o=r,_instanceof(r,SVGSVGElement)){var l=new XMLSerializer;o=l.serializeToString(r)}else _instanceof(r,Image)&&(o=r.src);i.has(o)?a=i.get(o):(s.push(r),a=s.length-1,i.set(o,a))}return a},mergeImages=function n(r,i,s){var a=r.images,o=r.wx,l=o===void 0?[64,64]:o,u=new Map,f=[],c=a.map(function(h){var p=getIconIndex(h,u,f);return p});concatSprites({images:f,wx:l},function(h){if(h){var p=h.Mx,d=c.map(function(v){return p[v]});h.Mx=d}i&&i(h)},function(h){s&&s(h)})},toSvg=function n(r,i){return i=i||{},copyOptions(i),Promise.resolve(r).then(function(a){return cloneNode(a,i.filter,!0)}).then(embedFonts).then(inlineImages).then(s).then(function(a){return makeSvgDataUri(a,i.width||util.width(r),i.height||util.height(r))});function s(a){return i.hM&&(a.style.backgroundColor=i.hM),i.width&&(a.style.width=i.width+"px"),i.height&&(a.style.height=i.height+"px"),i.style&&Object.keys(i.style).forEach(function(o){a.style[o]=i.style[o]}),a}},toPixelData=function n(r,i){return draw(r,i||{}).then(function(s){return s.getContext("2d").getImageData(0,0,util.width(r),util.height(r)).data})},toPng=function n(r,i){return draw(r,i||{}).then(function(s){return s.toDataURL()})},toCanvas=function n(r,i){return draw(r,i||{}).then(function(s){return s})},toJpeg=function n(r,i){return i=i||{},draw(r,i).then(function(s){return s.toDataURL("image/jpeg",i.dM||1)})},toBlob=function n(r,i){return draw(r,i||{}).then(util.vM)},copyOptions=function n(r){typeof r.iM=="undefined"?domtoimage.sM.options.iM=defaultOptions.iM:domtoimage.sM.options.iM=r.iM,typeof r.rM=="undefined"?domtoimage.sM.options.rM=defaultOptions.rM:domtoimage.sM.options.rM=r.rM},draw=function n(r,i){return toSvg(r,i).then(util.pM).then(util.delay(100)).then(function(a){var o=s(r);return o.getContext("2d").drawImage(a,0,0),o});function s(a){var o=document.createElement("canvas");if(o.width=i.width||util.width(a),o.height=i.height||util.height(a),i.hM){var l=o.getContext("2d");l.fillStyle=i.hM,l.fillRect(0,0,o.width,o.height)}return o}},embedFonts=function n(r){return fontFaces.gM().then(function(i){var s=document.createElement("style");return r.appendChild(s),s.appendChild(document.createTextNode(i)),r})},inlineImages=function n(r){return images.yM(r).then(function(){return r})},makeSvgDataUri=function n(r,i,s){return Promise.resolve(r).then(function(a){return a.setAttribute("xmlns","http://www.w3.org/1999/xhtml"),new XMLSerializer().serializeToString(a)}).then(util.wM).then(function(a){return'<foreignObject x="0" y="0" width="100%" height="100%">'+a+"</foreignObject>"}).then(function(a){return'<svg xmlns="http://www.w3.org/2000/svg" width="'+i+'" height="'+s+'">'+a+"</svg>"}).then(function(a){return"data:image/svg+xml;charset=utf-8,"+a})},newUtil=function n(){return{escape:d,xM:i,mimeType:s,MM:p,kM:a,vM:l,CM:u,AM:h,bM:f(),delay:v,mM:g,wM:m,pM:c,width:y,height:b};function r(){var C="application/font-woff",A="image/jpeg";return{woff:C,woff2:C,ttf:"application/font-truetype",eot:"application/vnd.ms-fontobject",png:"image/png",jpg:A,jpeg:A,gif:"image/gif",tiff:"image/tiff",svg:"image/svg+xml"}}function i(C){var A=/\.([^\.\/]*?)$/g.exec(C);return A?A[1]:""}function s(C){var A=i(C).toLowerCase();return r()[A]||""}function a(C){return C.search(/^(data:)/)!==-1}function o(C){return new Promise(function(A){for(var I=window.atob(C.toDataURL().split(",")[1]),D=I.length,X=new Uint8Array(D),W=0;W<D;W++)X[W]=I.charCodeAt(W);A(new Blob([X],{type:"image/png"}))})}function l(C){return C.toBlob?new Promise(function(A){C.toBlob(A)}):o(C)}function u(C,A){var I=document.implementation.createHTMLDocument(),D=I.createElement("base");I.head.appendChild(D);var X=I.createElement("a");return I.body.appendChild(X),D.href=A,X.href=C,X.href}function f(){var C=0;return function(){return"u"+A()+C++;function A(){return("0000"+(Math.random()*Math.pow(36,4)<<0).toString(36)).slice(-4)}}}function c(C){return new Promise(function(A,I){var D=new Image;D.onload=function(){A(D)},D.onerror=I,D.src=C})}function h(C){var A=3e4;return domtoimage.sM.options.rM&&(C+=(/\?/.test(C)?"&":"?")+new Date().getTime()),new Promise(function(I){var D=new XMLHttpRequest;D.onreadystatechange=K,D.ontimeout=U,D.responseType="blob",D.timeout=A,D.open("GET",C,!0),D.send();var X;if(domtoimage.sM.options.iM){var W=domtoimage.sM.options.iM.split(/,/);W&&W[1]&&(X=W[1])}function K(){if(D.readyState===4){if(D.status!==200){X?I(X):M("cannot fetch resource: "+C+", status: "+D.status);return}var L=new FileReader;L.onloadend=function(){var P=L.result.split(/,/)[1];I(P)},L.readAsDataURL(D.response)}}function U(){X?I(X):M("timeout of "+A+"ms occured while fetching resource: "+C)}function M(L){console.error(L),I("")}})}function p(C,A){return"data:"+A+";base64,"+C}function d(C){return C.replace(/([.*+?^${}()|\[\]\/\\])/g,"\\$1")}function v(C){return function(A){return new Promise(function(I){setTimeout(function(){I(A)},C)})}}function g(C){for(var A=[],I=C.length,D=0;D<I;D++)A.push(C[D]);return A}function m(C){return C.replace(/#/g,"%23").replace(/\n/g,"%0A")}function y(C){var A=_(C,"border-left-width"),I=_(C,"border-right-width");return C.scrollWidth+A+I}function b(C){var A=_(C,"border-top-width"),I=_(C,"border-bottom-width");return C.scrollHeight+A+I}function _(C,A){var I=window.getComputedStyle(C).getPropertyValue(A);return parseFloat(I.replace("px",""))}},newInliner=function n(){var r=/url\(['"]?([^'"]+?)['"]?\)/g;return{yM:o,OM:i,sM:{zM:s,_M:a}};function i(l){return l.search(r)!==-1}function s(l){for(var u=[],f;(f=r.exec(l))!==null;)u.push(f[1]);return u.filter(function(c){return!util.kM(c)})}function a(l,u,f,c){return Promise.resolve(u).then(function(p){return f?util.CM(p,f):p}).then(c||util.AM).then(function(p){return util.MM(p,util.mimeType(u))}).then(function(p){return l.replace(h(u),"$1"+p+"$3")});function h(p){return new RegExp("(url\\(['\"]?)("+util.escape(p)+")(['\"]?\\))","g")}}function o(l,u,f){if(c())return Promise.resolve(l);return Promise.resolve(l).then(s).then(function(h){var p=Promise.resolve(l);return h.forEach(function(d){p=p.then(function(v){return a(v,d,u,f)})}),p});function c(){return!i(l)}}},newFontFaces=function n(){return{gM:r,sM:{SM:i}};function r(){return i().then(function(s){return Promise.all(s.map(function(a){return a.resolve()}))}).then(function(s){return s.join("\n")})}function i(){return Promise.resolve(util.mM(document.styleSheets)).then(a).then(s).then(function(l){return l.map(o)});function s(l){return l.filter(function(u){return u.type===CSSRule.FONT_FACE_RULE}).filter(function(u){return inliner.OM(u.style.getPropertyValue("src"))})}function a(l){var u=[];return l.forEach(function(f){try{util.mM(f.cssRules||[]).forEach(u.push.bind(u))}catch(c){console.log("Error while reading CSS rules from "+f.href,c.toString())}}),u}function o(l){return{resolve:function(){var u=(l.parentStyleSheet||{}).href;return inliner.yM(l.cssText,u)},src:function(){return l.style.getPropertyValue("src")}}}}},newImages=function n(){return{yM:i,sM:{IM:r}};function r(s){return{_M:a};function a(o){return util.kM(s.src)?Promise.resolve():Promise.resolve(s.src).then(o||util.AM).then(function(l){return util.MM(l,util.mimeType(s.src))}).then(function(l){return new Promise(function(u,f){s.onload=u,s.onerror=f,s.src=l})})}}function i(s){if(!_instanceof(s,Element))return Promise.resolve(s);return a(s).then(function(){return _instanceof(s,HTMLImageElement)?r(s)._M():Promise.all(util.mM(s.childNodes).map(function(o){return i(o)}))});function a(o){var l=o.style.getPropertyValue("background");return l?inliner.yM(l).then(function(u){o.style.setProperty("background",u,o.style.getPropertyPriority("background"))}).then(function(){return o}):Promise.resolve(o)}}},_arrayBuffer2TypedArray=function n(r,i,s,a){switch(a){case 5122:return new Int16Array(r,i,s);case 5123:return new Uint16Array(r,i,s);case 5124:return new Int32Array(r,i,s);case 5125:return new Uint32Array(r,i,s);case 5126:return new Float32Array(r,i,s);default:return null}},_getAccessorData=function n(r){return _arrayBuffer2TypedArray(r.bufferView.data,r.byteOffset,r.count*Type2NumOfComponent[r.type],r.componentType)},_getBaseUri=function n(r){var i="",s=r.lastIndexOf("/");return s!==-1&&(i=r.substring(0,s+1)),i},_loadGlb=function n(r,i){var s=new XMLHttpRequest;s.overrideMimeType("model/gltf-binary"),s.responseType="arraybuffer",s.open("GET",r,!0),s.onload=function(){var a=s.response;if(a){var o=new GLTFBinaryExtension(a);o.content&&(JSON.parse(o.content),i(o,this))}},s.send(null)},_loadJSON=function n(r,i){var s=new XMLHttpRequest;s.overrideMimeType("application/json"),s.open("GET",r,!0),s.onreadystatechange=function(){s.readyState==4&&s.status===200&&i(s.responseText,this)},s.send(null)},_loadArrayBuffer=function n(r,i,s){return __async$1(this,null,regeneratorRuntime$1.mark(function a(){var o,l;return regeneratorRuntime$1.wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return u.next=2,fetch(r);case 2:return o=u.sent,u.next=5,o.arrayBuffer();case 5:l=u.sent,i(l,s);case 7:case"end":return u.stop()}},a)}))},isPowOf2=function n(r){for(var i=2;i!==r&&i<r;)i*=2;return i==r},getFitPow=function n(r){for(var i=2;i<r;)i*=2;return i/r>1.5?i:i/2},_loadImage=function n(r,i,s){var a=new Image;a.crossOrigin="Anonymous",a.src=r,a.onload=function(o){var l=o.target,u=l.width,f=l.height;if(isPowOf2(u)&&isPowOf2(f)){s(l,i);return}var c=getFitPow(u),h=getFitPow(f);canvas.width=c,canvas.height=h,context.drawImage(l,0,0,c,h),s(context.getImageData(0,0,c,h),i)}},formatArray=function n(r,i,s){var a={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},o={5120:"int8",5121:"uint8",5122:"int16",5123:"uint16",5125:"uint32",5126:"float32"},l=r.bufferView.data,u=a[r.componentType],f;f=new u(l);var c=o[r.componentType];return s==="buffer"?f=i.buffer(f):f=i.elements({primitive:"triangles",type:c,data:f}),{array:f,type:c,offset:r.byteOffset||0,stride:r.byteStride||0,HAS:1}},BezierEasing__namespace=_interopNamespace(BezierEasing),earcut__default=_interopDefaultLegacy(earcut),REGL__default=_interopDefaultLegacy(REGL),dat__namespace=_interopNamespace(dat),polylabel$1={exports:{}},TinyQueue=function(){function n(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:defaultCompare;if(_classCallCheck(this,n),this.data=i,this.length=this.data.length,this.t$=s,this.length>0)for(var a=(this.length>>1)-1;a>=0;a--)this.e$(a)}var r=n.prototype;return r.push=function(i){this.data.push(i),this.length++,this.i$(this.length-1)},r.pop=function(){if(this.length!==0){var i=this.data[0],s=this.data.pop();return this.length--,this.length>0&&(this.data[0]=s,this.e$(0)),i}},r.n$=function(){return this.data[0]},r.i$=function(i){for(var s=this,a=s.data,o=s.t$,l=a[i];i>0;){var u=i-1>>1,f=a[u];if(o(l,f)>=0)break;a[i]=f,i=u}a[i]=l},r.e$=function(i){for(var s=this,a=s.data,o=s.t$,l=this.length>>1,u=a[i];i<l;){var f=(i<<1)+1,c=a[f],h=f+1;if(h<this.length&&o(a[h],c)<0&&(f=h,c=a[h]),o(c,u)>=0)break;a[i]=c,i=f}a[i]=u},n}(),tinyqueue=Object.freeze({__proto__:null,default:TinyQueue}),require$$0=getAugmentedNamespace(tinyqueue),Queue=require$$0;Queue.default&&(Queue=Queue.default),polylabel$1.exports=polylabel,polylabel$1.exports.default=polylabel;function coordEach(n,r,i){if(n!==null)for(var s,a,o,l,u,f,c,h=0,p=0,d,v=n.type,g=v==="FeatureCollection",m=v==="Feature",y=g?n.features.length:1,b=0;b<y;b++){c=g?n.features[b].geometry:m?n.geometry:n,d=c?c.type==="GeometryCollection":!1,u=d?c.tz.length:1;for(var _=0;_<u;_++){var C=0,A=0;if(l=d?c.tz[_]:c,l!==null){f=l.coordinates;var I=l.type;switch(h=i&&(I==="Polygon"||I==="MultiPolygon")?1:0,I){case null:break;case"Point":if(r(f,p,b,C,A)===!1)return!1;p++,C++;break;case"LineString":case"MultiPoint":for(s=0;s<f.length;s++){if(r(f[s],p,b,C,A)===!1)return!1;p++,I==="MultiPoint"&&C++}I==="LineString"&&C++;break;case"Polygon":case"MultiLineString":for(s=0;s<f.length;s++){for(a=0;a<f[s].length-h;a++){if(r(f[s][a],p,b,C,A)===!1)return!1;p++}I==="MultiLineString"&&C++,I==="Polygon"&&A++}I==="Polygon"&&C++;break;case"MultiPolygon":for(s=0;s<f.length;s++){for(A=0,a=0;a<f[s].length;a++){for(o=0;o<f[s][a].length-h;o++){if(r(f[s][a][o],p,b,C,A)===!1)return!1;p++}A++}C++}break;case"GeometryCollection":for(s=0;s<l.tz.length;s++)if(coordEach(l.tz[s],r,i)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}var geobuf={},encode_1=encode,keys$1,keysNum,keysArr,dim$1,e$1,maxPrecision=1e6,geometryTypes$1={Point:0,MultiPoint:1,LineString:2,MultiLineString:3,Polygon:4,MultiPolygon:5,GeometryCollection:6};function analyze(n){var r,i;if(n.type==="FeatureCollection")for(r=0;r<n.features.length;r++)analyze(n.features[r]);else if(n.type==="Feature"){n.geometry!==null&&analyze(n.geometry);for(i in n.properties)saveKey(i)}else if(n.type==="Point")analyzePoint(n.coordinates);else if(n.type==="MultiPoint")analyzePoints(n.coordinates);else if(n.type==="GeometryCollection")for(r=0;r<n.tz.length;r++)analyze(n.tz[r]);else if(n.type==="LineString")analyzePoints(n.coordinates);else if(n.type==="Polygon"||n.type==="MultiLineString")analyzeMultiLine(n.coordinates);else if(n.type==="MultiPolygon")for(r=0;r<n.coordinates.length;r++)analyzeMultiLine(n.coordinates[r]);for(i in n)isSpecialKey(i,n.type)||saveKey(i)}function writeGeometry(n,r){r.tP(1,geometryTypes$1[n.type]);var i=n.coordinates;if(n.type==="Point")writePoint(i,r);else if(n.type==="MultiPoint")writeLine(i,r);else if(n.type==="LineString")writeLine(i,r);else if(n.type==="MultiLineString")writeMultiLine(i,r);else if(n.type==="Polygon")writeMultiLine(i,r,!0);else if(n.type==="MultiPolygon")writeMultiPolygon(i,r);else if(n.type==="GeometryCollection")for(var s=0;s<n.tz.length;s++)r.Az(4,writeGeometry,n.tz[s]);writeProps(n,r,!0)}var decode_1=decode,keys,values,lengths,dim,e,geometryTypes=["Point","MultiPoint","LineString","MultiLineString","Polygon","MultiPolygon","GeometryCollection"];geobuf.encode=encode_1,geobuf.decode=decode_1;var ieee754$1={};ieee754$1.read=function(n,r,i,s,a){var o,l,u=a*8-s-1,f=(1<<u)-1,c=f>>1,h=-7,p=i?a-1:0,d=i?-1:1,v=n[r+p];for(p+=d,o=v&(1<<-h)-1,v>>=-h,h+=u;h>0;o=o*256+n[r+p],p+=d,h-=8);for(l=o&(1<<-h)-1,o>>=-h,h+=s;h>0;l=l*256+n[r+p],p+=d,h-=8);if(o===0)o=1-c;else{if(o===f)return l?NaN:(v?-1:1)*(1/0);l=l+Math.pow(2,s),o=o-c}return(v?-1:1)*l*Math.pow(2,o-s)},ieee754$1.write=function(n,r,i,s,a,o){var l,u,f,c=o*8-a-1,h=(1<<c)-1,p=h>>1,d=a===23?Math.pow(2,-24)-Math.pow(2,-77):0,v=s?0:o-1,g=s?1:-1,m=r<0||r===0&&1/r<0?1:0;for(r=Math.abs(r),isNaN(r)||r===1/0?(u=isNaN(r)?1:0,l=h):(l=Math.floor(Math.log(r)/Math.LN2),r*(f=Math.pow(2,-l))<1&&(l--,f*=2),l+p>=1?r+=d/f:r+=d*Math.pow(2,1-p),r*f>=2&&(l++,f/=2),l+p>=h?(u=0,l=h):l+p>=1?(u=(r*f-1)*Math.pow(2,a),l=l+p):(u=r*Math.pow(2,p-1)*Math.pow(2,a),l=0));a>=8;n[i+v]=u&255,v+=g,u/=256,a-=8);for(l=l<<a|u,c+=a;c>0;n[i+v]=l&255,v+=g,l/=256,c-=8);n[i+v-g]|=m*128};var pbf=Pbf,ieee754=ieee754$1;Pbf.oz=0,Pbf.sz=1,Pbf.az=2,Pbf.uz=5;var SHIFT_LEFT_32=(1<<16)*(1<<16),SHIFT_RIGHT_32=1/SHIFT_LEFT_32,TEXT_DECODER_MIN_LENGTH=12,utf8TextDecoder=typeof TextDecoder=="undefined"?null:new TextDecoder("utf8");Pbf.prototype={destroy:function n(){this.rz=null},ez:function n(r,i,s){for(s=s||this.length;this.Br<s;){var a=this.YC(),o=a>>3,l=this.Br;this.type=a&7,r(o,i,this),this.Br===l&&this.yz(a)}return i},$C:function n(r,i){return this.ez(r,i,this.YC()+this.Br)},xz:function n(){var r=readUInt32(this.rz,this.Br);return this.Br+=4,r},wz:function n(){var r=readInt32(this.rz,this.Br);return this.Br+=4,r},Cz:function n(){var r=readUInt32(this.rz,this.Br)+readUInt32(this.rz,this.Br+4)*SHIFT_LEFT_32;return this.Br+=8,r},kz:function n(){var r=readUInt32(this.rz,this.Br)+readInt32(this.rz,this.Br+4)*SHIFT_LEFT_32;return this.Br+=8,r},hl:function n(){var r=ieee754.read(this.rz,this.Br,!0,23,4);return this.Br+=4,r},iz:function n(){var r=ieee754.read(this.rz,this.Br,!0,52,8);return this.Br+=8,r},YC:function n(r){var i=this.rz,s,a;return a=i[this.Br++],s=a&127,a<128||(a=i[this.Br++],s|=(a&127)<<7,a<128)||(a=i[this.Br++],s|=(a&127)<<14,a<128)||(a=i[this.Br++],s|=(a&127)<<21,a<128)?s:(a=i[this.Br],s|=(a&15)<<28,readVarintRemainder(s,r,this))},zz:function n(){return this.YC(!0)},ZC:function n(){var r=this.YC();return r%2===1?(r+1)/-2:r/2},nz:function n(){return Boolean(this.YC())},JC:function n(){var r=this.YC()+this.Br,i=this.Br;return this.Br=r,r-i>=TEXT_DECODER_MIN_LENGTH&&utf8TextDecoder?readUtf8TextDecoder(this.rz,i,r):readUtf8(this.rz,i,r)},Pz:function n(){var r=this.YC()+this.Br,i=this.rz.subarray(this.Br,r);return this.Br=r,i},KC:function n(r,i){if(this.type!==Pbf.az)return r.push(this.YC(i));var s=readPackedEnd(this);for(r=r||[];this.Br<s;)r.push(this.YC(i));return r},Sz:function n(r){if(this.type!==Pbf.az)return r.push(this.ZC());var i=readPackedEnd(this);for(r=r||[];this.Br<i;)r.push(this.ZC());return r},Mz:function n(r){if(this.type!==Pbf.az)return r.push(this.nz());var i=readPackedEnd(this);for(r=r||[];this.Br<i;)r.push(this.nz());return r},_z:function n(r){if(this.type!==Pbf.az)return r.push(this.hl());var i=readPackedEnd(this);for(r=r||[];this.Br<i;)r.push(this.hl());return r},Iz:function n(r){if(this.type!==Pbf.az)return r.push(this.iz());var i=readPackedEnd(this);for(r=r||[];this.Br<i;)r.push(this.iz());return r},Vz:function n(r){if(this.type!==Pbf.az)return r.push(this.xz());var i=readPackedEnd(this);for(r=r||[];this.Br<i;)r.push(this.xz());return r},Dz:function n(r){if(this.type!==Pbf.az)return r.push(this.wz());var i=readPackedEnd(this);for(r=r||[];this.Br<i;)r.push(this.wz());return r},Lz:function n(r){if(this.type!==Pbf.az)return r.push(this.Cz());var i=readPackedEnd(this);for(r=r||[];this.Br<i;)r.push(this.Cz());return r},Fz:function n(r){if(this.type!==Pbf.az)return r.push(this.kz());var i=readPackedEnd(this);for(r=r||[];this.Br<i;)r.push(this.kz());return r},yz:function n(r){var i=r&7;if(i===Pbf.oz)for(;this.rz[this.Br++]>127;);else if(i===Pbf.az)this.Br=this.YC()+this.Br;else if(i===Pbf.uz)this.Br+=4;else if(i===Pbf.sz)this.Br+=8;else throw new Error("Unimplemented type: "+i)},Rz:function n(r,i){this.lz(r<<3|i)},hz:function n(r){for(var i=this.length||16;i<this.Br+r;)i*=2;if(i!==this.length){var s=new Uint8Array(i);s.set(this.rz),this.rz=s,this.length=i}},finish:function n(){return this.length=this.Br,this.Br=0,this.rz.subarray(0,this.length)},pz:function n(r){this.hz(4),writeInt32(this.rz,r,this.Br),this.Br+=4},mz:function n(r){this.hz(4),writeInt32(this.rz,r,this.Br),this.Br+=4},gz:function n(r){this.hz(8),writeInt32(this.rz,r&-1,this.Br),writeInt32(this.rz,Math.floor(r*SHIFT_RIGHT_32),this.Br+4),this.Br+=8},bz:function n(r){this.hz(8),writeInt32(this.rz,r&-1,this.Br),writeInt32(this.rz,Math.floor(r*SHIFT_RIGHT_32),this.Br+4),this.Br+=8},lz:function n(r){if(r=+r||0,r>268435455||r<0){writeBigVarint(r,this);return}this.hz(4),this.rz[this.Br++]=r&127|(r>127?128:0),!(r<=127)&&(this.rz[this.Br++]=(r>>>=7)&127|(r>127?128:0),!(r<=127)&&(this.rz[this.Br++]=(r>>>=7)&127|(r>127?128:0),!(r<=127)&&(this.rz[this.Br++]=r>>>7&127)))},fz:function n(r){this.lz(r<0?-r*2-1:r*2)},dz:function n(r){this.lz(Boolean(r))},Tz:function n(r){r=String(r),this.hz(r.length*4),this.Br++;var i=this.Br;this.Br=writeUtf8(this.rz,r,this.Br);var s=this.Br-i;s>=128&&makeRoomForExtraLength(i,s,this),this.Br=i-1,this.lz(s),this.Br+=s},cz:function n(r){this.hz(4),ieee754.write(this.rz,r,this.Br,!0,23,4),this.Br+=4},vz:function n(r){this.hz(8),ieee754.write(this.rz,r,this.Br,!0,52,8),this.Br+=8},Oz:function n(r){var i=r.length;this.lz(i),this.hz(i);for(var s=0;s<i;s++)this.rz[this.Br++]=r[s]},Bz:function n(r,i){this.Br++;var s=this.Br;r(i,this);var a=this.Br-s;a>=128&&makeRoomForExtraLength(s,a,this),this.Br=s-1,this.lz(a),this.Br+=a},Az:function n(r,i,s){this.Rz(r,Pbf.az),this.Bz(i,s)},Wz:function n(r,i){i.length&&this.Az(r,writePackedVarint,i)},Nz:function n(r,i){i.length&&this.Az(r,writePackedSVarint,i)},Ez:function n(r,i){i.length&&this.Az(r,writePackedBoolean,i)},jz:function n(r,i){i.length&&this.Az(r,writePackedFloat,i)},Uz:function n(r,i){i.length&&this.Az(r,writePackedDouble,i)},Gz:function n(r,i){i.length&&this.Az(r,writePackedFixed32,i)},qz:function n(r,i){i.length&&this.Az(r,writePackedSFixed32,i)},Qz:function n(r,i){i.length&&this.Az(r,writePackedFixed64,i)},Xz:function n(r,i){i.length&&this.Az(r,writePackedSFixed64,i)},Jz:function n(r,i){this.Rz(r,Pbf.az),this.Oz(i)},Yz:function n(r,i){this.Rz(r,Pbf.uz),this.pz(i)},$z:function n(r,i){this.Rz(r,Pbf.uz),this.mz(i)},Zz:function n(r,i){this.Rz(r,Pbf.sz),this.gz(i)},Kz:function n(r,i){this.Rz(r,Pbf.sz),this.bz(i)},tP:function n(r,i){this.Rz(r,Pbf.oz),this.lz(i)},iP:function n(r,i){this.Rz(r,Pbf.oz),this.fz(i)},nP:function n(r,i){this.Rz(r,Pbf.az),this.Tz(i)},eP:function n(r,i){this.Rz(r,Pbf.uz),this.cz(i)},rP:function n(r,i){this.Rz(r,Pbf.sz),this.vz(i)},oP:function n(r,i){this.tP(r,Boolean(i))}};var __defProp$3$1=Object.defineProperty,__defProps$2$1=Object.defineProperties,__getOwnPropDescs$2$1=Object.getOwnPropertyDescriptors,__getOwnPropSymbols$3$1=Object.getOwnPropertySymbols,__hasOwnProp$3$1=Object.prototype.hasOwnProperty,__propIsEnum$3$1=Object.prototype.propertyIsEnumerable,__defNormalProp$3$1=function(n,r,i){return r in n?__defProp$3$1(n,r,{Fr:!0,Lr:!0,writable:!0,value:i}):n[r]=i},__spreadValues$3$1=function(n,r){for(var i in r||(r={}))__hasOwnProp$3$1.call(r,i)&&__defNormalProp$3$1(n,i,r[i]);var s=!0,a=!1,o=void 0;if(__getOwnPropSymbols$3$1)try{for(var l=__getOwnPropSymbols$3$1(r)[Symbol.iterator](),u;!(s=(u=l.next()).done);s=!0){var i=u.value;__propIsEnum$3$1.call(r,i)&&__defNormalProp$3$1(n,i,r[i])}}catch(f){a=!0,o=f}finally{try{!s&&l.return!=null&&l.return()}finally{if(a)throw o}}return n},__spreadProps$2$1=function(n,r){return __defProps$2$1(n,__getOwnPropDescs$2$1(r))},colorNameDist={aliceblue:"#f0f8ff",antiquewhite:"#faebd7",aqua:"#00ffff",aquamarine:"#7fffd4",azure:"#f0ffff",beige:"#f5f5dc",bisque:"#ffe4c4",black:"#000000",blanchedalmond:"#ffebcd",blue:"#0000ff",blueviolet:"#8a2be2",brown:"#a52a2a",burlywood:"#deb887",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",cornflowerblue:"#6495ed",cornsilk:"#fff8dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkgray:"#a9a9a9",darkgreen:"#006400",darkkhaki:"#bdb76b",darkmagenta:"#8b008b",darkolivegreen:"#556b2f",darkorange:"#ff8c00",darkorchid:"#9932cc",darkred:"#8b0000",darksalmon:"#e9967a",darkseagreen:"#8fbc8f",darkslateblue:"#483d8b",darkslategray:"#2f4f4f",darkturquoise:"#00ced1",darkviolet:"#9400d3",deeppink:"#ff1493",deepskyblue:"#00bfff",dimgray:"#696969",dodgerblue:"#1e90ff",firebrick:"#b22222",floralwhite:"#fffaf0",forestgreen:"#228b22",fuchsia:"#ff00ff",gainsboro:"#dcdcdc",ghostwhite:"#f8f8ff",gold:"#ffd700",goldenrod:"#daa520",grey:"#808080",gray:"#808080",green:"#008000",greenyellow:"#adff2f",honeydew:"#f0fff0",hotpink:"#ff69b4",indianred:"#cd5c5c",indigo:"#4b0082",ivory:"#fffff0",khaki:"#f0e68c",lavender:"#e6e6fa",lavenderblush:"#fff0f5",lawngreen:"#7cfc00",lemonchiffon:"#fffacd",lightblue:"#add8e6",lightcoral:"#f08080",lightcyan:"#e0ffff",lightgoldenrodyellow:"#fafad2",lightgrey:"#d3d3d3",lightgreen:"#90ee90",lightpink:"#ffb6c1",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",lightskyblue:"#87cefa",lightslategray:"#778899",lightsteelblue:"#b0c4de",lightyellow:"#ffffe0",lime:"#00ff00",limegreen:"#32cd32",linen:"#faf0e6",magenta:"#ff00ff",maroon:"#800000",mediumaquamarine:"#66cdaa",mediumblue:"#0000cd",mediumorchid:"#ba55d3",mediumpurple:"#9370d8",mediumseagreen:"#3cb371",mediumslateblue:"#7b68ee",mediumspringgreen:"#00fa9a",mediumturquoise:"#48d1cc",mediumvioletred:"#c71585",midnightblue:"#191970",mintcream:"#f5fffa",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",navajowhite:"#ffdead",navy:"#000080",oldlace:"#fdf5e6",olive:"#808000",olivedrab:"#6b8e23",orange:"#ffa500",orangered:"#ff4500",orchid:"#da70d6",palegoldenrod:"#eee8aa",palegreen:"#98fb98",paleturquoise:"#afeeee",palevioletred:"#d87093",papayawhip:"#ffefd5",peachpuff:"#ffdab9",peru:"#cd853f",pink:"#ffc0cb",plum:"#dda0dd",powderblue:"#b0e0e6",purple:"#800080",rebeccapurple:"#663399",red:"#ff0000",rosybrown:"#bc8f8f",royalblue:"#4169e1",saddlebrown:"#8b4513",salmon:"#fa8072",sandybrown:"#f4a460",seagreen:"#2e8b57",seashell:"#fff5ee",sienna:"#a0522d",silver:"#c0c0c0",skyblue:"#87ceeb",slateblue:"#6a5acd",slategray:"#708090",snow:"#fffafa",springgreen:"#00ff7f",steelblue:"#4682b4",tan:"#d2b48c",teal:"#008080",thistle:"#d8bfd8",tomato:"#ff6347",turquoise:"#40e0d0",violet:"#ee82ee",wheat:"#f5deb3",white:"#ffffff",whitesmoke:"#f5f5f5",yellow:"#ffff00",yellowgreen:"#9acd32"},ColorUtil$1={yC:function n(r){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;if(!r)return r;for(var s=[],a=0,o=r.length;a<o;a+=2){var l=parseInt(r.substr(a,2),16);i&&(l=parseInt(l/255+"")),s.push(l)}return s.push(s.shift()),s},xC:function n(r){var i=r.split(",");return i[0]=parseFloat(i[0].slice(5))/255,i[1]=parseFloat(i[1])/255,i[2]=parseFloat(i[2])/255,i[3]=parseFloat(i[3]),i},Zn:function n(r){var i=r.split(",");return i[0]=parseFloat(i[0].slice(4))/255,i[1]=parseFloat(i[1])/255,i[2]=parseFloat(i[2])/255,i[3]=1,i},CC:function n(r){for(var i=[],s=1,a=r.length;s<a;s+=2)i.push(parseInt(r.substr(s,2),16));return i.push((i.shift()/255).toFixed(2)),"rgba("+i.join(",")+")"},$n:function n(r){for(var i=[],s=1,a=r.length;s<a;s+=2)i.push(parseInt(r.substr(s,2),16)/255);return i},Kn:function n(r){for(var i=[],s=1,a=r.length;s<a;s+=2)i.push(parseInt(r.substr(s,2),16)/255);return i[3]=1,i},ti:function n(r){for(var i=[],s=1,a=r.length;s<a;s+=1){var o=r.substr(s,1);i.push(parseInt(o+o,16)/255)}return i[3]=1,i},kC:function n(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"";return r=r.toLowerCase(),colorNameDist[r]},zC:function n(r){if(_instanceof(r,Array))return[r[0]/255,r[1]/255,r[2]/255,r[3]||1];if(/^rgba\(/.test(r))return this.xC(r);if(/^rgb\(/.test(r))return this.Zn(r);if(r[0]==="#"&&typeof r=="string"){var i=r.length;if(i===4)return this.ti(r);if(i===7)return this.Kn(r);if(i===9)return this.$n(r)}else if(typeof r=="string"){var s=this.kC(r);return this.Kn(s)}return r}},DomUtil={wC:function n(r,i){var s=i.target;if(s){var a=r.getBoundingClientRect(),o=[r.clientLeft,r.clientTop],l=i;return _instanceof(i,TouchEvent)&&i.touches&&i.changedTouches&&(i.touches.length>0?l=i.touches[0]:l=i.changedTouches[i.changedTouches.length-1]),[l.clientX-a.left-o[0],l.clientY-a.left-o[1]]}return[0,0]}},MathUtil={PC:function n(r){return r/180*Math.PI},SC:function n(r){return r*180/Math.PI}},CommonUtil$1={MC:function n(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"",i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:10;return r+Math.round(Math.random()*Math.pow(10,i))+"_"+new Date().getTime()},_C:function n(r,i){var s=r.length,a=i.length;r.length=s+a;for(var o=0;o<a;o++)r[s+o]=i[o];return r},ni:function n(r,i){var s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};r=encodeURI(r);var a={callback:"callback",type:"json",charset:"utf-8"},o=CommonUtil$1.MC("jsonp_",6)+"_",l=document.createElement("script");l.type="text/javascript",l.async=!0,s=Object.assign({},a,s);var u=function(){window[o]=null,l.onerror=null,l.parentNode&&l.parentNode.removeChild(l)};l.onerror=function(){u(),i&&i("error",{url:r,info:"Request Error"})},window[o]=function(p){u(),i&&i("complete",{info:"ok",url:r,data:p})};var f="?";r.indexOf("?")!==-1&&(f="&");var c=r+f+s.callback+"="+o;l.src=c;var h=document.getElementsByTagName("body")[0]||document.getElementsByTagName("head")[0];h.appendChild(l)},grid:{ri:function n(r){for(var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:100,s={},a=[],o=i*2,l=-1,u=r.length;++l<u;){var f=r[l].coordinaties,c=Math.floor(f[0]/o),h=Math.floor(f[1]/o),p=c+"-"+h,d=s[p];d?d.coordinates.push(r[l]):(s[p]=d={rowCol:[c,h],center:[c*o+i,h*o+i],coordinates:[r[l]]},a.push(d))}return a},DC:function n(r,i){var s,a=[],o=i.gap,l=i.radius,u=o/2,f=_slicedToArray(r.center,2),c=f[0],h=f[1],p=[c-l+u,h+l-u],d=[c-l+u,h-l+u],v=[c+l-u,h-l+u],g=[c+l-u,h+l-u];return(s=a).push.apply(s,[p,d,v,g,p]),a}},hexagon:{ei:Math.PI/3,oi:[0,Math.PI/3,2*Math.PI/3,Math.PI/3,Math.PI/3,5*Math.PI/3],ri:function n(r){for(var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:100,s={},a=[],o=i*2*Math.sin(this.ei),l=i*1.5,u=0,f=r.length;u<f;++u){var c=r[u].coordinaties,h=_slicedToArray(c,2),p=h[0],d=h[1];d=d/l;var v=Math.round(d);p=p/o-(v&1)/2;var g=Math.round(p),m=d-v;if(Math.abs(m)*3>1){var y=p-g,b=g+(p<g?-1:1)/2,_=v+(d<v?-1:1),C=p-b,A=d-_;y*y+m*m>C*C+A*A&&(g=b+(v&1?1:-1)/2,v=_)}var I=g+"-"+v,D=s[I];D?D.coordinates.push(r[u]):(s[I]=D={rowCol:[g,v],center:[(g+(v&1)/2)*o,v*l],coordinates:[r[u]]},a.push(D))}return a},DC:function n(r,i){var s,a=[],o=i.gap,l=i.radius,u=o/2,f=l/2,c=Math.sqrt(3)*l,h=Math.sqrt(Math.pow(c,2)+Math.pow(l,2)),p=_slicedToArray(r.center,2),d=p[0],v=p[1],g=[d,v+h/2-u],m=[d-c/2+u,v+f-u/2],y=[d-c/2+u,v-f+u/2],b=[d,v-h/2+u],_=[d+c/2-u,v-f+u/2],C=[d+c/2-u,v+f-u/2];return(s=a).push.apply(s,[g,m,y,b,_,C,g]),a}},ai:function n(r){var i=[];if(r.type==="MultiPoint")for(var s=r.properties,a=r.coordinates,o=a.length,l=0;l<o;++l){var u=a[l];i.push({properties:s,type:"Point",coordinates:u})}else if(r.type==="MultiLineString")for(var f=r.properties,c=r.coordinates,h=c.length,p=0;p<h;++p){var d=c[p];i.push({properties:f,type:"Point",coordinates:d})}else if(r.type==="MultiPolygon")for(var v=r.properties,g=r.coordinates,m=g.length,y=0;y<m;++y){var b=g[y];i.push({properties:v,type:"Point",coordinates:b})}return i}},GeometryUtil=__spreadProps$2$1(__spreadValues$3$1({},AMap.GeometryUtil),{s$:function n(r){var i=0;if(r&&r.length>0){i+=Math.abs(this.ringArea(r[0]));for(var s=1;s<r.length;s++)i-=Math.abs(this.ringArea(r[s]))}return i},a$:function n(r){return polylabel$1.exports(r,1)},l$:function n(r){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},s=0,a=0,o=0;return coordEach(r,function(l){s+=l[0],a+=l[1],o++},!0),point$1([s/o,a/o],i.properties)},c$:function n(r){for(var i=multiPoint(r),s=i.geometry,a=this.l$(i),o=!1,l=0;!o&&l<s.coordinates.length;)a.geometry.coordinates[0]===s.coordinates[l][0]&&a.geometry.coordinates[1]===s.coordinates[l][1]&&(o=!0),l++;if(o)return a.geometry.coordinates;var u=1/0,f,c=!0,h=!1,p=void 0;try{for(var d=s.coordinates[Symbol.iterator](),v;!(c=(v=d.next()).done);c=!0){var g=v.value,m=this.distance(g,a.geometry.coordinates);m<u&&(u=m,f=g)}}catch(y){h=!0,p=y}finally{try{!c&&d.return!=null&&d.return()}finally{if(h)throw p}}return f}}),LangUtil={Wb:function n(r){return Object.prototype.toString.call(r)==="[object Object]"}},__defProp$2$1=Object.defineProperty,__getOwnPropSymbols$2$1=Object.getOwnPropertySymbols,__hasOwnProp$2$1=Object.prototype.hasOwnProperty,__propIsEnum$2$1=Object.prototype.propertyIsEnumerable,__defNormalProp$2$1=function(n,r,i){return r in n?__defProp$2$1(n,r,{Fr:!0,Lr:!0,writable:!0,value:i}):n[r]=i},__spreadValues$2$1=function(n,r){for(var i in r||(r={}))__hasOwnProp$2$1.call(r,i)&&__defNormalProp$2$1(n,i,r[i]);var s=!0,a=!1,o=void 0;if(__getOwnPropSymbols$2$1)try{for(var l=__getOwnPropSymbols$2$1(r)[Symbol.iterator](),u;!(s=(u=l.next()).done);s=!0){var i=u.value;__propIsEnum$2$1.call(r,i)&&__defNormalProp$2$1(n,i,r[i])}}catch(f){a=!0,o=f}finally{try{!s&&l.return!=null&&l.return()}finally{if(a)throw o}}return n},ColorUtil=ColorUtil$1,_Style=function(){function n(){_classCallCheck(this,n)}var r=n.prototype;return r.parse=function(i,s,a){for(var o={},l={},u={},f=0,c=i.length;f<c;f++){var h=i[f],p=this.u$(h,f,s,a);for(var d in p)o[d]||(o[d]=[]),o[d].push(p[d])}for(var v in a)if(["uniform","config"].includes(a[v].render)){var g=this.h$(v,s[v],a[v].defaultValue,a[v].type);a[v].render==="uniform"?l[v]=g:u[v]=g}return{attributes:o,uniforms:l,si:u}},r.u$=function(i,s,a,o){var l={};for(var u in o)o[u].render==="attribute"&&(l[u]=this.h$(u,a[u],o[u].defaultValue,o[u].type,function(){return[s,i]}));return l},r.h$=function(i,s,a,o,l){var u=typeof o=="function"?o(i):o;if((LangUtil.Wb(a)||LangUtil.Wb(s))&&u==="nest"){var f=__spreadValues$2$1(__spreadValues$2$1({},a),s);for(var c in f)if(Object.prototype.toString.call(f[c])==="[object Object]")f[c]=this.h$(c,f[c],(a||{})[c],o,l);else if(typeof f[c]=="function"){var h;f[c]=this.f$(u,(h=f)[c].apply(h,_toConsumableArray((l==null?void 0:l(i))||[])))}else f[c]=this.f$(u,f[c]);return f}else{var p;return typeof s=="function"?p=s.apply(void 0,_toConsumableArray((l==null?void 0:l(i))||[])):p=s!=null?s:a,this.f$(u,p)}},r.f$=function(i,s){if(i==="color")return ColorUtil.zC(s);if(i==="colors"){if(!Array.isArray(s))throw new Error("style.colors \u5FC5\u987B\u662F\u6570\u7EC4");return s.map(function(a){return ColorUtil.zC(a)})}return s},n.getInstance=function(){return this.ui},n}(),Style=_Style;Style.ui=new _Style;var StyleInstance=Style.getInstance(),__defProp$1$2=Object.defineProperty,__defProps$1$1=Object.defineProperties,__getOwnPropDescs$1$1=Object.getOwnPropertyDescriptors,__getOwnPropSymbols$1$2=Object.getOwnPropertySymbols,__hasOwnProp$1$2=Object.prototype.hasOwnProperty,__propIsEnum$1$2=Object.prototype.propertyIsEnumerable,__defNormalProp$1$2=function(n,r,i){return r in n?__defProp$1$2(n,r,{Fr:!0,Lr:!0,writable:!0,value:i}):n[r]=i},__spreadValues$1$2=function(n,r){for(var i in r||(r={}))__hasOwnProp$1$2.call(r,i)&&__defNormalProp$1$2(n,i,r[i]);var s=!0,a=!1,o=void 0;if(__getOwnPropSymbols$1$2)try{for(var l=__getOwnPropSymbols$1$2(r)[Symbol.iterator](),u;!(s=(u=l.next()).done);s=!0){var i=u.value;__propIsEnum$1$2.call(r,i)&&__defNormalProp$1$2(n,i,r[i])}}catch(f){a=!0,o=f}finally{try{!s&&l.return!=null&&l.return()}finally{if(a)throw o}}return n},__spreadProps$1$1=function(n,r){return __defProps$1$1(n,__getOwnPropDescs$1$1(r))},Event=function(){function n(){_classCallCheck(this,n),this.fi={}}var r=n.prototype;return r.on=function(i,s){var a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:this,o=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1,l;Array.isArray(i)?l=i:l=[i];var u=!0,f=!1,c=void 0;try{for(var h=l[Symbol.iterator](),p;!(u=(p=h.next()).done);u=!0){var d=p.value;this._on(d,s,a,o)}}catch(v){f=!0,c=v}finally{try{!u&&h.return!=null&&h.return()}finally{if(f)throw c}}return this},r.off=function(i,s){var a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:this,o=this.fi;if(i in o){for(var l=0;l<o[i].length;l+=1)if(o[i][l].hi===s&&o[i][l].context===a)return o[i].splice(l,1),this}return this},r.hasEvents=function(i,s){var a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:this,o=this.fi;if(i&&s&&i in o){for(var l=0;l<o[i].length;l+=1)if(o[i][l].hi===s&&o[i][l].context===a)return!0}return!1},r.clearEvents=function(i){return i?this.fi[i]&&delete this.fi[i]:this.fi={},this},r.emit=function(i){var s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!(i in this.fi))return this;for(var a=__spreadProps$1$1(__spreadValues$1$2({},s),{type:i}),o=this.fi[i],l=0,u=o.length;l<u;l+=1){var f=o[l];!f.hi||(f.hi.call(f.context,a),f.once&&(this.fi[i].splice(l,1),l-=1,u-=1))}return this},r.getEvents=function(){return this.fi},r._on=function(i,s){var a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:this,o=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1;if(this.hasEvents(i,s,a))return this;var l=this.fi;return l[i]=l[i]||[],l[i].push({hi:s,context:a||this,once:o}),this},n}(),parser=new uaParserJs.UAParser,buryPoint={sr:Math.random(),cr:"1.0",lr:{},hr:"",dr:"LOCA",vr:{},pr:{},init:function n(){this.mr(),setTimeout(function(){buryPoint.send()},2e3),setInterval(function(){buryPoint.send()},1e4)},setAPIKey:function n(r){this.hr=r},setContainer:function n(r){this.lr=r;var i=r.getBoundingClientRect();this.pr.size=[i.width,i.height]},setVersion:function n(r){this.cr=r},mr:function n(){var r=document.createElement("canvas"),i=r.getContext("webgl");if(i){var s=i.getExtension("WEBGL_debug_renderer_info");this.pr.br=s&&i.getParameter(s.UNMASKED_RENDERER_WEBGL)}},getKey:function n(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"",i=arguments.length>1?arguments[1]:void 0;r=r;var s,a=[];return Object.prototype.toString.call(i)==="[object Object]"&&(a=Object.keys(i)),i!==void 0&&r?s=r+"@"+a.join():s=r,s},record:function n(r,i,s){this.vr[r]||(this.vr[r]={});var a=this.getKey(i,s);this.vr[r][a]==null&&(this.vr[r][a]=0)},send:function n(){var r=[];for(var i in this.vr)if(this.vr.hasOwnProperty(i)){var s=this.vr[i],a=[];for(var o in s)s.hasOwnProperty(o)&&s[o]==0&&(a.push(o),s[o]=1);a.length&&r.push(i+"~"+a.join(","))}if(r.length){var l=parser.getResult(),u=["type=nfl","k="+this.hr,"m="+(l.device.type==="moblie"?1:0),"pf="+l.os.name,"v="+this.cr,"branch="+this.dr,"logversion=2.0","gc="+this.pr.br,"log="+r.join("!"),"appname="+window.location.origin+window.location.pathname,"sdkversion="+this.cr],f="https://webapi.amap.com/count?"+u.join("&");CommonUtil$1.ni(f)}},gr:function n(){}},Layer$1=function(n){_inherits(i,n);var r=_createSuper(i);function i(a){_classCallCheck(this,i);var o;return o=r.call(this),o.CLASS_NAME="Layer",o.meshes=[],o.preHandle=!1,o.buryPoint=buryPoint,o.d$=a,o.id=CommonUtil$1.MC(),o.map=a.map,o.zIndex=a.zIndex,o.visible=a.visible,o.opacity=a.opacity,o.zooms=a.zooms,o.style=StyleInstance,o.preHandle=!!a.preHandle,o}var s=i.prototype;return s.setSource=function(a,o){this.source&&this.source.Mr(this),this.buryPoint.record(this.CLASS_NAME,"setSource"),this.source=a,o&&this.setStyle(o),this.source.addLayer(this)},s.setStyle=function(a){a&&this.buryPoint.record(this.CLASS_NAME,"setStyle",a),this.styleOptions=a,this.preHandle&&this.beforeRender()},s.WC=function(){for(var a=function(c){var h=o[c].id,p=l.find(function(d){return d.id===h});p?(u.didFusion.push(p),u.didFusionDataset.push(o[c])):u.willFusion.push(o[c])},o=this.dataset,l=this.meshes,u={willFusion:[],didFusion:[],didFusionDataset:[]},f=0;f<o.length;f++)a(f);return u},s.setMap=function(a){this.map=a},s.onAdd=function(){this.Cr=performance.now()},s.Ar=function(){this.Cr=0},s.setZooms=function(a){this.zooms=a},s.setOpacity=function(a){this.opacity=a},s.setzIndex=function(a){this.zIndex=a},s.show=function(){this.visible=!0},s.hide=function(){this.visible=!1},s.zr=function(){return performance.now()-this.Cr},i}(_wrapNativeSuper(Event)),Handler=function(){function n(i){var s=this;_classCallCheck(this,n),this._r=[0,0],this.Sr=[0,0],this.clickCount=0,this.Ir=!1,this.Pr=function(a){var o=a.deltaX,l=a.deltaY;s.map.emit("wheel",{event:a,deltaX:o,deltaY:l})},this.Tr=function(a){s.Ir=!0,s.container&&(s._r=DomUtil.wC(s.container,a),s.Sr=s._r),s.map.emit("mousedown",{event:a,Br:s._r})},this.Dr=function(a){var o=[0,0],l=_toConsumableArray(s.Sr),u={event:a,Sr:l,Er:o,_r:s._r};if(s.Ir&&s.container){var f=DomUtil.wC(s.container,a);o=[f[0]-l[0],f[1]-l[1]],s.Sr=f,u.Er=o,s.map.emit("drag",u)}s.map.emit("mousemove",u)},this.Vr=function(a){s.Ir=!1;var o=[0,0];if(s.container){var l=s;o=DomUtil.wC(s.container,a),Math.abs(o[0]-s._r[0])<=1&&Math.abs(o[1]-s._r[1])<=1&&(s.clickCount++,s.clickCount>=2?s.map.emit("dblclick",{event:a,Br:o}):s.map.emit("click",{event:a,Br:o})),s.map.emit("mouseup",{event:a,Br:o}),setTimeout(function(){l.clickCount=0},300)}},this.Rr=function(a){if(a.preventDefault(),s.container){var o=DomUtil.wC(s.container,a);s.map.emit("rightclick",{event:a,Br:o})}},this.map=i,this.container=this.map.container,this.bindEvents()}var r=n.prototype;return r.bindEvents=function(){var i,s,a,o,l;(i=this.container)==null||i.addEventListener("wheel",this.Pr),(s=this.container)==null||s.addEventListener("mousedown",this.Tr),(a=this.container)==null||a.addEventListener("mousemove",this.Dr),(o=this.container)==null||o.addEventListener("mouseup",this.Vr),(l=this.container)==null||l.addEventListener("contextmenu",this.Rr)},n}();buryPoint.record("Base");var Map$1=function(n){_inherits(i,n);var r=_createSuper(i);function i(a,o){_classCallCheck(this,i);var l;return l=r.call(this),l.center=[0,0],l.zoom=10,l.pitch=0,l.rotation=0,l.zooms=[1,30],l.animate=new chito.Animation,l.layers=[],l.buryPoint=buryPoint,l.Fa=30*2,l.La=0,l.Wa=!1,l.Na=!1,l.Ua=l.Fa,l.timeline=performance.now(),l.container=document.getElementById(a),l.qa=new Handler(_assertThisInitialized(l)),l.options=o,l.Na=o.Na===void 0?l.Na:o.Na,l.Fa=o.Fa===void 0?l.Fa:o.Fa,l.animate.addClip(new chito.Clip({duration:1e4,repeat:1/0}),{x:[0,1]}),buryPoint.init(),l}var s=i.prototype;return s.render=function(){var a=this;this.layers.sort(function(o,l){return o.zIndex-l.zIndex}),this.layers.forEach(function(o){o.visible&&o.opacity>0&&o.zooms[0]<a.zoom&&o.zooms[1]>a.zoom&&(o.beforeRender(),o.render(),o.afterRender())})},s.Qa=function(a){a&&(a.zoom!==void 0&&(this.zoom=Math.min(Math.max(this.zooms[0],a.zoom),this.zooms[1]),this.setZoom()),a.center!==void 0&&(this.setCenter(a.center),this.center=a.center),a.pitch!==void 0&&(this.pitch=Math.min(150,Math.max(a.pitch,0)),this.setPitch()),a.rotation!==void 0&&(this.setRotation(this.rotation-a.rotation),this.rotation=a.rotation)),this.requestRender(),this.emit("viewchange")},s.addLayer=function(a){var o=this.layers.some(function(l){return l.id===a.id});!o&&(a.onAdd()||this.layers.push(a)),this.requestRender()},s.Mr=function(a){var o=this.layers.findIndex(function(u){return u.id===a.id});if(o>-1){var l=this.layers.splice(o,1);l.length>=0&&(l[0].Ar(),this.requestRender())}},s.requestRender=function(){var a=this;this.Ua=this.Fa;var o=function(){if(a.La=requestAnimationFrame(o),a.Wa=!a.Wa,!(a.Na&&a.Wa)){if(a.Ua<=0){cancelAnimationFrame(a.La),a.La=0;return}a.render(),a.Ua--}};this.Ua>0&&!this.La&&o()},s.Za=function(){return{startTime:this.timeline,duration:performance.now()-this.timeline}},s.$a=function(){return this.Na},i}(_wrapNativeSuper(Event));Map$1.Clip=chito.Clip,Map$1.Animation=chito.Animation;var ViewControl$1=function(){function n(i){var s=this;_classCallCheck(this,n),this.La=0,this.Bs=[],this.animateStatus="start",this.Es=Date.now(),this.Vs=[],this.map=i,this.map.animate.on("update",function(){s.Rs(),s.Fs()}),buryPoint.record("ViewControl")}var r=n.prototype;return r.addAnimates=function(i,s){this.animateStatus="start",buryPoint.record("ViewControl","addAnimates");var a=i[0],o;i.length>1?o=this.addAnimates.bind(this,i.slice(1),s):i.length===1&&(o=s),this.Ls(a,o)},r.removeAnimate=function(i){buryPoint.record("ViewControl","removeAnimate");var s=this.Bs.findIndex(function(a){return a===i});return this.Bs.splice(s,1)},r.Ws=function(i){return buryPoint.record("ViewControl","removeAnimateByIndex"),this.Bs.splice(i,1),this.Bs},r.Ns=function(){return this.Bs},r.clearAnimates=function(){buryPoint.record("ViewControl","clearAnimates"),this.Bs=[],this.qs()},r.pauseAnimate=function(){this.animateStatus="pause",this.Es=Date.now()},r.resumeAnimate=function(){if(this.animateStatus==="pause")for(var i=Date.now()-this.Es,s=0;s<this.Bs.length;s++)this.Bs[s].startTime+=i;this.animateStatus="start"},r.addTrackAnimate=function(i,s){this.animateStatus="start",(i||s)&&(this.animateStatus="start")},r.Ys=function(){return{zoom:this.map.getZoom(),center:this.map.getCenter(),pitch:this.map.getPitch(),rotation:this.map.getRotation()}},r.Zs=function(i){var s=i.zoom,a=i.center,o=i.pitch,l=i.rotation;s&&this.map.setZoom(s),a&&this.map.setCenter(a),o!==void 0&&this.map.setPitch(o),l!==void 0&&this.map.setRotation(l)},r.Ls=function(i,s){var a=this.Ys(),o=a.zoom,l=a.pitch,u=a.center,f=a.rotation,c=Object.keys(i),h,p=-1,d;c.forEach(function(X){p<i[X].duration&&(p=i[X].duration,d=X)});for(var v in i){var g,m=i[v],y=m.value,b=m.control,_=m.duration,C=m.timing,A=(g=BezierEasing__namespace).default.apply(g,_toConsumableArray(C)),I=v==="zoom"?o:v==="pitch"?l:v==="rotation"?f:u;v==="center"&&u?h=new bezierJs.Bezier({x:u[0],y:u[1]},{x:b[0][0],y:b[0][1]},{x:b[1][0],y:b[1][1]},{x:y[0],y:y[1]}):h=new bezierJs.Bezier({x:0,y:I},{x:b[0][0],y:b[0][1]},{x:b[1][0],y:b[1][1]},{x:1,y:y});var D={type:v,$s:h,timing:A,duration:_,startTime:0,finish:d===v?s:void 0};this.Ks(D)}},r.Ks=function(i){i.startTime=Date.now(),this.Bs.push(i)},r.qs=function(){this.animateStatus="stop",cancelAnimationFrame(this.La),this.La=0,this.Bs=[]},r.Rs=function(){var i=this,s=function(u){var f=i.Bs[u],c=f.timing,h=f.$s,p=f.startTime,d=f.duration,v=f.type,g=f.finish,m=o-p;m>d?(f.tf=!0,requestAnimationFrame(function(){g&&g(f)})):a.push(f);var y=Math.min(1,c(m/d)),b=h.get(y);switch(v){case"zoom":i.Zs({zoom:b.y});break;case"pitch":i.Zs({pitch:b.y});break;case"rotation":i.Zs({rotation:b.y});break;case"center":i.Zs({center:[b.x,b.y]});break}};if(this.animateStatus==="start"){for(var a=[],o=Date.now(),l=0;l<this.Bs.length;l++)s(l);this.Bs=a,a.length>0}},r.Fs=function(){},n}(),DataSource=function(){function n(i){_classCallCheck(this,n),this.layers=[],this.status="unload",this.dataset=[],this.options=i,this.id=CommonUtil$1.MC()}var r=n.prototype;return r.nf=function(){this.status="loaded";for(var i=0;i<this.layers.length;i++){var s=this.layers[i];s.receiveDataset(this.dataset),s.emit("loaded")}},r.addLayer=function(i){var s=this.layers.some(function(a){return a.id===i.id});s||(this.layers.push(i),i.receiveDataset(this.dataset))},r.Mr=function(i){var s=this.layers.findIndex(function(a){return a.id===i.id});s>-1&&this.layers.splice(s,1)},n}(),__defProp$w=Object.defineProperty,__defProps$m=Object.defineProperties,__getOwnPropDescs$m=Object.getOwnPropertyDescriptors,__getOwnPropSymbols$w=Object.getOwnPropertySymbols,__hasOwnProp$w=Object.prototype.hasOwnProperty,__propIsEnum$w=Object.prototype.propertyIsEnumerable,__defNormalProp$w=function(n,r,i){return r in n?__defProp$w(n,r,{Fr:!0,Lr:!0,writable:!0,value:i}):n[r]=i},__spreadValues$w=function(n,r){for(var i in r||(r={}))__hasOwnProp$w.call(r,i)&&__defNormalProp$w(n,i,r[i]);var s=!0,a=!1,o=void 0;if(__getOwnPropSymbols$w)try{for(var l=__getOwnPropSymbols$w(r)[Symbol.iterator](),u;!(s=(u=l.next()).done);s=!0){var i=u.value;__propIsEnum$w.call(r,i)&&__defNormalProp$w(n,i,r[i])}}catch(f){a=!0,o=f}finally{try{!s&&l.return!=null&&l.return()}finally{if(a)throw o}}return n},__spreadProps$m=function(n,r){return __defProps$m(n,__getOwnPropDescs$m(r))},CommonUtil=CommonUtil$1,GeoUtil={ai:function n(r){var i=[];if(r.type==="MultiPoint")for(var s=r.properties,a=r.coordinates,o=a.length,l=0;l<o;++l){var u=a[l];i.push({properties:s,type:"Point",coordinates:u})}else if(r.type==="MultiLineString")for(var f=r.properties,c=r.coordinates,h=c.length,p=0;p<h;++p){var d=c[p];i.push({properties:f,type:"Point",coordinates:d})}else if(r.type==="MultiPolygon")for(var v=r.properties,g=r.coordinates,m=g.length,y=0;y<m;++y){var b=g[y];i.push({properties:v,type:"Point",coordinates:b})}return i},hf:function n(r){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;if(r.type==="FeatureCollection"&&r.features.length>0){var a=r.features,o=this.df(a,s);return i&&o.polygons.length>0&&(o.polygons=this.vf(o.polygons)),o}return r},vf:function n(r){for(var i=[],s=0,a=r.length;s<a;s++){var o=r[s],l=__spreadProps$m(__spreadValues$w({},o),{polygons:[]});if(o.geometry.type==="MultiPolygon")for(var u=o.geometry.coordinates,f=0,c=u.length;f<c;f++){var h=u[f];l.polygons[f]=this.triangle(h)}else l.polygons[0]=this.triangle(o.geometry.coordinates);i[s]=l}return i},df:function n(r){for(var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,s={points:[],lines:[],polygons:[],mf:[]},a=0,o=r.length;a<o;a++){var l=r[a].geometry,u=l.type,f="points";u==="Point"||u==="MultiPoint"?f="points":u==="LineString"||u==="MultiLineString"?f="lines":u==="Polygon"||u==="MultiPolygon"?f="polygons":f="others",s[f][s[f].length]=__spreadProps$m(__spreadValues$w({},l),{properties:r[a].properties,sr:++i})}return s},triangle:function n(r){var i=earcut__default.default.flatten(r),s=earcut__default.default(i.vertices,i.holes,i.dimensions);return{index:s,vertex:i.vertices}},mergeTriangles:function n(r,i){var s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:3,a=r.index,o=r.vertex,l=i.index,u=i.vertex,f=o.length/s,c=l.length,h=a.length;a.length+=l.length;for(var p=0;p<c;p++){var d=l[p];a[p+h]=d+f}return CommonUtil._C(o,u),{index:a,vertex:o}},isClock:function n(r){for(var i=r.length,s=0,a=0;a<i;a++){var o=r[a],l=r[(a+1)%i];s+=(l[0]-o[0])*(l[1]+o[1])}return s>0}},GeoJSONSource=function(n){_inherits(i,n);var r=_createSuper(i);function i(a){_classCallCheck(this,i);var o;return o=r.call(this,a),o.className="GeoJSONSource",o.type="geojson",o.url=a.url,buryPoint.record(o.className),o}var s=i.prototype;return s.LC=function(){return this.load(),this.dataset},s.load=function(){if(!(this.status==="loaded"||this.status==="loading"))if(this.status="loading",this.options.data){var a=this.options.data;if(this.valid(a)){var o=this;Promise.resolve().then(function(){o.dataset=o.bf(a),o.nf()})}}else{var l=this,u=this.url;fetch(u).then(function(f){return f.json()}).then(function(f){l.valid(f)&&(l.dataset=l.bf(f),l.nf())})}},s.valid=function(a){return a||console.warn("\u65E0\u6548\u6570\u636E"),!0},s.bf=function(a){var o=GeoUtil.hf(a,!1,0);return[{id:CommonUtil$1.MC(),features:o}]},s.destroy=function(){this.dataset=[],this.url=""},i}(DataSource),GeoBufferSource=function(n){_inherits(i,n);var r=_createSuper(i);function i(a){_classCallCheck(this,i);var o;return o=r.call(this,a),o.className="GeoBufferSource",o.type="geobuffer",o}var s=i.prototype;return s.load=function(){if(!(this.status==="loaded"||this.status==="loading")){this.status="loading";var a=this.options,o=a.data,l=a.url;if(o){if(this.valid(o)){var u=this;Promise.resolve().then(function(){var c=geobuf.decode(new pbf(o));u.dataset=u.bf(c),u.nf()})}}else{var f=this;fetch(l).then(function(c){return c.arrayBuffer()}).then(function(c){var h=geobuf.decode(new pbf(c));f.valid(h)&&(f.dataset=f.bf(h),f.nf())})}}},s.destroy=function(){_get(_getPrototypeOf(i.prototype),"destroy",this).call(this)},i}(GeoJSONSource),Context=function(){function n(){_classCallCheck(this,n),this.gf()}var r=n.prototype;return r.gf=function(){console.log("gl",this.gl)},r.wf=function(){},r.reset=function(){},n}(),GeometryFusion=function n(){_classCallCheck(this,n)},Projection=function n(){_classCallCheck(this,n)},_Earth=function(n){_inherits(i,n);var r=_createSuper(i);function i(){return _classCallCheck(this,i),r.apply(this,arguments)}var s=i.prototype;return s.project=function(a){var o=_slicedToArray(a,3),l=o[0],u=o[1],f=o[2],c=_Earth.xf+f,h=MathUtil.PC(l),p=MathUtil.PC(u),d=c*Math.cos(p),v=d*Math.sin(h),g=c*Math.sin(p),m=d*Math.cos(h);return[v,g,m]},s.unproject=function(a){var o=_slicedToArray(a,3),l=o[0],u=o[1],f=o[2],c=Math.sqrt(l*l+u*u+f*f),h=Math.asin(u/c),p=c*Math.cos(h),d=Math.asin(l/p);return[d,h,c-_Earth.xf]},s.getResolution=function(a){return 20037508342789244e-9*2/256/Math.pow(2,a)},i}(Projection),Earth=_Earth;Earth.xf=6378137,Earth.Mf=20037508342789244e-9,Earth.kf=1496e8,Earth.Cf=363e6,Earth.Af=23.3/180*Math.PI;var _Mercator=function(n){_inherits(i,n);var r=_createSuper(i);function i(){return _classCallCheck(this,i),r.apply(this,arguments)}var s=i.prototype;return s.project=function(a){var o=_Mercator.r,l=_Mercator.Of,u=_slicedToArray(a,2),f=u[0],c=u[1],h=_Mercator.zf,p=c*l,d=Math.max(Math.min(h,f),-h)*l;return d=Math.log(Math.tan(Math.PI/4+d/2)),[p*o,d*o]},s.unproject=function(a){var o=_Mercator.r,l=_Mercator._f,u=_slicedToArray(a,2),f=u[0],c=u[1],h=f/o*l,p=(2*Math.atan(Math.exp(c/o))-Math.PI/2)*l;return[h,p,0]},s.getResolution=function(a){return 20037508342789244e-9*2/256/Math.pow(2,a)},i}(Projection),Mercator=_Mercator;Mercator.Of=Math.PI/180,Mercator._f=180/Math.PI,Mercator.r=6378137,Mercator.zf=85.0511287798;var ColorPick=function(){function n(){_classCallCheck(this,n),this.Sf=[],this.If=[0,0,0,255],this.Pf=256}var r=n.prototype;return r.add=function(i){return this.Sf[this.Tf()]=i,_toConsumableArray(this.If)},r.clear=function(){this.If=[0,0,0,255],this.Sf={}},r.getColor=function(){return _toConsumableArray(this.If)},r.jf=function(i){var s=this.Pf,a=s*s,o=_slicedToArray(i,3),l=o[0],u=o[1],f=o[2],c=l+u*s+f*a;return this.Sf[c]},r.Tf=function(){var i=this.Pf,s=i*i,a=_slicedToArray(this.If,3),o=a[0],l=a[1],u=a[2],f=o+l*i+u*s+1;return this.If[0]=f%i,this.If[1]=~~(f/i)%i,this.If[2]=~~(f/s)%i,f},n}(),_Project=function(n){_inherits(i,n);var r=_createSuper(i);function i(){return _classCallCheck(this,i),r.apply(this,arguments)}var s=i.prototype;return s.project=function(a){var o=[];return this.loca?(o=this.loca.customCoords.lngLatToCoord([a[0],a[1]]),o[2]=a[2]||0,o):a},s.unproject=function(a){return a},s.coordsToContainer=function(a){return a},s.containerToCoords=function(a){return a},s.getResolution=function(a){return 20037508342789244e-9*2/256/Math.pow(2,a)},i.getProject=function(){return this.ui},i}(Projection),Project=_Project;Project.ui=new _Project;var ProjectInstance=Project.getProject(),RendererManager=function(){function n(){_classCallCheck(this,n),this.Cp=[]}var r=n.prototype;return r.addRenderer=function(i){var s=this.Cp.findIndex(function(a){return a===i});s<0&&this.Cp.push(i)},r.removeRenderer=function(i){var s=this.Cp.findIndex(function(a){return a===i});s>-1&&this.Cp.splice(s,1)},r.destroyRenderers=function(){this.Cp.forEach(function(i){i.destroy()})},n}(),FusionManager=function(){function n(){_classCallCheck(this,n),this.Ap=[]}var r=n.prototype;return r.addFusion=function(i){var s=this.Ap.findIndex(function(a){return a===i});s<0&&this.Ap.push(i)},r.removeFusion=function(i){var s=this.Ap.findIndex(function(a){return a===i});s>-1&&this.Ap.splice(s,1)},r.destroyFusions=function(){this.Ap.forEach(function(i){i.destroy()})},n}(),__defProp$1$1=Object.defineProperty,__defProps$l=Object.defineProperties,__getOwnPropDescs$l=Object.getOwnPropertyDescriptors,__getOwnPropSymbols$1$1=Object.getOwnPropertySymbols,__hasOwnProp$1$1=Object.prototype.hasOwnProperty,__propIsEnum$1$1=Object.prototype.propertyIsEnumerable,__defNormalProp$1$1=function(n,r,i){return r in n?__defProp$1$1(n,r,{Fr:!0,Lr:!0,writable:!0,value:i}):n[r]=i},__spreadValues$1$1=function(n,r){for(var i in r||(r={}))__hasOwnProp$1$1.call(r,i)&&__defNormalProp$1$1(n,i,r[i]);var s=!0,a=!1,o=void 0;if(__getOwnPropSymbols$1$1)try{for(var l=__getOwnPropSymbols$1$1(r)[Symbol.iterator](),u;!(s=(u=l.next()).done);s=!0){var i=u.value;__propIsEnum$1$1.call(r,i)&&__defNormalProp$1$1(n,i,r[i])}}catch(f){a=!0,o=f}finally{try{!s&&l.return!=null&&l.return()}finally{if(a)throw o}}return n},__spreadProps$l=function(n,r){return __defProps$l(n,__getOwnPropDescs$l(r))},ViewControl=function(n){_inherits(i,n);var r=_createSuper(i);function i(){_classCallCheck(this,i);var a;return a=r.call.apply(r,[this].concat(Array.prototype.slice.call(arguments))),a.Op={},a.zp=-1,a}var s=i.prototype;return s.addAnimates=function(a,o){_get(_getPrototypeOf(i.prototype),"addAnimates",this).call(this,a,o)},s.addTrackAnimate=function(a,o){_get(_getPrototypeOf(i.prototype),"addTrackAnimate",this).call(this,a,o);var l=a.path,u=a.timing,f=a.rotationSpeed,c=a.duration,h=this.Sp(l),p=h.Ip,d=h.oi,v=h.coords,g=h.Pp,m=new bezierJs.Bezier({x:0,y:0},{x:u[0][0],y:u[0][1]},{x:u[1][0],y:u[1][1]},{x:1,y:1}),y=Date.now();this.Op=__spreadProps$l(__spreadValues$1$1({$s:m,startTime:y,coords:v,Ip:p,Pp:g,oi:d},a),{Tp:this.jp(d,p,g,c,f),finish:o&&o.bind(this)})},s.clearAnimates=function(){_get(_getPrototypeOf(i.prototype),"clearAnimates",this).call(this),this.Op={}},s.pauseAnimate=function(){this.animateStatus="pause",this.Es=Date.now()},s.resumeAnimate=function(){var a=this.animateStatus;if(_get(_getPrototypeOf(i.prototype),"resumeAnimate",this).call(this),a==="pause"){var o=Date.now()-this.Es;this.Op.startTime+=o}},s.Fs=function(){if(this.animateStatus==="start"){var a=Date.now(),o=this.Op,l=o.timing,u=o.$s,f=o.startTime,c=o.duration,h=o.finish,p=o.Ip,d=o.Pp,v=o.path,g=o.oi,m=o.Tp;if(!(!p||!l)){var y=a-f;y>c&&(h&&h(this.Op),this.Op={});for(var b=Math.min(1,y/c),_=u.get(b),C=0,A={index:0,Bp:0},I=d*_.y,D=0;D<p.length;D++){var X=p[D];if(C+X>=I){A.index=D,A.Bp=(I-C)/X;break}C+=X}var W=A.index,K=A.Bp,U=v[W],M=v[W+1];this.zp!=W&&this.Op.rotationSpeed>0&&this.map.map.setRotation(-g[W],!1,m[W]),this.Zs({center:[U[0]+(M[0]-U[0])*K,U[1]+(M[1]-U[1])*K]}),this.zp=W}}},s.jp=function(a,o,l,u,f){for(var c=[],h=this.map.map.getRotation(),p=0;p<a.length;p++){var d=Math.abs(a[p]-h),v=p===0?1e3:o[p]/l*u,g=o[p]/l*u,m=d/f*1e3;c.push(Math.min(v,g,m)),h=a[p]}return c},s.Sp=function(a){for(var o=[],l=[],u=[],f=!1,c=[0,1],h=0,p=0,d=a.length-1;p<d;p++){var v=f||ProjectInstance.project(a[p]),g=ProjectInstance.project(a[p+1]);o.push(Math.sqrt(Math.pow(v[0]-g[0],2)+Math.pow(v[1]-g[1],2)+Math.pow(v[2]-g[2],2))),h+=o[p],l.push(v);var m=[];glMatrix.vec2.normalize(m,[g[0]-v[0],g[1]-v[1]]);var y=[0,0,0];glMatrix.vec3.cross(y,[c[0],c[1],0],[m[0],m[1],0]),u.push((u[p-1]||0)+(y[2]<0?1:-1)*Math.acos(glMatrix.vec2.dot(m,c))*180/Math.PI),f=g,c=m}return{oi:u,coords:l,Ip:o,Pp:h}},i}(ViewControl$1),DefaultLight=0,NewLight=1,LagacyLight=2,Light=function(){function n(r,i){_classCallCheck(this,n),this.rawproperty=r,i&&(this.loca=i,this.loca.addLight(this))}return _createClass(n,[{key:"color",get:function(){return ColorUtil$1.zC(this.rawproperty.color).slice(0,3)},set:function(r){var i;this.rawproperty.color=r,(i=this.loca)==null||i.requestRender()}},{key:"intensity",get:function(){var r;return(r=this.rawproperty.intensity)!=null?r:1},set:function(r){var i;this.rawproperty.intensity=r,(i=this.loca)==null||i.requestRender()}}]),n}(),AmbientLight=function(n){_inherits(i,n);var r=_createSuper(i);function i(){return _classCallCheck(this,i),r.apply(this,arguments)}var s=i.prototype;return s.eA=function(a){},s.iA=function(a){a.intensity=this.intensity,a.lightColor=this.color},i}(Light),DirectionalLight=function(n){_inherits(i,n);var r=_createSuper(i);function i(){return _classCallCheck(this,i),r.apply(this,arguments)}var s=i.prototype;return s.eA=function(a){},s.iA=function(a){a.intensity=this.intensity,a.lightColor=this.color,a.direction=this.direction},_createClass(i,[{key:"target",get:function(){return this.rawproperty.target},set:function(a){var o;this.rawproperty.target=a,(o=this.loca)==null||o.requestRender()}},{key:"position",get:function(){return this.rawproperty.position},set:function(a){var o;this.rawproperty.position=a,(o=this.loca)==null||o.requestRender()}},{key:"direction",get:function(){return Array.from(glMatrix.vec3.subtract(glMatrix.vec3.create(),this.target,this.position))}}]),i}(Light),PointLight=function(n){_inherits(i,n);var r=_createSuper(i);function i(){return _classCallCheck(this,i),r.apply(this,arguments)}var s=i.prototype;return s.eA=function(a){},s.iA=function(a){a.intensity=this.intensity,a.lightColor=this.color,a.position=this.position,a.dist=this.distance},_createClass(i,[{key:"position",get:function(){var a,o=(a=this.loca)==null?void 0:a.customCoords.lngLatToCoord(this.rawproperty.position);return[o[0],o[1],this.rawproperty.position[2]]},set:function(a){var o;this.rawproperty.position=a,(o=this.loca)==null||o.requestRender()}},{key:"distance",get:function(){var a;return(a=this.rawproperty.distance)!=null?a:0},set:function(a){var o;this.rawproperty.distance=a,(o=this.loca)==null||o.requestRender()}}]),i}(Light),Loca=function(n){_inherits(i,n);var r=_createSuper(i);function i(a){_classCallCheck(this,i);var o;o=r.call(this,"null",a),o.size=[0,0],o.layers=[],o.animateStatus="stop",o.rendererManager=new RendererManager,o.fusionManager=new FusionManager,o.Dp=document.createElement("div"),o.nA={},o.rA=[],o.oA=DefaultLight,o.Lp=!1,o.map=a.map,o.viewControl=new ViewControl(_assertThisInitialized(o)),o.Wp=a.Wp||[108.9398,34.3416],o.projection=ProjectInstance,o.projection.loca=_assertThisInitialized(o),o.customCoords=o.map.customCoords,o.Np=o.map.customCoords,o.Np.setCenter(o.Wp),o.Up(),o.qp();var l=o.map.getContainer();o.Dp.className="amap-loca loca-controls",l.appendChild(o.Dp),o.map&&o.buryPoint.setAPIKey(window.AMap.getConfig().key),o.buryPoint.setVersion("2.0.0"),o.buryPoint.record("Loca");var u=new AmbientLight({color:"#fff",intensity:.5}),f=new DirectionalLight({color:"rgb(255,255,255)",position:[0,-1,1],target:[0,0,0],intensity:.5}),c=new PointLight({color:"rgb(255,255,255)",position:[0,0,1e4],intensity:1,distance:0});return u.loca=f.loca=c.loca=_assertThisInitialized(o),o.nA={ambLight:u,dirLight:f,pointLight:c},o.animate.on("start",function(){return o.animateStatus="start"}),o.animate.on("pause",function(){return o.animateStatus="pause"}),o.animate.on("stop",function(){return o.animateStatus="stop"}),o}var s=i.prototype;return s.Up=function(){if(this.map){var a=this.map.getGL&&this.map.getGL()||this.map.getContext().gl;if(a){var o=this;REGL__default.default({gl:a,extensions:["OES_element_index_uint","ANGLE_instanced_arrays"],onDone:function(l,u){if(l)console.error(l);else{o.regl=u;var f=o.map.getContext();f&&f.setDirty(),o.requestRender()}}}),this.map.on("firstPaint",function(){var l=o.map.getContext();l&&l.setDirty()})}}},s.requestRender=function(){this.map&&this.map.render()},s.add=function(a){if(this.map){var o=this.layers.some(function(l){return l.id===a.id});o||(this.layers.push(a),this.map.add(a.Yp),a.setLoca(this),a.sA(this.lights,this))}},s.remove=function(a){if(this.map){var o=this.layers.findIndex(function(l){return l.id===a.id});o>-1&&(this.layers.splice(o,1),this.map.remove(a.Yp),a.Ar(),a.setLoca(null))}},s.clear=function(){if(this.map){var a=!0,o=!1,l=void 0;try{for(var u=this.layers[Symbol.iterator](),f;!(a=(f=u.next()).done);a=!0){var c=f.value;this.map.remove(c.Yp),c.Ar(),c.setLoca(null)}}catch(h){o=!0,l=h}finally{try{!a&&u.return!=null&&u.return()}finally{if(o)throw l}}this.layers.splice(0,this.layers.length)}},s.getControlContainer=function(){return this.Dp},s.getCenter=function(){return this.map.getCenter().toArray()},s.getZoom=function(){return this.map.getZoom()},s.getPitch=function(){return this.map.getPitch()},s.getRotation=function(){return this.map.getRotation()},s.setRotation=function(a){this.map.setRotation(a,!0)},s.setZoom=function(a){this.map.setZoom(a,!0)},s.setCenter=function(a){this.map.setCenter(a,!0)},s.setPitch=function(a){this.map.setPitch(a,!0)},s.getLights=function(){var a=this.ambLight,o=a.intensity,l=a.color,u=this.dirLight,f=u.intensity,c=u.color,h=u.target,p=u.position,d=[h[0]-p[0],h[1]-p[1],h[2]-p[2]],v=this.pointLight,g=v.intensity,m=v.color,y=v.position,b=v.distance,_=this.customCoords.lngLatToCoord(y);return{ambIntensity:o,ambLightColor:ColorUtil$1.zC(l).slice(0,3),dirIntensity:f,dirLightColor:ColorUtil$1.zC(c).slice(0,3),dirVec:_toConsumableArray(d),pointIntensity:g,pointLightColor:ColorUtil$1.zC(m).slice(0,3),pointPosition:[_[0],_[1],y[2]],aA:b}},s.addLight=function(a){a.loca||(a.loca=this),this.rA.includes(a)||this.rA.push(a),this.oA|=NewLight;var o=!0,l=!1,u=void 0;try{for(var f=this.layers[Symbol.iterator](),c;!(o=(c=f.next()).done);o=!0){var h=c.value;h.sA(this.lights,this)}}catch(p){l=!0,u=p}finally{try{!o&&f.return!=null&&f.return()}finally{if(l)throw u}}this.requestRender()},s.removeLight=function(a){var o=this.rA.indexOf(a);if(!(o<0)){this.rA.splice(o,1),this.rA.length||(this.oA^=NewLight);var l=!0,u=!1,f=void 0;try{for(var c=this.layers[Symbol.iterator](),h;!(l=(h=c.next()).done);l=!0){var p=h.value;p.sA(this.lights,this)}}catch(d){u=!0,f=d}finally{try{!l&&c.return!=null&&c.return()}finally{if(u)throw f}}this.requestRender()}},s.clearLight=function(){this.rA=[],this.nA={};var a=!0,o=!1,l=void 0;try{for(var u=this.layers[Symbol.iterator](),f;!(a=(f=u.next()).done);a=!0){var c=f.value;c.sA(this.lights,this)}}catch(h){o=!0,l=h}finally{try{!a&&u.return!=null&&u.return()}finally{if(o)throw l}}this.oA=DefaultLight,this.requestRender()},s.destroy=function(){this.animate.stop(),this.fusionManager.destroyFusions();for(var a=0;this.layers.length>0;a=0){var o=this.layers[a];o.destroy()}this.regl.destroy(),this.animate.destroy();var l=this.map.getContainer();l&&l.removeChild(this.Dp),this.map=null,this.animate=null},s.qp=function(){var a=this;this.animate.on("update",function(){a.requestRender()})},_createClass(i,[{key:"ambLight",get:function(){return this.nA.ambLight.rawproperty},set:function(a){var o=new AmbientLight(a);o.loca=this,this.oA|=LagacyLight,this.nA.ambLight=o}},{key:"dirLight",get:function(){return this.nA.dirLight.rawproperty},set:function(a){var o=new DirectionalLight(a);o.loca=this,this.oA|=LagacyLight,this.nA.dirLight=o}},{key:"pointLight",get:function(){return this.nA.pointLight.rawproperty},set:function(a){var o=new PointLight(a);o.loca=this,this.oA|=LagacyLight,this.nA.pointLight=o}},{key:"lights",get:function(){var a=this.nA,o=a.ambLight,l=a.dirLight,u=a.pointLight;return this.oA===(NewLight|LagacyLight)?[o,l,u].concat(_toConsumableArray(this.rA)).filter(Boolean):this.oA===LagacyLight||this.oA===DefaultLight?[o,l,u].filter(Boolean):this.rA}}]),i}(Map$1),Animation$1=Loca.Animation,Clip=Loca.Clip,legendColor={title:{label:"\u56FE\u4F8B",fontColor:"#fff",fontSize:"20px",fontWeight:"bold",padding:"0 0 5px 0",margin:0},style:{backgroundColor:"rgba(0,0,0,0.7)",fontSize:"14px",size:"16px",fontColor:"#fff",borderRadius:0,position:"absolute",padding:"10px 15px"},dataMap:[{label:"\u7B2C\u4E00\u4E2A",color:"#feedde"},{label:"\u7B2C\u4E8C\u4E2A",color:"#fdbe85"},{label:"\u7B2C\u4E09\u4E2A",color:"#fd8d3c"},{label:"\u7B2C\u56DB\u4E2A",color:"#e6550d"},{label:"\u7B2C\u4E94\u4E2A",color:"#a63603"}]},Legend=function(){function n(i){_classCallCheck(this,n),this.$p=null,this.Kp={},this.tm={},this.$p=i.loca,this.nm=this.$p&&this.$p.getControlContainer(),this.lr=document.createElement("div"),this.im=i.dataMap||legendColor.dataMap,this.setStyle(i),this.addTo(this.$p),buryPoint.record("Legend")}var r=n.prototype;return r.om=function(){var i=this,s,a,o=document.createElement("h5");o.innerHTML=this.tm.label,o.style.cssText="color: ".concat(this.tm.fontColor,";font-size: ").concat(this.tm.fontSize,";text-align: ").concat(this.tm.textAlign,";font-weight: ").concat(this.tm.fontWeight,";padding: ").concat(this.tm.padding,";margin: ").concat(this.tm.margin,";");var l=document.createElement("ul");l.style.cssText="margin: 0; padding: 0; list-style: none;";var u="";this.im.forEach(function(f){u+='\n                <li style="height: '.concat(i.Kp.size,'; box-sizing: content-box; padding: 2px 0;" ><span style="background-color: ').concat(f.color,"; float:left; width: ").concat(i.Kp.size,"; height: ").concat(i.Kp.size,';"></span><a style="float:left; height: ').concat(i.Kp.size,"; line-height: ").concat(i.Kp.size,"; text-align: left; padding-left: 10px; font-size: ").concat(i.Kp.fontSize,"; color: ").concat(i.Kp.fontColor,';">').concat(f.label,"</a></li>\n            ")}),l.innerHTML=u,this.lr.innerHTML="",(s=this.lr)==null||s.appendChild(o),(a=this.lr)==null||a.appendChild(l)},r.setStyle=function(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{style:{},title:{}},s,a,o,l,u,f,c,h,p=legendColor.style,d=i.style||{};this.Kp.backgroundColor=d.backgroundColor||this.Kp.backgroundColor||p.backgroundColor,this.Kp.borderRadius=d.borderRadius||this.Kp.borderRadius||p.borderRadius,this.Kp.fontColor=d.fontColor||this.Kp.fontColor||p.fontColor,this.Kp.fontSize=d.fontSize||this.Kp.fontSize||p.fontSize,this.Kp.size=d.size||this.Kp.size||p.size,this.Kp.position=d.position||this.Kp.position||p.position,this.Kp.padding=d.padding||this.Kp.padding||p.padding,this.Kp.bottom=d.bottom||"",this.Kp.right=d.right||"",this.Kp.left=d.left||"",this.Kp.top=d.top||"";var v=legendColor.title,g=i.title||{};this.tm.label=g.label||this.tm.label||v.label,this.tm.fontColor=g.fontColor||this.tm.fontColor||v.fontColor,this.tm.fontSize=g.fontSize||this.tm.fontSize||v.fontSize,this.tm.fontWeight=g.fontWeight||this.tm.fontWeight||v.fontWeight,this.tm.padding=g.padding||this.tm.padding||v.padding,this.tm.margin=g.margin||this.tm.margin||v.margin,(s=this.lr)==null||s.style.setProperty("background-color",this.Kp.backgroundColor),(a=this.lr)==null||a.style.setProperty("border-radius",this.Kp.borderRadius),(o=this.lr)==null||o.style.setProperty("position",this.Kp.position),(l=this.lr)==null||l.style.setProperty("padding",this.Kp.padding),(u=this.lr)==null||u.style.setProperty("bottom",this.Kp.bottom),(f=this.lr)==null||f.style.setProperty("right",this.Kp.right),(c=this.lr)==null||c.style.setProperty("left",this.Kp.left),(h=this.lr)==null||h.style.setProperty("top",this.Kp.top),this.om()},r.addTo=function(i){var s;!i||(this.$p=i,this.nm=i.getControlContainer(),this.lr&&((s=this.nm)==null||s.appendChild(this.lr)))},r.remove=function(){var i;this.lr&&((i=this.nm)==null||i.removeChild(this.lr)),this.nm=null,this.$p=null},n}(),RenderUtil={getMipMap:function n(r,i){var s={mipmap:"nice",min:"nearest mipmap linear",mag:"linear",wrapS:"repeat",wrapT:"repeat"},a=Math.log2(r),o=Math.log2(i);return a===~~a&&o===~~o?s:{min:"linear",mag:"linear"}},getBlend:function n(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"normal",i={normal:{srcRGB:"src alpha",srcAlpha:1,dstRGB:"one minus src alpha",dstAlpha:"one minus src alpha"},lighter:{srcRGB:1,srcAlpha:1,dstRGB:1,dstAlpha:1},darker:{srcRGB:"dst color",srcAlpha:1,dstRGB:"dst color",dstAlpha:1},zero:{srcRGB:0,srcAlpha:0,dstRGB:0,dstAlpha:0}};return i[r]},getBezier:function n(){var r="\n            // \u4E8C\u6B21\n            float QuadraticIn (float k) {\n                return pow(k, 2.);\n            }\n            float QuadraticOut (float k) {\n                return k * (2.0 - k);\n            }\n            float QuadraticInOut (float k) {\n                if ((k *= 2.0) < 1.0) {\n                    return 0.5 * k * k;\n                }\n                return -0.5 * (--k * (k - 2.0) - 1.0);\n            }\n\n            // \u4E09\u6B21\n            float CubicIn (float k) {\n                return pow(k, 3.);\n            }\n            float CubicOut (float k) {\n                return pow(--k, 3.) + 1.0;\n            }\n            float CubicInOut (float k) {\n                if ((k *= 2.0) < 1.0) {\n                    return 0.5 * pow(k, 3.);\n                }\n                return 0.5 * ((k -= 2.0) * k * k + 2.0);\n            }\n\n            // \u56DB\u6B21\n            float QuarticIn (float k) {\n                return pow(k, 4.);\n            }\n            float QuarticOut (float k) {\n                return 1.0 - (pow(--k, 4.));\n            }\n            float QuarticInOut (float k) {\n                if ((k *= 2.0) < 1.0) {\n                    return 0.5 * pow(k, 4.);\n                }\n                return 0.5 * ((k -= 2.0) * pow(k, 3.) + 2.0);\n            }\n\n            // \u4E94\u6B21\n            float QuinticIn (float k) {\n                return pow(k, 5.);\n            }\n            float QuinticOut (float k) {\n                return 1.0 - (pow(--k, 5.));\n            }\n            float QuinticInOut (float k) {\n                if ((k *= 2.0) < 1.0) {\n                    return 0.5 * pow(k, 5.);\n                }\n                return 0.5 * ((k -= 2.0) * pow(k, 4.) + 2.0);\n            }\n\n            // \u516D\u6B21\n            float SinusoidalIn (float k) {\n                float pi = 3.14159265;\n                return 1.0 - cos(k * pi / 2.0);\n            }\n            float SinusoidalOut (float k) {\n                float pi = 3.14159265;\n                return sin(k * pi / 2.0);\n            }\n            float SinusoidalInOut (float k) {\n                float pi = 3.14159265;\n                return 0.5 * (1.0 - cos(pi * k));\n            }\n\n            // \u4E03\u6B21\n            float ExponentialIn (float k) {\n                return k == 0.0 ? 0.0 : pow(1024.0, k - 1.0);\n            }\n            float ExponentialOut (float k) {\n                return k == 1.0 ? 1.0 : 1.0 - pow(2.0, -10.0 * k);\n            }\n            float ExponentialInOut (float k) {\n                // if (k == 0.0) {\n                //     return 0.0;\n                // }\n                // if (k == 1.0) {\n                //     return 1.0;\n                // }\n                if ((k *= 2.0) < 1.0) {\n                    return 0.5 * pow(1024.0, k - 1.0);\n                }\n                return 0.5 * (-pow(2.0, -10.0 * (k - 1.0)) + 2.0);\n            }\n\n            // \u516B\u6B21\n            float CircularIn (float k) {\n                return 1.0 - sqrt(1.0 - k * k);\n            }\n            float CircularOut (float k) {\n                return sqrt(1.0 - (--k * k));\n            }\n            float CircularInOut (float k) {\n                if ((k *= 2.0) < 1.0) {\n                    return -0.5 * (sqrt(1.0 - k * k) - 1.0);\n                }\n                return 0.5 * (sqrt(1.0 - (k -= 2.0) * k) + 1.0);\n            }\n\n            // \u4E5D\u6B21\n            float ElasticIn (float k) {\n                float pi = 3.14159265;\n                float s;\n                float a = 0.1;\n                float p = 0.4;\n                // if (k == 0.0) {\n                //     return 0.0;\n                // }\n                // if (k == 1.0) {\n                //     return 1.0;\n                // }\n                if (a < 1.0) {\n                    a = 1.0;\n                    s = p / 4.0;\n                } else {\n                    s = p * asin(1.0 / a) / (2.0 * pi);\n                }\n                // return pow(2.0, 10.0 * (k -= 1.0));\n                return -(a * pow(2.0, 10.0 * (k -= 1.0)) * sin((k - s) * (2.0 * pi) / p));\n            }\n            float ElasticOut (float k) {\n                float pi = 3.14159265;\n                float s;\n                float a = 0.1;\n                float p = 0.4;\n                // if (k == 0.0) {\n                //     return 0.0;\n                // }\n                // if (k == 1.0) {\n                //     return 1.0;\n                // }\n                if (a < 1.0) {\n                    a = 1.0;\n                    s = p / 4.0;\n                } else {\n                    s = p * asin(1.0 / a) / (2.0 * pi);\n                }\n                return (a * pow(2.0, -10.0 * k) * sin((k - s) * (2.0 * pi) / p) + 1.0);\n            }\n            float ElasticInOut (float k) {\n                float pi = 3.14159265;\n                float s;\n                float a = 0.1;\n                float p = 0.4;\n                // if (k == 0.0) {\n                //     return 0.0;\n                // }\n                // if (k == 1.0) {\n                //     return 1.0;\n                // }\n                if (a < 1.0) {\n                    a = 1.0;\n                    s = p / 4.0;\n                } else {\n                    s = p * asin(1.0 / a) / (2.0 * pi);\n                }\n                if ((k *= 2.0) < 1.0) {\n                    return -0.5 * (a * pow(2.0, 10.0 * (k -= 1.0)) * sin((k - s) * (2.0 * pi) / p));\n                }\n                return a * pow(2.0, -10.0 * (k -= 1.0)) * sin((k - s) * (2.0 * pi) / p) * 0.5 + 1.0;\n            }\n\n            // \u56DE\u5F39\n            float BackIn (float k) {\n                float s = 1.70158;\n                return pow(k, 2.) * ((s + 1.0) * k - s);\n            }\n            float BackOut (float k) {\n                float s = 1.70158;\n                return pow(--k, 2.) * ((s + 1.0) * k + s) + 1.0;\n            }\n            float BackInOut (float k) {\n                float s = 1.70158 * 1.525;\n                if ((k *= 2.0) < 1.0) {\n                    return 0.5 * (pow(k, 2.) * ((s + 1.0) * k - s));\n                }\n                return 0.5 * ((k -= 2.0) * k * ((s + 1.0) * k + s) + 2.0);\n            }\n\n            // \u53CD\u590D\u6A2A\u8DF3\n            float BounceOut (float k) {\n                if (k < (1.0 / 2.75)) {\n                    return 7.5625 * k * k;\n                } else if (k < (2.0 / 2.75)) {\n                    return 7.5625 * (k -= (1.5 / 2.75)) * k + 0.75;\n                } else if (k < (2.5 / 2.75)) {\n                    return 7.5625 * (k -= (2.25 / 2.75)) * k + 0.9375;\n                } else {\n                    return 7.5625 * (k -= (2.625 / 2.75)) * k + 0.984375;\n                }\n            }\n            float BounceIn (float k) {\n                return 1.0 - BounceOut(1.0 - k);\n            }\n            float BounceInOut (float k) {\n                if (k < 0.5) {\n                    return BounceIn(k * 2.0) * 0.5;\n                }\n                return BounceOut(k * 2.0 - 1.0) * 0.5 + 0.5;\n            }\n            float getBezier(int type, float delayTime, float transformTime, float timer) {\n                if(type == 0) {\n                    return QuadraticIn(timer);\n                } else if(type == 1) {\n                    return QuadraticOut(timer);\n                } else if(type == 2) {\n                    return QuadraticInOut(timer);\n                } else if(type == 3) {\n                    return CubicIn(timer);\n                } else if(type == 4) {\n                    return CubicOut(timer);\n                } else if(type == 5) {\n                    return CubicInOut(timer);\n                } else if(type == 6) {\n                    return QuarticIn(timer);\n                } else if(type == 7) {\n                    return QuarticOut(timer);\n                } else if(type == 8) {\n                    return QuarticInOut(timer);\n                } else if(type == 9) {\n                    return QuinticIn(timer);\n                } else if(type == 10) {\n                    return QuinticOut(timer);\n                } else if(type == 11) {\n                    return QuinticInOut(timer);\n                } else if(type == 12) {\n                    return SinusoidalIn(timer);\n                } else if(type == 13) {\n                    return SinusoidalOut(timer);\n                } else if(type == 14) {\n                    return SinusoidalInOut(timer);\n                } else if(type == 15) {\n                    return ExponentialIn(timer);\n                } else if(type == 16) {\n                    return ExponentialOut(timer);\n                } else if(type == 17) {\n                    return ExponentialInOut(timer);\n                } else if(type == 18) {\n                    return CircularIn(timer);\n                } else if(type == 19) {\n                    return CircularOut(timer);\n                } else if(type == 20) {\n                    return CircularInOut(timer);\n                } else if(type == 21) {\n                    return ElasticIn(timer);\n                } else if(type == 22) {\n                    return ElasticOut(timer);\n                } else if(type == 23) {\n                    return ElasticInOut(timer);\n                } else if(type == 24) {\n                    return BackIn(timer);\n                } else if(type == 25) {\n                    return BackOut(timer);\n                } else if(type == 26) {\n                    return BackInOut(timer);\n                } else if(type == 27) {\n                    return BounceIn(timer);\n                } else if(type == 28) {\n                    return BounceOut(timer);\n                } else if(type == 29) {\n                    return BounceInOut(timer);\n                } else {\n                    return timer;\n                }\n            }";return r.replace(/\/\/.*\n/g,"").replace(/\s\s+/g,"")},getScaleType:function n(r){return"\n            uniform vec4 ".concat(r,"Time; // time/delay/trasform/random\n            uniform vec4 ").concat(r,"Type; // type/repeat/yoyo/duration\n            uniform vec2 ").concat(r,"Value; // start/end\n            float ").concat(r,"ScaleValue(float sule) {\n                bool isYoyoDuration = ").concat(r,"Type.z == 1.0 && mod(ceil(").concat(r,"Time.x / ").concat(r,"Type.w), 2.0) == 0.0;\n                bool isYoyoLast = mod(").concat(r,"Type.y, 2.0) == 0.0 && ").concat(r,"Type.z == 1.0;\n                float timer = 0.0;\n                float vs = ").concat(r,"Value.x;\n                float ve = ").concat(r,"Value.y;\n                if(").concat(r,"Time.w == 0.0) {\n                    timer = fract(").concat(r,"Time.x / ").concat(r,"Type.w);\n                    // \u6700\u540E\u4E00\u8F6E,\u7ED3\u675F\n                    if(").concat(r,"Time.x >= ").concat(r,"Type.y * ").concat(r,"Type.w) {\n                        if(isYoyoLast) {\n                            return vs;\n                        }\n                        return ve;\n                    }\n                    if(isYoyoDuration) {\n                        timer = 1.0 - timer;\n                    }\n                    float t = getBezier(int(").concat(r,"Type.x), 0.0, ").concat(r,"Type.w, timer);\n                    return t * (ve - vs) + vs;\n                }\n\n                float randomDelay = (sin(length(sule)) + 1.0) / 2.0 * ").concat(r,"Time.y;\n                timer = (").concat(r,"Time.x - randomDelay) / ").concat(r,"Time.z;\n                // \u7B2C\u4E00\u8F6E\n                if(timer < 0.0) {\n                    return 0.0;\n                } else if(").concat(r,"Time.x >= randomDelay + ").concat(r,"Type.y * ").concat(r,"Time.z) {\n                    // \u6700\u540E\u4E00\u8F6E,\u7ED3\u675F\n                    if(isYoyoLast) {\n                        return vs;\n                    }\n                    return ve;\n                } else {\n                    if(").concat(r,"Type.z == 1.0 && mod(ceil(timer), 2.0) == 0.0) {\n                        timer = 1.0 - fract(timer);\n                    } else {\n                        timer = fract(timer);\n                    }\n                    float t = getBezier(int(").concat(r,"Type.x), ").concat(r,"Time.y, ").concat(r,"Time.z, timer);\n                    return t * (ve - vs) + vs;\n                }\n            }\n        ").replace(/\/\/.*\n/g,"").replace(/\s\s+/g,"")},getScaleUniform:function n(r,i){var s;return s={},_defineProperty(s,r+"Time",i.prop(r+"Time")),_defineProperty(s,r+"Type",i.prop(r+"Type")),_defineProperty(s,r+"Value",i.prop(r+"Value")),s},getScaleProps:function n(r,i){var s={};if(i){var a=r[i];return s[i+"Time"]=a.time,s[i+"Type"]=a.type,s[i+"Value"]=a.value,s}for(var o in r){var l=r[o];s[o+"Time"]=l.time,s[o+"Type"]=l.type,s[o+"Value"]=l.value}return s}},NotDirty=0,LightDirty=1,AttributesDirty=2,LabelsDirty=4,MeshDirty=AttributesDirty|LabelsDirty,MeshesDirty=8,Defines=function(){function n(){_classCallCheck(this,n),this.state=NotDirty}return _createClass(n,[{key:"isDirty",get:function(){return this.state!==NotDirty}}]),n}(),Shader=function(){function n(i){_classCallCheck(this,n);var s=i.vertex,a=i.fragment,o=i.includes;this.uA=s,this.fA=a,this.includes=o||{}}var r=n.prototype;return r.process=function(i){return(!(this.lA&&this.cA)||i.isDirty)&&(this.lA=this.hA(i,this.uA),this.cA=this.hA(i,this.fA)),{vertex:this.lA,fragment:this.cA}},r.hA=function(i,s){var a=s;do{var o=this;a=s.replace(/#include <(.*?)>.*?\n/g,function(u,f){var c=o,h=f.split(",").map(function(p){return p.trim()}).filter(Boolean);return h.reduce(function(p,d){if(c.includes[d])return p+c.includes[d]+"\n";throw new Error("include not found: "+d)},"")})}while(a.includes("#include"));var l=Object.keys(i).reduce(function(u,f){return i[f]?u+"#define ".concat(f," ").concat(i[f],"\n"):u},"");return l+"\n"+a},n}(),Layer=function(n){_inherits(i,n);var r=_createSuper(i);function i(a){_classCallCheck(this,i);var o;return o=r.call(this,a),o.id=CommonUtil$1.MC(),o.Yp=[],o.styleOptions={},o.vA=new Defines,o.lights=new Array,o.dA=!1,o.customCenter=[108.9398,34.3416],o.colorPick=new ColorPick,o._needPickFrame=!1,o._pickPos=null,o.um={},o.sm=new Loca.Animation,o.sP=0,o.fm=1,o._animateLayerState=o.getInitialAnimateState(),o.q$=!1,o.customCenter=a.customCenter||o.customCenter,o.dA=a.acceptLight||!1,o.loca=a.loca,o.loca&&(o.map=a.loca.map,o.onAdd()),o.projection=ProjectInstance,o.vA.ACCEPT_LIGHT=o.dA,o.sm.addClip(new Loca.Clip({duration:1e4,repeat:1/0}),{x:[0,1]}),o.sm.start(),o}var s=i.prototype;return s.getInitialAnimateState=function(){return{}},s.onAdd=function(){var a;_get(_getPrototypeOf(i.prototype),"onAdd",this).call(this),this.map&&this.loca&&(this.loca.add(this),this.loca.requestRender(),(a=this.ll)==null||a.p$(this))},s.sA=function(a,o){this.vA.HAS_LIGHTS=a.length>0,this.vA.state|=LightDirty},s.setLoca=function(){var a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null,o=this.loca;this.loca=a,this.map=a?a==null?void 0:a.map:null,this.onAdd(),o&&o.requestRender()},s.AC=function(a){if(window.AMap){var o=this,l=new window.AMap.GLCustomLayer({zIndex:a.zIndex,visible:a.visible,zooms:a.zooms,render:function(){var u=o.render();u&&!o.q$&&(o.q$=!0,o.emit("complete"))}});l.beforeRender=this.beforeRender.bind(this),l.afterRender=this.afterRender.bind(this),this.Yp.push(l),this.map&&this.map.add(l)}},s.getLayerOptions=function(){return{opacity:this.opacity,zooms:this.zooms,visible:this.visible,zIndex:this.zIndex}},s.setOpacity=function(){var a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:1;this.opacity=a;var o=this.getLabelsLayer();o&&o.setOpacity(a),this.loca&&this.loca.requestRender()},s.setzIndex=function(){var a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:10;this.zIndex=a,this.Yp.forEach(function(l){l.setzIndex(a)});var o=this.getLabelsLayer();o&&o.setzIndex(a),this.loca&&this.loca.requestRender()},s.setZooms=function(){var a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[2,20];this.zooms=a,this.Yp.forEach(function(l){l.setZooms(a)});var o=this.getLabelsLayer();o&&o.setZooms(a),this.loca&&this.loca.requestRender()},s.show=function(){var a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,o=arguments.length>1?arguments[1]:void 0,l=this,u;if((u=this.ll)==null||u.O$(this),this.visible=!0,this.Yp.forEach(function(c){c.show()}),a<=0){this.fm=1,this.loca&&this.loca.requestRender();return}this.fm=0;var f=new Loca.Clip({duration:a},{opacity:[0,1]});this.sm.addClip(f),f.on("update",function(c){l.fm=c.keyframe.opacity,l.loca&&l.loca.requestRender()}),f.on("complete",function(){var c=l;l.sm.removeClip(f),requestAnimationFrame(function(){o&&o.call(c)})}),this.sm.start()},s.hide=function(){var a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,o=arguments.length>1?arguments[1]:void 0,l=this,u;if(a<=0){this.visible=!1,this.fm=0,(u=this.ll)==null||u.k$(this),this.Yp.forEach(function(c){c.hide()}),this.loca&&this.loca.requestRender();return}this.fm=1;var f=new Loca.Clip({duration:a},{opacity:[1,0]});this.sm.addClip(f),f.on("update",function(c){l.fm=c.keyframe.opacity,l.loca&&l.loca.requestRender()}),f.on("complete",function(){var c=l,h;l.visible=!1,l.Yp.forEach(function(p){p.hide()}),(h=l.ll)==null||h.k$(l),l.sm.removeClip(f),requestAnimationFrame(function(){o&&o.call(c)})}),this.sm.start()},s.setCustomCenter=function(a){this.customCenter=a,this.loca&&this.loca.requestRender()},s.beforeRender=function(){if(!(!this.loca||!this.loca.regl)){var a=this.loca.regl;this.aP(a),this.loca.customCoords.setCenter(this.customCenter)}},s.Ar=function(){_get(_getPrototypeOf(i.prototype),"Ar",this).call(this);var a=this.getLabelsLayer();this.map&&a&&this.map.remove(a)},s.remove=function(){var a;this.map&&this.loca&&((a=this.loca)==null||a.remove(this),this.loca=null,this.map=null)},s.destroy=function(){var a;(a=this.ll)==null||a.destroy(),this.remove(),this.sm.destroy(),this.styleOptions=null,this.fusion=null,this.ll=null,this.dataset=[],this.meshes=[],this.source=null},s.queryFeature=function(a){var o,l,u;if(buryPoint.record(this.CLASS_NAME,"queryFeature"),!!this.dm()&&(this._needPickFrame=!0,!(!this._pickFbo||!a))){this._pickPos=a;var f=(o=this.loca)==null?void 0:o.regl,c=this.pickRender(),h=f._gl,p=h.drawingBufferHeight/h.canvas.clientHeight,d=a[0]*p,v=h.drawingBufferHeight-a[1]*p,g=new Uint8Array(4);h.bindFramebuffer(h.FRAMEBUFFER,this._pickFbo._framebuffer.framebuffer),h.readPixels(d,v,1,1,h.RGBA,h.UNSIGNED_BYTE,g);var m=typeof c=="function"?c(g):this.colorPick.jf([g[0],g[1],g[2],g[3]]);return h.bindFramebuffer(h.FRAMEBUFFER,null),this._needPickFrame=!1,this._pickPos=null,(l=this.loca)!=null&&l.map.getContext()&&((u=this.loca)==null||u.map.getContext().setDirty()),m}},s.addAnimate=function(a,o){var l=this;buryPoint.record(this.CLASS_NAME,"addAnimate");var u=0,f={Linear:-1,QuadraticIn:u,QuadraticOut:++u,QuadraticInOut:++u,CubicIn:++u,CubicOut:++u,CubicInOut:++u,QuarticIn:++u,QuarticOut:++u,QuarticInOut:++u,QuinticIn:++u,QuinticOut:++u,QuinticInOut:++u,SinusoidalIn:++u,SinusoidalOut:++u,SinusoidalInOut:++u,ExponentialIn:++u,ExponentialOut:++u,ExponentialInOut:++u,CircularIn:++u,CircularOut:++u,CircularInOut:++u,ElasticIn:++u,ElasticOut:++u,ElasticInOut:++u,BackIn:++u,BackOut:++u,BackInOut:++u,BounceIn:++u,BounceOut:++u,BounceInOut:++u},c=Date.now(),h=c;a.random=a.random===void 0?!1:!!a.random,a.repeat=a.repeat===void 0?1:a.repeat;var p=new Loca.Clip({duration:a.random?a.transform:a.duration,easing:a.easing,repeat:a.repeat,startAt:a.startAt,yoyo:a.yoyo},_defineProperty({},a.key,a.value));this.sm.addClip(p),p.on("update",function(){c=Date.now()-h,l._animateLayerState[a.key]={time:[c,a.delay,a.transform,+a.random],type:[f[a.easing],+a.repeat,+a.yoyo,+a.duration],value:a.value},l.loca&&l.loca.requestRender()}),p.on("complete",function(){if(a.random&&a.delay>0){var d=l,v=new Loca.Clip({duration:a.delay},{delayTime:[0,1]});l.sm.addClip(v),v.on("update",function(){c=Date.now()-h,d._animateLayerState[a.key]={time:[c,a.delay,a.transform,+a.random],type:[f[a.easing],+a.repeat,+a.yoyo,+a.duration],value:a.value},d.loca&&d.loca.requestRender()}),v.on("complete",function(){c=0,d.sm.removeClip(v),o&&o.call(d)})}else c=0,l.sm.removeClip(p),o&&o.call(l)}),this.sm.start()},s.clearAnimate=function(){buryPoint.record(this.CLASS_NAME,"clearAnimate"),this._animateLayerState=this.getInitialAnimateState(),this.sm.reset(),this.sm.removeClip(),this.loca&&this.loca.requestRender()},s.jC=function(){if(!(!this.loca||!this.loca.regl||this._pickFbo)){var a=this.loca.regl;this._pickFbo=a.framebuffer({width:~~a._gl.canvas.width,height:~~a._gl.canvas.height,stencil:!1,depth:!1,Zh:!1})}},s.gm=function(a,o){var l;if(!(!this.map&&this.loca)&&(o=o||this.um.size,a=a||this.um.center,!(!o||!a))){var u=(l=this.loca)==null?void 0:l.regl._gl,f=this.map.getCenter().toArray(),c=u.canvas.width,h=u.canvas.height;this.um={center:f,size:[c,h]},u.canvas.width=o[0]*window.devicePixelRatio,u.canvas.height=o[1]*window.devicePixelRatio,u.canvas.style.width=o[0]+"px",u.canvas.style.height=o[1]+"px",u.viewport(0,0,u.canvas.width,u.canvas.height),this.map.updateView({size:o,center:a},!1)}},s.getLabelsLayer=function(){return null},s._getOpacity=function(){return this.fm*this.opacity},s.dm=function(){var a;if(!this.loca||!this.visible||this.opacity<=0)return!1;var o=(a=this.loca)==null?void 0:a.getZoom();return!(o<this.zooms[0]||o>this.zooms[1])},s.aP=function(a,o){if(this._pickFbo){var l=a._gl,u=l.canvas;(o||this._pickFbo.width!==u.width||this._pickFbo.height!==u.height)&&this._pickFbo({width:~~u.width,height:~~u.height})}},s.uP=function(a){if(a)for(var o=0,l=a.length;o<l;o++){var u=a[o];if(u.attributes)for(var f in u.attributes){var c=u.attributes[f];c.destroy&&c.destroy(),c.buffer&&c.buffer.destroy()}}},s.hP=function(){var a;return this.sP>=1<<30&&(this.sP=0),((a=this.loca)==null?void 0:a.animateStatus)==="start"&&this.sP++,this.sP},_createClass(i,[{key:"acceptLight",get:function(){return this.dA},set:function(a){var o;a!==this.dA&&(this.vA.state|=LightDirty),this.vA.ACCEPT_LIGHT=a,this.dA=a,(o=this.loca)==null||o.requestRender()}}]),i}(Layer$1),ColorGLSL={getColor:function n(r){return{uniform:{isPick:r.prop("isPick")},attribute:{pickColor:r.prop("pickColor")}}},getColorShader:function n(){return{vertex:"\n                uniform bool isPick;\n                attribute vec4 pickColor;\n                varying vec4 vPickColor;\n            ",fragment:"\n                uniform bool isPick;\n                varying vec4 vPickColor;\n            ",mainVert:"\n                vPickColor = pickColor;\n            ",mainFrag:"\n                if(isPick) {\n                    gl_FragColor = vec4(vPickColor.xyzw / 255.0);\n                }\n            "}}},LightGLSL={getLights:function n(r){return{acceptLight:r.prop("acceptLight"),ambIntensity:r.prop("ambIntensity"),ambLightColor:r.prop("ambLightColor"),dirIntensity:r.prop("dirIntensity"),dirLightColor:r.prop("dirLightColor"),dirVec:r.prop("dirVec"),pointIntensity:r.prop("pointIntensity"),pointLightColor:r.prop("pointLightColor"),pointPosition:r.prop("pointPosition"),pointDistence:r.prop("pointDistence"),cameraPosition:r.prop("cameraPosition"),shininess:r.prop("shininess")}},NC:function n(){return"\n            uniform bool acceptLight;\n            uniform float ambIntensity;\n            uniform vec3 ambLightColor;\n\n            uniform float dirIntensity;\n            uniform vec3 dirLightColor;\n            uniform vec3 dirVec;\n\n            uniform float pointIntensity;\n            uniform float pointDistence;\n            uniform vec3 pointLightColor;\n            uniform vec3 pointPosition;\n            uniform vec3 cameraPosition;\n            uniform float shininess;\n\n            struct DiffHighLight {\n                vec3 diffuse;\n                vec3 hightLight;\n            };\n\n            // \u73AF\u5883\u53CD\u5C04\n            vec3 ambient() {\n                return ambLightColor * ambIntensity;\n            }\n\n            // \u6F2B\u53CD\u5C04\n            vec3 diffuse(\n                vec3 normal,\n                vec3 lightDir,\n                vec3 lightColor,\n                float lightIntensity,\n                float weaken\n            ) {\n                vec3 nNormal = normalize(normal);\n                //\u8BA1\u7B97\u5149\u7EBF\u65B9\u5411\u548C\u6CD5\u5411\u91CF\u7684\u70B9\u79EF\n                float nDotL = max(dot(normalize(lightDir), nNormal), 0.0);\n                //\u8BA1\u7B97\u6F2B\u53CD\u5C04\u5149\u7684\u989C\u8272\n                return lightColor * nDotL * lightIntensity * weaken;\n            }\n\n            // \u955C\u9762\u53CD\u5C04\n            vec3 reflectLight(\n                vec3 cameraPosition,\n                vec3 lightDir,\n                vec3 position,\n                vec3 normal,\n                vec3 lightColor,\n                float shininess,\n                float lightIntensity,\n                float weaken\n            ) {\n                float specularLightWeighting = 0.0;\n                // vec3 lightDir = normalize(lightPosition - position);\n                vec3 cameraDirection = normalize(cameraPosition - position);\n                vec3 reflectionDirection = reflect(-lightDir, normal);\n                specularLightWeighting = pow(max(dot(reflectionDirection, cameraDirection), 0.0), shininess);\n                return lightColor * specularLightWeighting * lightIntensity * weaken;\n            }\n\n            // \u8BA1\u7B97\u8870\u51CF\u91CF\n            float lightWeaken(vec3 lightPosition, vec3 position, float distanceIntensity) {\n                // \u5149\u6E90\u548C\u5F53\u524D\u7684\u8DDD\u79BB\uFF0C\u8BA1\u7B97\u8870\u51CF\n                float dist = distance(lightPosition, position);\n                float weaken = 1.0 / (1.0 + dist + dist * dist);\n                if(distanceIntensity > 0.0) {\n                    weaken = clamp(-dist / distanceIntensity + 1.0, 0.0, 1.0);\n                } else {\n                    weaken = 1.0;\n                }\n                return weaken;\n            }\n\n            // \u8BA1\u7B97\u70B9\u5149\u7684\u6F2B\u53CD\u5C04\u548C\u955C\u9762\u53CD\u5C04\n            DiffHighLight pointLightCalc() {\n                vec3 normal = normalize(vNormal);\n                vec3 lightDir = normalize(pointPosition - vPosition);\n                float weaken = lightWeaken(pointPosition, vPosition, pointDistence);\n                vec3 diff = diffuse(normal, lightDir, pointLightColor, pointIntensity, weaken);\n                vec3 highL = reflectLight(cameraPosition, lightDir, vPosition, normal, pointLightColor, shininess, pointIntensity, weaken);\n                DiffHighLight result;\n                result.diffuse = diff;\n                result.hightLight = highL;\n                return result;\n            }\n\n            // \u8BA1\u7B97\u5E73\u884C\u5149\u7684\u6F2B\u53CD\u5C04\u548C\u955C\u9762\u53CD\u5C04\n            DiffHighLight dirLightCalc() {\n                vec3 normal = normalize(vNormal);\n                vec3 diff = diffuse(normal, -dirVec, dirLightColor, dirIntensity, 1.0);\n                // vec3 highL = reflectLight(cameraPosition, normalize(dirVec), vPosition, normal, dirLightColor, shininess, dirIntensity, 1.0);\n                DiffHighLight result;\n                result.diffuse = diff;\n                result.hightLight = vec3(0);\n                return result;\n            }\n\n            // \u8BA1\u7B97\u6700\u7EC8\u7684\u5149\u548C\u6750\u8D28\u7684\u5149 \u989C\u8272\u589E\u76CA\n            vec3 lightColor(vec3 color) {\n                vec3 amb = ambient() * color;\n                DiffHighLight pointDiffHigh = pointLightCalc();\n                DiffHighLight dirDiffHigh = dirLightCalc();\n\n                return amb + dirDiffHigh.diffuse * color + dirDiffHigh.hightLight * color + pointDiffHigh.diffuse * color + pointDiffHigh.hightLight * color;;\n            }\n        "}},__defProp$v=Object.defineProperty,__getOwnPropSymbols$v=Object.getOwnPropertySymbols,__hasOwnProp$v=Object.prototype.hasOwnProperty,__propIsEnum$v=Object.prototype.propertyIsEnumerable,__defNormalProp$v=function(n,r,i){return r in n?__defProp$v(n,r,{Fr:!0,Lr:!0,writable:!0,value:i}):n[r]=i},__spreadValues$v=function(n,r){for(var i in r||(r={}))__hasOwnProp$v.call(r,i)&&__defNormalProp$v(n,i,r[i]);var s=!0,a=!1,o=void 0;if(__getOwnPropSymbols$v)try{for(var l=__getOwnPropSymbols$v(r)[Symbol.iterator](),u;!(s=(u=l.next()).done);s=!0){var i=u.value;__propIsEnum$v.call(r,i)&&__defNormalProp$v(n,i,r[i])}}catch(f){a=!0,o=f}finally{try{!s&&l.return!=null&&l.return()}finally{if(a)throw o}}return n},Render=function(){function n(i){_classCallCheck(this,n),this.pA=new Map,this.v$=[],this.regl=i}var r=n.prototype;return r.p$=function(i){this.v$.forEach(function(s){var a;return(a=s.p$)==null?void 0:a.call(s,i)})},r.O$=function(i){this.v$.forEach(function(s){var a;return(a=s.O$)==null?void 0:a.call(s,i)})},r.k$=function(i){this.v$.forEach(function(s){var a;return(a=s.k$)==null?void 0:a.call(s,i)})},r.gA=function(i,s,a,o){if(!this.regl){console.warn("Please initialize `regl` first.");return}var l=new Shader(i),u=l.process(s),f=u.vertex,c=u.fragment;o=o!=null?o:0;var h=this.pA.get(i)||[];h[o]=this.regl(__spreadValues$v({frag:c,vert:f},a)),this.pA.set(i,h)},r.yA=function(i,s){var a=this.pA.get(i)||[];if(!this.regl||!(a!=null&&a.length)){console.warn("Please execute `prepareRender` first.");return}return s=s!=null?s:0,this.bA=a[s]},r.destroy=function(){this.pA.clear(),this.bA=void 0,this.regl=void 0,this.v$.forEach(function(i){var s;(s=i.destroy)==null||s.call(i)})},_createClass(n,[{key:"mA",get:function(){return!this.bA}}]),n}(),SubRender=function n(){_classCallCheck(this,n)},polygon={Sw:{zooms:[2,26],zIndex:120,visible:!0,opacity:1,cullface:"back",shininess:30,hasSide:!0,depth:!0,acceptLight:!0,blockHide:!0,I$:!1,hasTop:!0},style:{topColor:{defaultValue:"rgba(200,200,200,1)",type:"color",render:"attribute"},bottomColor:{defaultValue:"rgba(200,200,200,1)",type:"color",render:"attribute"},sideTopColor:{defaultValue:"#ffffff",type:"color",render:"attribute"},sideBottomColor:{defaultValue:"#fff",type:"color",render:"attribute"},borderWidth:{defaultValue:10,type:"number",render:"attribute"},borderColor:{defaultValue:"rgba(250,250,250,1)",type:"color",render:"attribute"},altitude:{defaultValue:0,type:"number",render:"attribute"},height:{defaultValue:0,type:"number",render:"attribute"},texture:{defaultValue:!1,type:"image",render:"uniform"},textureSize:{defaultValue:[10,3],type:"array",render:"attribute"},labelAltitude:{defaultValue:0,type:"number",render:"attribute"},label:{defaultValue:null,type:"nest",render:"attribute"}}},line={Sw:{zooms:[2,26],zIndex:120,visible:!0,opacity:1,depth:!1},style:{unit:{defaultValue:"px",type:"string",render:"uniform"},color:{defaultValue:"rgba(200,200,200,1)",type:"color",render:"attribute"},borderWidth:{defaultValue:0,type:"number",render:"attribute"},borderColor:{defaultValue:"rgba(250,250,250,1)",type:"color",render:"attribute"},lineWidth:{defaultValue:20,type:"number",render:"attribute"},dash:{defaultValue:[1,0,1,0],type:"array",render:"attribute"},altitude:{defaultValue:0,type:"number",render:"attribute"}}},pulseline={Sw:{zooms:[2,26],zIndex:120,visible:!0,opacity:1},style:{lineWidth:{defaultValue:1,type:"number",render:"attribute"},headColor:{defaultValue:"rgba(0, 0, 0, 0.75)",type:"color",render:"attribute"},trailColor:{defaultValue:"rgba(0, 0, 0, 0.25)",type:"color",render:"attribute"},altitude:{defaultValue:0,type:"number",render:"uniform"},interval:{defaultValue:1,type:"number",render:"uniform"},duration:{defaultValue:2e3,type:"number",render:"uniform"}}},scatter={Sw:{zooms:[2,26],zIndex:120,visible:!0,opacity:1,depth:!1},style:{size:{defaultValue:[20,20],type:"array",render:"attribute"},rotation:{defaultValue:0,type:"number",render:"attribute"},color:{defaultValue:"rgba(200,200,200,1)",type:"color",render:"attribute"},altitude:{defaultValue:0,type:"number",render:"attribute"},borderWidth:{defaultValue:0,type:"number",render:"attribute"},borderColor:{defaultValue:"rgba(250,250,250,1)",type:"color",render:"attribute"},texture:{defaultValue:null,type:"image",render:"uniform"},unit:{defaultValue:"px",type:"string",render:"uniform"},animate:{defaultValue:!1,type:"boolean",render:"uniform"},duration:{defaultValue:0,type:"number",render:"uniform"},labelAltitude:{defaultValue:0,type:"number",render:"attribute"},label:{defaultValue:null,type:"nest",render:"attribute"}}},heatmap={Sw:{zooms:[2,26],zIndex:120,visible:!0,opacity:1,depth:!0},style:{radius:{defaultValue:20,type:"number",render:"attribute"},value:{defaultValue:10,type:"number",render:"attribute"},gradient:{defaultValue:{.5:"blue",.65:"rgb(117,211,248)",.7:"rgb(0, 255, 0)",.9:"#ffea00",1:"red"},type:"object",render:"uniform"},opacity:{defaultValue:[0,1],type:"array",render:"uniform"},height:{defaultValue:100,type:"number",render:"uniform"},heightBezier:{defaultValue:[.4,.2,.4,.8],type:"array",render:"uniform"},max:{defaultValue:null,type:"number",render:"uniform"},min:{defaultValue:null,type:"number",render:"uniform"},unit:{defaultValue:"px",type:"string",render:"uniform"},difference:{defaultValue:!1,type:"bool",render:"uniform"}}},point={Sw:{zooms:[2,26],zIndex:120,visible:!0,opacity:1,blend:"normal"},style:{unit:{defaultValue:"px",type:"string",render:"uniform"},radius:{defaultValue:20,type:"number",render:"attribute"},borderWidth:{defaultValue:10,type:"number",render:"attribute"},blurWidth:{defaultValue:-1,type:"number",render:"attribute"},color:{defaultValue:"rgba(255,255,255,1)",type:"color",render:"attribute"},borderColor:{defaultValue:"rgba(255,255,255,1)",type:"color",render:"attribute"},label:{defaultValue:null,type:"nest",render:"attribute"}}},icon={Sw:{zooms:[2,26],zIndex:120,visible:!0,opacity:1},style:{unit:{defaultValue:"px",type:"string",render:"uniform"},icon:{defaultValue:"",type:"string",render:"attribute"},iconSize:{defaultValue:[20,20],type:"array",render:"attribute"},offset:{defaultValue:[0,0],type:"array",render:"attribute"},rotation:{defaultValue:0,type:"number",render:"attribute"},opacity:{defaultValue:1,type:"number",render:"attribute"},label:{defaultValue:null,type:"nest",render:"attribute"}}},grid$1={Sw:{zooms:[2,26],zIndex:120,visible:!0,opacity:1,depth:!0,acceptLight:!0,shininess:30,hasSide:!0,cullface:"back"},style:{unit:{defaultValue:"meter",type:"string",render:"uniform"},radius:{defaultValue:1e3,type:"number",render:"uniform"},gap:{defaultValue:0,type:"number",render:"uniform"},altitude:{defaultValue:0,type:"number",render:"attribute"},value:{defaultValue:0,type:"number",render:"attribute"},height:{defaultValue:0,type:"number",render:"attribute"},topColor:{defaultValue:"#ffffff",type:"color",render:"attribute"},sideTopColor:{defaultValue:"#ffffff",type:"color",render:"attribute"},sideBottomColor:{defaultValue:"#fff",type:"color",render:"attribute"},bottomColor:{defaultValue:"rgba(253,0,255,0)",type:"color",render:"attribute"},labelAltitude:{defaultValue:0,type:"number",render:"attribute"},label:{defaultValue:null,type:"nest",render:"attribute"}}},hexagon$1={Sw:{zooms:[2,26],zIndex:120,visible:!0,opacity:1,depth:!0,acceptLight:!0,shininess:30,hasSide:!0,cullface:"back"},style:{unit:{defaultValue:"meter",type:"string",render:"uniform"},radius:{defaultValue:1e3,type:"number",render:"uniform"},gap:{defaultValue:0,type:"number",render:"uniform"},altitude:{defaultValue:0,type:"number",render:"attribute"},value:{defaultValue:0,type:"number",render:"attribute"},height:{defaultValue:0,type:"number",render:"attribute"},topColor:{defaultValue:"#ffffff",type:"color",render:"attribute"},bottomColor:{defaultValue:"rgba(253,0,255,0)",type:"color",render:"attribute"},sideTopColor:{defaultValue:"#ffffff",type:"color",render:"attribute"},sideBottomColor:{defaultValue:"#fff",type:"color",render:"attribute"},labelAltitude:{defaultValue:0,type:"number",render:"attribute"},label:{defaultValue:null,type:"nest",render:"attribute"}}},link={Sw:{zooms:[2,26],zIndex:120,visible:!0,opacity:1},style:{lineColors:{defaultValue:["rgba(10,10,10,1)"],type:"colors",render:"attribute"},height:{defaultValue:function n(r,i){return i.distance*.7},type:"number",render:"attribute"},smoothSteps:{defaultValue:50,type:"number",render:"uniform"}}},pulselink={Sw:{zooms:[2,26],zIndex:120,visible:!0,opacity:1,depth:!0},style:{maxHeightScale:{defaultValue:.5,type:"number",render:"uniform"},lineColors:{defaultValue:["rgb(255,228,105)","rgb(255,164,105)","rgba(1, 34, 249,1)"],type:"colors",render:"attribute"},dash:{defaultValue:[10,0,10,0],type:"array",render:"attribute"},lineWidth:{defaultValue:[10,20],type:"array",render:"attribute"},height:{defaultValue:0,type:"number",render:"attribute"},speed:{defaultValue:10,type:"number",render:"attribute"},smoothSteps:{defaultValue:50,type:"number",render:"uniform"},headColor:{defaultValue:"rgba(255, 255, 0, 1)",type:"color",render:"uniform"},trailColor:{defaultValue:"rgba(255, 255, 0, 0)",type:"color",render:"uniform"},unit:{defaultValue:"px",type:"number",render:"uniform"},flowLength:{defaultValue:10,type:"number",render:"uniform"}}},prism={Sw:{zooms:[2,26],zIndex:120,visible:!0,opacity:1,depth:!1,acceptLight:!0,shininess:30,hasSide:!0,cullface:"back"},style:{unit:{defaultValue:"px",type:"string",render:"uniform"},sideNumber:{defaultValue:3,type:"number",render:"uniform"},rotation:{defaultValue:0,type:"number",render:"attribute"},radius:{defaultValue:20,type:"number",render:"attribute"},altitude:{defaultValue:0,type:"number",render:"attribute"},height:{defaultValue:100,type:"number",render:"attribute"},topColor:{defaultValue:"#ffffff",type:"color",render:"attribute"},sideTopColor:{defaultValue:"#ffffff",type:"color",render:"attribute"},sideBottomColor:{defaultValue:"#fff",type:"color",render:"attribute"},labelAltitude:{defaultValue:0,type:"number",render:"attribute"},label:{defaultValue:null,type:"nest",render:"attribute"}}},gltf={Sw:{zooms:[2,26],zIndex:120,visible:!0,opacity:1,depth:!0},style:{rotateX:{defaultValue:0,type:"number",render:"attribute"},rotateY:{defaultValue:0,type:"number",render:"attribute"},rotateZ:{defaultValue:0,type:"number",render:"attribute"},height:{defaultValue:0,type:"number",render:"attribute"},visible:{defaultValue:!0,type:"boolean",render:"attribute"},scale:{defaultValue:[1,1,1],type:"array",render:"attribute"}}},zmarker={Sw:{zooms:[2,26],zIndex:120,visible:!0,opacity:1,depth:!0},style:{unit:{defaultValue:"px",type:"string",render:"uniform"},alwaysFront:{defaultValue:!1,type:"bool",render:"uniform"},content:{defaultValue:"<p>\u8FD9\u662F\u4E00\u4E2A\u6807\u8BB0</p>",type:"string",render:"attribute"},size:{defaultValue:[20,20],type:"array",render:"attribute"},rotation:{defaultValue:0,type:"number",render:"attribute"},altitude:{defaultValue:0,type:"number",render:"attribute"}}},labels={Sw:{zooms:[2,26],zIndex:120,visible:!0,opacity:1,z$:!0,A$:!0},style:{label:{defaultValue:null,type:"nest",render:"attribute"}}},laser={Sw:{zooms:[1,20],zIndex:10,visible:!0,opacity:1,depth:!0},style:{unit:{defaultValue:"px",type:"string",render:"uniform"},height:{defaultValue:200,type:"number",render:"attribute"},color:{defaultValue:"rgba(255,255,0,0.5)",type:"color",render:"attribute"},angle:{defaultValue:0,type:"number",render:"uniform"},trailLength:{defaultValue:30,type:"number",render:"uniform"},lineWidth:{defaultValue:2,type:"number",render:"uniform"},repeat:{defaultValue:1/0,type:"number",render:"uniform"},duration:{defaultValue:2e3,type:"number",render:"attribute"},interval:{defaultValue:0,type:"number",render:"attribute"},delay:{defaultValue:0,type:"number",render:"attribute"},fadeOpacity:{defaultValue:.2,type:"number",render:"uniform"}}},conf=Object.freeze({__proto__:null,polygon:polygon,line:line,pulseline:pulseline,scatter:scatter,heatmap:heatmap,grid:grid$1,hexagon:hexagon$1,link:link,point:point,icon:icon,pulselink:pulselink,Iw:gltf,prism:prism,zmarker:zmarker,labels:labels,laser:laser}),__defProp$u=Object.defineProperty,__defProps$k=Object.defineProperties,__getOwnPropDescs$k=Object.getOwnPropertyDescriptors,__getOwnPropSymbols$u=Object.getOwnPropertySymbols,__hasOwnProp$u=Object.prototype.hasOwnProperty,__propIsEnum$u=Object.prototype.propertyIsEnumerable,__defNormalProp$u=function(n,r,i){return r in n?__defProp$u(n,r,{Fr:!0,Lr:!0,writable:!0,value:i}):n[r]=i},__spreadValues$u=function(n,r){for(var i in r||(r={}))__hasOwnProp$u.call(r,i)&&__defNormalProp$u(n,i,r[i]);var s=!0,a=!1,o=void 0;if(__getOwnPropSymbols$u)try{for(var l=__getOwnPropSymbols$u(r)[Symbol.iterator](),u;!(s=(u=l.next()).done);s=!0){var i=u.value;__propIsEnum$u.call(r,i)&&__defNormalProp$u(n,i,r[i])}}catch(f){a=!0,o=f}finally{try{!s&&l.return!=null&&l.return()}finally{if(a)throw o}}return n},__spreadProps$k=function(n,r){return __defProps$k(n,__getOwnPropDescs$k(r))},pushArray$q=CommonUtil$1._C,_PolygonsFusion=function(n){_inherits(i,n);var r=_createSuper(i);function i(){return _classCallCheck(this,i),r.apply(this,arguments)}var s=i.prototype;return s.DC=function(){},s.buildStyle=function(a,o){for(var l,u=polygon.style,f=[],c=0;c<a.length;c++)if(!(!a[c].features||!a[c].features.polygons)){for(var h=a[c].features.polygons,p=StyleInstance.parse(h,o,u),d={},v=0;v<h.length;v++)if(p)for(var g in p.attributes){var m=p.attributes[g];d[g]||(d[g]=[]),((l=m[v])==null?void 0:l.length)>0?pushArray$q(d[g],m[v]):d[g][d[g].length]=m[v]}f.push({attributes:d,uniforms:p.uniforms,si:p.si})}return f},s.fusion=function(a,o,l,u){if(!this.regl||!l.loca)return[];var f=[];u=u||this.buildStyle(a,o);for(var c=l.loca.customCoords,h=0;h<a.length;h++){var p=a[h];if(!(!p.features||!p.features.polygons||!u[h])){for(var d=p.features.polygons,v=u[h],g={index:[],vertex:[],color:[],normal:[],uv:[],textureSize:[],pickColor:[],topOrBottom:[],labels:[]},m=[],y=[],b=[],_=[],C=0;C<d.length;C++){var A=d[C],I=l.colorPick.add(A),D=A.coordinates;if(A.type==="MultiPolygon"){for(var X=0,W=D.length;X<W;X++){var K=D[X],U=this.triangles(K,{style:v,index:C,pickColor:I,id:A.sr},c,l.hasTop,l.hasSide,l.I$),M=g.vertex.length;m.push(M),y.push(M+U.Tw.Pw),b.push(M+U.Tw.top),GeoUtil.mergeTriangles(g,U,4),pushArray$q(g.color,U.color),pushArray$q(g.pickColor,U.pickColor),pushArray$q(g.normal,U.normal),pushArray$q(g.uv,U.uv),pushArray$q(g.textureSize,U.textureSize),pushArray$q(g.topOrBottom,U.topOrBottom)}v.attributes.label[C]&&g.labels.push(__spreadValues$u({position:_toConsumableArray(GeometryUtil.a$(getMaximumPolygon(D))).concat([v.attributes.altitude[C]+v.attributes.height[C]+v.attributes.labelAltitude[C]])},v.attributes.label[C]))}else{var L=this.triangles(D,{style:v,index:C,pickColor:I,id:A.sr},c,l.hasTop,l.hasSide,l.I$),P=g.vertex.length;m.push(P),y.push(P+L.Tw.Pw),b.push(P+L.Tw.top),GeoUtil.mergeTriangles(g,L,4),pushArray$q(g.color,L.color),pushArray$q(g.pickColor,L.pickColor),pushArray$q(g.normal,L.normal),pushArray$q(g.uv,L.uv),pushArray$q(g.textureSize,L.textureSize),pushArray$q(g.topOrBottom,L.topOrBottom),v.attributes.label[C]&&g.labels.push(__spreadValues$u({position:_toConsumableArray(GeometryUtil.a$(D)).concat([v.attributes.altitude[C]+v.attributes.height[C]+v.attributes.labelAltitude[C]])},v.attributes.label[C]))}_[C]=g.vertex.length}f[h]={id:p.id,attributes:{position:{buffer:this.regl.buffer(g.vertex),offset:0,stride:4*4,td:!1,divisor:0},topOrBottom:{buffer:this.regl.buffer(g.topOrBottom),offset:0,stride:4*1,td:!1,divisor:0},color:{buffer:this.regl.buffer(g.color),offset:0,stride:4*4,td:!1,divisor:0},pickColor:{buffer:this.regl.buffer(g.pickColor),offset:0,stride:4*4,td:!1,divisor:0},normal:{buffer:this.regl.buffer(g.normal),offset:0,stride:4*3,td:!1,divisor:0},uv:{buffer:this.regl.buffer(g.uv),offset:0,stride:4*2,td:!1,divisor:0},textureSize:{buffer:this.regl.buffer(g.textureSize),offset:0,stride:4*2,td:!1,divisor:0},index:this.regl.elements({primitive:"triangles",type:"uint32",data:g.index})},uniforms:v.uniforms,si:v.si,mf:{Tw:{bottom:m,Pw:y,top:b,jw:_},origin:{position:g.vertex,color:g.color},labels:g.labels}}}}return f},s.triangles=function(a,o,l){for(var u=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!0,f=arguments.length>4&&arguments[4]!==void 0?arguments[4]:!0,c=arguments.length>5&&arguments[5]!==void 0?arguments[5]:!0,h=GeoUtil.triangle(a),p=h.vertex,d=h.index,v=[],g=o.index,m=o.pickColor,y=o.style.attributes,b=y.height,_=y.altitude,C=y.topColor,A=y.bottomColor,I=y.sideTopColor,D=y.sideBottomColor,X=y.textureSize,W=_[g],K=b[g]+W,U=g*4,M=C.slice(U,U+4),L=A.slice(U,U+4),P=D.slice(U,U+4),$=I.slice(U,U+4),R=X&&X.slice(g*2,g*2+2),T=[],w=[],E=[],O=[],k=[],F=[],q=[],Y=[],fe=[],_e=[],Pe=[],De=[],tt=[],je=[],Fe=[],Ge=[],Et=[],st=[],at=[],$t=0,kt=p.length;$t<kt;$t+=2){var Rt=p[$t],Tt=p[$t+1],bt=l.lngLatToCoord([Rt,Tt]);u&&(this.addVertex(T,q,O,_e,[bt[0],bt[1],K,o.id],M,[0,0,1],[-1,-1],tt,[-1,-1],Ge,m),st.push(1)),c&&(this.addVertex(w,Y,k,Pe,[bt[0],bt[1],W,o.id],L,[0,0,-1],[-1,-1],je,[-1,-1],Ge,m),Et.push(0))}if(f)for(var Ot=this.isClock(a[0]),Lt=!1,xt=0,ht=a.length;xt<ht;xt++){var ot=a[xt];xt>0&&(Lt=!0);for(var mt=!1,nt=0,Ut=0,Dt=ot.length;Ut<Dt-1;Ut++){var ft=ot[Ut],Ct=ot[Ut+1],St=mt||l.lngLatToCoord(ft),zt=l.lngLatToCoord(Ct),Nt=E.length/4,Vt=v.length,$r=this.getNormal(St,zt,!!(+Ot^+Lt)),Ur=glMatrix.vec2.distance(St,zt);at.push(0,1,0,1),this.addVertex(E,fe,F,De,[St[0],St[1],W,o.id],P,$r,[nt,0],Fe,R,Ge,m),this.addVertex(E,fe,F,De,[St[0],St[1],K,o.id],$,$r,[nt,K],Fe,R,Ge,m),this.addVertex(E,fe,F,De,[zt[0],zt[1],W,o.id],P,$r,[nt+Ur,0],Fe,R,Ge,m),this.addVertex(E,fe,F,De,[zt[0],zt[1],K,o.id],$,$r,[nt+Ur,K],Fe,R,Ge,m),Ot?(v[Vt]=Nt,v[Vt+1]=Nt+3,v[Vt+2]=Nt+1,v[Vt+3]=Nt,v[Vt+4]=Nt+2,v[Vt+5]=Nt+3):(v[Vt]=Nt,v[Vt+1]=Nt+1,v[Vt+2]=Nt+3,v[Vt+3]=Nt,v[Vt+4]=Nt+3,v[Vt+5]=Nt+2),mt=zt,nt+=Ur}}var En=w.length,si=En+E.length,jr={vertex:E,index:v};return c&&(jr=GeoUtil.mergeTriangles({vertex:w,index:d.slice(0)},{vertex:E,index:v},4)),u&&GeoUtil.mergeTriangles(jr,{vertex:T,index:d.reverse()},4),pushArray$q(Y,fe),pushArray$q(Y,q),pushArray$q(k,F),pushArray$q(k,O),pushArray$q(Pe,De),pushArray$q(Pe,_e),pushArray$q(je,Fe),pushArray$q(je,tt),pushArray$q(Et,at),pushArray$q(Et,st),{vertex:jr.vertex,index:jr.index,color:Y,normal:k,uv:Pe,textureSize:je,pickColor:Ge,topOrBottom:Et,Tw:{Pw:En,top:si}}},s.addVertex=function(a,o,l,u,f,c,h){var p=arguments.length>7&&arguments[7]!==void 0?arguments[7]:[-1,-1],d=arguments.length>8?arguments[8]:void 0,v=arguments.length>9?arguments[9]:void 0,g=arguments.length>10?arguments[10]:void 0,m=arguments.length>11?arguments[11]:void 0,y=a.length,b=l.length,_=u.length;if(a[y]=f[0],a[y+1]=f[1],a[y+2]=f[2],a[y+3]=f[3],o[y]=c[0],o[y+1]=c[1],o[y+2]=c[2],o[y+3]=c[3],g&&m){var C=g.length;g[C]=m[0],g[C+1]=m[1],g[C+2]=m[2],g[C+3]=m[3]}l[b]=h[0],l[b+1]=h[1],l[b+2]=h[2],u[_]=p[0],u[_+1]=p[1],d&&v&&(d[_]=v[0],d[_+1]=v[1])},s.getNormal=function(a,o){var l=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,u=glMatrix.vec3.create();glMatrix.vec3.set(u,o[0]-a[0],o[1]-a[1],0),l&&glMatrix.vec3.set(u,a[0]-o[0],a[1]-o[1],0);var f=glMatrix.vec3.create();glMatrix.vec3.set(f,0,0,1);var c=glMatrix.vec3.create();return glMatrix.vec3.normalize(c,glMatrix.vec3.cross(c,u,f))},s.isClock=function(a){for(var o=a.length,l=0,u=0;u<o;u++){var f=a[u],c=a[(u+1)%o];l+=(c[0]-f[0])*(c[1]+f[1])}return l>0},s.updateStyle=function(a,o,l){for(var u=function(h,p){for(var d=a[h],v=o[h].attributes,g=v.altitude,m=v.height,y=v.topColor,b=v.bottomColor,_=v.sideTopColor,C=v.sideBottomColor,A=v.textureSize,I=v.label,D=v.labelAltitude,X=d.mf.origin,W=X.position,K=X.color,U=d.mf.Tw,M=U.top,L=U.bottom,P=U.Pw,$=U.jw,R=new Float32Array(K.length/2),T=0,w=0,E=0,O=W.length;E<O;E+=4){var k=E/4*4,F=void 0,q=[-1,-1];E>=$[T]&&T++;var Y=T*4;E>=L[w+1]&&w++,E<P[w]?l.I$&&(F=b,W[E+2]=g[T]):E>=P[w]&&E<M[w]?l.hasSide&&((E-P[w])/4%2===0?(F=C,W[E+2]=g[T]):(F=_,W[E+2]=m[T]+g[T]),q=A.slice(T*2,T*2+2)):l.hasTop&&(F=y,W[E+2]=m[T]+g[T]),K[k]=F[Y],K[k+1]=F[Y+1],K[k+2]=F[Y+2],K[k+3]=F[Y+3],R[k/2]=q[0],R[k/2+1]=q[1]}d.attributes.position.buffer({data:W}),d.attributes.color.buffer({data:K}),d.attributes.textureSize.buffer({data:R}),d.uniforms=o[h].uniforms,d.mf.labels=d.mf.labels.map(function(fe,_e){var Pe=fe.position;return Pe[2]=m[_e]+g[_e]+D[_e],__spreadProps$k(__spreadValues$u(__spreadValues$u({},fe),I[_e]),{position:Pe})})},f=0,c=a.length;f<c;f++)u(f,c)},s.EC=function(){return[]},s.destroy=function(){this.regl=null},i.getInstance=function(){return this.ui},i}(GeometryFusion),PolygonsFusion=_PolygonsFusion;PolygonsFusion.ui=new _PolygonsFusion;var PolygonsFusionInstance=PolygonsFusion.getInstance(),lightUniforms="\n#if defined(ACCEPT_LIGHT) && defined(HAS_LIGHTS)\n    #ifdef NUMBER_OF_AMBIENT_LIGHTS\n        struct AmbientLight {\n            float intensity;\n            vec3 lightColor; \n        };\n        uniform AmbientLight ambientLight; \n    #endif\n\n    #ifdef NUMBER_OF_POINT_LIGHTS\n        struct PointLight {\n            float intensity;\n            float dist;\n            vec3 lightColor;\n            vec3 position;\n        };\n        uniform PointLight pointLights[NUMBER_OF_POINT_LIGHTS]; \n    #endif\n\n    #ifdef NUMBER_OF_DIRECTIONAL_LIGHTS\n        struct DirectionalLight {\n            float intensity;\n            vec3 lightColor;\n            vec3 direction;\n        };\n        uniform DirectionalLight directionalLights[NUMBER_OF_DIRECTIONAL_LIGHTS]; \n    #endif\n#endif\n",lightFunctions="\n#if defined(ACCEPT_LIGHT) && defined(HAS_LIGHTS)\n    struct DiffHighLight {\n        vec3 diffuse;\n        vec3 highLight;\n    };\n\n    // \u73AF\u5883\u53CD\u5C04\n    vec3 ambient(vec3 ambLightColor, float ambIntensity) {\n        return ambLightColor * ambIntensity;\n    }\n\n    vec3 diffuse(\n        vec3 normal,\n        vec3 lightDir,\n        vec3 lightColor,\n        float lightIntensity,\n        float weaken\n    ) {\n        vec3 nNormal = normalize(normal);\n        //\u8BA1\u7B97\u5149\u7EBF\u65B9\u5411\u548C\u6CD5\u5411\u91CF\u7684\u70B9\u79EF\n        float nDotL = max(dot(normalize(lightDir), nNormal), 0.0);\n        //\u8BA1\u7B97\u6F2B\u53CD\u5C04\u5149\u7684\u989C\u8272\n        return lightColor * nDotL * lightIntensity * weaken;\n    }\n\n    // \u955C\u9762\u53CD\u5C04\n    vec3 reflectLight(\n        vec3 cameraPosition,\n        vec3 lightDir,\n        vec3 position,\n        vec3 normal,\n        vec3 lightColor,\n        float shininess,\n        float lightIntensity,\n        float weaken\n    ) {\n        float specularLightWeighting = 0.0;\n        // vec3 lightDir = normalize(lightPosition - position);\n        vec3 cameraDirection = normalize(cameraPosition - position);\n        vec3 reflectionDirection = reflect(-lightDir, normal);\n        specularLightWeighting = pow(max(dot(reflectionDirection, cameraDirection), 0.0), shininess);\n        return lightColor * specularLightWeighting * lightIntensity * weaken;\n    }\n\n    // \u8BA1\u7B97\u8870\u51CF\u91CF\n    float lightWeaken(vec3 lightPosition, vec3 position, float distanceIntensity) {\n        // \u5149\u6E90\u548C\u5F53\u524D\u7684\u8DDD\u79BB\uFF0C\u8BA1\u7B97\u8870\u51CF\n        float dist = distance(lightPosition, position);\n        float weaken;\n        if(distanceIntensity > 0.0) {\n            weaken = clamp(-dist / distanceIntensity + 1.0, 0.0, 1.0);\n        } else {\n            weaken = 1.0;\n        }\n        return weaken;\n    }\n\n    // \u8BA1\u7B97\u70B9\u5149\u7684\u6F2B\u53CD\u5C04\u548C\u955C\u9762\u53CD\u5C04\n    DiffHighLight pointLightCalc(vec3 pointPosition, vec3 pointLightColor, float pointDistance, float pointIntensity) {\n        vec3 normal = normalize(vNormal);\n        vec3 lightDir = normalize(pointPosition - vPosition);\n        float weaken = lightWeaken(pointPosition, vPosition, pointDistance);\n        vec3 diff = diffuse(normal, lightDir, pointLightColor, pointIntensity, weaken);\n        vec3 highL = reflectLight(cameraPosition, lightDir, vPosition, normal, pointLightColor, shininess, pointIntensity, weaken);\n        DiffHighLight result;\n        result.diffuse = diff;\n        result.highLight = highL;\n        return result;\n    }\n\n    // \u8BA1\u7B97\u5E73\u884C\u5149\u7684\u6F2B\u53CD\u5C04\u548C\u955C\u9762\u53CD\u5C04\n    DiffHighLight dirLightCalc(vec3 dirVec, vec3 dirLightColor, float dirIntensity) {\n        vec3 normal = normalize(vNormal);\n        vec3 diff = diffuse(normal, -dirVec, dirLightColor, dirIntensity, 1.0);\n        // vec3 highL = reflectLight(cameraPosition, normalize(dirVec), vPosition, normal, dirLightColor, shininess, dirIntensity, 1.0);\n        DiffHighLight result;\n        result.diffuse = diff;\n        result.highLight = vec3(0);\n        return result;\n    }\n#endif\n",lightMainCompute="\n#if defined(ACCEPT_LIGHT) && defined(HAS_LIGHTS)\n\n    DiffHighLight diffHighLight;\n    vec3 amb = vec3(0.0, 0.0, 0.0);\n    vec3 diffuse = vec3(0.0, 0.0, 0.0);\n    vec3 highLight = vec3(0.0, 0.0, 0.0);  \n\n    #ifdef NUMBER_OF_AMBIENT_LIGHTS\n        amb = ambient(ambientLight.lightColor, ambientLight.intensity) * gl_FragColor.rgb;\n    #endif\n\n    #ifdef NUMBER_OF_POINT_LIGHTS\n        for (int i = 0; i < NUMBER_OF_POINT_LIGHTS; i++) {\n            PointLight l = pointLights[i];\n            diffHighLight = pointLightCalc(l.position, l.lightColor, l.dist, l.intensity);\n            diffuse += diffHighLight.diffuse;\n            highLight += diffHighLight.highLight;\n        }\n    #endif\n\n    #ifdef NUMBER_OF_DIRECTIONAL_LIGHTS\n        for (int i = 0; i < NUMBER_OF_DIRECTIONAL_LIGHTS; i++) {\n            DirectionalLight l = directionalLights[i];\n            diffHighLight = dirLightCalc(l.direction, l.lightColor, l.intensity);\n            diffuse += diffHighLight.diffuse;\n            highLight += diffHighLight.highLight;   \n        }\n\n    #endif\n\n    gl_FragColor.rgb = amb + diffuse * gl_FragColor.rgb + highLight * gl_FragColor.rgb;\n\n#endif\n",LightIncludes={lightUniforms:lightUniforms,lightFunctions:lightFunctions,lightMainCompute:lightMainCompute},__defProp$t=Object.defineProperty,__getOwnPropSymbols$t=Object.getOwnPropertySymbols,__hasOwnProp$t=Object.prototype.hasOwnProperty,__propIsEnum$t=Object.prototype.propertyIsEnumerable,__defNormalProp$t=function(n,r,i){return r in n?__defProp$t(n,r,{Fr:!0,Lr:!0,writable:!0,value:i}):n[r]=i},__spreadValues$t=function(n,r){for(var i in r||(r={}))__hasOwnProp$t.call(r,i)&&__defNormalProp$t(n,i,r[i]);var s=!0,a=!1,o=void 0;if(__getOwnPropSymbols$t)try{for(var l=__getOwnPropSymbols$t(r)[Symbol.iterator](),u;!(s=(u=l.next()).done);s=!0){var i=u.value;__propIsEnum$t.call(r,i)&&__defNormalProp$t(n,i,r[i])}}catch(f){a=!0,o=f}finally{try{!s&&l.return!=null&&l.return()}finally{if(a)throw o}}return n},PolygonShader={vertex:"\n        precision highp float;\n\n        attribute vec4 position;\n        attribute vec3 normal;\n        attribute vec4 color;\n        attribute vec2 uv;\n        attribute vec2 textureSize;\n        attribute float topOrBottom;\n\n        varying vec3 vNormal;\n        varying vec4 vColor;\n        varying vec3 vPosition;\n        varying vec2 vUv;\n        varying vec2 vTexSize;\n        ".concat(ColorGLSL.getColorShader().vertex,"\n        ").concat(RenderUtil.getBezier(),"\n        ").concat(RenderUtil.getScaleType("height"),"\n        ").concat(RenderUtil.getScaleType("altitude"),"\n\n        uniform mat4 mvp;\n\n        void main() {\n            vec3 realPos = position.xyz;\n            float altitudeScale = altitudeScaleValue(position.w);\n            float heightScale = heightScaleValue(position.w);\n            if(topOrBottom == 0.0) {\n                realPos = vec3(position.xy, position.z * altitudeScale);\n            }\n            if(topOrBottom == 1.0) {\n                realPos = vec3(position.xy, position.z * heightScale);\n            }\n            vColor = color;\n            vNormal = normal;\n            vPosition = realPos;\n            vUv = vec2(uv.x / textureSize.x, uv.y / textureSize.y);\n            vTexSize = textureSize;\n            gl_Position = mvp * vec4(realPos, 1.0);\n            ").concat(ColorGLSL.getColorShader().mainVert,"\n        }\n    "),fragment:"\n        precision highp float;\n        varying vec4 vColor;\n\n        // \u5982\u679C\u9700\u8981\u5149\u7167\uFF0C\u8FD9\u4E24\u4E2A\u53D8\u91CF\u662F\u5FC5\u987B\u7684\n        varying vec3 vNormal;\n        varying vec3 vPosition;\n        varying vec2 vUv;\n        varying vec2 vTexSize;\n\n        uniform float opacity;\n        uniform sampler2D texture;\n        uniform bool useTexture;\n\n        uniform vec3 cameraPosition;\n        uniform float shininess;\n        #include <lightUniforms,lightFunctions>;\n\n        ".concat(ColorGLSL.getColorShader().fragment,"\n\n        void main() {\n            if(useTexture && vTexSize.x >= 0.0) {\n                gl_FragColor = texture2D(texture, vUv);\n            } else {\n                gl_FragColor = vColor;\n            }\n            #include <lightMainCompute>;\n            gl_FragColor.a *= opacity;\n            ").concat(ColorGLSL.getColorShader().mainFrag,"\n        }\n    "),includes:__spreadValues$t({},LightIncludes)},RenderHelper=function(){function n(){_classCallCheck(this,n)}return n.SA=function(r,i,s){var a=i.vA,o=i.loca,l=r.mA||a.isDirty;if(l){if(r.mA&&(s==null||s("onFirstRendering")),(a.state&LightDirty)===LightDirty&&(this.MA(a,o.lights),s==null||s("light")),(a.state&MeshDirty)===MeshDirty&&(s==null||s("mesh")),(a.state&MeshesDirty)===MeshesDirty&&(s==null||s("meshes")),r.m$(a)===!1)return!1;a.state=NotDirty}return!0},n.MA=function(r,i){for(var s=function(c,h){h>0?r[c]=h:delete r[c]},a=0,o=0,l=0,u=0;u<i.length;u++){var f=i[u];if(_instanceof(f,AmbientLight))if(a>0){console.warn("\u73AF\u5883\u5149\u53EA\u5141\u8BB8\u6709\u4E00\u4E2A\uFF01");continue}else a+=1;else _instanceof(f,PointLight)?o+=1:_instanceof(f,DirectionalLight)&&(l+=1)}s("NUMBER_OF_AMBIENT_LIGHTS",a),s("NUMBER_OF_POINT_LIGHTS",o),s("NUMBER_OF_DIRECTIONAL_LIGHTS",l)},n._A=function(r,i){var s=[];if(r.NUMBER_OF_AMBIENT_LIGHTS>0&&(s.push("ambientLight.intensity"),s.push("ambientLight.lightColor")),r.NUMBER_OF_POINT_LIGHTS>0)for(var a=0;a<r.NUMBER_OF_POINT_LIGHTS;a++)s.push("pointLights[".concat(a,"].intensity")),s.push("pointLights[".concat(a,"].dist")),s.push("pointLights[".concat(a,"].lightColor")),s.push("pointLights[".concat(a,"].position"));if(r.NUMBER_OF_DIRECTIONAL_LIGHTS>0)for(var o=0;o<r.NUMBER_OF_DIRECTIONAL_LIGHTS;o++)s.push("directionalLights[".concat(o,"].intensity")),s.push("directionalLights[".concat(o,"].lightColor")),s.push("directionalLights[".concat(o,"].direction"));return s.reduce(function(l,u){return l[u]=i.prop(u),l},{})},n.IA=function(r){var i,s=[],a=[],o=!0,l=!1,u=void 0;try{for(var f=r[Symbol.iterator](),c;!(o=(c=f.next()).done);o=!0){var h=c.value,p={};h.iA(p),_instanceof(h,AmbientLight)?i=p:_instanceof(h,PointLight)?s.push(p):_instanceof(h,DirectionalLight)&&a.push(p)}}catch(v){l=!0,u=v}finally{try{!o&&f.return!=null&&f.return()}finally{if(l)throw u}}var d={};return i&&(d.ambientLight=i),s.length&&(d.pointLights=s),a.length&&(d.directionalLights=a),d},n}(),NoneState=0,FreshState=1,UpdateState=2,LabelsRender$1=function(n){_inherits(i,n);var r=_createSuper(i);function i(){_classCallCheck(this,i);var a;return a=r.call.apply(r,[this].concat(Array.prototype.slice.call(arguments))),a.g$=[],a.renderState=NoneState,a}var s=i.prototype;return s.m$=function(a){(a.state&MeshesDirty)===MeshesDirty?this.renderState|=FreshState:(a.state&MeshDirty)===MeshDirty&&(this.renderState|=UpdateState)},s.render=function(a,o){var l;if("AMap"in window){(l=this._$)==null||l.setOpacity(o);var u=a.mf||{},f=u.labels;f&&f.length&&((this.renderState&FreshState)===FreshState?(this.g$=f.map(function(c){return new AMap.LabelMarker(c)}),this._$.clear(),this._$.add(this.g$),this.renderState=NoneState):(this.renderState&UpdateState)===UpdateState?(this.g$.forEach(function(c,h){c.setText({content:""}),c.setPosition(f[h].position),c._opts=f[h]}),this.renderState^=UpdateState):this.renderState=NoneState)}else this.renderState=NoneState},s.p$=function(a){if("AMap"in window){var o=a.d$.labelsLayerOptions||{},l=a.zooms,u=a.opacity,f=a.zIndex;o.zooms===void 0&&(o.zooms=l),o.opacity===void 0&&(o.opacity=u),o.zIndex===void 0&&(o.zIndex=f),this._$=new AMap.LabelsLayer(o);var c=a.map;c.hasLayer(this._$)||(c.add(this._$),this.renderState=FreshState)}else console.warn("[LabelsRender]: \u4EC5\u652F\u6301\u5728AMap\u4E0A\u8FDB\u884Clabels\u6E32\u67D3\u3002")},s.O$=function(a){var o;(o=this._$)==null||o.show()},s.k$=function(a){var o;(o=this._$)==null||o.hide()},s.destroy=function(){var a,o;(a=this._$)==null||a.clear(),(o=this._$)==null||o.setMap(null)},i}(SubRender),__defProp$s=Object.defineProperty,__defProps$j=Object.defineProperties,__getOwnPropDescs$j=Object.getOwnPropertyDescriptors,__getOwnPropSymbols$s=Object.getOwnPropertySymbols,__hasOwnProp$s=Object.prototype.hasOwnProperty,__propIsEnum$s=Object.prototype.propertyIsEnumerable,__defNormalProp$s=function(n,r,i){return r in n?__defProp$s(n,r,{Fr:!0,Lr:!0,writable:!0,value:i}):n[r]=i},__spreadValues$s=function(n,r){for(var i in r||(r={}))__hasOwnProp$s.call(r,i)&&__defNormalProp$s(n,i,r[i]);var s=!0,a=!1,o=void 0;if(__getOwnPropSymbols$s)try{for(var l=__getOwnPropSymbols$s(r)[Symbol.iterator](),u;!(s=(u=l.next()).done);s=!0){var i=u.value;__propIsEnum$s.call(r,i)&&__defNormalProp$s(n,i,r[i])}}catch(f){a=!0,o=f}finally{try{!s&&l.return!=null&&l.return()}finally{if(a)throw o}}return n},__spreadProps$j=function(n,r){return __defProps$j(n,__getOwnPropDescs$j(r))},PolygonsRender=function(n){_inherits(i,n);var r=_createSuper(i);function i(){_classCallCheck(this,i);var a;return a=r.call.apply(r,[this].concat(Array.prototype.slice.call(arguments))),a.v$=[new LabelsRender$1],a}var s=i.prototype;return s.m$=function(a){if(!this.regl)return!1;this.v$.forEach(function(u){return u.m$(a)});var o=this.regl,l=RenderHelper._A(a,o);this.gA(PolygonShader,a,{attributes:__spreadValues$s({position:o.prop("position"),color:o.prop("color"),normal:o.prop("normal"),uv:o.prop("uv"),textureSize:o.prop("textureSize"),topOrBottom:o.prop("topOrBottom")},ColorGLSL.getColor(o).attribute),uniforms:__spreadValues$s(__spreadValues$s(__spreadValues$s(__spreadValues$s({mvp:o.prop("mvp"),opacity:o.prop("opacity"),shininess:o.prop("shininess"),cameraPosition:o.prop("cameraPosition"),texture:o.prop("texture"),useTexture:o.prop("useTexture")},ColorGLSL.getColor(o).uniform),RenderUtil.getScaleUniform("altitude",o)),RenderUtil.getScaleUniform("height",o)),l),blend:{enable:!0,func:RenderUtil.getBlend("normal")},cull:{enable:o.prop("cullEnable"),face:o.prop("cullface")},frontFace:"cw",depth:{enable:o.prop("depth"),func:"lequal"},colorMask:o.prop("colorMask"),elements:o.prop("index")})},s.render=function(a){var o=this.yA(PolygonShader);if(o){var l=a.meshes,u=a.mvp,f=a.lights,c=a.blockHide,h=a.opacity,p=a.cull,d=a.cameraPosition,v=a.shininess,g=a.acceptLight,m=a.texture,y=a.useTexture,b=a.depth,_=a.vP,C=p!=="none",A=p==="front"?"front":"back";if(c)for(var I=0;I<l.length;I++){var D=l[I],X=D.attributes;o(__spreadValues$s(__spreadProps$j(__spreadValues$s(__spreadValues$s({},X),f),{mvp:u,colorMask:[!1,!1,!1,!1],opacity:h,cullEnable:C,cullface:A,depth:b,cameraPosition:d,shininess:v,acceptLight:g,texture:m,useTexture:y,isPick:!1}),RenderUtil.getScaleProps(_)))}for(var W=0;W<l.length;W++){var K=l[W],U=K.attributes;o(__spreadValues$s(__spreadProps$j(__spreadValues$s(__spreadValues$s({},U),f),{mvp:u,colorMask:[!0,!0,!0,!0],opacity:h,cullEnable:C,cullface:A,cameraPosition:d,depth:b,shininess:v,acceptLight:g,texture:m,useTexture:y,isPick:!1}),RenderUtil.getScaleProps(_)))}for(var M=0;M<l.length;M++){var L=!0,P=!1,$=void 0;try{for(var R=this.v$[Symbol.iterator](),T;!(L=(T=R.next()).done);L=!0){var w=T.value;w.render(l[M],h)}}catch(E){P=!0,$=E}finally{try{!L&&R.return!=null&&R.return()}finally{if(P)throw $}}}}},s.pickRender=function(a){var o=this.yA(PolygonShader);if(o){var l=a.meshes,u=a.mvp,f=a.lights,c=a.opacity,h=a.cull,p=a.cameraPosition,d=a.depth,v=a.texture,g=a.pickFbo,m=a.pickPos,y=a.vP,b=h!=="none",_=h==="front"?"front":"back";if(g&&m){var C=this;g.use(function(){C.regl.clear({color:[0,0,0,0],depth:1});for(var A=0;A<l.length;A++){var I=l[A],D=I.attributes;o(__spreadValues$s(__spreadProps$j(__spreadValues$s(__spreadValues$s({},D),f),{mvp:u,colorMask:[!0,!0,!0,!0],opacity:c,cullEnable:b,cullface:_,cameraPosition:p,depth:d,shininess:1,acceptLight:!1,texture:v,useTexture:!1,isPick:!0}),RenderUtil.getScaleProps(y)))}})}}},i}(Render),__defProp$r=Object.defineProperty,__getOwnPropSymbols$r=Object.getOwnPropertySymbols,__hasOwnProp$r=Object.prototype.hasOwnProperty,__propIsEnum$r=Object.prototype.propertyIsEnumerable,__defNormalProp$r=function(n,r,i){return r in n?__defProp$r(n,r,{Fr:!0,Lr:!0,writable:!0,value:i}):n[r]=i},__spreadValues$r=function(n,r){for(var i in r||(r={}))__hasOwnProp$r.call(r,i)&&__defNormalProp$r(n,i,r[i]);var s=!0,a=!1,o=void 0;if(__getOwnPropSymbols$r)try{for(var l=__getOwnPropSymbols$r(r)[Symbol.iterator](),u;!(s=(u=l.next()).done);s=!0){var i=u.value;__propIsEnum$r.call(r,i)&&__defNormalProp$r(n,i,r[i])}}catch(f){a=!0,o=f}finally{try{!s&&l.return!=null&&l.return()}finally{if(a)throw o}}return n},getMipMap$1=RenderUtil.getMipMap,pushArray$p=CommonUtil$1._C,PolygonLayer=function(n){_inherits(i,n);var r=_createSuper(i);function i(a){_classCallCheck(this,i);var o;o=r.call(this,a),o.CLASS_NAME="Polygon",o.styleOptions={},o.fusion=new PolygonsFusion,o.ll=new PolygonsRender,o.Vw=!0;var l=polygon.Sw;return o.zooms=a.zooms===void 0?l.zooms:a.zooms,o.visible=a.visible===void 0?l.visible:a.visible,o.zIndex=a.zIndex===void 0?l.zIndex:a.zIndex,o.opacity=a.opacity===void 0?l.opacity:a.opacity,o.depth=a.depth===void 0?l.depth:a.depth,o.blockHide=a.blockHide===void 0?l.blockHide:a.blockHide,o.shininess=a.shininess===void 0?l.shininess:a.shininess,o.acceptLight=a.acceptLight===void 0?l.acceptLight:a.acceptLight,o.cullface=a.cullface||l.cullface,o.hasSide=a.hasSide===void 0?l.hasSide:a.hasSide,o.hasTop=a.hasTop===void 0?l.hasTop:a.hasTop,o.I$=a.I$===void 0?l.I$:a.I$,o.AC({zooms:o.zooms,visible:o.visible,zIndex:o.zIndex}),o.buryPoint.record(o.CLASS_NAME),o}var s=i.prototype;return s.getLabelsLayer=function(){return this.ll.v$[0]._$||null},s.receiveDataset=function(a){this.dataset=a,this.setStyle(this.styleOptions),this.onAdd()},s.setStyle=function(a){if(_get(_getPrototypeOf(i.prototype),"setStyle",this).call(this,a),this.Kf=null,this.dataset=this.source.LC(),this.dataset&&this.dataset.length>0&&this.meshes){var o=this.WC(),l=o.didFusion,u=this.fusion.buildStyle(this.dataset,this.styleOptions);this.fusion.updateStyle(l,u,this),this.vA.state|=MeshDirty,this.loca&&this.loca.requestRender()}},s.getInitialAnimateState=function(){return{altitude:{time:[1,0,0,0],type:[-1,1,0,0],value:[0,1]},height:{time:[1,0,0,0],type:[-1,1,0,0],value:[0,1]}}},s.jC=function(){_get(_getPrototypeOf(i.prototype),"jC",this).call(this),!(!this.loca||!this.loca.regl||this.ll.regl)&&(this.ll.regl=this.loca.regl,this.loca.rendererManager.addRenderer(this.ll))},s.beforeRender=function(){if(_get(_getPrototypeOf(i.prototype),"beforeRender",this).call(this),!this.fusion.regl&&this.loca&&(this.fusion.regl=this.loca.regl,this.loca.fusionManager.addFusion(this.fusion)),this.jC(),this.source&&(this.dataset=this.source.LC()),this.fusion&&this.dataset&&this.dataset.length>0){var a=this.WC(),o=a.willFusion,l=a.didFusion;if(o.length>0){var u=this.fusion.fusion(o,this.styleOptions,this);this.meshes=pushArray$p(l,u),this.vA.state|=MeshesDirty}}var f=this.meshes[0]&&this.meshes[0].uniforms.texture;this.Rw(f)},s.render=function(){var a;if(!!this.loca&&!!this.PA()){this.loca.regl._refresh();var o=this.loca.customCoords.getCameraParams().position,l=(a=this.loca)==null?void 0:a.customCoords.getMVPMatrix(),u=RenderHelper.IA(this.loca.lights);if(this.ll&&this.meshes.length>0)return this.ll.render({meshes:this.meshes,mvp:l,lights:u,shininess:this.shininess,acceptLight:this.acceptLight,opacity:this._getOpacity(),depth:this.depth,cull:this.cullface,blockHide:this.blockHide,cameraPosition:o,texture:this.Kf,useTexture:this.Vw,vP:this._animateLayerState}),!0}},s.pickRender=function(){var a;if(!!this.loca&&!!this.PA()){this.loca.regl._refresh();var o=(a=this.loca)==null?void 0:a.customCoords.getMVPMatrix(),l=this.loca.customCoords.getCameraParams().position,u=RenderHelper.IA(this.loca.lights);this.ll&&this.Kf&&this.ll.pickRender({meshes:this.meshes,mvp:o,lights:u,shininess:this.shininess,acceptLight:this.acceptLight,opacity:this._getOpacity(),depth:this.depth,blockHide:this.blockHide,cull:this.cullface,texture:this.Kf,pickFbo:this._needPickFrame&&this._pickFbo,pickPos:this._pickPos,cameraPosition:l,vP:this._animateLayerState})}},s.afterRender=function(){},s.Rw=function(a){if(this.Vw=!!a,!(this.Kf||!this.loca||!this.loca.regl)&&(this.Kf=this.loca.regl.texture({data:[[[0,255,0,0],[255,0,0,0]],[[0,0,255,0],[255,255,0,0]]],flipY:!0}),!!a))if(Object.prototype.toString.call(a)==="[object String]"){var o=this,l=new Image;l.crossOrigin="anonymous",l.src=a,l.onload=function(){o.Kf=o.loca.regl.texture(__spreadValues$r({data:l,flipY:!0},getMipMap$1(l.naturalWidth,l.naturalHeight)))}}else this.Kf=this.loca.regl.texture(__spreadValues$r({data:a,flipY:!0},getMipMap$1(a.width,a.height)))},s.PA=function(){return RenderHelper.SA(this.ll,this)},i}(Layer),pushArray$o=CommonUtil$1._C,LineFusion=function(n){_inherits(i,n);var r=_createSuper(i);function i(){return _classCallCheck(this,i),r.apply(this,arguments)}var s=i.prototype;return s.DC=function(){},s.buildStyle=function(a,o){for(var l,u=line.style,f=[],c=0;c<a.length;c++)if(!(!a[c].features||!a[c].features.lines)){for(var h=a[c].features.lines,p=StyleInstance.parse(h,o,u),d={},v=0;v<h.length;v++)if(p)for(var g in p.attributes){var m=p.attributes[g];d[g]||(d[g]=[]),((l=m[v])==null?void 0:l.length)>0?pushArray$o(d[g],m[v]):d[g][d[g].length]=m[v]}f.push({attributes:d,uniforms:p.uniforms,si:p.si})}return f},s.fusion=function(a,o,l,u){if(!this.regl||!l.loca)return[];var f=[];u=u||this.buildStyle(a,o);for(var c=l.loca.customCoords,h=0;h<a.length;h++){var p=a[h];if(!(!p.features||!p.features.lines||!u[h])){for(var d=p.features.lines,v=u[h],g={index:[],vertex:[],color:[],normal:[],lineWidth:[],distance:[],dash:[],borderColor:[],borderWidth:[],pickColor:[]},m=[],y=0;y<d.length;y++){var b=d[y],_=b.coordinates,C=l.colorPick.add(b);if(b.type==="MultiLineString")for(var A=0,I=_.length;A<I;A++){var D=_[A],X=this.triangles(D,{style:v,index:y,pickColor:C,id:b.sr},c);GeoUtil.mergeTriangles(g,X,4),pushArray$o(g.color,X.color),pushArray$o(g.normal,X.normal),pushArray$o(g.lineWidth,X.lineWidth),pushArray$o(g.distance,X.distance),pushArray$o(g.dash,X.dash),pushArray$o(g.borderColor,X.borderColor),pushArray$o(g.pickColor,X.pickColor),pushArray$o(g.borderWidth,X.borderWidth)}else{var W=this.triangles(_,{style:v,index:y,pickColor:C,id:b.sr},c);GeoUtil.mergeTriangles(g,W,4),pushArray$o(g.color,W.color),pushArray$o(g.normal,W.normal),pushArray$o(g.lineWidth,W.lineWidth),pushArray$o(g.distance,W.distance),pushArray$o(g.dash,W.dash),pushArray$o(g.pickColor,W.pickColor),pushArray$o(g.borderColor,W.borderColor),pushArray$o(g.borderWidth,W.borderWidth)}m[y]=g.lineWidth.length}f[h]={id:p.id,attributes:{color:{buffer:this.regl.buffer(g.color),offset:0,stride:4*4,td:!1,divisor:0},dash:{buffer:this.regl.buffer(g.dash),offset:0,stride:4*4,td:!1,divisor:0},position:{buffer:this.regl.buffer(g.vertex),offset:0,stride:4*4,td:!1,divisor:0},normal:{buffer:this.regl.buffer(g.normal),offset:0,stride:4*3,td:!1,divisor:0},lineWidth:{buffer:this.regl.buffer(g.lineWidth),offset:0,stride:4,td:!1,divisor:0},borderWidth:{buffer:this.regl.buffer(g.borderWidth),offset:0,stride:4,td:!1,divisor:0},borderColor:{buffer:this.regl.buffer(g.borderColor),offset:0,stride:4*4,td:!1,divisor:0},distance:{buffer:this.regl.buffer(g.distance),offset:0,stride:4*2,td:!1,divisor:0},pickColor:{buffer:this.regl.buffer(g.pickColor),offset:0,stride:4*4,td:!1,divisor:0},index:this.regl.elements({primitive:"triangles",type:"uint32",data:g.index})},uniforms:v.uniforms,si:v.si,mf:{Tw:{jw:m},altitude:v.attributes.altitude,origin:{color:g.color,lineWidth:g.lineWidth,borderColor:g.borderColor,borderWidth:g.borderWidth,dash:g.dash,vertex:g.vertex}}}}}return f},s.triangles=function(a,o,l){var u=o.index,f=o.pickColor,c=o.style.attributes,h=c.lineWidth,p=c.color,d=c.dash,v=c.borderColor,g=c.borderWidth,m=c.altitude,y=p.slice(u*4,u*4+4),b=d.slice(u*4,u*4+4),_=v.slice(u*4,u*4+4),C=g[u],A=h[u],I=m[u],D={vertex:[],index:[]},X=[],W=[],K=[],U=[],M=[],L=[],P=[],$=[],R=glMatrix.vec3.create();glMatrix.vec3.set(R,0,0,1);for(var T,w,E,O=0,k=a.length-1;k>0;k--){var F=a[k],q=a[k-1];F[0]===q[0]&&F[1]===q[1]&&a.splice(k,1)}for(var Y=0,fe=a.length;Y<fe-1;Y++){var _e=[],Pe=[0,1,3,0,3,2],De=T||l.lngLatToCoord(a[Y]),tt=a[Y][2]||I||0,je=w||l.lngLatToCoord(a[Y+1]),Fe=a[Y+1][2]||I||0,Ge=!1,Et=!1,st=0,at=0,$t=W.length;Y>0&&(st=W[$t-1]);var kt=glMatrix.vec2.distance(De,je),Rt=Math.max(kt,O),Tt=Rt;at=st+kt,Y+2<fe&&(Ge=l.lngLatToCoord(a[Y+2]),Tt=Math.max(kt,glMatrix.vec2.distance(Ge,je))),pushArray$o(W,[Rt,st,Rt,st,Tt,at,Tt,at]);var bt=this.calcNormal(De,je,R),Ot=[bt[0],bt[1],0],Lt=[0,0,0],xt=[0,0,0],ht=E||{Fw:bt,angle:Math.PI},ot=Ge?this.calcAngleNormal(De,je,Ge):{Fw:bt,angle:Math.PI};ot.Fw[0]===0&&ot.Fw[1]===0&&(ot.Fw[0]=-bt[0],ot.Fw[1]=-bt[1]),Lt[0]=ht.Fw[0],Lt[1]=ht.Fw[1],xt[0]=ot.Fw[0],xt[1]=ot.Fw[1];var mt=this.calcAngle(bt,Lt),nt=this.calcAngle(bt,xt);mt<Math.PI/2&&nt<Math.PI/2||mt>Math.PI/2&&nt>Math.PI/2?Et=!0:Et=!1,mt<Math.PI/2&&(bt=[-bt[0],-bt[1],0]),nt<Math.PI/2&&(Ot=[-Ot[0],-Ot[1],0]);var Ut=this.calcWise(Lt,[-bt[0],-bt[1]])||1,Dt=this.calcWise(xt,[-Ot[0],-Ot[1]])||1;if(Lt[2]=-Ut*ht.angle,xt[2]=-Dt*ot.angle,this.addVertex({Lw:_e,Gh:K,Ww:X,Nw:P,Uw:U,qw:M,Gw:L,Qw:$,vertex:[De[0],De[1],tt,o.id],color:y,normal:bt,lineWidth:A,dash:b,Hw:_,Yw:C,pickColor:f}),this.addVertex({Lw:_e,Gh:K,Ww:X,Nw:P,Uw:U,qw:M,Gw:L,Qw:$,vertex:[De[0],De[1],tt,o.id],color:y,normal:Lt,lineWidth:A,dash:b,Hw:_,Yw:C,pickColor:f}),this.addVertex({Lw:_e,Gh:K,Ww:X,Nw:P,Uw:U,qw:M,Gw:L,Qw:$,vertex:[je[0],je[1],Fe,o.id],color:y,normal:Et?Ot:xt,lineWidth:A,dash:b,Hw:_,Yw:C,pickColor:f}),this.addVertex({Lw:_e,Gh:K,Ww:X,Nw:P,Uw:U,qw:M,Gw:L,Qw:$,vertex:[je[0],je[1],Fe,o.id],color:y,normal:Et?xt:Ot,lineWidth:A,dash:b,Hw:_,Yw:C,pickColor:f}),Ge){pushArray$o(W,[Tt,at]);var ft=this.calcNormal(je,Ge,R),Ct=this.calcAngle(ft,xt);Ct<Math.PI/2&&(ft[0]=-ft[0],ft[1]=-ft[1]),this.addVertex({Lw:_e,Gh:K,Ww:X,Nw:P,Uw:U,qw:M,Gw:L,Qw:$,vertex:[je[0],je[1],Fe,o.id],color:y,normal:ft,lineWidth:A,dash:b,Hw:_,Yw:C,pickColor:f}),Pe[6]=2,Pe[7]=3,Pe[8]=4}GeoUtil.mergeTriangles(D,{index:Pe,vertex:_e},4),T=je,w=Ge,E=ot,O=Tt}return{index:D.index,vertex:D.vertex,distance:W,normal:X,color:K,lineWidth:P,dash:U,borderColor:M,borderWidth:L,pickColor:$}},s.addVertex=function(a){var o=a.Lw,l=a.Gh,u=a.Ww,f=a.Nw,c=a.Uw,h=a.qw,p=a.Gw,d=a.Qw,v=a.vertex,g=a.color,m=a.normal,y=a.lineWidth,b=a.dash,_=a.Hw,C=a.Yw,A=a.pickColor,I=o.length,D=l.length,X=u.length;o[I]=v[0],o[I+1]=v[1],o[I+2]=v[2],o[I+3]=v[3],l[D]=g[0],l[D+1]=g[1],l[D+2]=g[2],l[D+3]=g[3],u[X]=m[0],u[X+1]=m[1],u[X+2]=m[2],f[f.length]=y,c[D]=b[0],c[D+1]=b[1],c[D+2]=b[2],c[D+3]=b[3],h[D]=_[0],h[D+1]=_[1],h[D+2]=_[2],h[D+3]=_[3],d[D]=A[0],d[D+1]=A[1],d[D+2]=A[2],d[D+3]=A[3],p[p.length]=C},s.calcAngleNormal=function(a,o,l){var u=glMatrix.vec2.create();glMatrix.vec2.set(u,a[0],a[1]);var f=glMatrix.vec2.create();glMatrix.vec2.set(f,o[0],o[1]);var c=glMatrix.vec2.create();glMatrix.vec2.set(c,l[0],l[1]);var h=glMatrix.vec2.create();glMatrix.vec2.sub(h,u,f),glMatrix.vec2.normalize(h,h);var p=glMatrix.vec2.create();glMatrix.vec2.sub(p,c,f),glMatrix.vec2.normalize(p,p);var d=glMatrix.vec2.create();return glMatrix.vec2.add(d,h,p),glMatrix.vec2.normalize(d,d),{Fw:[d[0],d[1],0],angle:this.calcAngle([h[0],h[1],0],[p[0],p[1],0])}},s.calcAngle=function(a,o){var l=glMatrix.vec3.dot(a,o),u=l/glMatrix.vec3.length(a)/glMatrix.vec3.length(o);return Math.acos(Math.max(-1,Math.min(1,u)))},s.calcNormal=function(a,o,l){var u=glMatrix.vec3.create(),f=glMatrix.vec3.create();glMatrix.vec3.set(f,a[0],a[1],0);var c=glMatrix.vec3.create();glMatrix.vec3.set(c,o[0],o[1],0);var h=glMatrix.vec3.create();return glMatrix.vec3.sub(h,c,f),glMatrix.vec3.cross(u,l,h),glMatrix.vec3.normalize(u,u),[u[0],u[1],0]},s.calcWise=function(a,o){var l=glMatrix.vec3.create(),u=glMatrix.vec2.fromValues(a[0],a[1]),f=glMatrix.vec2.fromValues(o[0],o[1]);return glMatrix.vec2.cross(l,u,f),l[2]===0?l[2]:l[2]/Math.abs(l[2])},s.updateStyle=function(a,o){for(var l=0,u=a.length;l<u;l++){for(var f=a[l],c=o[l].attributes,h=c.color,p=c.lineWidth,d=c.borderColor,v=c.borderWidth,g=c.dash,m=c.altitude,y=f.mf.origin,b=y.borderColor,_=y.color,C=y.lineWidth,A=y.borderWidth,I=y.dash,D=y.vertex,X=f.mf.altitude,W=f.mf.Tw.jw,K=0,U=0,M=C.length;U<M;U++){var L=U*4;U>=W[K]&&K++;var P=K*4;_[L]=h[P],_[L+1]=h[P+1],_[L+2]=h[P+2],_[L+3]=h[P+3],b[L]=d[P],b[L+1]=d[P+1],b[L+2]=d[P+2],b[L+3]=d[P+3],I[L]=g[P],I[L+1]=g[P+1],I[L+2]=g[P+2],I[L+3]=g[P+3],A[U]=v[K],C[U]=p[K],X[K]!==m[K]&&(D[L+2]=m[K])}f.attributes.color.buffer({data:_}),f.attributes.lineWidth.buffer({data:C}),f.attributes.borderColor.buffer({data:b}),f.attributes.borderWidth.buffer({data:A}),f.attributes.dash.buffer({data:I}),f.attributes.position.buffer({data:D})}},s.EC=function(){return[]},s.destroy=function(){this.regl=null},i}(GeometryFusion),LineShader={vertex:"\n        precision highp float;\n        #define PI 3.14159265359\n        attribute vec4 position;\n        attribute vec4 color;\n        attribute vec4 borderColor;\n        attribute vec4 dash;\n        attribute vec3 normal;\n        attribute float lineWidth;\n        attribute float borderWidth;\n        attribute vec2 distance;\n        varying vec4 vColor;\n        varying vec4 vBorderColor;\n        varying vec4 vDash;\n        varying vec2 vNormal;\n        varying float vDist;\n        varying float vWidth;\n        varying float vBorderWidth;\n        uniform mat4 mvp;\n        uniform float resolution;\n        uniform float unit; // 0: px; 1: meter;\n        ".concat(ColorGLSL.getColorShader().vertex,"\n        ").concat(RenderUtil.getBezier(),"\n        ").concat(RenderUtil.getScaleType("lineWidth"),"\n        ").concat(RenderUtil.getScaleType("altitude"),"\n\n        void main() {\n            vColor = color;\n            vBorderColor = borderColor;\n            vDash = dash;\n            vDist = distance.y; // \u8DDD\u79BB\u7EBF\u8D77\u59CB\u70B9\u7684\u8DDD\u79BB\n            float res = unit == 0.0 ? resolution : 1.0;\n            float lineWidthScale = lineWidthScaleValue(position.w);\n            float altitudeScale = altitudeScaleValue(position.w);\n            float realLineWidth = (borderWidth + lineWidth / 2.) * res * lineWidthScale;\n            vWidth = lineWidth * lineWidthScale;\n            vBorderWidth = borderWidth * lineWidthScale;\n            // \u7EBF\u6BB5\u7684\u6CD5\u5411\u91CF\u8FD8\u539F\n            vec2 tmpNormal = normal.xy;\n            float angleLineWidth = realLineWidth;\n\n            // z \u65B9\u5411\u4E0D\u7B49\u4E8E 0\uFF0C\u8BF4\u660E\u662F\u62D0\u89D2\u5411\u91CF\uFF0Cz \u4EE3\u8868\u89D2\u5EA6\uFF0C\u9700\u8981\u5BF9\u7EBF\u5BBD\u8FDB\u884C\u8BA1\u7B97\n            if(normal.z != 0.0) {\n                angleLineWidth /= sin(abs(normal.z / 2.));\n                angleLineWidth = max(realLineWidth, min(distance.x, angleLineWidth));\n\n                // \u62D0\u89D2\u5904\u7684\u6CD5\u5411\u91CF\uFF0C\u9700\u8981\u8FD8\u539F\u6210\u5782\u76F4\u7EBF\u6BB5\u65B9\u5411\u7684\u5411\u91CF\n                // \u8FD9\u6837\u624D\u80FD\u5C06\u63CF\u8FB9\u8BA1\u7B97\u51FA\u6765\n                // \u65CB\u8F6C\u89D2\u5EA6\u8BA1\u7B97\n                float theta = normal.z / abs(normal.z) * ((PI - abs(normal.z)) / 2.);\n                // \u65CB\u8F6C\n                tmpNormal =\n                    mat2(cos(theta), -sin(theta),\n                         sin(theta), cos(theta)) * tmpNormal;\n            }\n            vNormal = normalize(tmpNormal.xy);\n\n            vec3 pos = position.xyz + vec3(normal.xy, 0) * angleLineWidth;\n            gl_Position = mvp * vec4(pos.xy, pos.z * altitudeScale, 1.0);\n            ").concat(ColorGLSL.getColorShader().mainVert,"\n        }\n    "),fragment:"\n        precision highp float;\n        uniform float resolution;\n        uniform float unit; // 0: px; 1: meter;\n        uniform float opacity;\n        varying vec4 vDash;\n        varying vec2 vNormal;\n        varying vec4 vColor;\n        varying float vDist;\n        varying float vWidth;\n        varying float vBorderWidth;\n        varying vec4 vBorderColor;\n        ".concat(ColorGLSL.getColorShader().fragment,"\n\n        void main() {\n            float res = unit == 0.0 ? resolution : 1.0;\n            float distPixel = vDist / res;\n            float offset = mod(distPixel, vDash.r + vDash.g + vDash.b + vDash.a);\n            if(offset > vDash.r && offset < vDash.r + vDash.g) {\n                discard;\n            } else if(offset > vDash.r + vDash.g + vDash.b) {\n                discard;\n            }\n\n            gl_FragColor = vColor;\n\n            if(vBorderWidth > 0. && length(vNormal) > 1. - vBorderWidth / (vWidth / 2. + vBorderWidth)) {\n                gl_FragColor = vBorderColor;\n            }\n            gl_FragColor.a *= opacity;\n            ").concat(ColorGLSL.getColorShader().mainFrag,"\n        }\n    ")},__defProp$q=Object.defineProperty,__defProps$i=Object.defineProperties,__getOwnPropDescs$i=Object.getOwnPropertyDescriptors,__getOwnPropSymbols$q=Object.getOwnPropertySymbols,__hasOwnProp$q=Object.prototype.hasOwnProperty,__propIsEnum$q=Object.prototype.propertyIsEnumerable,__defNormalProp$q=function(n,r,i){return r in n?__defProp$q(n,r,{Fr:!0,Lr:!0,writable:!0,value:i}):n[r]=i},__spreadValues$q=function(n,r){for(var i in r||(r={}))__hasOwnProp$q.call(r,i)&&__defNormalProp$q(n,i,r[i]);var s=!0,a=!1,o=void 0;if(__getOwnPropSymbols$q)try{for(var l=__getOwnPropSymbols$q(r)[Symbol.iterator](),u;!(s=(u=l.next()).done);s=!0){var i=u.value;__propIsEnum$q.call(r,i)&&__defNormalProp$q(n,i,r[i])}}catch(f){a=!0,o=f}finally{try{!s&&l.return!=null&&l.return()}finally{if(a)throw o}}return n},__spreadProps$i=function(n,r){return __defProps$i(n,__getOwnPropDescs$i(r))},LineRender=function(n){_inherits(i,n);var r=_createSuper(i);function i(){return _classCallCheck(this,i),r.apply(this,arguments)}var s=i.prototype;return s.m$=function(a){if(!this.regl)return!1;var o=this.regl;this.gA(LineShader,a,{attributes:__spreadValues$q({position:o.prop("position"),color:o.prop("color"),lineWidth:o.prop("lineWidth"),normal:o.prop("normal"),distance:o.prop("distance"),dash:o.prop("dash"),borderColor:o.prop("borderColor"),borderWidth:o.prop("borderWidth")},ColorGLSL.getColor(o).attribute),uniforms:__spreadValues$q(__spreadValues$q(__spreadValues$q({mvp:o.prop("mvp"),resolution:o.prop("resolution"),unit:o.prop("unit"),opacity:o.prop("opacity")},RenderUtil.getScaleUniform("altitude",o)),RenderUtil.getScaleUniform("lineWidth",o)),ColorGLSL.getColor(o).uniform),cull:{enable:!1},depth:{enable:o.prop("depth")},blend:{enable:!0,func:RenderUtil.getBlend()},elements:o.prop("index")})},s.render=function(a){var o=this.yA(LineShader);if(o)for(var l=a.meshes,u=a.mvp,f=a.resolution,c=a.opacity,h=a.vP,p=a.depth,d=0;d<l.length;d++){var v=l[d],g=v.attributes,m=v.uniforms,y=m.unit;o(__spreadProps$i(__spreadValues$q(__spreadProps$i(__spreadValues$q({},g),{unit:y==="px"?0:1,mvp:u,resolution:f,depth:p,opacity:c}),RenderUtil.getScaleProps(h)),{isPick:!1}))}},s.pickRender=function(a){var o=this.yA(LineShader);if(o){var l=a.meshes,u=a.mvp,f=a.resolution,c=a.opacity,h=a.pickFbo,p=a.pickPos,d=a.depth,v=a.vP;if(h&&p){var g=this;h.use(function(){g.regl.clear({color:[0,0,0,0],depth:1});for(var m=0;m<l.length;m++){var y=l[m],b=y.attributes,_=y.uniforms,C=_.unit;o(__spreadValues$q(__spreadProps$i(__spreadValues$q({},b),{unit:C==="px"?0:1,mvp:u,depth:d,resolution:f,opacity:c,isPick:!0}),RenderUtil.getScaleProps(v)))}})}}},i}(Render),pushArray$n=CommonUtil$1._C,LineLayer=function(n){_inherits(i,n);var r=_createSuper(i);function i(a){_classCallCheck(this,i);var o;o=r.call(this,a),o.CLASS_NAME="Line",o.fusion=new LineFusion,o.ll=new LineRender,o.depth=!1;var l=line.Sw;return o.zooms=a.zooms===void 0?l.zooms:a.zooms,o.zIndex=a.zIndex===void 0?l.zIndex:a.zIndex,o.opacity=a.opacity===void 0?l.opacity:a.opacity,o.visible=a.visible===void 0?l.visible:a.visible,o.depth=a.depth===void 0?l.depth:a.depth,o.AC({zooms:o.zooms,visible:o.visible,zIndex:o.zIndex}),o.buryPoint.record(o.CLASS_NAME),o}var s=i.prototype;return s.receiveDataset=function(a){this.dataset=a,this.setStyle(this.styleOptions),this.onAdd()},s.setStyle=function(a){if(_get(_getPrototypeOf(i.prototype),"setStyle",this).call(this,a),this.dataset=this.source.LC(),this.dataset&&this.dataset.length>0&&this.meshes){var o=this.WC(),l=o.didFusion,u=this.fusion.buildStyle(this.dataset,this.styleOptions);this.fusion.updateStyle(l,u),this.loca&&this.loca.requestRender()}},s.getInitialAnimateState=function(){return{altitude:{time:[1,0,0,0],type:[-1,1,0,0],value:[0,1]},lineWidth:{time:[1,0,0,0],type:[-1,1,0,0],value:[0,1]}}},s.jC=function(){_get(_getPrototypeOf(i.prototype),"jC",this).call(this),!(!this.loca||!this.loca.regl||this.ll.regl)&&(this.ll.regl=this.loca.regl,this.loca.rendererManager.addRenderer(this.ll))},s.beforeRender=function(){if(_get(_getPrototypeOf(i.prototype),"beforeRender",this).call(this),!this.fusion.regl&&this.loca&&(this.fusion.regl=this.loca.regl,this.loca.fusionManager.addFusion(this.fusion)),this.jC(),this.source&&(this.dataset=this.source.LC()),this.fusion){var a=this.WC(),o=a.willFusion,l=a.didFusion;if(this.fusion.EC(),o.length>0){var u=this.fusion.fusion(o,this.styleOptions,this);this.meshes=pushArray$n(l,u)}}},s.render=function(){var a,o;if(!!this.loca&&!!this.PA()){this.loca.regl._refresh();var l=(a=this.loca)==null?void 0:a.customCoords.getMVPMatrix(),u=this.projection.getResolution((o=this.loca)==null?void 0:o.map.getZoom());if(this.ll&&this.meshes.length>0)return this.ll.render({meshes:this.meshes,mvp:l,vP:this._animateLayerState,resolution:u,depth:this.depth,opacity:this._getOpacity()}),!0}},s.pickRender=function(){var a,o;if(!!this.loca&&!!this.PA()){this.loca.regl._refresh();var l=(a=this.loca)==null?void 0:a.customCoords.getMVPMatrix(),u=this.projection.getResolution((o=this.loca)==null?void 0:o.map.getZoom());this.ll&&this.ll.pickRender({meshes:this.meshes,mvp:l,vP:this._animateLayerState,resolution:u,depth:this.depth,opacity:this._getOpacity(),pickFbo:this._needPickFrame&&this._pickFbo,pickPos:this._pickPos})}},s.afterRender=function(){},s.PA=function(){return RenderHelper.SA(this.ll,this)},i}(Layer),__defProp$p=Object.defineProperty,__defProps$h=Object.defineProperties,__getOwnPropDescs$h=Object.getOwnPropertyDescriptors,__getOwnPropSymbols$p=Object.getOwnPropertySymbols,__hasOwnProp$p=Object.prototype.hasOwnProperty,__propIsEnum$p=Object.prototype.propertyIsEnumerable,__defNormalProp$p=function(n,r,i){return r in n?__defProp$p(n,r,{Fr:!0,Lr:!0,writable:!0,value:i}):n[r]=i},__spreadValues$p=function(n,r){for(var i in r||(r={}))__hasOwnProp$p.call(r,i)&&__defNormalProp$p(n,i,r[i]);var s=!0,a=!1,o=void 0;if(__getOwnPropSymbols$p)try{for(var l=__getOwnPropSymbols$p(r)[Symbol.iterator](),u;!(s=(u=l.next()).done);s=!0){var i=u.value;__propIsEnum$p.call(r,i)&&__defNormalProp$p(n,i,r[i])}}catch(f){a=!0,o=f}finally{try{!s&&l.return!=null&&l.return()}finally{if(a)throw o}}return n},__spreadProps$h=function(n,r){return __defProps$h(n,__getOwnPropDescs$h(r))},pushArray$m=CommonUtil$1._C,colorToArray=ColorUtil$1.zC.bind(ColorUtil$1),DEFAULT_VALUE=0,_HeatMapFusion=function(n){_inherits(i,n);var r=_createSuper(i);function i(){_classCallCheck(this,i);var a;return a=r.call.apply(r,[this].concat(Array.prototype.slice.call(arguments))),a.dP=[1/0,-1/0],a}var s=i.prototype;return s.DC=function(){for(var a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:1e3,o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1e3,l=[],u=[],f=0;f<a;f++)for(var c=0;c<o;c++){if(c<o-1&&f>=1){var h=((f-1)*a+c)*6;l[h]=a*(f-1)+c+1,l[h+1]=a*(f-1)+c,l[h+2]=f*a+c,l[h+3]=a*(f-1)+c+1,l[h+4]=f*a+c,l[h+5]=f*a+1+c}u.push(f*a+c)}return{size:[a,o],index:this.regl.elements({primitive:"triangles",type:"uint32",data:l}),position:{buffer:this.regl.buffer(u),offset:0,stride:4*1,td:!1,divisor:0},texture:this.regl.texture({data:[[[0,255,0,200],[255,0,0,200]],[[0,0,255,200],[255,0,255,200]]],flipY:!0})}},s.buildStyle=function(a,o){for(var l,u=heatmap.style,f={attributes:[],uniforms:!1,si:!1},c=0;c<a.length;c++)if(!(!a[c].features||!a[c].features.points)){var h=a[c].features.points,p=StyleInstance.parse(h,o,u),d={};f.uniforms||(f.uniforms=p.uniforms),f.si||(f.si=p.si);for(var v=0,g=h.length;v<g;v++)if(p)for(var m in p.attributes){var y=p.attributes[m];d[m]||(d[m]=[]),((l=y[v])==null?void 0:l.length)>0?pushArray$m(d[m],y[v]):d[m][d[m].length]=y[v]}f.attributes.push(d)}return f},s.fusion=function(a,o,l,u){if(!this.regl||!l.loca)return[];var f=[];u=u||this.buildStyle(a,o);for(var c=u.attributes,h=l.loca.customCoords,p=[1/0,1/0,-1/0,-1/0],d=0,v=[1/0,-1/0],g=this.GC(u.uniforms.gradient),m=0;m<a.length;m++){var y=a[m];if(!(!y.features||!y.features.points||!c[m])){for(var b=y.features.points,_=c[m],C=[],A={vertex:[],index:[],radius:[],value:[]},I=[],D=0;D<b.length;D++){var X=b[D],W=X.coordinates,K=+_.radius[D],U=+_.value[D];Number.isNaN(U)&&(U=DEFAULT_VALUE,I.push(D));var M=X.sr;if(X.type==="MultiPoint")for(var L=0,P=W.length;L<P;L++){var $=h.lngLatToCoord(W[L]),R=[$[0],$[1],0,M,$[0],$[1],1,M,$[0],$[1],2,M,$[0],$[1],3,M];GeoUtil.mergeTriangles(A,{vertex:R,index:[0,1,2,1,3,2]},4),pushArray$m(A.radius,[K,K,K,K]),pushArray$m(A.value,[U,U,U,U]),this.calcBbox(p,$),d=Math.max(d,K),v[0]=Math.min(U,v[0]),v[1]=Math.max(U,v[1])}else{var T=h.lngLatToCoord(W),w=[T[0],T[1],0,M,T[0],T[1],1,M,T[0],T[1],2,M,T[0],T[1],3,M];GeoUtil.mergeTriangles(A,{vertex:w,index:[0,1,2,1,3,2]},4),pushArray$m(A.radius,[K,K,K,K]),pushArray$m(A.value,[U,U,U,U]),this.calcBbox(p,T),d=Math.max(d,K),v[0]=Math.min(U,v[0]),v[1]=Math.max(U,v[1])}C[D]=A.radius.length}this.G$(I),f[m]={id:y.id,attributes:{position:{buffer:this.regl.buffer(A.vertex),offset:0,stride:4*4,td:!1,divisor:0},radius:{buffer:this.regl.buffer(A.radius),offset:0,stride:4,td:!1,divisor:0},value:{buffer:this.regl.buffer(A.value),offset:0,stride:4,td:!1,divisor:0},index:this.regl.elements({primitive:"triangles",type:"uint32",data:A.index})},uniforms:__spreadProps$h(__spreadValues$p({},u.uniforms),{gradient:g.Gh,alpha:g.alpha,maxRadius:d,dataBBox:p,min:u.uniforms.min===null?v[0]:u.uniforms.min,max:u.uniforms.max===null?v[1]:u.uniforms.max}),si:__spreadProps$h(__spreadValues$p({},u.si),{count:_.radius.length}),mf:{origin:{radius:A.radius,value:A.value},Tw:{jw:C}}}}}return this.dP=v,f},s.updateStyle=function(a,o){for(var l=this.GC(o.uniforms.gradient),u=0,f=a.length;u<f;u++){for(var c=a[u],h=o.attributes[u],p=h.radius,d=h.value,v=c.mf.origin,g=v.radius,m=v.value,y=c.mf.Tw.jw,b=0,_=0,C=[1/0,-1/0],A=new Set,I=0,D=g.length;I<D;I++){I>=y[b]&&b++,g[I]=p[b];var X=+d[b];Number.isNaN(X)&&(X=DEFAULT_VALUE,A.add(b)),m[I]=X,_=Math.max(_,p[b]),C[0]=Math.min(X,C[0]),C[1]=Math.max(X,C[1])}c.attributes.radius.buffer({data:g}),c.attributes.value.buffer({data:m}),c.uniforms=__spreadProps$h(__spreadValues$p(__spreadValues$p({},c.uniforms),o.uniforms),{gradient:l.Gh,alpha:l.alpha,maxRadius:_,min:o.uniforms.min===null?C[0]:o.uniforms.min,max:o.uniforms.max===null?C[1]:o.uniforms.max}),this.G$(Array.from(A))}},s.EC=function(){return[]},s.calcBbox=function(a,o){var l=o[0],u=o[1];a[0]=Math.min(l,a[0]),a[1]=Math.min(u,a[1]),a[2]=Math.max(l,a[2]),a[3]=Math.max(u,a[3])},s.GC=function(a){var o=[],l=[];for(var u in a)a.hasOwnProperty(u)&&o.push({stop:parseFloat(u),color:a[u]});o.sort(function(p,d){return p.stop-d.stop});for(var f=[],c=0;c<o.length;c+=1){var h=colorToArray(o[c].color);l.push(o[c].stop,h[0],h[1],h[2]),f.push(h[3])}return{Gh:l,alpha:f}},s.destroy=function(){this.regl=null},s.G$=function(a){a.length&&console.warn("\u6570\u636E\u6E90\u4E2D\u5B58\u5728value\u53D6\u503C\u7F3A\u5931\uFF0C\u9ED8\u8BA4\u4E3A".concat(DEFAULT_VALUE,"\uFF0C\u53EF\u80FD\u4F1A\u5F71\u54CD\u8BA1\u7B97\u7ED3\u679C\uFF0C\u8BF7\u68C0\u67E5\u7B2C").concat(a.join("\u3001"),"\u4E2A\u6570\u636E"))},i.getInstance=function(){return this.ui},i}(GeometryFusion),HeatMapFusion=_HeatMapFusion;HeatMapFusion.ui=new _HeatMapFusion,HeatMapFusion.getInstance();var HeatMapShader={gray:{vertex:"\n            precision highp float;\n            attribute vec4 position;\n            attribute float value;\n            attribute float radius;\n\n            varying float vValue;\n            varying vec2 vDir;\n            varying float vRadius;\n\n            uniform vec4 bbox;\n            uniform float resolution;\n            uniform float unit; // 0: px; 1: meter;\n            uniform float maxRadius;\n            // uniform float radiusScale;\n            ".concat(RenderUtil.getBezier(),"\n            ").concat(RenderUtil.getScaleType("radius"),"\n\n            // \u8BA1\u7B97\u65B9\u4F4D, xy \u662F\u4F4D\u7F6E, zw \u662F \u65B9\u5411 \u5750\u6807\n            vec4 getPosByDirection(vec2 pos, float direction, float r) {\n                vec2 targetPos;\n                vec2 dir;\n\n                targetPos = vec2(pos - r);\n                dir = vec2(-1, -1);\n                if (direction == 1.0) {\n                    targetPos = vec2(pos.x - r, pos.y + r);\n                    dir = vec2(-1, 1);\n                } else if (direction == 2.0) {\n                    targetPos = vec2(pos.x + r, pos.y - r);\n                    dir = vec2(1, -1);\n                } else if (direction == 3.0) {\n                    targetPos = vec2(pos + r);\n                    dir = vec2(1, 1);\n                }\n                return vec4(targetPos, normalize(dir));\n            }\n\n            void main() {\n                float radiusScale = radiusScaleValue(position.w);\n                float r = radius * radiusScale;\n                float maxR = maxRadius;\n                if(unit == 0.0) {\n                    r *= resolution;\n                    maxR *= resolution;\n                }\n                vec4 b = vec4(bbox.xy - maxR, bbox.zw + maxR);\n                vec2 center = vec2((b.z + b.x) / 2.0, (b.w + b.y) / 2.0);\n                vec2 bboxSize = vec2((b.z - b.x), (b.w - b.y)) / 2.0;\n                vec4 posDir = getPosByDirection(position.xy - center, position.z, r);\n                gl_Position = vec4(posDir.xy / bboxSize, 0, 1);\n                vValue = value;\n                vDir = posDir.zw * sqrt(r * r * 2.0);\n                vRadius = r;\n            }\n        "),fragment:"\n            precision highp float;\n            varying float vValue;\n            varying vec2 vDir;\n            varying float vRadius;\n\n            uniform float max;\n            uniform float min;\n\n            void main() {\n                float len = length(vDir);\n                gl_FragColor = vec4(1, 0, 0, (vRadius - len) / vRadius * (vValue - min) / (max - min));\n            }\n        "},grid:{vertex:"\n            precision highp float;\n            attribute float position;\n\n            varying float vValue;\n            varying vec2 vUv;\n\n            uniform mat4 mvp;\n            uniform float resolution;\n            uniform float height;\n            uniform float unit; // 0: px; 1: meter;\n            uniform vec2 size;\n            uniform vec4 bbox;\n            uniform float maxRadius;\n            uniform vec4 heightBezier;\n            uniform sampler2D texture;\n            ".concat(RenderUtil.getBezier(),"\n            ").concat(RenderUtil.getScaleType("height"),"\n\n            vec2 bezier(float t, vec2 P0, vec2 P1, vec2 P2, vec2 P3) {\n                float t2 = t * t;\n                float one_minus_t = 1.0 - t;\n                float one_minus_t2 = one_minus_t * one_minus_t;\n                return (P0 * one_minus_t2 * one_minus_t + P1 * 3.0 * t * one_minus_t2 + P2 * 3.0 * t2 * one_minus_t + P3 * t2 * t);\n            }\n\n            vec2 toBezier(float t, vec4 p) {\n                return bezier(t, vec2(0.0, 0.0), vec2(p.x, p.y), vec2(p.z, p.w), vec2(1.0, 1.0));\n            }\n\n            // \u8BA1\u7B97\u7EB9\u7406\u5750\u6807\n            vec2 calcUV(float index, vec2 size) {\n                float y = floor(index / size.x);\n                float x = mod(index, size.x);\n                return vec2(x / (size.x - 1.0), y / (size.y - 1.0));\n            }\n\n            // \u8BA1\u7B97\u9876\u70B9\u5750\u6807\n            vec2 calcVertex(float index, vec2 size, vec4 bbox) {\n                // \u6839\u636E\u7D22\u5F15\u83B7\u53D6\u7ECF\u7EAC\u5EA6\n                float col = mod(index, size.x);\n                float row = floor(index / size.x);\n                float widthStep = (bbox.b - bbox.r) / (size.x - 1.0);\n                float heightStep = (bbox.a - bbox.g) / (size.y - 1.0);\n                float x = bbox.x + col * widthStep;\n                float y = bbox.y + row * heightStep;\n                return vec2(x, y);\n            }\n\n            void main() {\n                float heightScale = heightScaleValue(position);\n                vUv = calcUV(position, size);\n                vec4 color = texture2D(texture, vUv);\n                float h = height * toBezier(color.a, heightBezier).y;\n                float maxR = maxRadius;\n                if(unit == 0.0) {\n                    h *= resolution;\n                    maxR *= resolution;\n                }\n                vec4 b = vec4(bbox.xy - maxR, bbox.zw + maxR);\n                gl_Position = mvp * vec4(calcVertex(position, size, b), h * heightScale, 1);\n            }\n        "),fragment:"\n            precision highp float;\n            varying vec2 vUv;\n            uniform sampler2D texture;\n            uniform float opacity;\n            uniform vec4 gradient[8];\n            uniform vec2 alpha;\n            uniform bool difference;\n            uniform bool isPick;\n\n            float fade(float low, float high, float value) {\n                if (value < low || value > high) { return 0.0; }\n                return (value-low) / (high-low);\n            }\n\n            // \u6570\u503C\u6620\u5C04\u51FD\u6570\uFF0C\u4E3A\u4E86\u5C06 x:0-1 \u6620\u5C04\u5230\u4EFB\u610F\u4E00\u4E2A [min, max] \u533A\u95F4\u7684\u503C\n            float scaleMap(float min, float max, float x) {\n                if(x == 0.0) {\n                    return x;\n                }\n                if(x < 0.0) {\n                    return min;\n                }\n                if(x > 1.0) {\n                    return max;\n                }\n                float delta = max - min;\n                return min + delta * x;\n            }\n\n            vec4 getColor(float intensity) {\n                vec3 color = vec3(0);\n                float a = 1.0;\n                color = mix(vec3(0, 0, 1), gradient[0].yzw, fade(0.0, gradient[0].x, intensity));\n                for (int gn = 0; gn < 8; gn += 1) {\n                    if (gradient[gn].x >= intensity) {\n                        \n                        // \u5F69\u8679\u6548\u679C\n                        if(difference) {\n                            color = mix(gradient[gn+1].yzw, gradient[gn].yzw, intensity);\n                        } else {\n                            // \u6B63\u5E38\u6548\u679C\n                            color = mix(gradient[gn-1].yzw, gradient[gn].yzw, fade(gradient[gn-1].x, gradient[gn].x, intensity));\n                        }\n                        break;\n                    }\n\n                    // bool isBreak = false;\n                    // if (gradient[gn].x >= intensity) {\n                    //     color = mix(gradient[gn-1].yzw, gradient[gn].yzw, intensity);\n                    //     isBreak = true;\n                    // }\n                    // float delta = gradient[gn].x - intensity;\n                    // if((delta > -0.01 && delta < 0.01) && gn > 0 && intensity <= 1.0) {\n                    //     // \u5F69\u8679\u6548\u679C\n                    //     color = mix(gradient[gn+1].yzw, gradient[gn].yzw, (delta * 100. + 1.) / 2.);\n                    //     // color = vec3(0,1,0);\n                    // }\n                    // if(isBreak) {\n                    //     break;\n                    // }\n                }\n                return vec4(color, scaleMap(alpha.x, alpha.y, intensity));\n            }\n\n            void main() {\n                vec4 gray = texture2D(texture, vUv);\n                gl_FragColor = getColor(gray.a);\n                gl_FragColor.a *= opacity;\n                if (isPick) {\n                    // \u907F\u514D\u900F\u660E\u5EA6\u5F71\u54CD\u62FE\u53D6\u51C6\u786E\u6027\uFF0C\u8FD9\u91CC\u628Aa\u901A\u9053\u7684\u503C\u8F6C\u79FB\u5230b\u901A\u9053\n                    gl_FragColor = vec4(0, 0, gray.a, 1);\n                }\n            }\n        "}},__defProp$o=Object.defineProperty,__defProps$g=Object.defineProperties,__getOwnPropDescs$g=Object.getOwnPropertyDescriptors,__getOwnPropSymbols$o=Object.getOwnPropertySymbols,__hasOwnProp$o=Object.prototype.hasOwnProperty,__propIsEnum$o=Object.prototype.propertyIsEnumerable,__defNormalProp$o=function(n,r,i){return r in n?__defProp$o(n,r,{Fr:!0,Lr:!0,writable:!0,value:i}):n[r]=i},__spreadValues$o=function(n,r){for(var i in r||(r={}))__hasOwnProp$o.call(r,i)&&__defNormalProp$o(n,i,r[i]);var s=!0,a=!1,o=void 0;if(__getOwnPropSymbols$o)try{for(var l=__getOwnPropSymbols$o(r)[Symbol.iterator](),u;!(s=(u=l.next()).done);s=!0){var i=u.value;__propIsEnum$o.call(r,i)&&__defNormalProp$o(n,i,r[i])}}catch(f){a=!0,o=f}finally{try{!s&&l.return!=null&&l.return()}finally{if(a)throw o}}return n},__spreadProps$g=function(n,r){return __defProps$g(n,__getOwnPropDescs$g(r))},_HeatMapRender=function(n){_inherits(i,n);var r=_createSuper(i);function i(){_classCallCheck(this,i);var a;return a=r.call.apply(r,[this].concat(Array.prototype.slice.call(arguments))),a.Xw=[0,0],a}var s=i.prototype;return s.m$=function(a){if(!this.regl)return!1;var o=this.regl;this.Jw=o.framebuffer({width:o._gl.drawingBufferWidth,height:o._gl.drawingBufferHeight,Zh:!1,stencil:!1,depth:!1}),this.Xw=[this.regl._gl.drawingBufferWidth,this.regl._gl.drawingBufferHeight],this.gA(HeatMapShader.gray,a,{framebuffer:o.prop("framebuffer"),attributes:{position:o.prop("position"),value:o.prop("value"),radius:o.prop("radius")},uniforms:__spreadValues$o({bbox:o.prop("bbox"),unit:o.prop("unit"),resolution:o.prop("resolution"),min:o.prop("min"),max:o.prop("max"),maxRadius:o.prop("maxRadius")},RenderUtil.getScaleUniform("radius",o)),depth:{enable:!1},blend:{enable:!0,func:RenderUtil.getBlend()},elements:o.prop("index")}),this.gA(HeatMapShader.grid,a,{attributes:{position:o.prop("position")},uniforms:__spreadValues$o({mvp:o.prop("mvp"),opacity:o.prop("opacity"),texture:o.prop("texture"),bbox:o.prop("bbox"),size:o.prop("size"),height:o.prop("height"),unit:o.prop("unit"),heightBezier:o.prop("heightBezier"),resolution:o.prop("resolution"),maxRadius:o.prop("maxRadius"),gradient:o.prop("gradient"),alpha:o.prop("alpha"),difference:o.prop("difference"),isPick:o.prop("isPick")},RenderUtil.getScaleUniform("height",o)),depth:{enable:o.prop("depth")},blend:{enable:!0,func:RenderUtil.getBlend()},cull:{enable:!0,face:"back"},frontFace:"cw",elements:o.prop("index")})},s.render=function(a){var o=this,l=function(A){var I=o,D=c[A],X=D.attributes,W=D.uniforms,K=W.unit,U=W.max,M=W.min,L=W.gradient,P=W.opacity,$=W.heightBezier,R=W.height,T=W.dataBBox,w=W.maxRadius,E=W.difference,O=D.si,k=O.count,F=o.QC(y,T);o.Jw.use(function(){I.regl.clear({color:[0,0,0,0],depth:1}),u(__spreadValues$o(__spreadProps$g(__spreadValues$o({framebuffer:I.Jw},X),{unit:K==="px"?0:1,resolution:p,max:U,min:M,bbox:F,maxRadius:w,count:k}),RenderUtil.getScaleProps(_,"radius")))}),f(__spreadValues$o({texture:o.Jw,heightBezier:$,unit:K==="px"?0:1,height:R,gradient:o.HC(L),alpha:P,position:g,index:v,resolution:p,mvp:h,bbox:F,maxRadius:w,size:m,opacity:d,depth:b,difference:E,isPick:!1},RenderUtil.getScaleProps(_,"height")))},u=this.yA(HeatMapShader.gray),f=this.yA(HeatMapShader.grid);if(!(!u||!f)){var c=a.meshes,h=a.mvp,p=a.resolution,d=a.opacity,v=a.index,g=a.position,m=a.size,y=a.bbox,b=a.depth,_=a.vP;(this.Xw[0]!==this.regl._gl.drawingBufferWidth||this.Xw[1]!==this.regl._gl.drawingBufferHeight)&&(this.Xw=[this.regl._gl.drawingBufferWidth,this.regl._gl.drawingBufferHeight],this.Jw({width:this.Xw[0],height:this.Xw[1]}));for(var C=0;C<c.length;C++)l(C)}},s.pickRender=function(a){var o=this.yA(HeatMapShader.gray),l=this.yA(HeatMapShader.grid);if(!(!o||!l)){var u=a.meshes,f=a.mvp,c=a.resolution,h=a.opacity,p=a.index,d=a.position,v=a.size,g=a.bbox,m=a.depth,y=a.vP,b=a.pickFbo,_=a.pickPos;if(b&&_){var C=this;b.use(function(){C.regl.clear({color:[0,0,0,0],depth:1});for(var A=0;A<u.length;A++){var I=u[A],D=I.uniforms,X=D.unit,W=D.gradient,K=D.opacity,U=D.heightBezier,M=D.height,L=D.dataBBox,P=D.maxRadius,$=D.difference,R=C.QC(g,L);l(__spreadValues$o({texture:C.Jw,heightBezier:U,unit:X==="px"?0:1,height:M,gradient:C.HC(W),alpha:K,position:d,index:p,resolution:c,mvp:f,bbox:R,maxRadius:P,size:v,opacity:h,depth:m,difference:$,isPick:!0},RenderUtil.getScaleProps(y,"height")))}})}}},s.QC=function(a,o){var l=[];return l[0]=Math.max(a[0],o[0]),l[1]=Math.max(a[1],o[1]),l[2]=Math.min(a[2],o[2]),l[3]=Math.min(a[3],o[3]),l},s.HC=function(a){for(var o=a.length,l=0;l<8;l++)o<=l*4&&(a=a.concat([-1,0,0,0]));return a},s.destroy=function(){_get(_getPrototypeOf(i.prototype),"destroy",this).call(this),this.Jw&&this.Jw.destroy(),this.Jw=null},i.getInstance=function(){return this.ui},i}(Render),HeatMapRender=_HeatMapRender;HeatMapRender.ui=new _HeatMapRender,HeatMapRender.getInstance();var __defProp$n=Object.defineProperty,__defProps$f=Object.defineProperties,__getOwnPropDescs$f=Object.getOwnPropertyDescriptors,__getOwnPropSymbols$n=Object.getOwnPropertySymbols,__hasOwnProp$n=Object.prototype.hasOwnProperty,__propIsEnum$n=Object.prototype.propertyIsEnumerable,__defNormalProp$n=function(n,r,i){return r in n?__defProp$n(n,r,{Fr:!0,Lr:!0,writable:!0,value:i}):n[r]=i},__spreadValues$n=function(n,r){for(var i in r||(r={}))__hasOwnProp$n.call(r,i)&&__defNormalProp$n(n,i,r[i]);var s=!0,a=!1,o=void 0;if(__getOwnPropSymbols$n)try{for(var l=__getOwnPropSymbols$n(r)[Symbol.iterator](),u;!(s=(u=l.next()).done);s=!0){var i=u.value;__propIsEnum$n.call(r,i)&&__defNormalProp$n(n,i,r[i])}}catch(f){a=!0,o=f}finally{try{!s&&l.return!=null&&l.return()}finally{if(a)throw o}}return n},__spreadProps$f=function(n,r){return __defProps$f(n,__getOwnPropDescs$f(r))},pushArray$l=CommonUtil$1._C,HeatMapLayer=function(n){_inherits(i,n);var r=_createSuper(i);function i(a){_classCallCheck(this,i);var o;o=r.call(this,a),o.CLASS_NAME="HeatMap",o.fusion=new HeatMapFusion,o.ll=new HeatMapRender,o.Kw=!1;var l=heatmap.Sw;return o.zooms=a.zooms===void 0?l.zooms:a.zooms,o.zIndex=a.zIndex===void 0?l.zIndex:a.zIndex,o.opacity=a.opacity===void 0?l.opacity:a.opacity,o.visible=a.visible===void 0?l.visible:a.visible,o.depth=a.depth===void 0?l.depth:a.depth,o.AC({zooms:o.zooms,visible:o.visible,zIndex:o.zIndex}),o.buryPoint.record(o.CLASS_NAME),o}var s=i.prototype;return s.receiveDataset=function(a){this.dataset=a,this.setStyle(this.styleOptions),this.onAdd()},s.setStyle=function(a){if(_get(_getPrototypeOf(i.prototype),"setStyle",this).call(this,a),this.dataset=this.source.LC(),this.dataset&&this.dataset.length>0&&this.meshes){var o=this.WC(),l=o.didFusion,u=this.fusion.buildStyle(this.dataset,this.styleOptions);this.fusion.updateStyle(l,u),this.loca&&this.loca.requestRender()}},s.getInitialAnimateState=function(){return{height:{time:[1,0,0,0],type:[-1,1,0,0],value:[0,1]},radius:{time:[1,0,0,0],type:[-1,1,0,0],value:[0,1]}}},s.jC=function(){_get(_getPrototypeOf(i.prototype),"jC",this).call(this),!(!this.loca||!this.loca.regl||this.ll.regl)&&(this.ll.regl=this.loca.regl,this.loca.rendererManager.addRenderer(this.ll))},s.beforeRender=function(){if(_get(_getPrototypeOf(i.prototype),"beforeRender",this).call(this),!this.fusion.regl&&this.loca&&(this.fusion.regl=this.loca.regl,this.loca.fusionManager.addFusion(this.fusion)),this.jC(),this.source&&(this.dataset=this.source.LC()),this.fusion){var a=this.WC(),o=a.willFusion,l=a.didFusion;if(this.fusion.EC(),o.length>0){var u=this.fusion.fusion(o,this.styleOptions,this);this.meshes=pushArray$l(l,u),this.Kw=this.Kw||this.fusion.DC()}}},s.render=function(){if(!!this.loca&&!!this.PA()){this.loca.regl._refresh();var a=this.loca.customCoords,o=a.getMVPMatrix(),l=this.projection.getResolution(this.loca.map.getZoom()),u=this.loca.map.getBounds().toJSON(),f=_toConsumableArray(a.lngLatToCoord(u.slice(0,2))).concat(_toConsumableArray(a.lngLatToCoord(u.slice(2))));if(this.ll&&this.meshes.length>0)return this.ll.render(__spreadProps$f(__spreadValues$n({meshes:this.meshes,mvp:o,resolution:l,opacity:this._getOpacity()},this.Kw),{bbox:f,depth:this.depth,vP:this._animateLayerState})),!0}},s.pickRender=function(){if(!!this.loca&&!!this.PA()){this.loca.regl._refresh();var a=this.loca.customCoords,o=a.getMVPMatrix(),l=this.projection.getResolution(this.loca.map.getZoom()),u=this.loca.map.getBounds().toJSON(),f=_toConsumableArray(a.lngLatToCoord(u.slice(0,2))).concat(_toConsumableArray(a.lngLatToCoord(u.slice(2))));if(this.ll&&this.meshes.length>0){var c=this;this.aP(this.loca.regl,!0),this.ll.pickRender(__spreadProps$f(__spreadValues$n({meshes:this.meshes,mvp:o,resolution:l,opacity:this._getOpacity()},this.Kw),{bbox:f,depth:this.depth,pickFbo:this._needPickFrame&&this._pickFbo,pickPos:this._pickPos,vP:this._animateLayerState}));var h=this.styleOptions,p=h.height,d=p===void 0?heatmap.style.height.defaultValue:p,v=h.heightBezier,g=v===void 0?heatmap.style.heightBezier.defaultValue:v,m=h.unit,y=m===void 0?heatmap.style.unit.defaultValue:m;return function(b){var _,C=b[2],A=C/255,I=new bezierJs.Bezier({x:0,y:0},{x:g[0],y:g[1]},{x:g[2],y:g[3]},{x:1,y:1}),D=d*I.get(A).y,X=y==="px"?D*l:D,W=_slicedToArray(c.fusion.dP,2),K=W[0],U=W[1];return{scale:A,value:A!==0?K+(U-K)*A:0,height:D,lnglat:(_=c.loca)==null?void 0:_.map.containerToLngLat(_toConsumableArray(c._pickPos).concat([X])).toArray()}}}}},s.afterRender=function(){},s.getGradientSteps=function(){for(var a=this.styleOptions,o=a.gradient,l=o===void 0?heatmap.style.gradient.defaultValue:o,u=_slicedToArray(this.fusion.dP,2),f=u[0],c=u[1],h=this.fusion.GC(l),p=h.Gh,d=h.alpha,v=[],g=0,m=0;g<p.length;g+=4,m+=1){var y=_slicedToArray(p.slice(g,g+4),4),b=y[0],_=y[1],C=y[2],A=y[3],I=d[m];v.push({color:"rgba(".concat([_*255,C*255,A*255,I].join(","),")"),scale:b,value:b!==0?f+(c-f)*b:0})}return v},s.destroy=function(){_get(_getPrototypeOf(i.prototype),"destroy",this).call(this)},s.PA=function(){return RenderHelper.SA(this.ll,this)},i}(Layer),Dat=function(){function n(){_classCallCheck(this,n),this.style={},this.lights=[],this._w=new dat__namespace.GUI}var r=n.prototype;return r.addLayer=function(i){var s=this,a=function(p){c[p]=f[p];var d=u[p].type;if(_instanceof(c[p],Function))return"continue";if(c[p]===void 0&&(c[p]=u[p].defaultValue),d==="color"){var v=s;l.addColor(c,p).onChange(function(C){c[p]=C,i.setStyle(v.getStyle(i,c))})}else if(d==="array"){var g=s;c[p]=c[p]+"",l.add(c,p).onChange(function(C){c[p]=C,i.setStyle(g.getStyle(i,c))})}else if(d==="image"){var m=s;Object.prototype.toString.call(c[p])!=="[object String]"&&(c[p]=""),l.add(c,p).onChange(function(C){c[p]=C,i.setStyle(m.getStyle(i,c))})}else if(d==="object"){var y=s;c[p]=JSON.stringify(c[p]),l.add(c,p).onChange(function(C){c[p]=C,i.setStyle(y.getStyle(i,c))})}else if(d==="nest"){var b=s;c[p]=nestStringify(c[p]),l.add(c,p).onChange(function(C){c[p]=C,i.setStyle(b.getStyle(i,c))})}else{var _=s;l.add(c,p).onChange(function(C){c[p]=C,i.setStyle(_.getStyle(i,c))})}},o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"\u56FE\u5C42",l=this._w.addFolder(o),u=this.getSchema(i),f=i.styleOptions,c={};for(var h in u)a(h)},r.addLight=function(i,s){var a=function(c){var h=i[c];c==="color"?(u[c]=i[c],l.addColor(u,c).onChange(function(p){u[c]=p,i[c]=u[c],s.requestRender()})):Object.prototype.toString.call(h)==="[object Array]"?(u[c]=i[c]+"",l.add(u,c).onChange(function(p){u[c]=p.split(","),i[c]=u[c],s.requestRender()})):(u[c]=i[c],l.add(u,c).onChange(function(p){u[c]=p,i[c]=u[c],s.requestRender()}))},o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"\u5149\u6E90",l=this._w.addFolder(o),u={};this.lights.push(u);for(var f in i)a(f)},r.addLightInstance=function(i,s){var a=this._w.addFolder(s),o={};this.lights.push(o),Object.keys(i.rawproperty).forEach(function(l){var u=i.rawproperty[l];l==="color"?(o[l]=i.rawproperty[l],a.addColor(o,l).onChange(function(f){i[l]=o[l]=f})):Object.prototype.toString.call(u)==="[object Array]"?(o[l]=i.rawproperty[l]+"",a.add(o,l).onChange(function(f){i[l]=o[l]=f.split(",")})):(o[l]=i.rawproperty[l],a.add(o,l).onChange(function(f){i[l]=o[l]=f}))})},r.getSchema=function(i){var s=i.CLASS_NAME;if(s)return conf[s.toLowerCase()].style},r.getStyle=function(i,s){var a=function(f){var c=o[f].type;if(l[f]=s[f],c==="array"){var h=(s[f]+"").split(",");isNaN(+h[0])||h.forEach(function(p,d){h[d]=+p}),l[f]=h}else c==="object"?l[f]=JSON.parse(l[f]):c==="nest"&&(l[f]=nestParse(l[f]))},o=this.getSchema(i),l={};for(var u in o)a(u);return l},r.destroy=function(){this._w.destroy(),this.style={},this.lights=[]},n}(),__defProp$m=Object.defineProperty,__defProps$e=Object.defineProperties,__getOwnPropDescs$e=Object.getOwnPropertyDescriptors,__getOwnPropSymbols$m=Object.getOwnPropertySymbols,__hasOwnProp$m=Object.prototype.hasOwnProperty,__propIsEnum$m=Object.prototype.propertyIsEnumerable,__defNormalProp$m=function(n,r,i){return r in n?__defProp$m(n,r,{Fr:!0,Lr:!0,writable:!0,value:i}):n[r]=i},__spreadValues$m=function(n,r){for(var i in r||(r={}))__hasOwnProp$m.call(r,i)&&__defNormalProp$m(n,i,r[i]);var s=!0,a=!1,o=void 0;if(__getOwnPropSymbols$m)try{for(var l=__getOwnPropSymbols$m(r)[Symbol.iterator](),u;!(s=(u=l.next()).done);s=!0){var i=u.value;__propIsEnum$m.call(r,i)&&__defNormalProp$m(n,i,r[i])}}catch(f){a=!0,o=f}finally{try{!s&&l.return!=null&&l.return()}finally{if(a)throw o}}return n},__spreadProps$e=function(n,r){return __defProps$e(n,__getOwnPropDescs$e(r))},pushArray$k=CommonUtil$1._C,_ScatterFusion=function(n){_inherits(i,n);var r=_createSuper(i);function i(){return _classCallCheck(this,i),r.apply(this,arguments)}var s=i.prototype;return s.DC=function(){},s.buildStyle=function(a,o){for(var l,u=scatter.style,f={attributes:[],uniforms:!1,si:!1},c=0;c<a.length;c++)if(!(!a[c].features||!a[c].features.points)){var h=a[c].features.points,p=StyleInstance.parse(h,o,u),d={};f.uniforms||(f.uniforms=p.uniforms),f.si||(f.si=p.si);for(var v=0,g=h.length;v<g;v++)if(p)for(var m in p.attributes){var y=p.attributes[m];d[m]||(d[m]=[]),((l=y[v])==null?void 0:l.length)>0?pushArray$k(d[m],y[v]):d[m][d[m].length]=y[v]}f.attributes.push(d)}return f},s.fusion=function(a,o,l,u){if(!this.regl||!l.loca)return[];var f=[];u=u||this.buildStyle(a,o);for(var c=u.attributes,h=l.loca.customCoords,p=0;p<a.length;p++){var d=a[p];if(!(!d.features||!d.features.points)){for(var v=d.features.points,g=c[p],m={index:[],vertex:[],color:[],number:[],uv:[],size:[],rotation:[],borderColor:[],borderWidth:[],pickColor:[],labels:[]},y=[],b=0;b<v.length;b++){var _=v[b],C=_.coordinates,A=l.colorPick.add(_);if(_.type==="MultiPoint")for(var I=0,D=C.length;I<D;I++){var X=C[I],W=this.triangles(X,{attribute:g,index:b,pickColor:A},h);GeoUtil.mergeTriangles(m,W),pushArray$k(m.color,W.color),pushArray$k(m.rotation,W.rotation),pushArray$k(m.number,W.number),pushArray$k(m.size,W.size),pushArray$k(m.uv,W.uv),pushArray$k(m.borderColor,W.borderColor),pushArray$k(m.borderWidth,W.borderWidth),pushArray$k(m.pickColor,W.pickColor),g.label[b]&&m.labels.push(__spreadValues$m({position:[X[0],X[1],(X[2]||g.altitude[b])+g.labelAltitude[b]]},g.label[b]))}else{var K=this.triangles(C,{attribute:g,index:b,pickColor:A},h);GeoUtil.mergeTriangles(m,K),pushArray$k(m.color,K.color),pushArray$k(m.rotation,K.rotation),pushArray$k(m.number,K.number),pushArray$k(m.size,K.size),pushArray$k(m.uv,K.uv),pushArray$k(m.borderColor,K.borderColor),pushArray$k(m.borderWidth,K.borderWidth),pushArray$k(m.pickColor,K.pickColor),g.label[b]&&m.labels.push(__spreadValues$m({position:[C[0],C[1],(C[2]||g.altitude[b])+g.labelAltitude[b]]},g.label[b]))}y[b]=m.rotation.length}f[p]={id:d.id,attributes:{color:{buffer:this.regl.buffer(m.color),offset:0,stride:4*4,td:!1,divisor:0},pickColor:{buffer:this.regl.buffer(m.pickColor),offset:0,stride:4*4,td:!1,divisor:0},borderColor:{buffer:this.regl.buffer(m.borderColor),offset:0,stride:4*4,td:!1,divisor:0},position:{buffer:this.regl.buffer(m.vertex),offset:0,stride:4*3,td:!1,divisor:0},number:{buffer:this.regl.buffer(m.number),offset:0,stride:4,td:!1,divisor:0},borderWidth:{buffer:this.regl.buffer(m.borderWidth),offset:0,stride:4,td:!1,divisor:0},rotation:{buffer:this.regl.buffer(m.rotation),offset:0,stride:4,td:!1,divisor:0},size:{buffer:this.regl.buffer(m.size),offset:0,stride:4*2,td:!1,divisor:0},uv:{buffer:this.regl.buffer(m.uv),offset:0,stride:4*2,td:!1,divisor:0},index:this.regl.elements({primitive:"triangles",type:"uint32",data:m.index})},uniforms:u.uniforms,si:u.si,mf:{Tw:{jw:y},altitude:g.altitude,origin:{position:m.vertex,color:m.color,size:m.size,rotation:m.rotation,borderColor:m.borderColor,borderWidth:m.borderWidth},labels:m.labels}}}}return f},s.triangles=function(a,o,l){var u=o.index,f=o.pickColor,c=o.attribute,h=c.size,p=c.color,d=c.rotation,v=c.altitude,g=c.borderColor,m=c.borderWidth,y=p.slice(u*4,u*4+4),b=g.slice(u*4,u*4+4),_=h.slice(u*2,u*2+2),C=d[u],A=m[u],I=v[u],D=l.lngLatToCoord(a),X=a[2]||I||0,W=[_[0],_[1],_[0],_[1],_[0],_[1],_[0],_[1]],K=[y[0],y[1],y[2],y[3],y[0],y[1],y[2],y[3],y[0],y[1],y[2],y[3],y[0],y[1],y[2],y[3]],U=[C,C,C,C],M=[D[0],D[1],X,D[0],D[1],X,D[0],D[1],X,D[0],D[1],X],L=[0,0,0,1,1,0,1,1],P=[b[0],b[1],b[2],b[3],b[0],b[1],b[2],b[3],b[0],b[1],b[2],b[3],b[0],b[1],b[2],b[3]],$=[f[0],f[1],f[2],f[3],f[0],f[1],f[2],f[3],f[0],f[1],f[2],f[3],f[0],f[1],f[2],f[3]],R=[A,A,A,A];return{vertex:M,index:[0,1,2,1,3,2],number:[0,1,3,2],uv:L,size:W,rotation:U,color:K,borderColor:P,borderWidth:R,pickColor:$}},s.updateStyle=function(a,o){for(var l=function(c,h){for(var p=a[c],d=o.attributes[c],v=d.altitude,g=d.color,m=d.borderColor,y=d.borderWidth,b=d.rotation,_=d.size,C=d.label,A=d.labelAltitude,I=p.mf.origin,D=I.position,X=I.borderColor,W=I.color,K=I.borderWidth,U=I.size,M=I.rotation,L=p.mf.altitude,P=p.mf.Tw.jw,$=0,R=0,T=M.length;R<T;R++){var w=R*4,E=R*2;R>=P[$]&&$++;var O=$*4,k=$*2;L[$]!==v[$]&&(D[w+2-R]=v[$]),W[w]=g[O],W[w+1]=g[O+1],W[w+2]=g[O+2],W[w+3]=g[O+3],X[w]=m[O],X[w+1]=m[O+1],X[w+2]=m[O+2],X[w+3]=m[O+3],U[E]=+_[k],U[E+1]=+_[k+1],K[R]=y[$],M[R]=b[$]}p.attributes.position.buffer({data:D}),p.attributes.color.buffer({data:W}),p.attributes.rotation.buffer({data:M}),p.attributes.borderColor.buffer({data:X}),p.attributes.borderWidth.buffer({data:K}),p.attributes.size.buffer({data:U}),p.uniforms=o.uniforms,p.mf.labels=p.mf.labels.map(function(F,q){var Y=F.position,fe=L[q]!==v[q]?v[q]:D[3*q+2];return Y[2]=fe+A[q],__spreadProps$e(__spreadValues$m(__spreadValues$m({},F),C[q]),{position:Y})})},u=0,f=a.length;u<f;u++)l(u,f)},s.EC=function(){return[]},s.destroy=function(){this.regl=null},i.getInstance=function(){return this.ui},i}(GeometryFusion),ScatterFusion=_ScatterFusion;ScatterFusion.ui=new _ScatterFusion,ScatterFusion.getInstance();var ScatterShader={vertex:"\n        precision highp float;\n        #define PI 3.14159265359\n        attribute vec3 position;\n        attribute vec4 color;\n        attribute vec4 borderColor;\n        attribute vec2 size;\n        attribute vec2 uv;\n        attribute float rotation;\n        attribute float borderWidth;\n        attribute float number;\n\n        varying vec4 vColor;\n        varying vec4 vBColor;\n        varying float vBWidth;\n        varying vec2 vUv;\n        varying vec2 vSize;\n        varying vec2 vPos;\n\n        uniform mat4 mvp;\n        uniform float resolution;\n        // 0: px, 1: meter\n        uniform float unit;\n        ".concat(ColorGLSL.getColorShader().vertex,"\n\n        void main() {\n            // \u5BF9\u89D2\u7EBF\u957F\u5EA6\u4E00\u534A\n            float diagonal = length(size + vec2(borderWidth * 2.0)) / 2.0;\n            float x = size.x / 2.0 + borderWidth;\n            float y = size.y / 2.0 + borderWidth;\n\n            // \u8BA1\u7B97\u9876\u70B9\u5411\u91CF\n            // 1 3 -- 0 1\n            // 0 2 -- 2 3\n            float rotNumber = mod(number + 2.0, 4.0);\n            float oneAngle = asin(x / diagonal);\n            float twoAngle = asin(y / diagonal) * 2.0;\n            float theta = rotation / 180. * PI + oneAngle;\n            if(rotNumber == 1.0) {\n                theta += twoAngle;\n            } else if(rotNumber == 2.0) {\n                theta += twoAngle + oneAngle * 2.0;\n            } else if(rotNumber == 3.0) {\n                theta += (twoAngle + oneAngle) * 2.0;\n            }\n\n            vec2 pos =\n                mat2(cos(theta), -sin(theta),\n                     sin(theta), cos(theta)) * vec2(0, 1);\n\n            float res = unit == 0.0 ? resolution : 1.0;\n\n            gl_Position = mvp * vec4(position + vec3(pos, 0) * diagonal * res, 1.0);\n        \n            vColor = color;\n            vSize = size;\n            vBWidth = borderWidth;\n            vBColor = borderColor;\n            vUv = uv;\n            vPos = pos * diagonal;\n            ").concat(ColorGLSL.getColorShader().mainVert,"\n        }\n    "),fragment:"\n        precision highp float;\n        uniform float resolution;\n        uniform float opacity;\n        uniform float textureSequence;\n        uniform sampler2D texture;\n        uniform bool useTexture;\n        uniform float animateCounter;\n\n        varying vec2 vSize;\n        varying vec4 vColor;\n        varying vec4 vBColor;\n        varying float vBWidth;\n        varying vec2 vUv;\n        varying vec2 vPos;\n        ".concat(ColorGLSL.getColorShader().fragment,"\n\n        void main() {\n            if(useTexture) {\n                // 0.0001 \u89E3\u51B3 mod \u8FD0\u7B97\u7684\u7CBE\u5EA6\u8BEF\u5DEE\u95EE\u9898\u3002\n                float offset = mod(animateCounter + 0.001, textureSequence) / textureSequence;\n                gl_FragColor = texture2D(texture, vec2(vUv.x / textureSequence + offset, vUv.y));\n                // gl_FragColor = vec4(mod(textureSequence + 0.1, textureSequence) / textureSequence, 0, 0, 1);\n            } else {\n                gl_FragColor = vColor;\n\n                // \u6297\u952F\u9F7F\u50CF\u7D20\u4F4D\n                float len = length(vPos);\n                float taaRadius = 2.0;\n                if(len > vSize.x / 2.0 + vBWidth) {\n                    discard;\n                } else if(len > vSize.x / 2.0 + vBWidth - taaRadius) {\n                    gl_FragColor = vBWidth > 0.0 ? vBColor : vColor;\n                    float opa = smoothstep(1.0, 0.0, (len - (vSize.x / 2.0 + vBWidth - taaRadius)) / taaRadius);\n                    gl_FragColor.a *= opa;\n                } else if(vBWidth > 0.0 && len > vSize.x / 2.0 + taaRadius) {\n                    gl_FragColor = vBColor;\n                } else if(vBWidth > 0.0 && len > vSize.x / 2.0) {\n                    float blend = smoothstep(0.0, 1.0, (len - vSize.x / taaRadius) / taaRadius);\n                    gl_FragColor = mix(vColor, vBColor, blend);\n                }\n            }\n            gl_FragColor.a *= opacity;\n            ").concat(ColorGLSL.getColorShader().mainFrag,"\n        }\n    ")},__defProp$l=Object.defineProperty,__defProps$d=Object.defineProperties,__getOwnPropDescs$d=Object.getOwnPropertyDescriptors,__getOwnPropSymbols$l=Object.getOwnPropertySymbols,__hasOwnProp$l=Object.prototype.hasOwnProperty,__propIsEnum$l=Object.prototype.propertyIsEnumerable,__defNormalProp$l=function(n,r,i){return r in n?__defProp$l(n,r,{Fr:!0,Lr:!0,writable:!0,value:i}):n[r]=i},__spreadValues$l=function(n,r){for(var i in r||(r={}))__hasOwnProp$l.call(r,i)&&__defNormalProp$l(n,i,r[i]);var s=!0,a=!1,o=void 0;if(__getOwnPropSymbols$l)try{for(var l=__getOwnPropSymbols$l(r)[Symbol.iterator](),u;!(s=(u=l.next()).done);s=!0){var i=u.value;__propIsEnum$l.call(r,i)&&__defNormalProp$l(n,i,r[i])}}catch(f){a=!0,o=f}finally{try{!s&&l.return!=null&&l.return()}finally{if(a)throw o}}return n},__spreadProps$d=function(n,r){return __defProps$d(n,__getOwnPropDescs$d(r))},ScatterRender=function(n){_inherits(i,n);var r=_createSuper(i);function i(){_classCallCheck(this,i);var a;return a=r.call.apply(r,[this].concat(Array.prototype.slice.call(arguments))),a.v$=[new LabelsRender$1],a}var s=i.prototype;return s.m$=function(a){if(!this.regl)return!1;this.v$.forEach(function(l){return l.m$(a)});var o=this.regl;this.gA(ScatterShader,a,{attributes:__spreadValues$l({position:o.prop("position"),color:o.prop("color"),size:o.prop("size"),uv:o.prop("uv"),rotation:o.prop("rotation"),number:o.prop("number"),borderColor:o.prop("borderColor"),borderWidth:o.prop("borderWidth")},ColorGLSL.getColor(o).attribute),uniforms:__spreadValues$l({mvp:o.prop("mvp"),resolution:o.prop("resolution"),opacity:o.prop("opacity"),unit:o.prop("unit"),texture:o.prop("texture"),textureSequence:o.prop("textureSequence"),useTexture:o.prop("useTexture"),animateCounter:o.prop("animateCounter")},ColorGLSL.getColor(o).uniform),blend:{enable:!0,func:RenderUtil.getBlend("normal"),equation:{rgb:"add",alpha:"add"}},cull:{enable:!0,face:"back"},frontFace:"cw",depth:{enable:o.prop("depth")},elements:o.prop("index")})},s.render=function(a){var o=this.yA(ScatterShader);if(o){for(var l=a.meshes,u=a.mvp,f=a.resolution,c=a.opacity,h=a.texture,p=a.useTexture,d=a.animateCounter,v=a.textureSequence,g=a.depth,m=0;m<l.length;m++){var y=l[m],b=y.attributes,_=y.uniforms,C=_.unit,A=_.duration;_.animate;var I=parseInt(d/60*v/(A/1e3));o(__spreadProps$d(__spreadValues$l({},b),{mvp:u,resolution:f,opacity:c,unit:C==="px"?0:1,texture:h,textureSequence:v,useTexture:p,animateCounter:isNaN(I)?0:I,depth:g,isPick:!1}))}for(var D=0;D<l.length;D++){var X=!0,W=!1,K=void 0;try{for(var U=this.v$[Symbol.iterator](),M;!(X=(M=U.next()).done);X=!0){var L=M.value;L.render(l[D],c)}}catch(P){W=!0,K=P}finally{try{!X&&U.return!=null&&U.return()}finally{if(W)throw K}}}}},s.pickRender=function(a){var o=this.yA(ScatterShader);if(o){var l=a.meshes,u=a.mvp,f=a.resolution,c=a.opacity,h=a.texture,p=a.useTexture,d=a.animateCounter,v=a.textureSequence,g=a.depth,m=a.pickFbo,y=a.pickPos;if(h&&m&&y){var b=this;m.use(function(){b.regl.clear({color:[0,0,0,0],depth:1});for(var _=0;_<l.length;_++){var C=l[_],A=C.attributes,I=C.uniforms,D=I.unit,X=I.duration,W=I.animate,K=parseInt(d/60*v/(X/1e3));o(__spreadProps$d(__spreadValues$l({},A),{mvp:u,resolution:f,opacity:c,unit:D==="px"?0:1,texture:h,textureSequence:v,useTexture:p,animateCounter:isNaN(K)?0:K,animate:W,depth:g,isPick:!0}))}})}}},i}(Render),__defProp$k=Object.defineProperty,__getOwnPropSymbols$k=Object.getOwnPropertySymbols,__hasOwnProp$k=Object.prototype.hasOwnProperty,__propIsEnum$k=Object.prototype.propertyIsEnumerable,__defNormalProp$k=function(n,r,i){return r in n?__defProp$k(n,r,{Fr:!0,Lr:!0,writable:!0,value:i}):n[r]=i},__spreadValues$k=function(n,r){for(var i in r||(r={}))__hasOwnProp$k.call(r,i)&&__defNormalProp$k(n,i,r[i]);var s=!0,a=!1,o=void 0;if(__getOwnPropSymbols$k)try{for(var l=__getOwnPropSymbols$k(r)[Symbol.iterator](),u;!(s=(u=l.next()).done);s=!0){var i=u.value;__propIsEnum$k.call(r,i)&&__defNormalProp$k(n,i,r[i])}}catch(f){a=!0,o=f}finally{try{!s&&l.return!=null&&l.return()}finally{if(a)throw o}}return n},getMipMap=RenderUtil.getMipMap,pushArray$j=CommonUtil$1._C,Scatter=function(n){_inherits(i,n);var r=_createSuper(i);function i(a){_classCallCheck(this,i);var o;o=r.call(this,a),o.CLASS_NAME="Scatter",o.fusion=new ScatterFusion,o.ll=new ScatterRender,o.Vw=!1,o.nx=0;var l=scatter.Sw;return o.zooms=a.zooms===void 0?l.zooms:a.zooms,o.visible=a.visible===void 0?l.visible:a.visible,o.zIndex=a.zIndex===void 0?l.zIndex:a.zIndex,o.opacity=a.opacity===void 0?l.opacity:a.opacity,o.depth=a.depth===void 0?l.depth:a.depth,o.AC({zooms:o.zooms,visible:o.visible,zIndex:o.zIndex}),o.buryPoint.record(o.CLASS_NAME),o}var s=i.prototype;return s.getLabelsLayer=function(){return this.ll.v$[0]._$||null},s.receiveDataset=function(a){this.dataset=a,this.setStyle(this.styleOptions),this.onAdd()},s.setStyle=function(a){if(_get(_getPrototypeOf(i.prototype),"setStyle",this).call(this,a),!!a&&(this.dataset=this.source.LC(),this.dataset&&this.dataset.length>0)){var o=this.WC(),l=o.didFusion;this.Kf=null;var u=this.fusion.buildStyle(this.dataset,this.styleOptions);this.fusion.updateStyle(l,u),this.vA.state|=MeshDirty,this.loca&&this.loca.requestRender()}},s.jC=function(){_get(_getPrototypeOf(i.prototype),"jC",this).call(this),!(!this.loca||!this.loca.regl||this.ll.regl)&&(this.ll.regl=this.loca.regl,this.loca.rendererManager.addRenderer(this.ll))},s.beforeRender=function(){if(_get(_getPrototypeOf(i.prototype),"beforeRender",this).call(this),!this.fusion.regl&&this.loca&&(this.fusion.regl=this.loca.regl,this.loca.fusionManager.addFusion(this.fusion)),this.jC(),this.source&&(this.dataset=this.source.LC()),this.fusion&&this.styleOptions){var a=this.WC(),o=a.willFusion,l=a.didFusion;if(this.fusion.EC(),o.length>0){var u=this.fusion.fusion(o,this.styleOptions,this);this.meshes=pushArray$j(l,u),this.vA.state|=MeshesDirty}}if(this.meshes.length>0){var f=this.meshes[0].uniforms.texture;this.createTexture(f)}},s.render=function(){var a,o;if(!!this.loca&&!!this.PA()){this.loca.regl._refresh();var l=(a=this.loca)==null?void 0:a.customCoords.getMVPMatrix(),u=this.projection.getResolution((o=this.loca)==null?void 0:o.map.getZoom());if(this.ll&&this.meshes.length>0){var f=this.hP();return this.ll.render({meshes:this.meshes,mvp:l,resolution:u,opacity:this._getOpacity(),texture:this.Kf,useTexture:this.Vw,animateCounter:f,textureSequence:this.nx,depth:this.depth}),!0}}},s.pickRender=function(){var a,o;if(!!this.loca&&!!this.PA()){this.loca.regl._refresh();var l=(a=this.loca)==null?void 0:a.customCoords.getMVPMatrix(),u=this.projection.getResolution((o=this.loca)==null?void 0:o.map.getZoom());if(this.ll){var f=this.hP();this.ll.pickRender({meshes:this.meshes,mvp:l,resolution:u,opacity:this._getOpacity(),texture:this.Kf,useTexture:this.Vw,animateCounter:f,textureSequence:this.nx,depth:this.depth,pickFbo:this._needPickFrame&&this._pickFbo,pickPos:this._pickPos})}}},s.afterRender=function(){},s.createTexture=function(a){if(this.Vw=!!a,!(this.Kf||!this.loca||!this.loca.regl)&&(this.Kf=this.loca.regl.texture({data:[[[0,255,0,0],[255,0,0,0]],[[0,0,255,0],[255,255,255,0]]]}),!!a))if(Object.prototype.toString.call(a)==="[object String]"){var o=this,l=new Image;l.crossOrigin="anonymous",l.src=a,l.onload=function(){o.Kf=o.loca.regl.texture(__spreadValues$k({data:l,flipY:!0},getMipMap(l.naturalWidth,l.naturalHeight))),o.nx=l.naturalWidth/l.naturalHeight}}else this.Kf=this.loca.regl.texture(__spreadValues$k({data:a,flipY:!0},getMipMap(a.width,a.height))),this.nx=a.width/a.height},s.PA=function(){return RenderHelper.SA(this.ll,this)},i}(Layer),pushArray$i=CommonUtil$1._C,_LinkFusion=function(n){_inherits(i,n);var r=_createSuper(i);function i(){return _classCallCheck(this,i),r.apply(this,arguments)}var s=i.prototype;return s.DC=function(){},s.buildStyle=function(a,o,l){var u=link.style,f=[];if(!l.loca)return{};for(var c=l.loca.customCoords,h=0;h<a.length;h++)if(!(!a[h].features||!a[h].features.lines)){var p=a[h].features.lines,d=[],v=!0,g=!1,m=void 0;try{for(var y=p[Symbol.iterator](),b;!(v=(b=y.next()).done);v=!0){var _=b.value,C=_.coordinates,A=_.type;if(A==="LineString"){var I=_slicedToArray(C,2),D=I[0],X=I[1],W=c.lngLatToCoord(D),K=c.lngLatToCoord(X),U=glMatrix.vec2.distance(W,K);d.push({distance:U,link:_})}if(A==="MultiLineString")for(var M=0;M<C.length;M++){var L=_slicedToArray(C[M],2),P=L[0],$=L[1],R=c.lngLatToCoord(P),T=c.lngLatToCoord($),w=glMatrix.vec2.distance(R,T);d.push({distance:w,link:{coordinates:_.coordinates[M],properties:_.properties}})}}}catch(O){g=!0,m=O}finally{try{!v&&y.return!=null&&y.return()}finally{if(g)throw m}}var E=StyleInstance.parse(d,o,u);f.push(E)}return f},s.fusion=function(a,o,l,u){var f=this,c=function(v){var g=function(X){var W=y[X],K=W.coordinates,U=_.lineColors,M=_.height,L=C.smoothSteps,P=l.colorPick.add(W);if(W.type==="MultiLineString"){var $=function(st,at){var $t=K[st],kt=_slicedToArray($t,2),Rt=kt[0],Tt=kt[1],bt=_slicedToArray(Rt,2),Ot=bt[0],Lt=bt[1],xt=_slicedToArray(Tt,2),ht=xt[0],ot=xt[1],mt={x:+Ot,y:+Lt,z:0},nt={x:+ht,y:+ot,z:0},Ut=M[st],Dt=[],ft=U[st];if(ft.length===1&&(ft[1]=ft[0]),Ut===0)Dt=LinearSplit(mt,nt,ft.length),Dt.forEach(function(St,zt){zt!==Dt.length-1&&A.index.push(I,++I);var Nt=p.lngLatToCoord([St.x,St.y]);A.vertex.push(Nt[0],Nt[1],St.z),pushArray$i(A.color,ft[zt]),pushArray$i(A.pickColor,P)});else{var Ct={x:Ot-(Ot-ht)/2,y:Lt-(Lt-ot)/2,z:Ut};Dt=cubicBezier(mt,Ct,nt,.5,L),Dt.forEach(function(St,zt){zt!==Dt.length-1&&A.index.push(I,++I);var Nt=p.lngLatToCoord([St.x,St.y]);A.vertex.push(Nt[0],Nt[1],St.z);var Vt=linearGradient(ft,St.t);pushArray$i(A.color,Vt),pushArray$i(A.pickColor,P)})}I++};I=0;for(var R=0,T=K.length;R<T;R++)$(R,T)}else{var w=K,E=_slicedToArray(w,2),O=E[0],k=E[1],F=_slicedToArray(O,2),q=F[0],Y=F[1],fe=_slicedToArray(k,2),_e=fe[0],Pe=fe[1],De={x:+q,y:+Y,z:0},tt={x:+_e,y:+Pe,z:0},je=M[X],Fe=[],Ge=U[X];if(Ge.length===1&&(Ge[1]=Ge[0]),je===0)Fe=LinearSplit(De,tt,Ge.length),Fe.forEach(function(st,at){at!==Fe.length-1&&A.index.push(I,++I);var $t=p.lngLatToCoord([st.x,st.y]);A.vertex.push($t[0],$t[1],st.z),pushArray$i(A.color,Ge[at]),pushArray$i(A.pickColor,P)});else{var Et={x:q-(q-_e)/2,y:Y-(Y-Pe)/2,z:je};Fe=cubicBezier(De,Et,tt,.5,L),Fe.forEach(function(st,at){at!==Fe.length-1&&A.index.push(I,++I);var $t=p.lngLatToCoord([st.x,st.y]);A.vertex.push($t[0],$t[1],st.z);var kt=linearGradient(Ge,st.t);pushArray$i(A.color,kt),pushArray$i(A.pickColor,P)})}I++}},m=a[v];if(!m.features||!m.features.lines)return"continue";for(var y=m.features.lines,b=u[v],_=b.attributes,C=b.uniforms,A={vertex:[],color:[],pickColor:[],index:[]},I=0,D=0;D<y.length;D++)g(D);h[v]={id:m.id,attributes:{color:{buffer:f.regl.buffer(A.color),offset:0,stride:4*4,td:!1,divisor:0},pickColor:{buffer:f.regl.buffer(A.pickColor),offset:0,stride:4*4,td:!1,divisor:0},position:{buffer:f.regl.buffer(A.vertex),offset:0,stride:4*3,td:!1,divisor:0},index:f.regl.elements({primitive:"lines",type:"uint32",data:A.index})},uniforms:b.uniforms,si:b.si}};if(!this.regl||!l.loca)return[];var h=[];u=u||this.buildStyle(a,o,l);for(var p=l.loca.customCoords,d=0;d<a.length;d++)c(d);return h},s.updateStyle=function(a,o,l,u){if(!l.loca)return[];var f=l.dataset;return this.fusion(f,o,l,u)},s.EC=function(){return[]},s.destroy=function(){this.regl=null},i.getInstance=function(){return this.ui},i}(GeometryFusion),LinkFusion=_LinkFusion;LinkFusion.ui=new _LinkFusion,LinkFusion.getInstance();var LinkShader={vertex:"\n        precision highp float;\n        attribute vec3 position;\n        attribute vec4 color;\n        varying vec4 v_color;\n        uniform mat4 mvp;\n        ".concat(ColorGLSL.getColorShader().vertex,"\n\n        void main() {\n            v_color = color;\n            gl_Position = mvp * vec4(position, 1.0);\n            ").concat(ColorGLSL.getColorShader().mainVert,"\n        }\n    "),fragment:"\n        precision highp float;\n        varying vec4 v_color;\n        uniform float opacity;\n        ".concat(ColorGLSL.getColorShader().fragment,"\n\n        void main() {\n            gl_FragColor = v_color;\n            gl_FragColor *= opacity;\n            ").concat(ColorGLSL.getColorShader().mainFrag,"\n        }\n    ")},__defProp$j=Object.defineProperty,__defProps$c=Object.defineProperties,__getOwnPropDescs$c=Object.getOwnPropertyDescriptors,__getOwnPropSymbols$j=Object.getOwnPropertySymbols,__hasOwnProp$j=Object.prototype.hasOwnProperty,__propIsEnum$j=Object.prototype.propertyIsEnumerable,__defNormalProp$j=function(n,r,i){return r in n?__defProp$j(n,r,{Fr:!0,Lr:!0,writable:!0,value:i}):n[r]=i},__spreadValues$j=function(n,r){for(var i in r||(r={}))__hasOwnProp$j.call(r,i)&&__defNormalProp$j(n,i,r[i]);var s=!0,a=!1,o=void 0;if(__getOwnPropSymbols$j)try{for(var l=__getOwnPropSymbols$j(r)[Symbol.iterator](),u;!(s=(u=l.next()).done);s=!0){var i=u.value;__propIsEnum$j.call(r,i)&&__defNormalProp$j(n,i,r[i])}}catch(f){a=!0,o=f}finally{try{!s&&l.return!=null&&l.return()}finally{if(a)throw o}}return n},__spreadProps$c=function(n,r){return __defProps$c(n,__getOwnPropDescs$c(r))},LinkRender=function(n){_inherits(i,n);var r=_createSuper(i);function i(){return _classCallCheck(this,i),r.apply(this,arguments)}var s=i.prototype;return s.m$=function(a){if(!this.regl)return!1;var o=this.regl;this.gA(LinkShader,a,{attributes:__spreadValues$j({position:o.prop("position"),color:o.prop("color")},ColorGLSL.getColor(o).attribute),uniforms:__spreadValues$j({mvp:o.prop("mvp"),opacity:o.prop("opacity")},ColorGLSL.getColor(o).uniform),depth:{enable:!1},blend:{enable:!0,func:o.prop("blendFun"),equation:{rgb:"add",alpha:"add"}},elements:o.prop("index")})},s.render=function(a){var o=this.yA(LinkShader);if(o)for(var l=a.meshes,u=a.mvp,f=a.opacity,c=0;c<l.length;c++){var h=l[c],p=h.attributes;o(__spreadProps$c(__spreadValues$j({blendFun:RenderUtil.getBlend("zero")},p),{mvp:u,opacity:f,isPick:!1})),o(__spreadProps$c(__spreadValues$j({blendFun:RenderUtil.getBlend("lighter")},p),{mvp:u,opacity:f,isPick:!1}))}},s.pickRender=function(a){var o=this.yA(LinkShader);if(o){var l=a.meshes,u=a.mvp,f=a.opacity,c=a.pickFbo,h=a.pickPos;if(c&&h){var p=this;c.use(function(){p.regl.clear({color:[0,0,0,0],depth:1});for(var d=0;d<l.length;d++){var v=l[d],g=v.attributes;o(__spreadProps$c(__spreadValues$j({blendFun:RenderUtil.getBlend("normal")},g),{mvp:u,opacity:f,isPick:!0}))}})}}},i}(Render),pushArray$h=CommonUtil$1._C,LinkLayer=function(n){_inherits(i,n);var r=_createSuper(i);function i(a){_classCallCheck(this,i);var o;o=r.call(this,a),o.CLASS_NAME="Link",o.fusion=new LinkFusion,o.ll=new LinkRender;var l=link.Sw;return o.zooms=a.zooms===void 0?l.zooms:a.zooms,o.zIndex=a.zIndex===void 0?l.zIndex:a.zIndex,o.opacity=a.opacity===void 0?l.opacity:a.opacity,o.visible=a.visible===void 0?l.visible:a.visible,o.AC({zooms:o.zooms,visible:o.visible,zIndex:o.zIndex}),o.buryPoint.record(o.CLASS_NAME),o}var s=i.prototype;return s.receiveDataset=function(a){this.dataset=a,this.setStyle(this.styleOptions),this.onAdd()},s.setStyle=function(a){if(_get(_getPrototypeOf(i.prototype),"setStyle",this).call(this,a),this.dataset=this.source.LC(),this.meshes=[],this.dataset&&this.dataset.length>0&&this.meshes){var o=this.WC(),l=o.didFusion,u=this.fusion.buildStyle(this.dataset,this.styleOptions,this),f=this.fusion.updateStyle(l,this.styleOptions,this,u);this.meshes=f,this.loca&&this.loca.requestRender()}},s.jC=function(){_get(_getPrototypeOf(i.prototype),"jC",this).call(this),!(!this.loca||!this.loca.regl||this.ll.regl)&&(this.ll.regl=this.loca.regl,this.loca.rendererManager.addRenderer(this.ll))},s.beforeRender=function(){if(_get(_getPrototypeOf(i.prototype),"beforeRender",this).call(this),!this.fusion.regl&&this.loca&&(this.fusion.regl=this.loca.regl,this.loca.fusionManager.addFusion(this.fusion)),this.jC(),this.source&&(this.dataset=this.source.LC()),this.fusion){var a=this.WC(),o=a.willFusion,l=a.didFusion;if(this.fusion.EC(),o.length>0){var u=this.fusion.fusion(o,this.styleOptions,this);this.meshes=pushArray$h(l,u)}}},s.render=function(){var a;if(!!this.loca&&!!this.PA()){this.loca.regl._refresh();var o=(a=this.loca)==null?void 0:a.customCoords.getMVPMatrix();if(this.ll&&this.meshes.length>0)return this.ll.render({meshes:this.meshes,mvp:o,opacity:this._getOpacity()}),!0}},s.pickRender=function(){var a;if(!!this.loca&&!!this.PA()){this.loca.regl._refresh();var o=(a=this.loca)==null?void 0:a.customCoords.getMVPMatrix();this.ll&&this.ll.pickRender({meshes:this.meshes,mvp:o,opacity:this._getOpacity(),pickFbo:this._needPickFrame&&this._pickFbo,pickPos:this._pickPos})}},s.afterRender=function(){},s.PA=function(){return RenderHelper.SA(this.ll,this)},i}(Layer),calcDistance=function(n){for(var r=0,i=0;i<n.length-1;i++)r+=glMatrix.vec2.distance(n[i],n[i+1]);return r},reverse=function(n){return glMatrix.vec3.fromValues(-n[0],-n[1],-n[2])},normalMultiple=function(n,r){return glMatrix.vec3.fromValues(n[0]*r,n[1]*r,n[2]*r)},calcNormal=function(n,r,i){var s=glMatrix.vec3.sub(glMatrix.vec3.create(),r,n),a=glMatrix.vec3.create();return glMatrix.vec3.cross(a,i,s),glMatrix.vec3.normalize(a,a)},calcAngle=function(n,r){var i=glMatrix.vec3.dot(n,r)/glMatrix.vec3.length(n)/glMatrix.vec3.length(r);return Math.acos(Math.min(1,i))},calcWise=function(n,r){var i=glMatrix.vec3.create(),s=glMatrix.vec2.fromValues(n[0],n[1]),a=glMatrix.vec2.fromValues(r[0],r[1]);return glMatrix.vec2.cross(i,a,s),i[2]===0?i[2]:i[2]/Math.abs(i[2])},calcAngleBisector=function(n,r){var i=glMatrix.vec3.normalize(glMatrix.vec3.create(),n),s=glMatrix.vec3.normalize(glMatrix.vec3.create(),r),a=glMatrix.vec3.add(glMatrix.vec3.create(),i,s);return glMatrix.vec3.normalize(a,a)},pushArray$g=CommonUtil$1._C,_PulseLineFusion=function(n){_inherits(i,n);var r=_createSuper(i);function i(){return _classCallCheck(this,i),r.apply(this,arguments)}var s=i.prototype;return s.DC=function(){},s.buildStyle=function(a,o){for(var l=function(h){var p=a[h];if(!a[h].features||!a[h].features.lines)return"continue";var d=p.features.lines,v=StyleInstance.parse(d,o,u),g={};d.forEach(function(m,y){if(v)for(var b in v.attributes){var _=v.attributes[b];g[b]||(g[b]=[]),g[b][g[b].length]=_[y]}}),f.push({attributes:g,uniforms:v.uniforms,si:v.si}),f.push(v)},u=pulseline.style,f=[],c=0;c<a.length;c++)l(c);return f},s.updateStyle=function(a,o,l,u){if(!l.loca)return[];var f=l.dataset;return this.fusion(f,o,l,u)},s.fusion=function(a,o,l,u){var f=this,c=function(v){var g=f,m=a[v];if(!a[v].features||!a[v].features.lines)return"continue";var y=m.features.lines,b=u[v],_={position:[],normal:[],angle:[],pointType:[],distance:[],startDistance:[],totalDistance:[],lineWidth:[],headColor:[],trailColor:[],pickColor:[],index:[]},C=0,A=[];y.forEach(function(I,D){var X=I.type,W=I.coordinates,K=l.colorPick.add(I);if(X==="MultiLineString"){var U=g;W.forEach(function($){var R=$.map(function(E){return p.lngLatToCoord(E)}),T=U.triangles(R,{style:b,index:D,pickColor:K}),w=T.index.map(function(E){return E+C});pushArray$g(_.position,T.position),pushArray$g(_.normal,T.normal),pushArray$g(_.angle,T.angle),pushArray$g(_.pointType,T.pointType),pushArray$g(_.distance,T.distance),pushArray$g(_.startDistance,T.startDistance),pushArray$g(_.totalDistance,T.totalDistance),pushArray$g(_.lineWidth,T.lineWidth),pushArray$g(_.headColor,T.headColor),pushArray$g(_.trailColor,T.trailColor),pushArray$g(_.pickColor,T.pickColor),pushArray$g(_.index,w),C+=T.distance.length})}else{var M=W.map(function($){return p.lngLatToCoord($)}),L=g.triangles(M,{style:b,index:D,pickColor:K}),P=L.index.map(function($){return $+C});pushArray$g(_.position,L.position),pushArray$g(_.normal,L.normal),pushArray$g(_.angle,L.angle),pushArray$g(_.pointType,L.pointType),pushArray$g(_.distance,L.distance),pushArray$g(_.startDistance,L.startDistance),pushArray$g(_.totalDistance,L.totalDistance),pushArray$g(_.lineWidth,L.lineWidth),pushArray$g(_.headColor,L.headColor),pushArray$g(_.trailColor,L.trailColor),pushArray$g(_.pickColor,L.pickColor),pushArray$g(_.index,P),C+=L.distance.length}A[D]=_.distance.length}),h[v]={id:m.id,attributes:{position:{buffer:f.regl.buffer(_.position),size:3,offset:0,stride:0,td:!1,divisor:0},normal:{buffer:f.regl.buffer(_.normal),size:3,offset:0,stride:0,td:!1,divisor:0},angle:{buffer:f.regl.buffer(_.angle),size:1,offset:0,stride:0,td:!1,divisor:0},pointType:{buffer:f.regl.buffer(_.pointType),size:1,offset:0,stride:0,td:!1,divisor:0},distance:{buffer:f.regl.buffer(_.distance),size:1,offset:0,stride:0,td:!1,divisor:0},startDistance:{buffer:f.regl.buffer(_.startDistance),size:1,offset:0,stride:0,td:!1,divisor:0},totalDistance:{buffer:f.regl.buffer(_.totalDistance),size:1,offset:0,stride:0,td:!1,divisor:0},lineWidth:{buffer:f.regl.buffer(_.lineWidth),size:1,offset:0,stride:0,td:!1,divisor:0},headColor:{buffer:f.regl.buffer(_.headColor),size:4,offset:0,stride:0,td:!1,divisor:0},trailColor:{buffer:f.regl.buffer(_.trailColor),size:4,offset:0,stride:0,td:!1,divisor:0},pickColor:{buffer:f.regl.buffer(_.pickColor),size:4,offset:0,stride:0,td:!1,divisor:0},index:f.regl.elements({primitive:"triangles",type:"uint32",data:_.index})},uniforms:b.uniforms,si:b.si,mf:{Tw:{jw:A},origin:{position:_.position,normal:_.normal,angle:_.angle,pointType:_.pointType,distance:_.distance,startDistance:_.startDistance,totalDistance:_.totalDistance,lineWidth:_.lineWidth,index:_.index}}}};if(!this.regl||!l.loca)return[];var h=[];u=u||this.buildStyle(a,o);for(var p=l.loca.customCoords,d=0;d<a.length;d++)c(d);return h},s.EC=function(){return[]},s.triangles=function(a,o){for(var l=o.style,u=l.attributes,f=l.uniforms,c=o.index,h=o.pickColor,p=u.lineWidth,d=u.headColor,v=u.trailColor,g=f.altitude,m=calcDistance(a),y={position:[],normal:[],angle:[],pointType:[],distance:[],startDistance:[],totalDistance:[],lineWidth:[],headColor:[],trailColor:[],pickColor:[],index:[]},b=[],_=0;_<a.length;_++)(_===0||a[_][0]!==a[_-1][0]||a[_][1]!==a[_-1][1])&&b.push(a[_]);if(b.length<=1)return y;for(var C=glMatrix.vec3.fromValues(0,0,1),A=[],I=[],D=[],X=[],W=[],K=[],U=[],M=glMatrix.vec3.create(),L=glMatrix.vec3.create(),P=glMatrix.vec3.create(),$=0,R=0;R<b.length;R++){var T=b[R],w=glMatrix.vec3.fromValues(T[0],T[1],g),E=glMatrix.vec3.fromValues(T[0],T[1],0);if(glMatrix.vec3.normalize(E,E),R===0){var O=b[R+1],k=glMatrix.vec3.fromValues(O[0],O[1],g),F=glMatrix.vec3.sub(glMatrix.vec3.create(),k,w),q=calcNormal(w,k,C);I.push(w,w),D.push(q,normalMultiple(q,-1)),X.push(0,0),W.push(0,0),K.push(0,0),U.push($,$),M=reverse(F),L=q,P=w}else if(R===b.length-1){var Y=glMatrix.vec3.dist(P,w);I.push(w,w),D.push(L,normalMultiple(L,-1)),X.push(0,0),W.push(0,0),$+=Y,K.push(Y,Y),U.push($,$);var fe=I.length;A.push(fe-4,fe-2,fe-1),A.push(fe-4,fe-1,fe-3)}else{var _e=b[R+1],Pe=glMatrix.vec3.fromValues(_e[0],_e[1],g),De=glMatrix.vec3.sub(glMatrix.vec3.create(),Pe,w),tt=calcAngleBisector(M,De);if(glMatrix.vec3.length(tt)===0)continue;var je=calcNormal(w,Pe,C),Fe=calcAngle(tt,De),Ge=glMatrix.vec3.dist(P,w),Et=calcWise(M,De);if(Et>=0){I.push(w,w,w,w,w),D.push(tt,normalMultiple(L,-1),tt,tt,normalMultiple(je,-1)),X.push(Fe,0,Fe,Fe,0),W.push(-1,0,0,1,0),$+=Ge,K.push(Ge,Ge,Ge,Ge,Ge),U.push($,$,$,$,$);var st=I.length;A.push(st-3,st-4,st-1),A.push(st-7,st-5,st-4),A.push(st-7,st-4,st-6)}else{I.push(w,w,w,w,w),D.push(L,tt,tt,je,tt),X.push(0,Fe,Fe,0,Fe),W.push(0,-1,0,0,1),$+=Ge,K.push(Ge,Ge,Ge,Ge,Ge),U.push($,$,$,$,$);var at=I.length;A.push(at-3,at-5,at-2),A.push(at-7,at-5,at-4),A.push(at-7,at-4,at-6)}M=reverse(De),L=je,P=w}}var $t=[],kt=I.length;I.forEach(function(Dt){var ft=_slicedToArray(Dt,3),Ct=ft[0],St=ft[1],zt=ft[2];$t.push(Ct,St,zt)});var Rt=[];D.forEach(function(Dt){var ft=_slicedToArray(Dt,3),Ct=ft[0],St=ft[1],zt=ft[2];Rt.push(Ct,St,zt)});for(var Tt=p[c],bt=d[c],Ot=[],Lt=v[c],xt=[],ht=[],ot=0;ot<kt;ot++){var mt,nt,Ut;(mt=Ot).push.apply(mt,_toConsumableArray(bt)),(nt=xt).push.apply(nt,_toConsumableArray(Lt)),(Ut=ht).push.apply(Ut,_toConsumableArray(h))}return y.index=A,y.position=$t,y.normal=Rt,y.angle=X,y.pointType=W,y.distance=K,y.startDistance=U,y.totalDistance=new Array(kt).fill(m),y.lineWidth=new Array(kt).fill(Tt),y.headColor=Ot,y.trailColor=xt,y.pickColor=ht,y},s.destroy=function(){this.regl=null},i.getInstance=function(){return this.ui},i}(GeometryFusion),PulseLineFusion=_PulseLineFusion;PulseLineFusion.ui=new _PulseLineFusion,PulseLineFusion.getInstance();var PulseLineShader={vertex:"\n        precision highp float;\n        attribute vec3 position;\n        attribute vec3 normal;\n        attribute float angle;\n        attribute float pointType;\n        attribute float distance;\n        attribute float startDistance;\n        attribute float totalDistance;\n        attribute float lineWidth;\n        attribute vec4 headColor;\n        attribute vec4 trailColor;\n        uniform mat4 mvp;\n        uniform float resolution;\n        varying float vDistance;\n        varying float vTotalDistance;\n        varying vec4 vHeadColor;\n        varying vec4 vTrailColor;\n        ".concat(ColorGLSL.getColorShader().vertex,"\n\n        vec3 normalizeAndMulti(vec3 vec, float multi) {\n            vec3 nNormal = normalize(vec);\n            return vec3(\n                multi * nNormal.x,\n                multi * nNormal.y,\n                multi * nNormal.z\n            );\n        }\n        \n        void main() {\n          float halfLineWidth = lineWidth / 2.0 * resolution;\n          vec3 pointPosition;\n            // \u5224\u65AD\u662F\u5426\u4E3A\u5185\u89D2\u70B9\n            if (angle != 0.0) {\n                // \u5224\u65AD\u662F\u5426\u4E3A\u89D2\u5EA6\u8FC7\u5C0F\u7684\u7279\u6B8A\u60C5\u5F62\n                bool angleIsTooSmall = halfLineWidth / tan(angle) >= distance;\n                if (angleIsTooSmall) {\n                    if (pointType == 0.0) {\n                        pointPosition = position;\n                    } else {\n                        pointPosition = position + normalizeAndMulti(normal, halfLineWidth);\n                    }\n                    vDistance = startDistance;\n                } else {\n                    pointPosition = position + normalizeAndMulti(normal, halfLineWidth / sin(angle));\n                    vDistance = startDistance + pointType * halfLineWidth / tan(angle);\n                }\n            } else {\n                // \u5916\u89D2\u70B9\n                pointPosition = position + normalizeAndMulti(normal, halfLineWidth);\n                vDistance = startDistance;\n            }\n            vTotalDistance = totalDistance;\n            vHeadColor = headColor;\n            vTrailColor = trailColor;\n            gl_Position = mvp * vec4(pointPosition, 1.0);\n            ").concat(ColorGLSL.getColorShader().mainVert,"\n        }\n    "),fragment:"\n        precision highp float;\n        varying float vDistance;\n        varying float vTotalDistance;\n        varying vec4 vHeadColor;\n        varying vec4 vTrailColor;\n        uniform float interval;\n        uniform float duration;\n        uniform float time;\n        uniform float opacity;\n\n        float trailLength;\n        float offset;\n        float distanceMod;\n        float ratio;\n        ".concat(ColorGLSL.getColorShader().fragment,"\n\n        void main() {\n            trailLength = vTotalDistance * interval;\n            offset = vTotalDistance * mod(time / duration * 1000.0, 1.0);\n            distanceMod = mod(vDistance + trailLength - offset, trailLength);\n            ratio = distanceMod / trailLength;\n            gl_FragColor = mix(vTrailColor, vHeadColor, ratio);\n            gl_FragColor.a *= opacity;\n\n            ").concat(ColorGLSL.getColorShader().mainFrag,"\n            // if (vDistance > offset) {\n            //   gl_FragColor = vec4(0.0, 0.0, 0.0, 0.0);\n            // } else {\n            // }\n        }\n    ")},__defProp$i=Object.defineProperty,__defProps$b=Object.defineProperties,__getOwnPropDescs$b=Object.getOwnPropertyDescriptors,__getOwnPropSymbols$i=Object.getOwnPropertySymbols,__hasOwnProp$i=Object.prototype.hasOwnProperty,__propIsEnum$i=Object.prototype.propertyIsEnumerable,__defNormalProp$i=function(n,r,i){return r in n?__defProp$i(n,r,{Fr:!0,Lr:!0,writable:!0,value:i}):n[r]=i},__spreadValues$i=function(n,r){for(var i in r||(r={}))__hasOwnProp$i.call(r,i)&&__defNormalProp$i(n,i,r[i]);var s=!0,a=!1,o=void 0;if(__getOwnPropSymbols$i)try{for(var l=__getOwnPropSymbols$i(r)[Symbol.iterator](),u;!(s=(u=l.next()).done);s=!0){var i=u.value;__propIsEnum$i.call(r,i)&&__defNormalProp$i(n,i,r[i])}}catch(f){a=!0,o=f}finally{try{!s&&l.return!=null&&l.return()}finally{if(a)throw o}}return n},__spreadProps$b=function(n,r){return __defProps$b(n,__getOwnPropDescs$b(r))},PulseLineRender=function(n){_inherits(i,n);var r=_createSuper(i);function i(){return _classCallCheck(this,i),r.apply(this,arguments)}var s=i.prototype;return s.m$=function(a){if(!this.regl)return!1;var o=this.regl;this.gA(PulseLineShader,a,{attributes:__spreadValues$i({position:o.prop("position"),normal:o.prop("normal"),angle:o.prop("angle"),pointType:o.prop("pointType"),startDistance:o.prop("startDistance"),totalDistance:o.prop("totalDistance"),distance:o.prop("distance"),lineWidth:o.prop("lineWidth"),headColor:o.prop("headColor"),trailColor:o.prop("trailColor")},ColorGLSL.getColor(o).attribute),uniforms:__spreadValues$i({mvp:o.prop("mvp"),resolution:o.prop("resolution"),opacity:o.prop("opacity"),duration:o.prop("duration"),interval:o.prop("interval"),time:o.prop("time")},ColorGLSL.getColor(o).uniform),blend:{enable:!0,func:{srcRGB:"src alpha",dstRGB:"one minus src alpha",srcAlpha:1,dstAlpha:"one minus src alpha"},equation:{rgb:"add",alpha:"add"}},depth:{enable:!1},primitive:"triangles",offset:0,elements:o.prop("index")})},s.render=function(a){var o=this.yA(PulseLineShader);if(o){var l=a.meshes,u=a.mvp,f=a.resolution,c=a.opacity,h=a.animateCounter;l.forEach(function(p){var d=p.attributes,v=p.uniforms,g=v.interval,m=v.duration,y=60,b=h/y;o(__spreadProps$b(__spreadValues$i({},d),{mvp:u,resolution:f,opacity:c,interval:g,duration:m,time:b,isPick:!1}))})}},s.pickRender=function(a){var o=this.yA(PulseLineShader);if(o){var l=a.meshes,u=a.mvp,f=a.resolution,c=a.opacity,h=a.animateCounter,p=a.pickFbo,d=a.pickPos;if(p&&d){var v=this;p.use(function(){v.regl.clear({color:[0,0,0,0],depth:1}),l.forEach(function(g){var m=g.attributes,y=g.uniforms,b=y.interval,_=y.duration,C=60,A=h/C;o(__spreadProps$b(__spreadValues$i({},m),{mvp:u,resolution:f,opacity:c,interval:b,duration:_,time:A,isPick:!0}))})})}}},i}(Render),pushArray$f=CommonUtil$1._C,PulseLineLayer=function(n){_inherits(i,n);var r=_createSuper(i);function i(a){_classCallCheck(this,i);var o;o=r.call(this,a),o.CLASS_NAME="PulseLine",o.fusion=new PulseLineFusion,o.ll=new PulseLineRender;var l=pulseline.Sw;return o.zooms=a.zooms===void 0?l.zooms:a.zooms,o.visible=a.visible===void 0?l.visible:a.visible,o.zIndex=a.zIndex===void 0?l.zIndex:a.zIndex,o.opacity=a.opacity===void 0?l.opacity:a.opacity,o.AC({zooms:o.zooms,visible:o.visible,zIndex:o.zIndex}),o.buryPoint.record(o.CLASS_NAME),o}var s=i.prototype;return s.receiveDataset=function(a){this.dataset=a,this.setStyle(this.styleOptions),this.onAdd()},s.sx=function(){return{ux:this.sP,timestamp:0}},s.setStyle=function(a){if(_get(_getPrototypeOf(i.prototype),"setStyle",this).call(this,a),this.dataset&&this.dataset.length>0&&this.meshes){var o=this.WC(),l=o.didFusion;if(l.length){var u=this.fusion.buildStyle(this.dataset,this.styleOptions),f=this.fusion.updateStyle(l,this.styleOptions,this,u);this.meshes=f,this.loca&&this.loca.requestRender()}}},s.jC=function(){_get(_getPrototypeOf(i.prototype),"jC",this).call(this),!(!this.loca||!this.loca.regl||this.ll.regl)&&(this.ll.regl=this.loca.regl,this.loca.rendererManager.addRenderer(this.ll))},s.beforeRender=function(){if(_get(_getPrototypeOf(i.prototype),"beforeRender",this).call(this),!this.fusion.regl&&this.loca&&(this.fusion.regl=this.loca.regl,this.loca.fusionManager.addFusion(this.fusion)),this.jC(),this.source&&(this.dataset=this.source.LC()),this.fusion){var a=this.WC(),o=a.willFusion,l=a.didFusion;if(this.fusion.EC(),o.length>0){var u=this.fusion.fusion(o,this.styleOptions,this);this.meshes=pushArray$f(l,u)}}},s.render=function(){var a,o;if(!!this.loca&&!!this.PA()){this.loca.regl._refresh();var l=(a=this.loca)==null?void 0:a.customCoords.getMVPMatrix(),u=this.projection.getResolution((o=this.loca)==null?void 0:o.map.getZoom());if(this.ll&&this.meshes.length>0){var f=this.hP();return this.ll.render({meshes:this.meshes,mvp:l,resolution:u,opacity:this._getOpacity(),animateCounter:f}),!0}}},s.pickRender=function(){var a,o;if(!!this.loca&&!!this.PA()){this.loca.regl._refresh();var l=(a=this.loca)==null?void 0:a.customCoords.getMVPMatrix(),u=this.projection.getResolution((o=this.loca)==null?void 0:o.map.getZoom());if(this.ll){var f=this.hP();this.ll.pickRender({meshes:this.meshes,mvp:l,resolution:u,opacity:this._getOpacity(),animateCounter:f,pickFbo:this._needPickFrame&&this._pickFbo,pickPos:this._pickPos})}}},s.afterRender=function(){},s.PA=function(){return RenderHelper.SA(this.ll,this)},i}(Layer),SphericalMercator=function(){var n=Math.PI/180,r=180/Math.PI,i=6378137,s=85.0511287798,a=function(u,f){var c=s;f=Math.max(Math.min(c,f),-c);var h=u*n,p=f*n;return p=Math.log(Math.tan(Math.PI/4+p/2)),[h*i,p*i]},o=function(u,f){var c=u/i*r,h=(2*Math.atan(Math.exp(f/i))-Math.PI/2)*r;return[c,h]},l=function(u){return 20037508342789244e-9*2/256/Math.pow(2,u)};return{project:a,unproject:o,getResolution:l}}(),grid={ri:function n(r){for(var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:100,s=arguments.length>2?arguments[2]:void 0,a={},o=[],l=i*2,u=-1,f=r.length;++u<f;){var c=_slicedToArray(r[u].lnglat,2),h=c[0],p=c[1],d=SphericalMercator.project(h,p),v=Math.floor(d[0]/l),g=Math.floor(d[1]/l),m=v+"-"+g,y=a[m];if(y)y.coordinates.push(r[u]);else{var b=SphericalMercator.unproject(v*l+i,g*l+i);a[m]=y={rowCol:[v,g],center:b,coordinates:[r[u]],hx:s(b)},o.push(y)}}return o},vx:function n(r){for(var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:100,s={},a=[],o=i*2,l=-1,u=r.length;++l<u;){var f=r[l].coordinaties,c=Math.floor(f[0]/o),h=Math.floor(f[1]/o),p=c+"-"+h,d=s[p];d?d.coordinates.push(r[l]):(s[p]=d={rowCol:[c,h],center:[c*o+i,h*o+i],coordinates:[r[l]]},a.push(d))}return a},DC:function n(r,i){var s,a=[],o=i.radius,l=0,u=_slicedToArray(r.hx,2),f=u[0],c=u[1],h=[f-o+l,c+o-l],p=[f-o+l,c-o+l],d=[f+o-l,c-o+l],v=[f+o-l,c+o-l];return(s=a).push.apply(s,[h,p,d,v,h]),a}},hexagon={ei:Math.PI/3,oi:[0,Math.PI/3,2*Math.PI/3,Math.PI/3,Math.PI/3,5*Math.PI/3],ri:function n(r){for(var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:100,s=arguments.length>2?arguments[2]:void 0,a={},o=[],l=i*2*Math.sin(this.ei),u=i*1.5,f=0,c=r.length;f<c;++f){var h=_slicedToArray(r[f].lnglat,2),p=h[0],d=h[1],v=SphericalMercator.project(p,d),g=_slicedToArray(v,2),m=g[0],y=g[1];y=y/u;var b=Math.round(y);m=m/l-(b&1)/2;var _=Math.round(m),C=y-b;if(Math.abs(C)*3>1){var A=m-_,I=_+(m<_?-1:1)/2,D=b+(y<b?-1:1),X=m-I,W=y-D;A*A+C*C>X*X+W*W&&(_=I+(b&1?1:-1)/2,b=D)}var K=_+"-"+b,U=a[K];if(U)U.coordinates.push(r[f]);else{var M=SphericalMercator.unproject((_+(b&1)/2)*l,b*u);a[K]=U={rowCol:[_,b],center:M,coordinates:[r[f]],hx:s(M)},o.push(U)}}return o},DC:function n(r,i){var s,a=[],o=i.radius,l=0,u=o/2,f=Math.sqrt(3)*o,c=Math.sqrt(Math.pow(f,2)+Math.pow(o,2)),h=_slicedToArray(r.hx,2),p=h[0],d=h[1],v=[p,d+c/2-l],g=[p-f/2+l,d+u-l/2],m=[p-f/2+l,d-u+l/2],y=[p,d-c/2+l],b=[p+f/2-l,d-u+l/2],_=[p+f/2-l,d+u-l/2];return(s=a).push.apply(s,[v,g,m,y,b,_,v]),a}},Bin=Object.freeze({__proto__:null,grid:grid,hexagon:hexagon}),geoUtils={ai:function n(r){var i=[];if(r.type==="MultiPoint")for(var s=r.properties,a=r.coordinates,o=a.length,l=0;l<o;++l){var u=a[l];i.push({properties:s,type:"Point",coordinates:u})}else if(r.type==="MultiLineString")for(var f=r.properties,c=r.coordinates,h=c.length,p=0;p<h;++p){var d=c[p];i.push({properties:f,type:"Point",coordinates:d})}else if(r.type==="MultiPolygon")for(var v=r.properties,g=r.coordinates,m=g.length,y=0;y<m;++y){var b=g[y];i.push({properties:v,type:"Point",coordinates:b})}return i}},__defProp$h=Object.defineProperty,__defProps$a=Object.defineProperties,__getOwnPropDescs$a=Object.getOwnPropertyDescriptors,__getOwnPropSymbols$h=Object.getOwnPropertySymbols,__hasOwnProp$h=Object.prototype.hasOwnProperty,__propIsEnum$h=Object.prototype.propertyIsEnumerable,__defNormalProp$h=function(n,r,i){return r in n?__defProp$h(n,r,{Fr:!0,Lr:!0,writable:!0,value:i}):n[r]=i},__spreadValues$h=function(n,r){for(var i in r||(r={}))__hasOwnProp$h.call(r,i)&&__defNormalProp$h(n,i,r[i]);var s=!0,a=!1,o=void 0;if(__getOwnPropSymbols$h)try{for(var l=__getOwnPropSymbols$h(r)[Symbol.iterator](),u;!(s=(u=l.next()).done);s=!0){var i=u.value;__propIsEnum$h.call(r,i)&&__defNormalProp$h(n,i,r[i])}}catch(f){a=!0,o=f}finally{try{!s&&l.return!=null&&l.return()}finally{if(a)throw o}}return n},__spreadProps$a=function(n,r){return __defProps$a(n,__getOwnPropDescs$a(r))},pushArray$e=CommonUtil$1._C,styleConf={grid:grid$1,hexagon:hexagon$1},GridsFusion=function(n){_inherits(i,n);var r=_createSuper(i);function i(){return _classCallCheck(this,i),r.apply(this,arguments)}var s=i.prototype;return s.DC=function(a,o,l){for(var u=arguments.length>3&&arguments[3]!==void 0?arguments[3]:"grid",f,c,h,p,d=[],v=0,g=a.length;v<g;v++)if(!(!a[v].features||!a[v].features.points)){var m=o.unit,y=o.radius,b=o.gap,_=a[v].features.points,C=y,A=b;m==="px"&&(C*=l.projection.getResolution((f=l.loca)==null?void 0:f.map.getZoom()),A*=l.projection.getResolution((c=l.loca)==null?void 0:c.map.getZoom()));for(var I=[],D=[],X=0,W=_.length;X<W;X++){var K=_[X];if(K.type==="MultiPoint"){for(var U=geoUtils.ai(K),M=0,L=U.length;M<L;M++){var P=U[M];D.push({lnglat:P.coordinates,properties:P.properties})}pushArray$e(I,U)}else D.push({lnglat:K.coordinates,properties:K.properties}),I.push(K)}var $=Bin[u].ri(D,C+A,(p=l.loca)==null?void 0:p.customCoords.lngLatToCoord.bind((h=l.loca)==null?void 0:h.customCoords));d.push($)}return d},s.buildStyle=function(a,o){var l=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"grid",u,f=styleConf[l].style,c=[],h=o.value;if(h){for(var p=[1/0,-1/0],d=0,v=a.length;d<v;d++)for(var g=a[d],m=StyleInstance.parse(g,{value:h},{value:f.value}),y=m.attributes.value,b=0,_=g.length;b<_;b++){var C=+y[b];Number.isNaN(C)&&(C=0),g[b].value=C,p[0]=Math.min(C,p[0]),p[1]=Math.max(C,p[1])}for(var A=0,I=a.length;A<I;A++)for(var D=a[A],X=0,W=D.length;X<W;X++)D[X].min=p[0],D[X].max=p[1]}for(var K=0,U=a.length;K<U;K++){for(var M=a[K],L=StyleInstance.parse(M,o,f),P={},$=0,R=M.length;$<R;$++)if(L)for(var T in L.attributes){var w=L.attributes[T];P[T]||(P[T]=[]),((u=w[$])==null?void 0:u.length)>0?pushArray$e(P[T],w[$]):P[T][P[T].length]=w[$]}c.push({attributes:P,uniforms:L.uniforms,si:L.si})}return c},s.fusion=function(a,o,l){var u=arguments.length>3&&arguments[3]!==void 0?arguments[3]:"grid",f;if(!this.regl||!l.loca)return[];var c=l.projection.getResolution((f=l.loca)==null?void 0:f.map.getZoom()),h=[],p=this.DC(a,o,l,u),d=o.unit,v=o.radius,g=o.gap,m=v,y=g;d==="px"&&(m*=c,y*=c);for(var b=this.buildStyle(p,o,u),_=0,C=p.length;_<C;_++){for(var A=p[_],I=b[_],D={index:[],vertex:[],color:[],pickColor:[],normal:[],topOrBottom:[],labels:[]},X=[],W=[],K=[],U=[],M=0,L=A.length;M<L;M++){var P=A[M],$=Bin[u].DC(P,{radius:m,gap:y}),R=l.colorPick.add(P),T=PolygonsFusionInstance.triangles([$],{style:I,index:M,pickColor:R,id:M},{lngLatToCoord:function(E){return E}},!0,l.hasSide,!1),w=D.vertex.length;X.push(w),W.push(w+T.Tw.Pw),K.push(w+T.Tw.top),GeoUtil.mergeTriangles(D,T,4),pushArray$e(D.color,T.color),pushArray$e(D.pickColor,T.pickColor),pushArray$e(D.normal,T.normal),pushArray$e(D.topOrBottom,T.topOrBottom),I.attributes.label[M]&&D.labels.push(__spreadValues$h({position:_toConsumableArray(P.center).concat([I.attributes.altitude[M]+I.attributes.height[M]+I.attributes.labelAltitude[M]])},I.attributes.label[M]))}U[_]=D.vertex.length,h[_]={id:a[_].id,attributes:{color:{buffer:this.regl.buffer(D.color),offset:0,stride:4*4,td:!1,divisor:0},pickColor:{buffer:this.regl.buffer(D.pickColor),offset:0,stride:4*4,td:!1,divisor:0},position:{buffer:this.regl.buffer(D.vertex),offset:0,stride:4*4,td:!1,divisor:0},topOrBottom:{buffer:this.regl.buffer(D.topOrBottom),offset:0,stride:4*1,td:!1,divisor:0},normal:{buffer:this.regl.buffer(D.normal),offset:0,stride:4*3,td:!1,divisor:0},index:this.regl.elements({primitive:"triangles",type:"uint32",data:D.index})},uniforms:{},si:I.si,mf:{Tw:{bottom:X,Pw:W,top:K,jw:U},origin:{position:D.vertex,color:D.color},labels:D.labels}}}return h},s.updateStyle=function(a,o){for(var l=function(c,h){for(var p=a[c],d=o[c].attributes,v=d.altitude,g=d.height,m=d.topColor,y=d.sideBottomColor,b=d.sideTopColor,_=d.label,C=d.labelAltitude,A=p.mf.origin,I=A.position,D=A.color,X=p.mf.Tw,W=X.top,K=X.bottom,U=X.Pw,M=X.jw,L=0,P=0,$=0,R=I.length;$<R;$+=3){var T=$/3*4,w=void 0;$>=M[L]&&L++;var E=L*4;$>=K[P+1]&&P++,$<U[P]?(w=y,I[$+2]=v[L]):$>=U[P]&&$<W[P]?($-U[P])/3%2===0?(I[$+2]=v[L],w=y):(I[$+2]=g[L],w=b):(w=m,I[$+2]=g[L]),D[T]=w[E],D[T+1]=w[E+1],D[T+2]=w[E+2],D[T+3]=w[E+3]}p.attributes.position.buffer({data:I}),p.attributes.color.buffer({data:D}),p.mf.labels=p.mf.labels.map(function(O,k){var F=O.position;return F[2]=g[k]+v[k]+C[k],__spreadProps$a(__spreadValues$h(__spreadValues$h({},O),_[k]),{position:F})})},u=0,f=a.length;u<f;u++)l(u,f)},s.EC=function(){for(var a=arguments.length,o=new Array(a),l=0;l<a;l++)o[l]=arguments[l];throw new Error("Method not implemented.")},s.destroy=function(){this.regl=null},i}(GeometryFusion),__defProp$g=Object.defineProperty,__getOwnPropSymbols$g=Object.getOwnPropertySymbols,__hasOwnProp$g=Object.prototype.hasOwnProperty,__propIsEnum$g=Object.prototype.propertyIsEnumerable,__defNormalProp$g=function(n,r,i){return r in n?__defProp$g(n,r,{Fr:!0,Lr:!0,writable:!0,value:i}):n[r]=i},__spreadValues$g=function(n,r){for(var i in r||(r={}))__hasOwnProp$g.call(r,i)&&__defNormalProp$g(n,i,r[i]);var s=!0,a=!1,o=void 0;if(__getOwnPropSymbols$g)try{for(var l=__getOwnPropSymbols$g(r)[Symbol.iterator](),u;!(s=(u=l.next()).done);s=!0){var i=u.value;__propIsEnum$g.call(r,i)&&__defNormalProp$g(n,i,r[i])}}catch(f){a=!0,o=f}finally{try{!s&&l.return!=null&&l.return()}finally{if(a)throw o}}return n},GridShader={vertex:"\n        precision highp float;\n\n        attribute vec4 position;\n        attribute vec3 normal;\n        attribute vec4 color;\n        attribute float topOrBottom;\n\n        varying vec3 vNormal;\n        varying vec4 vColor;\n        varying vec3 vPosition;\n\n        uniform mat4 mvp;\n        ".concat(ColorGLSL.getColorShader().vertex,"\n        ").concat(RenderUtil.getBezier(),"\n        ").concat(RenderUtil.getScaleType("altitude"),"\n        ").concat(RenderUtil.getScaleType("height"),"\n\n        void main() {\n            float altitudeScale = altitudeScaleValue(position.w);\n            float heightScale = heightScaleValue(position.w);\n            // \u52A8\u753B\n            vec3 realPos = position.xyz;\n            if(topOrBottom == 0.0) {\n                realPos = vec3(position.xy, position.z * altitudeScale);\n            }\n            if(topOrBottom == 1.0) {\n                realPos = vec3(position.xy, position.z * heightScale);\n            }\n            vColor = color;\n            vNormal = normal;\n            vPosition = realPos;\n            gl_Position = mvp * vec4(realPos, 1.0);\n            ").concat(ColorGLSL.getColorShader().mainVert,"\n        } \n    "),fragment:"\n        precision highp float;\n        varying vec4 vColor;\n\n        // \u5982\u679C\u9700\u8981\u5149\u7167\uFF0C\u8FD9\u4E24\u4E2A\u53D8\u91CF\u662F\u5FC5\u987B\u7684\n        varying vec3 vNormal;\n        varying vec3 vPosition;\n\n        uniform float opacity;\n\n        uniform vec3 cameraPosition;\n        uniform float shininess;\n        #include <lightUniforms,lightFunctions>;\n\n        ".concat(ColorGLSL.getColorShader().fragment,"\n\n        void main() {\n            gl_FragColor = vColor;\n            #include <lightMainCompute>;\n            gl_FragColor.a *= opacity;\n            ").concat(ColorGLSL.getColorShader().mainFrag,"\n        }\n    "),includes:__spreadValues$g({},LightIncludes)},__defProp$f=Object.defineProperty,__defProps$9=Object.defineProperties,__getOwnPropDescs$9=Object.getOwnPropertyDescriptors,__getOwnPropSymbols$f=Object.getOwnPropertySymbols,__hasOwnProp$f=Object.prototype.hasOwnProperty,__propIsEnum$f=Object.prototype.propertyIsEnumerable,__defNormalProp$f=function(n,r,i){return r in n?__defProp$f(n,r,{Fr:!0,Lr:!0,writable:!0,value:i}):n[r]=i},__spreadValues$f=function(n,r){for(var i in r||(r={}))__hasOwnProp$f.call(r,i)&&__defNormalProp$f(n,i,r[i]);var s=!0,a=!1,o=void 0;if(__getOwnPropSymbols$f)try{for(var l=__getOwnPropSymbols$f(r)[Symbol.iterator](),u;!(s=(u=l.next()).done);s=!0){var i=u.value;__propIsEnum$f.call(r,i)&&__defNormalProp$f(n,i,r[i])}}catch(f){a=!0,o=f}finally{try{!s&&l.return!=null&&l.return()}finally{if(a)throw o}}return n},__spreadProps$9=function(n,r){return __defProps$9(n,__getOwnPropDescs$9(r))},GridsRender=function(n){_inherits(i,n);var r=_createSuper(i);function i(){_classCallCheck(this,i);var a;return a=r.call.apply(r,[this].concat(Array.prototype.slice.call(arguments))),a.v$=[new LabelsRender$1],a}var s=i.prototype;return s.m$=function(a){if(!this.regl)return!1;this.v$.forEach(function(u){return u.m$(a)});var o=this.regl,l=RenderHelper._A(a,o);this.gA(GridShader,a,{attributes:__spreadValues$f({position:o.prop("position"),color:o.prop("color"),normal:o.prop("normal"),topOrBottom:o.prop("topOrBottom")},ColorGLSL.getColor(o).attribute),uniforms:__spreadValues$f(__spreadValues$f(__spreadValues$f(__spreadValues$f({mvp:o.prop("mvp"),opacity:o.prop("opacity"),shininess:o.prop("shininess"),cameraPosition:o.prop("cameraPosition")},RenderUtil.getScaleUniform("height",o)),RenderUtil.getScaleUniform("altitude",o)),ColorGLSL.getColor(o).uniform),l),blend:{enable:!0,func:RenderUtil.getBlend()},cull:{enable:o.prop("cullEnable"),face:o.prop("cullface")},depth:{enable:o.prop("depth"),func:"lequal"},frontFace:"cw",colorMask:o.prop("colorMask"),elements:o.prop("index")})},s.render=function(a){var o=this.yA(GridShader);if(o){for(var l=a.meshes,u=a.mvp,f=a.depth,c=a.shininess,h=a.acceptLight,p=a.cull,d=a.opacity,v=a.cameraPosition,g=a.lights,m=a.vP,y=p!=="none",b=p==="front"?"front":"back",_=0;_<l.length;_++){var C=l[_],A=C.attributes;o(__spreadValues$f(__spreadProps$9(__spreadValues$f(__spreadValues$f({},A),g),{depth:f,shininess:c,acceptLight:h,cullEnable:y,cullface:b,opacity:d,cameraPosition:v,count:A.index.length,mvp:u,colorMask:[!1,!1,!1,!1],isPick:!1}),RenderUtil.getScaleProps(m)))}for(var I=0;I<l.length;I++){var D=l[I],X=D.attributes;o(__spreadValues$f(__spreadProps$9(__spreadValues$f(__spreadValues$f({},X),g),{depth:f,shininess:c,acceptLight:h,cullEnable:y,cullface:b,opacity:d,cameraPosition:v,count:X.index.length,mvp:u,colorMask:[!0,!0,!0,!0],isPick:!1}),RenderUtil.getScaleProps(m)))}for(var W=0;W<l.length;W++){var K=!0,U=!1,M=void 0;try{for(var L=this.v$[Symbol.iterator](),P;!(K=(P=L.next()).done);K=!0){var $=P.value;$.render(l[W],d)}}catch(R){U=!0,M=R}finally{try{!K&&L.return!=null&&L.return()}finally{if(U)throw M}}}}},s.pickRender=function(a){var o=this.yA(GridShader);if(o){var l=a.meshes,u=a.mvp,f=a.depth,c=a.shininess,h=a.acceptLight,p=a.cull,d=a.opacity,v=a.cameraPosition,g=a.lights,m=a.pickFbo,y=a.vP,b=p!=="none",_=p==="front"?"front":"back";if(m){var C=this;m.use(function(){C.regl.clear({color:[0,0,0,0],depth:1});for(var A=0;A<l.length;A++){var I=l[A],D=I.attributes;o(__spreadValues$f(__spreadProps$9(__spreadValues$f(__spreadValues$f({},D),g),{depth:f,shininess:c,acceptLight:h,cullEnable:b,cullface:_,opacity:d,cameraPosition:v,count:D.index.length,mvp:u,colorMask:[!0,!0,!0,!0],isPick:!0}),RenderUtil.getScaleProps(y)))}})}}},i}(Render),pushArray$d=CommonUtil$1._C,GridLayer=function(n){_inherits(i,n);var r=_createSuper(i);function i(a){_classCallCheck(this,i);var o;o=r.call(this,a),o.CLASS_NAME="Grid",o.fusion=new GridsFusion,o.ll=new GridsRender;var l=grid$1.Sw;return o.zooms=a.zooms===void 0?l.zooms:a.zooms,o.visible=a.visible===void 0?l.visible:a.visible,o.zIndex=a.zIndex===void 0?l.zIndex:a.zIndex,o.opacity=a.opacity===void 0?l.opacity:a.opacity,o.shininess=a.shininess===void 0?l.shininess:a.shininess,o.acceptLight=a.acceptLight===void 0?l.acceptLight:a.acceptLight,o.cullface=a.cullface||l.cullface,o.hasSide=a.hasSide===void 0?l.hasSide:a.hasSide,o.depth=a.depth===void 0?l.depth:a.depth,o.AC({zooms:o.zooms,visible:o.visible,zIndex:o.zIndex}),o.buryPoint.record(o.CLASS_NAME),o}var s=i.prototype;return s.getLabelsLayer=function(){return this.ll.v$[0]._$||null},s.receiveDataset=function(a){this.dataset=a,this.setStyle(this.styleOptions),this.onAdd()},s.setStyle=function(a){if(a.unit=a.unit||"meter",_get(_getPrototypeOf(i.prototype),"setStyle",this).call(this,a),this.dataset=this.source.LC(),this.colorPick.clear(),this.dataset&&this.dataset.length>0&&this.meshes){var o=this.WC(),l=o.didFusionDataset,u=this.fusion.fusion(l,this.styleOptions,this);this.meshes=u,this.vA.state|=MeshesDirty,this.loca&&this.loca.requestRender()}},s.getInitialAnimateState=function(){return{altitude:{time:[1,0,0,0],type:[-1,1,0,0],value:[0,1]},height:{time:[1,0,0,0],type:[-1,1,0,0],value:[0,1]}}},s.jC=function(){_get(_getPrototypeOf(i.prototype),"jC",this).call(this),!(!this.loca||!this.loca.regl||this.ll.regl)&&(this.ll.regl=this.loca.regl,this.loca.rendererManager.addRenderer(this.ll))},s.beforeRender=function(){if(_get(_getPrototypeOf(i.prototype),"beforeRender",this).call(this),!this.fusion.regl&&this.loca&&(this.fusion.regl=this.loca.regl,this.loca.fusionManager.addFusion(this.fusion)),this.jC(),this.source&&(this.dataset=this.source.LC()),this.fusion){var a=this.WC(),o=a.willFusion;if(o.length>0){var l=this.fusion.fusion(o,this.styleOptions,this);this.meshes=pushArray$d(this.meshes,l),this.vA.state|=MeshesDirty}}},s.render=function(){var a;if(!!this.loca&&!!this.PA()){this.loca.regl._refresh();var o=(a=this.loca)==null?void 0:a.customCoords.getMVPMatrix(),l=RenderHelper.IA(this.loca.lights);if(this.ll&&this.meshes.length>0)return this.ll.render({meshes:this.meshes,mvp:o,lights:l,cameraPosition:this.loca.customCoords.getCameraParams().position,shininess:this.shininess,acceptLight:this.acceptLight,opacity:this._getOpacity(),depth:this.depth,cull:this.cullface,vP:this._animateLayerState}),!0}},s.pickRender=function(){var a;if(!!this.loca&&!!this.PA()){this.loca.regl._refresh();var o=(a=this.loca)==null?void 0:a.customCoords.getMVPMatrix(),l=RenderHelper.IA(this.loca.lights);this.ll&&this.ll.pickRender({meshes:this.meshes,mvp:o,lights:l,cameraPosition:this.loca.customCoords.getCameraParams().position,shininess:this.shininess,acceptLight:this.acceptLight,opacity:this._getOpacity(),depth:this.depth,cull:this.cullface,pickFbo:this._needPickFrame&&this._pickFbo,pickPos:this._pickPos,vP:this._animateLayerState})}},s.afterRender=function(){},s.PA=function(){return RenderHelper.SA(this.ll,this)},i}(Layer),pushArray$c=CommonUtil$1._C,HexagonLayer=function(n){_inherits(i,n);var r=_createSuper(i);function i(a){_classCallCheck(this,i);var o;o=r.call(this,a),o.CLASS_NAME="Hexagon",o.fusion=new GridsFusion,o.ll=new GridsRender;var l=hexagon$1.Sw;return o.zooms=a.zooms===void 0?l.zooms:a.zooms,o.zIndex=a.zIndex===void 0?l.zIndex:a.zIndex,o.opacity=a.opacity===void 0?l.opacity:a.opacity,o.visible=a.visible===void 0?l.visible:a.visible,o.shininess=a.shininess===void 0?l.shininess:a.shininess,o.acceptLight=a.acceptLight===void 0?l.acceptLight:a.acceptLight,o.cullface=a.cullface||l.cullface,o.hasSide=a.hasSide===void 0?l.hasSide:a.hasSide,o.depth=a.depth===void 0?l.depth:a.depth,o.AC({zooms:o.zooms,visible:o.visible,zIndex:o.zIndex}),o.buryPoint.record(o.CLASS_NAME),o}var s=i.prototype;return s.getLabelsLayer=function(){return this.ll.v$[0]._$||null},s.receiveDataset=function(a){this.dataset=a,this.setStyle(this.styleOptions),this.onAdd()},s.setStyle=function(a){if(a.unit=a.unit||"meter",_get(_getPrototypeOf(i.prototype),"setStyle",this).call(this,a),this.dataset=this.source.LC(),this.colorPick.clear(),this.dataset&&this.dataset.length>0&&this.meshes){var o=this.WC(),l=o.didFusionDataset,u=this.fusion.fusion(l,this.styleOptions,this,"hexagon");this.meshes=u,this.vA.state|=MeshesDirty,this.loca&&this.loca.requestRender()}},s.getInitialAnimateState=function(){return{altitude:{time:[1,0,0,0],type:[-1,1,0,0],value:[0,1]},height:{time:[1,0,0,0],type:[-1,1,0,0],value:[0,1]}}},s.jC=function(){_get(_getPrototypeOf(i.prototype),"jC",this).call(this),!(!this.loca||!this.loca.regl||this.ll.regl)&&(this.ll.regl=this.loca.regl,this.loca.rendererManager.addRenderer(this.ll))},s.beforeRender=function(){if(_get(_getPrototypeOf(i.prototype),"beforeRender",this).call(this),!this.fusion.regl&&this.loca&&(this.fusion.regl=this.loca.regl,this.loca.fusionManager.addFusion(this.fusion)),this.jC(),this.source&&(this.dataset=this.source.LC()),this.fusion){var a=this.WC(),o=a.willFusion;if(o.length>0){var l=this.fusion.fusion(o,this.styleOptions,this,"hexagon");this.meshes=pushArray$c(this.meshes,l),this.vA.state|=MeshesDirty}}},s.render=function(){var a;if(!!this.loca&&!!this.PA()){this.loca.regl._refresh();var o=(a=this.loca)==null?void 0:a.customCoords.getMVPMatrix(),l=RenderHelper.IA(this.loca.lights);if(this.ll&&this.meshes.length>0)return this.ll.render({meshes:this.meshes,mvp:o,lights:l,cameraPosition:this.loca.customCoords.getCameraParams().position,shininess:this.shininess,acceptLight:this.acceptLight,opacity:this._getOpacity(),depth:this.depth,cull:this.cullface,vP:this._animateLayerState}),!0}},s.pickRender=function(){var a;if(!!this.loca&&!!this.PA()){this.loca.regl._refresh();var o=(a=this.loca)==null?void 0:a.customCoords.getMVPMatrix(),l=RenderHelper.IA(this.loca.lights);this.ll&&this.ll.pickRender({meshes:this.meshes,mvp:o,lights:l,cameraPosition:this.loca.customCoords.getCameraParams().position,shininess:this.shininess,acceptLight:this.acceptLight,opacity:this._getOpacity(),depth:this.depth,cull:this.cullface,pickFbo:this._needPickFrame&&this._pickFbo,pickPos:this._pickPos,vP:this._animateLayerState})}},s.afterRender=function(){},s.PA=function(){return RenderHelper.SA(this.ll,this)},i}(Layer),__defProp$e=Object.defineProperty,__getOwnPropSymbols$e=Object.getOwnPropertySymbols,__hasOwnProp$e=Object.prototype.hasOwnProperty,__propIsEnum$e=Object.prototype.propertyIsEnumerable,__defNormalProp$e=function(n,r,i){return r in n?__defProp$e(n,r,{Fr:!0,Lr:!0,writable:!0,value:i}):n[r]=i},__spreadValues$e=function(n,r){for(var i in r||(r={}))__hasOwnProp$e.call(r,i)&&__defNormalProp$e(n,i,r[i]);var s=!0,a=!1,o=void 0;if(__getOwnPropSymbols$e)try{for(var l=__getOwnPropSymbols$e(r)[Symbol.iterator](),u;!(s=(u=l.next()).done);s=!0){var i=u.value;__propIsEnum$e.call(r,i)&&__defNormalProp$e(n,i,r[i])}}catch(f){a=!0,o=f}finally{try{!s&&l.return!=null&&l.return()}finally{if(a)throw o}}return n},pushArray$b=CommonUtil$1._C,_PointFusion=function(n){_inherits(i,n);var r=_createSuper(i);function i(){return _classCallCheck(this,i),r.apply(this,arguments)}var s=i.prototype;return s.buildStyle=function(a,o){for(var l=point.style,u=[],f=0;f<a.length;f++)if(!(!a[f].features||!a[f].features.points)){var c=a[f].features.points,h=StyleInstance.parse(c,o,l);u.push(h)}return u},s.DC=function(){},s.fusion=function(a,o,l,u){if(!this.regl||!l.loca)return[];u=u||this.buildStyle(a,o);for(var f=l.loca.customCoords.lngLatToCoord.bind(l.loca.customCoords),c=[],h=0,p=a.length;h<p;h++){var d=a[h];if(!(!d.features||!d.features.points||!u[h])){for(var v=u[h].attributes,g=d.features.points,m={vertex:[],color:[],radius:[],blurWidth:[],borderColor:[],borderWidth:[],pickColor:[],labels:[]},y=0;y<g.length;y++){var b=g[y],_=b.coordinates,C=l.colorPick.add(b);if(b.type==="MultiPoint")for(var A=0,I=_.length;A<I;A++){var D=_[A],X=f(D);pushArray$b(m.vertex,[X[0],X[1],b.sr]),pushArray$b(m.color,v.color[y]),pushArray$b(m.borderColor,v.borderColor[y]),pushArray$b(m.pickColor,C),m.radius.push(v.radius[y]),m.blurWidth.push(v.blurWidth[y]),m.borderWidth.push(v.borderWidth[y]),v.label[y]&&m.labels.push(__spreadValues$e({position:D},v.label[y]))}else{var W=f(_);pushArray$b(m.vertex,[W[0],W[1],b.sr]),pushArray$b(m.color,v.color[y]),pushArray$b(m.borderColor,v.borderColor[y]),pushArray$b(m.pickColor,C),m.radius.push(v.radius[y]),m.blurWidth.push(v.blurWidth[y]),m.borderWidth.push(v.borderWidth[y]),v.label[y]&&m.labels.push(__spreadValues$e({position:_},v.label[y]))}}c[h]={status:"buffered",id:d.id,attributes:{position:{buffer:this.regl.buffer(m.vertex),offset:0,stride:4*3,td:!1,divisor:0},radius:{buffer:this.regl.buffer(m.radius),offset:0,stride:4*1,td:!1,divisor:0},color:{buffer:this.regl.buffer(m.color),offset:0,stride:4*4,td:!1,divisor:0},borderWidth:{buffer:this.regl.buffer(m.borderWidth),offset:0,stride:4*1,td:!1,divisor:0},borderColor:{buffer:this.regl.buffer(m.borderColor),offset:0,stride:4*4,td:!1,divisor:0},blurWidth:{buffer:this.regl.buffer(m.blurWidth),offset:0,stride:4*1,td:!1,divisor:0},pickColor:{buffer:this.regl.buffer(m.pickColor),offset:0,stride:4*4,td:!1,divisor:0}},uniforms:u[h].uniforms,si:u[h].si,mf:{count:m.radius.length,labels:m.labels}}}}return c},s.EC=function(){return[]},s.destroy=function(){this.regl=null},i.getInstance=function(){return this.ui},i}(GeometryFusion),PointFusion=_PointFusion;PointFusion.ui=new _PointFusion,PointFusion.getInstance();var PointShader={point:{vertex:"\n            precision highp float;\n\n            uniform mat4 mvp;\n            uniform float resolution;\n            // unit: px=0, meter=1\n            uniform float unit;\n            uniform float ratio;\n\n            attribute vec3 position;\n            attribute float radius;\n            attribute vec4 color;\n            attribute float borderWidth;\n            attribute vec4 borderColor;\n            attribute float blurWidth;\n\n            varying float vRadius;\n            varying vec4 vColor;\n            varying float vBorderWidth;\n            varying vec4 vBorderColor;\n            varying float vBlurRadius;\n            ".concat(ColorGLSL.getColorShader().vertex,"\n            ").concat(RenderUtil.getBezier(),"\n            ").concat(RenderUtil.getScaleType("radius"),"\n\n            void main() {\n                float radiusScale = radiusScaleValue(position.z);\n                float res = (unit == 1.0 ? resolution : 1.0) / ratio;\n                gl_Position = mvp * vec4(position.xy, 0, 1);\n                vRadius = radius / res * radiusScale;\n                vColor = color;\n                vBorderWidth = borderWidth / res * radiusScale;\n                vBorderColor = borderColor;\n                vBlurRadius = blurWidth / res * radiusScale;\n                gl_PointSize = (vRadius + vBorderWidth) * 2.0 * radiusScale;\n                ").concat(ColorGLSL.getColorShader().mainVert,"\n            }\n        "),fragment:"\n            precision highp float;\n            uniform float layerOpacity;\n            \n            varying float vRadius;\n            varying vec4 vColor;\n            varying float vBorderWidth;\n            varying vec4 vBorderColor;\n            varying float vBlurRadius;\n            ".concat(ColorGLSL.getColorShader().fragment,"\n\n            void main() {\n                gl_FragColor = vColor;\n                // \u6297\u952F\u9F7F\u50CF\u7D20\u4F4D\n                float realRadius = vRadius + vBorderWidth;\n                float len = distance(gl_PointCoord, vec2(0.5, 0.5)) * 2.0 * realRadius;\n                float taaRadius = 2.0;\n                if(len > realRadius) {\n                    discard;\n                } else if(len > realRadius - taaRadius) {\n                    gl_FragColor = vBorderWidth > 0.0 ? vBorderColor : vColor;\n                    float opa = smoothstep(1.0, 0.0, (len - (realRadius - taaRadius)) / taaRadius);\n                    gl_FragColor.a *= opa;\n                } else if(vBorderWidth > 0.0 && len > vRadius + taaRadius) {\n                    gl_FragColor = vBorderColor;\n                } else if(vBorderWidth > 0.0 && len > vRadius) {\n                    float blend = smoothstep(0.0, 1.0, (len - vRadius / taaRadius) / taaRadius);\n                    gl_FragColor = mix(vColor, vBorderColor, blend);\n                }\n                // float opacity_t = 1. - smoothstep(u_range[1] - 1. / u_radius, u_range[1], offset);\n\n                if(vBlurRadius >= 0.0 && len > (realRadius - vBlurRadius)) {\n                    gl_FragColor.a = smoothstep(1.0, 0.0, (len - (realRadius - vBlurRadius)) / vBlurRadius);\n                }\n                // gl_FragColor.a *= layerOpacity;\n\n                ").concat(ColorGLSL.getColorShader().mainFrag,"\n            }\n        ")},mx:{vertex:"\n            precision highp float;\n\n            attribute float position;\n            varying vec2 vUv;\n\n            struct UvPos {\n                vec2 uv;\n                vec2 pos;\n            };\n\n            // \u83B7\u53D6\u5750\u6807\n            UvPos getPos(float type) {\n                UvPos result;\n                vec2 uv = vec2(1);\n                vec2 pos = vec2(1);\n                if(type == 0.0) {\n                    uv = vec2(0, 0);\n                    pos = vec2(-1, -1);\n                } else if(type == 1.0) {\n                    uv = vec2(0, 1);\n                    pos = vec2(-1, 1);\n                } else if(type == 2.0) {\n                    uv = vec2(1, 0);\n                    pos = vec2(1, -1);\n                }\n                result.uv = uv;\n                result.pos = pos;\n                return result;\n            }\n\n            void main() {\n                UvPos res = getPos(position);\n                gl_Position = vec4(res.pos, 0, 1);\n                vUv = res.uv;\n            }\n        ",fragment:"\n            precision highp float;\n\n            varying vec2 vUv;\n\n            uniform float layerOpacity;\n            uniform sampler2D texture;\n\n            void main() {\n                gl_FragColor = texture2D(texture, vUv);\n                gl_FragColor.a *= layerOpacity;\n            }\n        "}},__defProp$d=Object.defineProperty,__defProps$8=Object.defineProperties,__getOwnPropDescs$8=Object.getOwnPropertyDescriptors,__getOwnPropSymbols$d=Object.getOwnPropertySymbols,__hasOwnProp$d=Object.prototype.hasOwnProperty,__propIsEnum$d=Object.prototype.propertyIsEnumerable,__defNormalProp$d=function(n,r,i){return r in n?__defProp$d(n,r,{Fr:!0,Lr:!0,writable:!0,value:i}):n[r]=i},__spreadValues$d=function(n,r){for(var i in r||(r={}))__hasOwnProp$d.call(r,i)&&__defNormalProp$d(n,i,r[i]);var s=!0,a=!1,o=void 0;if(__getOwnPropSymbols$d)try{for(var l=__getOwnPropSymbols$d(r)[Symbol.iterator](),u;!(s=(u=l.next()).done);s=!0){var i=u.value;__propIsEnum$d.call(r,i)&&__defNormalProp$d(n,i,r[i])}}catch(f){a=!0,o=f}finally{try{!s&&l.return!=null&&l.return()}finally{if(a)throw o}}return n},__spreadProps$8=function(n,r){return __defProps$8(n,__getOwnPropDescs$8(r))},PointRender=function(n){_inherits(i,n);var r=_createSuper(i);function i(){_classCallCheck(this,i);var a;return a=r.call.apply(r,[this].concat(Array.prototype.slice.call(arguments))),a.v$=[new LabelsRender$1],a}var s=i.prototype;return s.m$=function(a){if(!this.regl)return!1;this.v$.forEach(function(l){return l.m$(a)});var o=this.regl;this.bx=o.framebuffer({width:o._gl.drawingBufferWidth,height:o._gl.drawingBufferHeight,stencil:!1,depth:!1,Zh:!1}),this.gA(PointShader.point,a,{attributes:__spreadValues$d({position:o.prop("position"),radius:o.prop("radius"),color:o.prop("color"),borderWidth:o.prop("borderWidth"),borderColor:o.prop("borderColor"),blurWidth:o.prop("blurWidth")},ColorGLSL.getColor(o).attribute),primitive:"points",uniforms:__spreadValues$d(__spreadValues$d({mvp:o.prop("mvp"),resolution:o.prop("resolution"),unit:o.prop("unit"),ratio:window.AMap.Browser.retina?2:1},RenderUtil.getScaleUniform("radius",o)),ColorGLSL.getColor(o).uniform),depth:{enable:!1},blend:{enable:!0,func:o.prop("blend")},count:o.prop("count")}),this.gA(PointShader.mx,a,{attributes:{position:[0,1,2,3]},uniforms:{texture:o.prop("texture"),layerOpacity:o.prop("layerOpacity")},depth:{enable:!1},blend:{enable:!0,func:o.prop("blend")},elements:[0,1,2,1,3,2],count:6})},s.render=function(a){var o=this,l=function(X){var W=o,K=c[X],U=K.attributes,M=K.uniforms,L=K.mf,P=L.count;o.bx.use(function(){W.regl.clear({color:[0,0,0,0],depth:1}),u(__spreadValues$d(__spreadProps$8(__spreadValues$d({},U),{unit:M.unit==="px"?0:1,count:P,resolution:v,layerOpacity:p,mvp:h,blend:RenderUtil.getBlend(d),isPick:!1}),RenderUtil.getScaleProps(g)))}),f(__spreadProps$8(__spreadValues$d({},U),{texture:o.bx,layerOpacity:p,blend:RenderUtil.getBlend("normal")}))},u=this.yA(PointShader.point),f=this.yA(PointShader.mx);if(!(!u||!f)){var c=a.meshes,h=a.mvp,p=a.opacity,d=a.blend,v=a.resolution,g=a.vP;if(!(c.length<1)){(this.bx.width!==this.regl._gl.drawingBufferWidth||this.bx.height!==this.regl._gl.drawingBufferHeight)&&this.bx({width:this.regl._gl.drawingBufferWidth,height:this.regl._gl.drawingBufferHeight});for(var m=0;m<c.length;m++)l(m);for(var y=0;y<c.length;y++){var b=!0,_=!1,C=void 0;try{for(var A=this.v$[Symbol.iterator](),I;!(b=(I=A.next()).done);b=!0){var D=I.value;D.render(c[y],p)}}catch(X){_=!0,C=X}finally{try{!b&&A.return!=null&&A.return()}finally{if(_)throw C}}}}}},s.pickRender=function(a){var o=this.yA(PointShader.point),l=this.yA(PointShader.mx);if(!(!o||!l)){var u=a.meshes,f=a.mvp,c=a.opacity,h=a.resolution,p=a.pickFbo,d=a.pickPos,v=a.vP;if(!(u.length<1)&&(this.regl._refresh(),p&&d)){var g=this;p.use(function(){g.regl.clear({color:[0,0,0,0]});for(var m=0;m<u.length;m++){var y=u[m],b=y.attributes,_=y.uniforms,C=y.mf,A=C.count;o(__spreadValues$d(__spreadProps$8(__spreadValues$d({},b),{unit:_.unit==="px"?0:1,count:A,resolution:h,layerOpacity:c,mvp:f,blend:RenderUtil.getBlend("normal"),isPick:!0}),RenderUtil.getScaleProps(v)))}})}}},s.destroy=function(){_get(_getPrototypeOf(i.prototype),"destroy",this).call(this),this.bx&&this.bx.destroy()},i}(Render),pushArray$a=CommonUtil$1._C,PointLayer=function(n){_inherits(i,n);var r=_createSuper(i);function i(a){_classCallCheck(this,i);var o;o=r.call(this,a),o.CLASS_NAME="Point",o.fusion=new PointFusion,o.ll=new PointRender;var l=point.Sw;return o.zooms=a.zooms===void 0?l.zooms:a.zooms,o.visible=a.visible===void 0?l.visible:a.visible,o.zIndex=a.zIndex===void 0?l.zIndex:a.zIndex,o.opacity=a.opacity===void 0?l.opacity:a.opacity,o.blend=a.blend===void 0?l.blend:a.blend,o.AC({zooms:o.zooms,visible:o.visible,zIndex:o.zIndex}),o.buryPoint.record(o.CLASS_NAME),o}var s=i.prototype;return s.getLabelsLayer=function(){return this.ll.v$[0]._$||null},s.setStyle=function(a){if(_get(_getPrototypeOf(i.prototype),"setStyle",this).call(this,a),this.dataset=this.source.LC(),this.colorPick.clear(),this.dataset&&this.dataset.length>0){var o=this.WC(),l=o.didFusionDataset,u=this.fusion.fusion(l,this.styleOptions,this);this.meshes=u,this.vA.state|=MeshesDirty,this.loca&&this.loca.requestRender()}},s.getInitialAnimateState=function(){return{radius:{time:[1,0,0,0],type:[-1,1,0,0],value:[0,1]}}},s.receiveDataset=function(a){this.dataset=a,this.setStyle(this.styleOptions),this.onAdd()},s.jC=function(){_get(_getPrototypeOf(i.prototype),"jC",this).call(this),!(!this.loca||!this.loca.regl||this.ll.regl)&&(this.ll.regl=this.loca.regl,this.loca.rendererManager.addRenderer(this.ll))},s.beforeRender=function(){if(_get(_getPrototypeOf(i.prototype),"beforeRender",this).call(this),!this.fusion.regl&&this.loca&&(this.fusion.regl=this.loca.regl,this.loca.fusionManager.addFusion(this.fusion)),this.jC(),this.source&&(this.dataset=this.source.LC()),this.fusion){var a=this.WC(),o=a.willFusion;if(o.length>0){var l=this.fusion.fusion(o,this.styleOptions,this);this.meshes=pushArray$a(this.meshes,l),this.vA.state|=MeshesDirty}}},s.render=function(){var a,o;if(!!this.loca&&!!this.PA()){this.loca.regl._refresh();var l=(a=this.loca)==null?void 0:a.customCoords.getMVPMatrix(),u=this.projection.getResolution((o=this.loca)==null?void 0:o.map.getZoom());if(this.ll&&this.meshes.length)return this.ll.render({meshes:this.meshes,mvp:l,resolution:u,opacity:this._getOpacity(),blend:this.blend,vP:this._animateLayerState}),!0}},s.pickRender=function(){var a,o;if(!!this.loca&&!!this.PA()){this.loca.regl._refresh();var l=this.projection.getResolution((a=this.loca)==null?void 0:a.map.getZoom()),u=(o=this.loca)==null?void 0:o.customCoords.getMVPMatrix();this.ll&&this.meshes.length>0&&this.ll.pickRender({meshes:this.meshes,resolution:l,opacity:this._getOpacity(),pickFbo:this._needPickFrame&&this._pickFbo,pickPos:this._pickPos,mvp:u,vP:this._animateLayerState})}},s.afterRender=function(){},s.destroy=function(){_get(_getPrototypeOf(i.prototype),"destroy",this).call(this)},s.PA=function(){return RenderHelper.SA(this.ll,this)},i}(Layer),__defProp$c=Object.defineProperty,__getOwnPropSymbols$c=Object.getOwnPropertySymbols,__hasOwnProp$c=Object.prototype.hasOwnProperty,__propIsEnum$c=Object.prototype.propertyIsEnumerable,__defNormalProp$c=function(n,r,i){return r in n?__defProp$c(n,r,{Fr:!0,Lr:!0,writable:!0,value:i}):n[r]=i},__spreadValues$c=function(n,r){for(var i in r||(r={}))__hasOwnProp$c.call(r,i)&&__defNormalProp$c(n,i,r[i]);var s=!0,a=!1,o=void 0;if(__getOwnPropSymbols$c)try{for(var l=__getOwnPropSymbols$c(r)[Symbol.iterator](),u;!(s=(u=l.next()).done);s=!0){var i=u.value;__propIsEnum$c.call(r,i)&&__defNormalProp$c(n,i,r[i])}}catch(f){a=!0,o=f}finally{try{!s&&l.return!=null&&l.return()}finally{if(a)throw o}}return n},pushArray$9=CommonUtil$1._C,_IconFusion=function(n){_inherits(i,n);var r=_createSuper(i);function i(){_classCallCheck(this,i);var a;return a=r.call.apply(r,[this].concat(Array.prototype.slice.call(arguments))),a.kx={},a}var s=i.prototype;return s.buildStyle=function(a,o){for(var l,u=icon.style,f=[],c=0;c<a.length;c++)if(!(!a[c].features||!a[c].features.points)){for(var h=a[c].features.points,p=StyleInstance.parse(h,o,u),d={},v=0;v<h.length;v++)if(p)for(var g in p.attributes){var m=p.attributes[g];d[g]||(d[g]=[]),typeof m[v]=="string"?pushArray$9(d[g],[m[v]]):((l=m[v])==null?void 0:l.length)>0?pushArray$9(d[g],m[v]):d[g][d[g].length]=m[v]}f.push({attributes:d,uniforms:p.uniforms,si:p.si})}return f},s.DC=function(){},s.fusion=function(a,o,l,u){return!this.regl||!l.loca?[]:(u=u||this.buildStyle(a,o),o&&a&&a.length?this.Cx({dataset:a,styleOptions:o,Sw:l,Ax:u}):[])},s.Ox=function(a,o){var l=o.zx(),u=l._x,f=l.Sx,c=null,h=a;if(f.has(h))c=f.get(h);else{if(_instanceof(a,SVGSVGElement)){var p=new XMLSerializer;h=p.serializeToString(a)}else _instanceof(a,Image)?h=a.src:typeof a=="string"&&(h=a);f.has(h)?c=f.get(h):(u.push(a),c=u.length-1,f.set(h,c))}return c},s.Cx=function(a){for(var o=a.dataset,l=a.Ax,u=a.Sw,f=this,c,h=[],p=(c=u==null?void 0:u.loca)==null?void 0:c.customCoords,d=function(W){var K=W.mesh,U=W.style,M=W.lnglat,L=W.pickColor,P=W.id,$=p.lngLatToCoord(M);pushArray$9(K.position,[$[0],$[1],P]),pushArray$9(K.iconSize,U.iconSize),pushArray$9(K.offset,U.offset);var R=U.rotation/180*Math.PI;pushArray$9(K.rotation,[R]),pushArray$9(K.opacity,[U.opacity]);var T=f.Ox(U.icon,u);pushArray$9(K.iconIndex,[T]),pushArray$9(K.pickColor,L),U.label&&K.labels.push(__spreadValues$c({position:M},U.label))},v=0;v<o.length;v++){var g=o[v];if(!(!g.features||!g.features.points)){for(var m=g.features.points,y=l[v],b={position:[],iconIndex:[],iconSize:[],offset:[],rotation:[],opacity:[],pickColor:[],labels:[]},_=0;_<m.length;_++){var C=m[_],A=C==null?void 0:C.coordinates,I=u.colorPick.add(C),D={icon:y.attributes.icon[_],iconSize:y.attributes.iconSize.slice(_*2,_*2+2),rotation:y.attributes.rotation[_],opacity:y.attributes.opacity[_],offset:y.attributes.offset.slice(_*2,_*2+2),label:y.attributes.label[_]};if(A&&A.length)if(C.type=="MultiPoint")for(var X=0;X<A.length;X++)d({mesh:b,style:D,lnglat:A[X],pickColor:I,id:C.sr});else d({mesh:b,style:D,lnglat:A,pickColor:I,id:C.sr})}h[v]={id:g.id,attributes:{position:{buffer:this.regl.buffer(b.position),offset:0,stride:4*3,td:!1,divisor:0},iconIndex:{buffer:this.regl.buffer(b.iconIndex),offset:0,stride:4*1,td:!1,divisor:0},iconSize:{buffer:this.regl.buffer(b.iconSize),offset:0,stride:4*2,td:!1,divisor:0},offset:{buffer:this.regl.buffer(b.offset),offset:0,stride:4*2,td:!1,divisor:0},rotation:{buffer:this.regl.buffer(b.rotation),offset:0,stride:4*1,td:!1,divisor:0},opacity:{buffer:this.regl.buffer(b.opacity),offset:0,stride:4*1,td:!1,divisor:0},pickColor:{buffer:this.regl.buffer(b.pickColor),offset:0,stride:4*4,td:!1,divisor:0}},uniforms:y.uniforms,si:y.si,mf:{count:b.position.length/3,labels:b.labels}}}}return h},s.EC=function(){return[]},s.destroy=function(){this.regl=null},i.getInstance=function(){return this.ui},i}(GeometryFusion),IconFusion=_IconFusion;IconFusion.ui=new _IconFusion,IconFusion.getInstance();var IconShader={vertex:"\n        precision highp float;\n\n        uniform mat4 mvp;\n        uniform float iconCount;\n        uniform float resolution;\n        // unit: px=0, meter=1\n        uniform float unit;\n        uniform float ratio;\n\n        attribute vec3 position;\n        attribute vec2 iconSize;\n        attribute vec2 offset;\n        attribute float rotation;\n        attribute float opacity;\n        attribute float iconIndex;\n\n        varying vec2 v_size;\n        varying float v_rotation;\n        varying float v_opacity;\n        varying vec2 v_texture_coord;\n        ".concat(ColorGLSL.getColorShader().vertex,"\n        ").concat(RenderUtil.getBezier(),"\n        ").concat(RenderUtil.getScaleType("iconSize"),"\n        ").concat(RenderUtil.getScaleType("offset"),"\n\n        void main() {\n            float res = unit == 1.0 ? 1.0 : resolution;\n\n            gl_Position = mvp * vec4(position.xy + offset * res * offsetScaleValue(position.z), 0, 1);\n            v_texture_coord = vec2(1.0 / iconCount * iconIndex, 0.0);\n\n            // \u8BA1\u7B97 xy \u7684\u76F8\u5BF9\u503C\n            res = unit == 1.0 ? resolution : 1.0;\n            v_size = iconSize.xy / res * ratio * iconSizeScaleValue(position.z);\n            float dist = sqrt(v_size.x * v_size.x + v_size.y * v_size.y);\n            // v_size.x = v_size.x / dist * v_size.x;\n            // v_size.y = v_size.y / dist * v_size.y;\n\n            v_rotation = rotation;\n            v_opacity = opacity;\n            gl_PointSize = dist;\n            ").concat(ColorGLSL.getColorShader().mainVert,"\n        }\n    "),fragment:"\n        precision highp float;\n        uniform sampler2D texture;\n        // uniform float resolution;\n        uniform float layerOpacity;\n        uniform float iconCount;\n\n        varying vec2 v_size;\n        varying float v_rotation;\n        varying float v_opacity;\n        varying vec2 v_texture_coord;\n        ".concat(ColorGLSL.getColorShader().fragment,"\n\n        vec2 rotateUV(vec2 uv, float arc, vec2 mid){\n            mat2 rotn =  mat2(cos(arc), sin(arc),\n                             -sin(arc), cos(arc));\n            return rotn * (uv - mid) + mid;\n        }\n\n        void main() {\n            vec2 txture_partial_size = vec2(1.0 / iconCount, 1);\n            gl_FragColor = vec4(0,0,0,1.0);\n\n            float maxSize = sqrt(v_size.x * v_size.x + v_size.y * v_size.y);\n\n            // \u65CB\u8F6C\uFF1A\u65CB\u8F6C\u5FC5\u987B\u5728\u653E\u7F29\u4E4B\u524D\n            vec2 uv = rotateUV(gl_PointCoord.xy, -v_rotation, vec2(0.5,0.5));\n\n            // \u653E\u7F29\uFF1A\u5750\u6807\u7A7A\u95F4\u653E\u5927\uFF0C\u4F7F\u539F\u672C\u7684[0, 1]\u53D8\u4E3A[0, 1*scale]\n            uv = vec2(\n                uv.x / v_size.x * maxSize,\n                uv.y / v_size.y * maxSize\n            );\n\n            // \u4FEE\u6B63\uFF1A\u4F7F[0, 1*scale]\u53D8\u4E3A[-1*scale/2, 0) [0, 1] (1, 1*scale/2]\u7684\u90E8\u5206\u6765\u753B\u56FE\u5F62\uFF0C\u4E24\u4FA7\u5176\u4F59\u90E8\u5206\u753B\u7A7A\u767D\n            uv = vec2(\n                uv.x - ((maxSize/v_size.x - 1.0) / 2.0),\n                uv.y - ((maxSize/v_size.y - 1.0) / 2.0)\n            );\n\n            float flag1 = step(float(uv.x), 0.0);\n            float flag2 = step(1.0, float(uv.x));\n            float flag3 = step(1.0, float(uv.y));\n            float flag4 = step(float(uv.y), 0.0);\n            float invalid = flag1 + flag2 + flag3 + flag4;\n            vec2 _uv = txture_partial_size * uv;\n            vec2 coord = v_texture_coord + _uv;\n            vec4 t_clr = texture2D(texture, coord);\n            gl_FragColor = (1.0 - invalid) * t_clr;\n            gl_FragColor.a *= v_opacity * layerOpacity;\n            ").concat(ColorGLSL.getColorShader().mainFrag,"\n        }\n    ")},__defProp$b=Object.defineProperty,__defProps$7=Object.defineProperties,__getOwnPropDescs$7=Object.getOwnPropertyDescriptors,__getOwnPropSymbols$b=Object.getOwnPropertySymbols,__hasOwnProp$b=Object.prototype.hasOwnProperty,__propIsEnum$b=Object.prototype.propertyIsEnumerable,__defNormalProp$b=function(n,r,i){return r in n?__defProp$b(n,r,{Fr:!0,Lr:!0,writable:!0,value:i}):n[r]=i},__spreadValues$b=function(n,r){for(var i in r||(r={}))__hasOwnProp$b.call(r,i)&&__defNormalProp$b(n,i,r[i]);var s=!0,a=!1,o=void 0;if(__getOwnPropSymbols$b)try{for(var l=__getOwnPropSymbols$b(r)[Symbol.iterator](),u;!(s=(u=l.next()).done);s=!0){var i=u.value;__propIsEnum$b.call(r,i)&&__defNormalProp$b(n,i,r[i])}}catch(f){a=!0,o=f}finally{try{!s&&l.return!=null&&l.return()}finally{if(a)throw o}}return n},__spreadProps$7=function(n,r){return __defProps$7(n,__getOwnPropDescs$7(r))},IconRender=function(n){_inherits(i,n);var r=_createSuper(i);function i(){_classCallCheck(this,i);var a;return a=r.call.apply(r,[this].concat(Array.prototype.slice.call(arguments))),a.v$=[new LabelsRender$1],a}var s=i.prototype;return s.m$=function(a){if(!this.regl)return!1;this.v$.forEach(function(l){return l.m$(a)});var o=this.regl;this.gA(IconShader,a,{attributes:__spreadValues$b({position:o.prop("position"),iconIndex:o.prop("iconIndex"),iconSize:o.prop("iconSize"),offset:o.prop("offset"),rotation:o.prop("rotation"),opacity:o.prop("opacity")},ColorGLSL.getColor(o).attribute),uniforms:__spreadValues$b(__spreadValues$b(__spreadValues$b({mvp:o.prop("mvp"),resolution:o.prop("resolution"),texture:o.prop("texture"),iconCount:o.prop("iconCount"),layerOpacity:o.prop("layerOpacity"),unit:o.prop("unit"),ratio:window.AMap.Browser.retina?2:1},ColorGLSL.getColor(o).uniform),RenderUtil.getScaleUniform("iconSize",o)),RenderUtil.getScaleUniform("offset",o)),depth:{enable:!1},blend:{enable:!0,func:RenderUtil.getBlend("normal")},count:o.prop("count"),primitive:"points"})},s.render=function(a){var o=this.yA(IconShader);if(o){var l=a.meshes,u=a.mvp,f=a.opacity,c=a.resolution,h=a.texture,p=a.iconCount,d=a.vP;if(!(l.length<1)){for(var v=0;v<l.length;v++){var g=l[v],m=g.attributes,y=g.uniforms,b=g.mf,_=b.count;o(__spreadValues$b(__spreadProps$7(__spreadValues$b(__spreadValues$b({},m),y),{unit:y.unit==="px"?0:1,count:_,resolution:c,layerOpacity:f,iconCount:p,texture:h,mvp:u,isPick:!1}),RenderUtil.getScaleProps(d)))}for(var C=0;C<l.length;C++){var A=!0,I=!1,D=void 0;try{for(var X=this.v$[Symbol.iterator](),W;!(A=(W=X.next()).done);A=!0){var K=W.value;K.render(l[C],f)}}catch(U){I=!0,D=U}finally{try{!A&&X.return!=null&&X.return()}finally{if(I)throw D}}}}}},s.pickRender=function(a){var o=this.yA(IconShader);if(o){var l=a.meshes,u=a.mvp,f=a.opacity,c=a.resolution,h=a.texture,p=a.iconCount,d=a.pickFbo,v=a.pickPos,g=a.vP;if(!(l.length<1)&&d&&v){var m=this;d.use(function(){m.regl.clear({color:[0,0,0,0],depth:1});for(var y=0;y<l.length;y++){var b=l[y],_=b.attributes,C=b.uniforms,A=b.mf,I=A.count,D=C.unit==="px"?0:1;o(__spreadValues$b(__spreadProps$7(__spreadValues$b(__spreadValues$b({},_),C),{unit:D,count:I,resolution:c,layerOpacity:f,iconCount:p,texture:h,mvp:u,isPick:!0}),RenderUtil.getScaleProps(g)))}})}}},i}(Render),IconLayer=function(n){_inherits(i,n);var r=_createSuper(i);function i(a){_classCallCheck(this,i);var o;o=r.call(this,a),o.CLASS_NAME="Icon",o.fusion=new IconFusion,o.ll=new IconRender,o.Tx=!1,o.jx=[],o.Bx=0,o.Dx=new Map,o.Vx=[];var l=icon.Sw;return o.zooms=a.zooms===void 0?l.zooms:a.zooms,o.visible=a.visible===void 0?l.visible:a.visible,o.zIndex=a.zIndex===void 0?l.zIndex:a.zIndex,o.opacity=a.opacity===void 0?l.opacity:a.opacity,o.AC({zooms:o.zooms,visible:o.visible,zIndex:o.zIndex}),o.buryPoint.record(o.CLASS_NAME),o}var s=i.prototype;return s.getLabelsLayer=function(){return this.ll.v$[0]._$||null},s.setStyle=function(a){if(_get(_getPrototypeOf(i.prototype),"setStyle",this).call(this,a),this.dataset=this.source.LC(),this.colorPick.clear(),this.Ex=null,this.jx=[],this.Dx.clear(),this.dataset&&this.dataset.length>0){this.Vx=this.meshes;var o=this.WC(),l=o.didFusionDataset,u=this.fusion.fusion(l,this.styleOptions,this);this.meshes=u;for(var f=0;f<this.meshes.length;f++)this.Vx[f].mf=this.meshes[f].mf;this.vA.state|=MeshesDirty,this.loca&&this.loca.requestRender()}},s.getInitialAnimateState=function(){return{iconSize:{time:[1,0,0,0],type:[-1,1,0,0],value:[0,1]},offset:{time:[1,0,0,0],type:[-1,1,0,0],value:[0,1]}}},s.receiveDataset=function(a){this.dataset=a,this.setStyle(this.styleOptions),this.onAdd()},s.jC=function(){_get(_getPrototypeOf(i.prototype),"jC",this).call(this),!(!this.loca||!this.loca.regl||this.ll.regl)&&(this.ll.regl=this.loca.regl,this.loca.rendererManager.addRenderer(this.ll))},s.beforeRender=function(){if(_get(_getPrototypeOf(i.prototype),"beforeRender",this).call(this),!this.fusion.regl&&this.loca&&(this.fusion.regl=this.loca.regl,this.loca.fusionManager.addFusion(this.fusion)),this.jC(),this.source&&(this.dataset=this.source.LC()),this.fusion){var a=this.WC(),o=a.willFusion;if(o.length>0){var l=this.fusion.fusion(o,this.styleOptions,this);this.meshes=l,this.vA.state|=MeshesDirty}}},s.render=function(){var a,o;if(!!this.loca&&!!this.PA()){this.loca.regl._refresh();var l=this.meshes;if(!this.Ex&&this.meshes.length>0&&(l=this.Vx),this.Kf){var u=(a=this.loca)==null?void 0:a.customCoords.getMVPMatrix(),f=this.projection.getResolution((o=this.loca)==null?void 0:o.map.getZoom());this.ll&&l.length>0&&this.ll.render({texture:this.Kf,iconCount:this.Bx,meshes:l,mvp:u,resolution:f,opacity:this._getOpacity(),vP:this._animateLayerState})}if(!this.Ex){var c=this.jx;if(c&&c.length&&!this.Tx){var h=this;this.Tx=!0,mergeImages({images:_toConsumableArray(c).concat(_toConsumableArray(c),_toConsumableArray(c)),wx:[256,256]},function(p){var d,v;h.Tx=!1,p&&(h.Ex=p.xx,p.xx&&(h.Kf&&h.Kf.destroy(),h.Kf=(d=h==null?void 0:h.loca)==null?void 0:d.regl.texture({format:"rgba",width:h.Ex.width,Rx:h.Ex.height,data:h.Ex}),h.Bx=c.length,(v=h.loca)==null||v.requestRender()))},function(p){console.log("mergeImage error",p)})}}if(this.Kf&&this.ll&&l.length>0)return!0}},s.pickRender=function(){var a,o;if(!!this.loca&&!!this.PA()){this.loca.regl._refresh();var l=(a=this.loca)==null?void 0:a.customCoords.getMVPMatrix(),u=this.projection.getResolution((o=this.loca)==null?void 0:o.map.getZoom());this.ll&&this.Kf&&this.ll.pickRender({texture:this.Kf,iconCount:this.jx.length,meshes:this.meshes,mvp:l,resolution:u,opacity:this._getOpacity(),pickFbo:this._needPickFrame&&this._pickFbo,pickPos:this._pickPos,vP:this._animateLayerState})}},s.destroy=function(){_get(_getPrototypeOf(i.prototype),"destroy",this).call(this),this.Ex=null,this.Kf&&this.Kf.destroy&&this.Kf.destroy(),this.Kf=null},s.afterRender=function(){},s.zx=function(){return{Sx:this.Dx,_x:this.jx}},s.PA=function(){return RenderHelper.SA(this.ll,this)},i}(Layer),__defProp$a=Object.defineProperty,__defProps$6=Object.defineProperties,__getOwnPropDescs$6=Object.getOwnPropertyDescriptors,__getOwnPropSymbols$a=Object.getOwnPropertySymbols,__hasOwnProp$a=Object.prototype.hasOwnProperty,__propIsEnum$a=Object.prototype.propertyIsEnumerable,__defNormalProp$a=function(n,r,i){return r in n?__defProp$a(n,r,{Fr:!0,Lr:!0,writable:!0,value:i}):n[r]=i},__spreadValues$a=function(n,r){for(var i in r||(r={}))__hasOwnProp$a.call(r,i)&&__defNormalProp$a(n,i,r[i]);var s=!0,a=!1,o=void 0;if(__getOwnPropSymbols$a)try{for(var l=__getOwnPropSymbols$a(r)[Symbol.iterator](),u;!(s=(u=l.next()).done);s=!0){var i=u.value;__propIsEnum$a.call(r,i)&&__defNormalProp$a(n,i,r[i])}}catch(f){a=!0,o=f}finally{try{!s&&l.return!=null&&l.return()}finally{if(a)throw o}}return n},__spreadProps$6=function(n,r){return __defProps$6(n,__getOwnPropDescs$6(r))},pushArray$8=CommonUtil$1._C,_PrismFusion=function(n){_inherits(i,n);var r=_createSuper(i);function i(){return _classCallCheck(this,i),r.apply(this,arguments)}var s=i.prototype;return s.DC=function(){},s.buildStyle=function(a,o){for(var l,u=prism.style,f=[],c=0;c<a.length;c++)if(!(!a[c].features||!a[c].features.points)){for(var h=a[c].features.points,p=StyleInstance.parse(h,o,u),d={},v=0;v<h.length;v++)if(p)for(var g in p.attributes){var m=p.attributes[g];d[g]||(d[g]=[]),((l=m[v])==null?void 0:l.length)>0?pushArray$8(d[g],m[v]):d[g][d[g].length]=m[v]}f.push({attributes:d,uniforms:p.uniforms,si:p.si})}return f},s.fusion=function(a,o,l,u){var f;if(!l.loca||!l.loca.regl)return[];var c=l.loca.regl,h=l.loca.customCoords,p=[];this.j$=l,u=u||this.buildStyle(a,o);for(var d=0;d<a.length;d++){var v=a[d];if(!(!v.features||!v.features.points||!u[d])){var g=v.features.points,m=u[d],y=m.uniforms.unit,b=1;y==="px"&&(b=l.projection.getResolution((f=l.loca)==null?void 0:f.map.getZoom()));for(var _={index:[],vertex:[],radius:[],sideNo:[],id:[],color:[],rotation:[],pickColor:[],labels:[]},C=m.attributes,A=C.altitude,I=C.height,D=C.radius,X=C.rotation,W=C.topColor,K=C.sideTopColor,U=C.sideBottomColor,M=C.label,L=C.labelAltitude,P=m.uniforms,$=P.sideNumber,R=0;R<g.length;R++){var T=g[R],w=R*4,E=l.colorPick.add(T),O=T.coordinates;if(T.type==="MultiPoint")for(var k=0,F=O.length;k<F;k++){var q=O[k],Y=this.Fx({vertex:[q[0],q[1],q[2]||A[R]],Lx:h,height:I[R],pickColor:E,Wx:$,topColor:W.slice(w,w+4),sideTopColor:K.slice(w,w+4),sideBottomColor:U.slice(w,w+4),radius:D[R],rotation:X[R],hasSide:l.hasSide,id:T.sr});GeoUtil.mergeTriangles(_,Y,4),pushArray$8(_.color,Y.Gh),pushArray$8(_.sideNo,Y.Nx),pushArray$8(_.radius,Y.radius),pushArray$8(_.id,Y.id),pushArray$8(_.rotation,Y.Ux),pushArray$8(_.pickColor,Y.Qw),M[R]&&_.labels.push(__spreadValues$a({position:[q[0],q[1],((q[2]||A[R])+I[R]+L[R])*b]},M[R]))}else{var fe=this.Fx({vertex:[O[0],O[1],O[2]||A[R]],Lx:h,height:I[R],pickColor:E,Wx:$,topColor:W.slice(w,w+4),sideTopColor:K.slice(w,w+4),sideBottomColor:U.slice(w,w+4),radius:D[R],rotation:X[R],hasSide:l.hasSide,id:T.sr});GeoUtil.mergeTriangles(_,fe,4),pushArray$8(_.color,fe.Gh),pushArray$8(_.sideNo,fe.Nx),pushArray$8(_.radius,fe.radius),pushArray$8(_.id,fe.id),pushArray$8(_.rotation,fe.Ux),pushArray$8(_.pickColor,fe.Qw),M[R]&&_.labels.push(__spreadValues$a({position:[O[0],O[1],((O[2]||A[R])+I[R]+L[R])*b]},M[R]))}}p[d]={id:v.id,attributes:{position:{buffer:c.buffer(_.vertex),offset:0,stride:4*4,td:!1,divisor:0},color:{buffer:c.buffer(_.color),offset:0,stride:4*4,td:!1,divisor:0},sideNo:{buffer:c.buffer(_.sideNo),offset:0,stride:4,td:!1,divisor:0},id:{buffer:c.buffer(_.id),offset:0,stride:4,td:!1,divisor:0},radius:{buffer:c.buffer(_.radius),offset:0,stride:4,td:!1,divisor:0},rotation:{buffer:c.buffer(_.rotation),offset:0,stride:4,td:!1,divisor:0},pickColor:{buffer:c.buffer(_.pickColor),offset:0,stride:4*4,td:!1,divisor:0},index:c.elements({primitive:"triangles",type:"uint32",data:_.index})},uniforms:m.uniforms,si:m.si,mf:{labels:_.labels}}}}return p},s.updateStyle=function(a,o){for(var l=this,u=function(p,d){var v=a[p],g=o[p].attributes,m=g.altitude,y=g.height,b=g.topColor,_=g.bottomColor,C=g.sideColor,A=g.textureSize,I=g.label,D=g.labelAltitude,X=v.mf.origin,W=X.position,K=X.color,U=v.mf.Tw,M=U.top,L=U.bottom,P=U.Pw,$=U.jw,R=o[p].uniforms.unit,T=1;R==="px"&&l.j$&&(T=l.j$.projection.getResolution((f=l.j$.loca)==null?void 0:f.map.getZoom()));for(var w=new Float32Array(K.length/2),E=0,O=0,k=0,F=W.length;k<F;k+=4){var q=k/4*4,Y=void 0,fe=[-1,-1];k>=$[E]&&E++;var _e=E*4;k>=L[O+1]&&O++,k<P[O]?(Y=_,W[k+2]=m[E]):k>=P[O]&&k<M[O]?((k-P[O])/4%2===0?W[k+2]=m[E]:W[k+2]=y[E]+m[E],Y=C,fe=A.slice(E*2,E*2+2)):(Y=b,W[k+2]=y[E]+m[E]),K[q]=Y[_e],K[q+1]=Y[_e+1],K[q+2]=Y[_e+2],K[q+3]=Y[_e+3],w[q/2]=fe[0],w[q/2+1]=fe[1]}v.attributes.position.buffer({data:W}),v.attributes.color.buffer({data:K}),v.attributes.textureSize.buffer({data:w}),v.uniforms=o[p].uniforms,v.mf.labels=v.mf.labels.map(function(Pe,De){var tt=_slicedToArray(Pe.position,2),je=tt[0],Fe=tt[1];return __spreadProps$6(__spreadValues$a(__spreadValues$a({},Pe),I[De]),{position:[je,Fe,(y[De]+m[De]+D[De])*T]})})},f,c=0,h=a.length;c<h;c++)u(c,h)},s.EC=function(){return[]},s.destroy=function(){delete this.j$},s.Fx=function(a){var o=a.Wx,l=a.height,u=a.Lx,f=a.vertex,c=a.topColor,h=a.sideTopColor,p=a.sideBottomColor,d=a.pickColor,v=a.radius,g=a.rotation,m=a.hasSide,y=a.id,b=[],_=[],C=[],A=[],I=[],D=[],X=[],W=[];this.qx(W,o,I.length);for(var K=0;K<o;K++){var U=u.lngLatToCoord(f);this.Gx(_,C,[U[0],U[1],f[2]+l,1],c,b,d),A.push(K),D.push(v),I.push(g),X.push(y)}if(m)for(var M=0;M<o;M++){var L=u.lngLatToCoord(f),P=I.length;W.push(P+1,P,P+3,P+3,P,P+2);for(var $=0;$<4;$++){var R=!!($%2),T=R?h:p;this.Gx(_,C,[L[0],L[1],f[2]+(R?l:0),R?.5:0],T,b,d),A.push($<2?M:M+.5),D.push(v),I.push(g),X.push(y)}}return{Qw:b,Gh:C,vertex:_,Nx:A,Ux:I,radius:D,id:X,index:W}},s.Gx=function(a,o,l,u,f,c){var h=a.length,p=o.length;if(a[h]=l[0],a[h+1]=l[1],a[h+2]=l[2],a[h+3]=l[3],o[p]=u[0],o[p+1]=u[1],o[p+2]=u[2],o[p+3]=u[3],f&&c){var d=f.length;f[d]=c[0],f[d+1]=c[1],f[d+2]=c[2],f[d+3]=c[3]}},s.qx=function(a,o,l){for(var u=0;u<o-2;u++)a.push(0,l+u+1,l+u+2);return a},i.getInstance=function(){return this.ui},i}(GeometryFusion),PrismFusion=_PrismFusion;PrismFusion.ui=new _PrismFusion;var PrismFusionInstance=PrismFusion.getInstance(),__defProp$9=Object.defineProperty,__getOwnPropSymbols$9=Object.getOwnPropertySymbols,__hasOwnProp$9=Object.prototype.hasOwnProperty,__propIsEnum$9=Object.prototype.propertyIsEnumerable,__defNormalProp$9=function(n,r,i){return r in n?__defProp$9(n,r,{Fr:!0,Lr:!0,writable:!0,value:i}):n[r]=i},__spreadValues$9=function(n,r){for(var i in r||(r={}))__hasOwnProp$9.call(r,i)&&__defNormalProp$9(n,i,r[i]);var s=!0,a=!1,o=void 0;if(__getOwnPropSymbols$9)try{for(var l=__getOwnPropSymbols$9(r)[Symbol.iterator](),u;!(s=(u=l.next()).done);s=!0){var i=u.value;__propIsEnum$9.call(r,i)&&__defNormalProp$9(n,i,r[i])}}catch(f){a=!0,o=f}finally{try{!s&&l.return!=null&&l.return()}finally{if(a)throw o}}return n},PrismShader={vertex:"\n        precision highp float;\n\n        attribute vec4 position;\n        attribute vec4 color;\n        attribute float radius;\n        attribute float rotation;\n        attribute float id;\n        // \u8FB9\u7684\u5E8F\u53F7, \u4EE3\u8868\u5F53\u524D\u7684\u9876\u70B9\u5E8F\u53F7\n        // \u5E8F\u53F7\u4ECE\u6B63\u5317\u65B9\u5411\u5F00\u59CB\uFF0C\u987A\u65F6\u9488\u6570\n        attribute float sideNo;\n\n        varying vec3 vNormal;\n        varying vec4 vColor;\n        varying vec3 vPosition;\n        ".concat(ColorGLSL.getColorShader().vertex,"\n\n        uniform mat4 mvp;\n        // unit: px=0, meter=1\n        uniform float unit;\n        uniform float resolution;\n        // uniform float heightScale;\n        // uniform float altitudeScale;\n        // uniform float rotationScale;\n        // uniform float radiusScale;\n        uniform float sideNumber;\n        ").concat(RenderUtil.getBezier(),"\n        ").concat(RenderUtil.getScaleType("radius"),"\n        ").concat(RenderUtil.getScaleType("height"),"\n        ").concat(RenderUtil.getScaleType("altitude"),"\n        ").concat(RenderUtil.getScaleType("rotation"),"\n\n        // z \u8F74\u65CB\u8F6C\n        vec2 rotateZ(vec2 a, float rad) {\n            float s = sin(rad);\n            float c = cos(rad);\n            float x = a.x;\n            float y = a.y;\n\n            // x = x * c - y * s;\n            // y = y * c + x * s;\n            // return vec2(x, y);\n            mat2 rotate = mat2(\n                c, -s,\n                s, c\n            );\n            return a * rotate;\n        }\n        // \u6839\u636E\u5E8F\u53F7\uFF0C\u8BA1\u7B97 normal \u548C\u9876\u70B9\u4F4D\u7F6E\n        struct vecInfo {\n            vec3 position;\n            vec3 normal;\n        };\n        vecInfo getVec(float rotationScale, float radiusScale) {\n            vec2 ori = vec2(0, 1);\n            float PI = 3.14159265;\n            float rot = rotation / 180.0 * PI * rotationScale;\n            float angle = PI * 2.0 / sideNumber;\n            // \u5982\u679C\u662F\u50CF\u7D20\uFF0C\u9700\u8981\u8BA1\u7B97\u4E3A\u7C73\n            float r = unit == 1.0 ? 1.0 : resolution;\n            vec2 pos = rotateZ(ori, -angle * ceil(sideNo) - rot) * radius * radiusScale * r;\n            vec3 normal = vec3(0,0,1);\n\n            // \u9876\u9762 normal \u5C31\u662F (0,0,1)\n            // \u5426\u5219\u5C31\u662F\u4FA7\u9762\uFF0C\u6211\u4EEC\u9700\u8981\u6839\u636E\u9762\u5B9A\u4E49\u4FA7\u9762\u5411\u91CF\n            // w \u5206\u91CF =1.0\uFF0C\u8BF4\u660E\u662F\u9876\u9762\n            // w = 0.5 \u8BF4\u660E\u662F\u4FA7\u9762\u7684\u9876\u70B9\n            // w = 0.0 \u8BF4\u660E\u662F\u4FA7\u9762\u7684\u5E95\u9762\n            if(position.w != 1.0) {\n                normal = vec3(rotateZ(ori, -angle * (floor(sideNo) + 0.5) - rot), 0);\n            }\n            vecInfo result;\n            result.position =vec3(pos + position.xy, position.z);\n            result.normal = normal;\n            return result;\n        }\n\n        void main() {\n            float radiusScale = radiusScaleValue(id);\n            float rotationScale = rotationScaleValue(id);\n            float heightScale = heightScaleValue(id);\n            float altitudeScale = altitudeScaleValue(id);\n            vecInfo info = getVec(rotationScale, radiusScale);\n            float r = unit == 1.0 ? 1.0 : resolution;\n            vec3 realPos = info.position.xyz;\n            // \u5E95\u90E8\n            if(position.w == 0.0) {\n                realPos = vec3(realPos.xy, realPos.z * r * altitudeScale);\n            }\n            // \u9876\u90E8\n            if(position.w > 0.0) {\n                realPos = vec3(realPos.xy, realPos.z * r * heightScale);\n            }\n            vColor = color;\n            vNormal = info.normal;\n            vPosition = realPos;\n            gl_Position = mvp * vec4(realPos, 1.0);\n            ").concat(ColorGLSL.getColorShader().mainVert,"\n        }\n    "),fragment:"\n        precision highp float;\n        varying vec4 vColor;\n\n        // \u5982\u679C\u9700\u8981\u5149\u7167\uFF0C\u8FD9\u4E24\u4E2A\u53D8\u91CF\u662F\u5FC5\u987B\u7684\n        varying vec3 vNormal;\n        varying vec3 vPosition;\n\n        uniform float opacity;\n\n        uniform vec3 cameraPosition;\n        uniform float shininess;\n        #include <lightUniforms,lightFunctions>;\n\n        ".concat(ColorGLSL.getColorShader().fragment,"\n\n        void main() {\n            gl_FragColor = vColor;\n\n            #include <lightMainCompute>;\n\n            gl_FragColor.a *= opacity;\n            ").concat(ColorGLSL.getColorShader().mainFrag,"\n        }\n    "),includes:__spreadValues$9({},LightIncludes)},__defProp$8=Object.defineProperty,__defProps$5=Object.defineProperties,__getOwnPropDescs$5=Object.getOwnPropertyDescriptors,__getOwnPropSymbols$8=Object.getOwnPropertySymbols,__hasOwnProp$8=Object.prototype.hasOwnProperty,__propIsEnum$8=Object.prototype.propertyIsEnumerable,__defNormalProp$8=function(n,r,i){return r in n?__defProp$8(n,r,{Fr:!0,Lr:!0,writable:!0,value:i}):n[r]=i},__spreadValues$8=function(n,r){for(var i in r||(r={}))__hasOwnProp$8.call(r,i)&&__defNormalProp$8(n,i,r[i]);var s=!0,a=!1,o=void 0;if(__getOwnPropSymbols$8)try{for(var l=__getOwnPropSymbols$8(r)[Symbol.iterator](),u;!(s=(u=l.next()).done);s=!0){var i=u.value;__propIsEnum$8.call(r,i)&&__defNormalProp$8(n,i,r[i])}}catch(f){a=!0,o=f}finally{try{!s&&l.return!=null&&l.return()}finally{if(a)throw o}}return n},__spreadProps$5=function(n,r){return __defProps$5(n,__getOwnPropDescs$5(r))},PrismRender=function(n){_inherits(i,n);var r=_createSuper(i);function i(){_classCallCheck(this,i);var a;return a=r.call.apply(r,[this].concat(Array.prototype.slice.call(arguments))),a.v$=[new LabelsRender$1],a}var s=i.prototype;return s.m$=function(a){if(!this.regl)return!1;this.v$.forEach(function(u){return u.m$(a)});var o=this.regl,l=RenderHelper._A(a,o);this.gA(PrismShader,a,{attributes:__spreadValues$8({position:o.prop("position"),color:o.prop("color"),sideNo:o.prop("sideNo"),radius:o.prop("radius"),rotation:o.prop("rotation"),id:o.prop("id")},ColorGLSL.getColor(o).attribute),uniforms:__spreadValues$8(__spreadValues$8(__spreadValues$8(__spreadValues$8(__spreadValues$8(__spreadValues$8({mvp:o.prop("mvp"),resolution:o.prop("resolution"),unit:o.prop("unit"),opacity:o.prop("layerOpacity"),sideNumber:o.prop("sideNumber"),shininess:o.prop("shininess"),cameraPosition:o.prop("cameraPosition")},ColorGLSL.getColor(o).uniform),RenderUtil.getScaleUniform("height",o)),RenderUtil.getScaleUniform("radius",o)),RenderUtil.getScaleUniform("rotation",o)),RenderUtil.getScaleUniform("altitude",o)),l),blend:{enable:!0,func:RenderUtil.getBlend("normal")},cull:{enable:o.prop("cullEnable"),face:o.prop("cullface")},frontFace:"cw",depth:{enable:!0,func:"lequal"},elements:o.prop("index")})},s.render=function(a){var o=this.yA(PrismShader);if(o){var l=a.meshes,u=a.mvp,f=a.lights,c=a.opacity,h=a.cull,p=a.cameraPosition,d=a.shininess,v=a.acceptLight,g=a.vP,m=a.resolution,y=a.isPick,b=y===void 0?!1:y;if(!(l.length<1)){for(var _=0;_<l.length;_++){var C=l[_],A=C.attributes,I=C.uniforms,D=h!=="none",X=h==="front"?"front":"back";o(__spreadValues$8(__spreadProps$5(__spreadValues$8(__spreadValues$8({},A),f),{unit:I.unit==="px"?0:1,layerOpacity:c,mvp:u,cullEnable:D,cullface:X,cameraPosition:p,shininess:d,acceptLight:v,isPick:b,resolution:m,sideNumber:I.sideNumber}),RenderUtil.getScaleProps(g)))}for(var W=0;W<l.length;W++){var K=!0,U=!1,M=void 0;try{for(var L=this.v$[Symbol.iterator](),P;!(K=(P=L.next()).done);K=!0){var $=P.value;$.render(l[W],c)}}catch(R){U=!0,M=R}finally{try{!K&&L.return!=null&&L.return()}finally{if(U)throw M}}}}}},s.pickRender=function(a){var o=this.yA(PrismShader);if(!!o&&a.pickFbo&&a.pickPos){var l=this;a.pickFbo.use(function(){l.regl.clear({color:[0,0,0,0],depth:1}),l.render(__spreadProps$5(__spreadValues$8({},a),{isPick:!0}))})}},i}(Render),pushArray$7=CommonUtil$1._C,PrismLayer=function(n){_inherits(i,n);var r=_createSuper(i);function i(a){_classCallCheck(this,i);var o;o=r.call(this,a),o.CLASS_NAME="Prism",o.fusion=new PrismFusion,o.ll=new PrismRender;var l=prism.Sw;return o.zooms=a.zooms===void 0?l.zooms:a.zooms,o.visible=a.visible===void 0?l.visible:a.visible,o.zIndex=a.zIndex===void 0?l.zIndex:a.zIndex,o.opacity=a.opacity===void 0?l.opacity:a.opacity,o.shininess=a.shininess===void 0?l.shininess:a.shininess,o.acceptLight=a.acceptLight===void 0?l.acceptLight:a.acceptLight,o.hasSide=a.hasSide===void 0?l.hasSide:a.hasSide,o.cullface=a.cullface||l.cullface,o.fusion=PrismFusionInstance,o.AC({zooms:o.zooms,visible:o.visible,zIndex:o.zIndex}),o.buryPoint.record(o.CLASS_NAME),o}var s=i.prototype;return s.getLabelsLayer=function(){return this.ll.v$[0]._$||null},s.setStyle=function(a){if(_get(_getPrototypeOf(i.prototype),"setStyle",this).call(this,a),this.dataset=this.source.LC(),this.colorPick.clear(),this.loca&&this.dataset&&this.dataset.length>0){var o=this.WC(),l=o.didFusionDataset,u=this.fusion.fusion(l,this.styleOptions,this);this.meshes=u,this.vA.state|=MeshesDirty,this.loca.requestRender()}},s.receiveDataset=function(a){this.dataset=a,this.setStyle(this.styleOptions),this.onAdd()},s.jC=function(){_get(_getPrototypeOf(i.prototype),"jC",this).call(this),!(!this.loca||!this.loca.regl||this.ll.regl)&&(this.ll.regl=this.loca.regl,this.loca.rendererManager.addRenderer(this.ll))},s.beforeRender=function(){if(_get(_getPrototypeOf(i.prototype),"beforeRender",this).call(this),this.loca&&this.loca.fusionManager.addFusion(this.fusion),this.jC(),this.source&&(this.dataset=this.source.LC()),this.fusion){var a=this.WC(),o=a.willFusion;if(o.length>0){var l=this.fusion.fusion(o,this.styleOptions,this);this.meshes=pushArray$7(this.meshes,l),this.vA.state|=MeshesDirty}}},s.render=function(){var a,o;if(!!this.loca&&!!this.PA()){this.loca.regl._refresh();var l=(a=this.loca)==null?void 0:a.customCoords.getMVPMatrix(),u=this.projection.getResolution((o=this.loca)==null?void 0:o.map.getZoom()),f=this.loca.customCoords.getCameraParams().position,c=RenderHelper.IA(this.loca.lights);if(this.ll&&this.meshes.length>0)return this.ll.render({meshes:this.meshes,mvp:l,resolution:u,opacity:this._getOpacity(),vP:this._animateLayerState,lights:c,cull:this.cullface,cameraPosition:f,shininess:this.shininess,acceptLight:this.acceptLight,isPick:!1}),!0}},s.pickRender=function(){var a,o;if(!!this.loca&&!!this.PA()){this.loca.regl._refresh();var l=(a=this.loca)==null?void 0:a.customCoords.getMVPMatrix(),u=this.projection.getResolution((o=this.loca)==null?void 0:o.map.getZoom()),f=this.loca.customCoords.getCameraParams().position,c=RenderHelper.IA(this.loca.lights);this.ll&&this.meshes.length>0&&this.ll.pickRender({meshes:this.meshes,mvp:l,resolution:u,opacity:this._getOpacity(),vP:this._animateLayerState,lights:c,cull:this.cullface,cameraPosition:f,shininess:this.shininess,acceptLight:this.acceptLight,isPick:!0,pickFbo:this._needPickFrame&&this._pickFbo,pickPos:this._pickPos})}},s.afterRender=function(){},s.destroy=function(){_get(_getPrototypeOf(i.prototype),"destroy",this).call(this),this.ll=null},s.getInitialAnimateState=function(){return{height:{time:[1,0,0,0],type:[-1,1,0,0],value:[0,1]},radius:{time:[1,0,0,0],type:[-1,1,0,0],value:[0,1]},altitude:{time:[1,0,0,0],type:[-1,1,0,0],value:[0,1]},rotation:{time:[1,0,0,0],type:[-1,1,0,0],value:[0,1]}}},s.PA=function(){return RenderHelper.SA(this.ll,this)},i}(Layer),pushArray$6=CommonUtil$1._C,PulseLinkFusion=function(n){_inherits(i,n);var r=_createSuper(i);function i(){return _classCallCheck(this,i),r.apply(this,arguments)}var s=i.prototype;return s.DC=function(){},s.buildStyle=function(a,o,l){var u=pulselink.style,f=[];if(!l.loca)return{};for(var c=l.loca.customCoords,h=0;h<a.length;h++)if(!(!a[h].features||!a[h].features.lines)){var p=a[h].features.lines,d=[],v=!0,g=!1,m=void 0;try{for(var y=p[Symbol.iterator](),b;!(v=(b=y.next()).done);v=!0){var _=b.value,C=_.coordinates,A=_.type;if(A==="LineString"){var I=C[0],D=C[C.length-1],X=c.lngLatToCoord(I),W=c.lngLatToCoord(D),K=glMatrix.vec2.distance(X,W);d.push({distance:K,link:_})}if(A==="MultiLineString")for(var U=0;U<C.length;U++){var M=C[U],L=[M[0],M[M.length-1]],P=L[0],$=L[1],R=c.lngLatToCoord(P),T=c.lngLatToCoord($),w=glMatrix.vec2.distance(R,T);d.push({distance:w,link:{coordinates:_.coordinates[U],properties:_.properties}})}}}catch(O){g=!0,m=O}finally{try{!v&&y.return!=null&&y.return()}finally{if(g)throw m}}var E=StyleInstance.parse(d,o,u);f.push(E)}return f},s.fusion=function(a,o,l,u){if(!this.regl||!l.loca)return[];var f=[];u=u||this.buildStyle(a,o,l);for(var c=l.loca.customCoords,h=0;h<a.length;h++){var p=a[h];if(!(!p.features||!p.features.lines)){for(var d=p.features.lines,v=u[h],g=v.attributes,m=v.uniforms,y={vertex:[],color:[],pickColor:[],lineWidth:[],distance:[],speed:[],lineDir:[],dash:[],index:[]},b=0;b<d.length;b++){var _=d[b],C=_.coordinates,A=g.lineColors,I=g.height,D=g.lineWidth,X=g.dash,W=g.speed,K=m.smoothSteps,U=m.maxHeightScale,M=X[b],L=W[b],P=D[b],$=(P[1]-P[0])/(K-1),R=l.colorPick.add(_),T=I[b],w=A[b],E=Math.max(w.length,2),O=(P[1]-P[0])/(E-1);if(_.type==="MultiLineString")for(var k=0,F=C.length;k<F;k++){var q=C[k],Y=[],fe=[q[0],q[q.length-1]],_e=_slicedToArray(fe[0],2),Pe=_e[0],De=_e[1],tt=_slicedToArray(fe[1],2),je=tt[0],Fe=tt[1],Ge={x:Pe,y:De,z:0},Et={x:je,y:Fe,z:0},st=[je-Pe,Fe-De,0],at=[Pe-je,De-Fe,0],$t=glMatrix.vec3.cross(new Float32Array(3),st,[0,0,-1]),kt=glMatrix.vec3.cross(new Float32Array(3),st,[0,0,1]);if(T===0)Y=LinearSplit(Ge,Et,E),this.Qx(Y,y,c,{Hx:w,Yx:P,Xx:$t,pickColor:R,lineDir:st,Jx:at,Zx:O,$x:kt,dash:M,speed:L});else{var Rt={x:Pe-(Pe-je)/2,y:De-(De-Fe)/2,z:T};Y=cubicBezier(Ge,Rt,Et,.5,K),this.Qx(Y,y,c,{Hx:w,Yx:P,Xx:$t,pickColor:R,lineDir:st,Jx:at,Zx:$,$x:kt,dash:M,speed:L})}}else{var Tt=[C[0],C[C.length-1]],bt=_slicedToArray(Tt[0],2),Ot=bt[0],Lt=bt[1],xt=_slicedToArray(Tt[1],2),ht=xt[0],ot=xt[1],mt=[ht-Ot,ot-Lt,0],nt=[Ot-ht,Lt-ot,0],Ut=glMatrix.vec3.cross(new Float32Array(3),mt,[0,0,-1]),Dt=glMatrix.vec3.cross(new Float32Array(3),mt,[0,0,1]),ft={x:Ot,y:Lt,z:0},Ct={x:ht,y:ot,z:0},St=[];if(T===0)St=LinearSplit(ft,Ct,E),this.Qx(St,y,c,{Hx:w,Yx:P,Xx:Ut,pickColor:R,lineDir:mt,Jx:nt,Zx:O,$x:Dt,dash:M,speed:L});else{var zt={x:Ot-(Ot-ht)*U,y:Lt-(Lt-ot)*U,z:T};St=cubicBezier(ft,zt,Ct,.5,K),this.Qx(St,y,c,{Hx:w,Yx:P,Xx:Ut,pickColor:R,lineDir:mt,Jx:nt,Zx:$,$x:Dt,dash:M,speed:L})}}}f[h]={id:p.id,attributes:{color:{buffer:this.regl.buffer(y.color),offset:0,stride:4*4,td:!1,divisor:0},dash:{buffer:this.regl.buffer(y.dash),offset:0,stride:4*4,td:!1,divisor:0},speed:{buffer:this.regl.buffer(y.speed),offset:0,stride:4*1,td:!1,divisor:0},lineDir:{buffer:this.regl.buffer(y.lineDir),offset:0,stride:4*3,td:!1,divisor:0},lineWidth:{buffer:this.regl.buffer(y.lineWidth),offset:0,stride:4*1,td:!1,divisor:0},distance:{buffer:this.regl.buffer(y.distance),offset:0,stride:4*2,td:!1,divisor:0},pickColor:{buffer:this.regl.buffer(y.pickColor),offset:0,stride:4*4,td:!1,divisor:0},position:{buffer:this.regl.buffer(y.vertex),offset:0,stride:4*3,td:!1,divisor:0},index:this.regl.elements({primitive:"triangles",type:"uint32",data:y.index})},uniforms:v.uniforms,si:v.si}}}return f},s.updateStyle=function(a,o,l,u){if(!l.loca)return[];var f=l.dataset;return this.fusion(f,o,l,u)},s.EC=function(){return[]},s.destroy=function(){this.regl=null},s.Qx=function(a,o,l,u){for(var f=u.Hx,c=u.speed,h=u.Yx,p=u.dash,d=u.Xx,v=u.pickColor,g=u.Zx,m=u.$x,y=0,b=!1,_=0,C={Kx:[],tM:[],coords:[]},A=0,I=a.length;A<I-1;A++){var D=a[A],X=a[A+1],W=b||l.lngLatToCoord([D.x,D.y]),K=l.lngLatToCoord([X.x,X.y]),U=[K[0]-W[0],K[1]-W[1],X.z-D.z],M=glMatrix.vec2.len(U);b||C.coords.push(W),C.coords.push(K),C.tM.push(U),C.Kx.push(y),_+=M,y=M+y,b=K}for(var L=C.Kx,P=C.tM,$=C.coords,R=0,T=a.length;R<T-1;R++){var w=a[R],E=a[R+1],O=$[R],k=$[R+1],F=P[R],q=linearGradient(f,w.t),Y=linearGradient(f,E.t),fe=L[R],_e=L[R+1]||_,Pe=P[R-1]||F,De=this.nM({Br:[O[0],O[1],w.z],color:q,Xx:d,lineDir:Pe,width:h[0]+g*R,distance:[fe,_],pickColor:v,dash:p,speed:c},{Br:[k[0],k[1],E.z],color:Y,Xx:m,lineDir:F,width:h[0]+g*(R+1),distance:[_e,_],pickColor:v,dash:p,speed:c});GeoUtil.mergeTriangles(o,De,3),pushArray$6(o.color,De.color),pushArray$6(o.lineWidth,De.width),pushArray$6(o.distance,De.distance),pushArray$6(o.lineDir,De.lineDir),pushArray$6(o.pickColor,De.pickColor),pushArray$6(o.dash,De.dash),pushArray$6(o.speed,De.speed)}},s.nM=function(a,o){var l=a.Br,u=a.color,f=a.width,c=a.pickColor,h=a.lineDir,p=a.distance,d=a.dash,v=a.speed,g=o.Br,m=o.color,y=o.width,b=o.pickColor,_=o.lineDir,C=o.distance,A=o.dash,I=o.speed,D=_toConsumableArray(l).concat(_toConsumableArray(l),_toConsumableArray(g),_toConsumableArray(g)),X=_toConsumableArray(u).concat(_toConsumableArray(u),_toConsumableArray(m),_toConsumableArray(m)),W=[f,f,y,y],K=_toConsumableArray(p).concat(_toConsumableArray(p),_toConsumableArray(C),_toConsumableArray(C)),U=_toConsumableArray(c).concat(_toConsumableArray(c),_toConsumableArray(b),_toConsumableArray(b)),M=[-h[0],-h[1],-h[2]],L=[-_[0],-_[1],-_[2]],P=_toConsumableArray(h).concat(_toConsumableArray(M),_toConsumableArray(_),_toConsumableArray(L)),$=_toConsumableArray(d).concat(_toConsumableArray(d),_toConsumableArray(A),_toConsumableArray(A)),R=[v,v,I,I];return{vertex:D,distance:K,speed:R,color:X,width:W,pickColor:U,lineDir:P,dash:$,index:[1,0,2,2,3,1]}},i}(GeometryFusion),PulseLinkShader={vertex:"\n        precision highp float;\n        attribute vec3 position;\n        attribute vec4 color;\n        // attribute vec3 normal;\n        attribute vec3 lineDir;\n        attribute vec3 vertexNext;\n        attribute float lineWidth;\n        attribute vec2 distance;\n        attribute vec4 dash;\n        attribute float speed;\n        varying vec4 vColor;\n        varying vec4 vDash;\n        varying vec2 vDistance;\n        varying float vSpeed;\n        uniform mat4 mvp;\n        uniform vec3 cameraPosition;\n        uniform float unit; // 0: px; 1: meter;\n        uniform float resolution;\n        ".concat(ColorGLSL.getColorShader().vertex,"\n\n        void main() {\n            float res = unit == 0.0 ? resolution : 1.0;\n            // \u8BA1\u7B97\u5F53\u524D\u9876\u70B9\u5230\u76F8\u673A\u7684\u5411\u91CF\n            vec3 cameraDir = vec3(cameraPosition - position);\n            vec3 cameraNor = cross(cameraDir, lineDir);\n\n            vColor = color;\n            vDash = dash;\n            vSpeed = speed;\n            vDistance = distance;\n            vec3 pos = position + normalize(cameraNor) * (lineWidth / 2.0) * res;\n            gl_Position = mvp * vec4(pos, 1.0);\n            ").concat(ColorGLSL.getColorShader().mainVert,"\n        }\n    "),fragment:"\n        precision highp float;\n        varying vec4 vColor;\n        varying vec4 vDash;\n        varying vec2 vDistance;\n        varying float vSpeed;\n        uniform float opacity;\n        uniform float animateCounter;\n        uniform float resolution;\n        uniform float flowLength;\n        uniform vec4 headColor;\n        uniform vec4 trailColor;\n        uniform float unit;\n        ".concat(ColorGLSL.getColorShader().fragment,"\n\n        void main() {\n            float res = unit == 0.0 ? resolution : 1.0;\n            float curDist = vDistance.x;\n            float distPixel = vDistance.x / res;\n            float offset = mod(distPixel, vDash.r + vDash.g + vDash.b + vDash.a);\n            if(offset > vDash.r && offset < vDash.r + vDash.g) {\n                discard;\n            } else if(offset > vDash.r + vDash.g + vDash.b) {\n                discard;\n            }\n            float op = offset / (vDash.r + vDash.g + vDash.b + vDash.a);\n            gl_FragColor = vColor;\n\n            // \u8109\u51B2\u7C92\u5B50\n            float ligLen = flowLength * res;\n            float curTop = animateCounter * vSpeed * res / 1000.0 * 60.0;\n            float realCurTop = mod(curTop, vDistance.y);\n            float realCurBottom = mod(curTop - ligLen, vDistance.y);\n            float delta = 1.0 - (curDist - realCurBottom) / ligLen;\n            vec4 resultColor = vColor;\n\n            // \u8BF4\u660E\u662F\u5728\u672B\u7AEF\uFF0C\u5934\u90E8\u5DF2\u7ECF\u51FA\u4E86\u7AEF\u70B9\n            if(realCurTop < realCurBottom) {\n                // \u672B\u7AEF\n                if(curDist > realCurBottom) {\n                    resultColor = mix(headColor, trailColor, delta);\n                }\n                // \u59CB\u7AEF\n                if(curDist < realCurTop) {\n                    float delta = 1.0 - (vDistance.y - realCurBottom + curDist) / ligLen;\n                    resultColor = mix(headColor, trailColor, delta);\n                }\n                gl_FragColor = mix(vColor, resultColor, resultColor.a);\n            } else {\n                if(curDist < realCurTop && curDist > realCurBottom) {\n                    resultColor = mix(headColor, trailColor, delta);\n                }\n                gl_FragColor = mix(vColor, resultColor, resultColor.a);\n            }\n            gl_FragColor.a *= opacity;\n            ").concat(ColorGLSL.getColorShader().mainFrag,"\n        }\n    ")},__defProp$7=Object.defineProperty,__defProps$4=Object.defineProperties,__getOwnPropDescs$4=Object.getOwnPropertyDescriptors,__getOwnPropSymbols$7=Object.getOwnPropertySymbols,__hasOwnProp$7=Object.prototype.hasOwnProperty,__propIsEnum$7=Object.prototype.propertyIsEnumerable,__defNormalProp$7=function(n,r,i){return r in n?__defProp$7(n,r,{Fr:!0,Lr:!0,writable:!0,value:i}):n[r]=i},__spreadValues$7=function(n,r){for(var i in r||(r={}))__hasOwnProp$7.call(r,i)&&__defNormalProp$7(n,i,r[i]);var s=!0,a=!1,o=void 0;if(__getOwnPropSymbols$7)try{for(var l=__getOwnPropSymbols$7(r)[Symbol.iterator](),u;!(s=(u=l.next()).done);s=!0){var i=u.value;__propIsEnum$7.call(r,i)&&__defNormalProp$7(n,i,r[i])}}catch(f){a=!0,o=f}finally{try{!s&&l.return!=null&&l.return()}finally{if(a)throw o}}return n},__spreadProps$4=function(n,r){return __defProps$4(n,__getOwnPropDescs$4(r))},PulseLinkRender=function(n){_inherits(i,n);var r=_createSuper(i);function i(){return _classCallCheck(this,i),r.apply(this,arguments)}var s=i.prototype;return s.m$=function(a){if(!this.regl)return!1;var o=this.regl;this.gA(PulseLinkShader,a,{frag:PulseLinkShader.fragment,vert:PulseLinkShader.vertex,attributes:__spreadValues$7({position:o.prop("position"),color:o.prop("color"),lineDir:o.prop("lineDir"),lineWidth:o.prop("lineWidth"),distance:o.prop("distance"),dash:o.prop("dash"),speed:o.prop("speed")},ColorGLSL.getColor(o).attribute),uniforms:__spreadValues$7({mvp:o.prop("mvp"),opacity:o.prop("opacity"),resolution:o.prop("resolution"),flowLength:o.prop("flowLength"),unit:o.prop("unit"),cameraPosition:o.prop("cameraPosition"),animateCounter:o.prop("animateCounter"),trailColor:o.prop("trailColor"),headColor:o.prop("headColor")},ColorGLSL.getColor(o).uniform),cull:{enable:!1},depth:{enable:o.prop("depth")},blend:{enable:!0,func:RenderUtil.getBlend()},elements:o.prop("index")})},s.render=function(a){var o=this.yA(PulseLinkShader);if(o)for(var l=a.meshes,u=a.mvp,f=a.animateCounter,c=a.opacity,h=a.resolution,p=a.depth,d=a.cameraPosition,v=0;v<l.length;v++){var g=l[v],m=g.attributes,y=g.uniforms,b=y.unit,_=y.flowLength,C=y.trailColor,A=y.headColor;o(__spreadProps$4(__spreadValues$7({},m),{cameraPosition:d,mvp:u,animateCounter:f,unit:b==="px"?0:1,resolution:h,opacity:c,depth:p,trailColor:C,headColor:A,flowLength:_,isPick:!1}))}},s.pickRender=function(a){var o=this.yA(PulseLinkShader);if(o){var l=a.meshes,u=a.animateCounter,f=a.mvp,c=a.opacity,h=a.pickFbo,p=a.pickPos,d=a.resolution,v=a.cameraPosition,g=a.depth;if(h&&p){var m=this;h.use(function(){m.regl.clear({color:[0,0,0,0],depth:1});for(var y=0;y<l.length;y++){var b=l[y],_=b.attributes,C=b.uniforms,A=C.unit,I=C.flowLength,D=C.trailColor,X=C.headColor;o(__spreadProps$4(__spreadValues$7({blendFun:RenderUtil.getBlend()},_),{cameraPosition:v,mvp:f,animateCounter:u,unit:A==="px"?0:1,resolution:d,opacity:c,depth:g,trailColor:D,headColor:X,flowLength:I,isPick:!0}))}})}}},i}(Render),pushArray$5=CommonUtil$1._C,PulseLinkLayer=function(n){_inherits(i,n);var r=_createSuper(i);function i(a){_classCallCheck(this,i);var o;o=r.call(this,a),o.CLASS_NAME="PulseLink",o.fusion=new PulseLinkFusion,o.ll=new PulseLinkRender,o.depth=!0;var l=pulselink.Sw;return o.zooms=a.zooms===void 0?l.zooms:a.zooms,o.zIndex=a.zIndex===void 0?l.zIndex:a.zIndex,o.opacity=a.opacity===void 0?l.opacity:a.opacity,o.visible=a.visible===void 0?l.visible:a.visible,o.depth=a.depth===void 0?l.depth:a.depth,o.AC({zooms:o.zooms,visible:o.visible,zIndex:o.zIndex}),o.buryPoint.record(o.CLASS_NAME),o}var s=i.prototype;return s.receiveDataset=function(a){this.dataset=a,this.setStyle(this.styleOptions),this.onAdd()},s.setStyle=function(a){if(_get(_getPrototypeOf(i.prototype),"setStyle",this).call(this,a),this.dataset=this.source.LC(),this.meshes=[],this.dataset&&this.dataset.length>0&&this.meshes){var o=this.WC(),l=o.didFusion,u=this.fusion.buildStyle(this.dataset,this.styleOptions,this),f=this.fusion.updateStyle(l,this.styleOptions,this,u);this.meshes=f,this.loca&&this.loca.requestRender()}},s.jC=function(){_get(_getPrototypeOf(i.prototype),"jC",this).call(this),!(!this.loca||!this.loca.regl||this.ll.regl)&&(this.ll.regl=this.loca.regl,this.loca.rendererManager.addRenderer(this.ll))},s.beforeRender=function(){if(_get(_getPrototypeOf(i.prototype),"beforeRender",this).call(this),!this.fusion.regl&&this.loca&&(this.fusion.regl=this.loca.regl,this.loca.fusionManager.addFusion(this.fusion)),this.jC(),this.source&&(this.dataset=this.source.LC()),this.fusion){var a=this.WC(),o=a.willFusion,l=a.didFusion;if(this.fusion.EC(),o.length>0){var u=this.fusion.fusion(o,this.styleOptions,this);this.meshes=pushArray$5(l,u)}}},s.render=function(){var a,o;if(!!this.loca&&!!this.PA()){this.loca.regl._refresh();var l=(a=this.loca)==null?void 0:a.customCoords.getMVPMatrix(),u=this.projection.getResolution((o=this.loca)==null?void 0:o.map.getZoom()),f=this.loca.customCoords.getCameraParams().position;if(this.ll&&this.meshes.length>0){var c=this.hP();return this.ll.render({meshes:this.meshes,mvp:l,depth:this.depth,resolution:u,opacity:this._getOpacity(),animateCounter:c,cameraPosition:f}),!0}}},s.pickRender=function(){var a,o;if(!!this.loca&&!!this.PA()){this.loca.regl._refresh();var l=(a=this.loca)==null?void 0:a.customCoords.getMVPMatrix(),u=this.loca.customCoords.getCameraParams().position,f=this.projection.getResolution((o=this.loca)==null?void 0:o.map.getZoom());if(this.ll){var c=this.hP();this.ll.pickRender({depth:this.depth,meshes:this.meshes,mvp:l,resolution:f,cameraPosition:u,animateCounter:c,opacity:this._getOpacity(),pickFbo:this._needPickFrame&&this._pickFbo,pickPos:this._pickPos})}}},s.afterRender=function(){},s.PA=function(){return RenderHelper.SA(this.ll,this)},i}(Layer),util=newUtil(),inliner=newInliner(),fontFaces=newFontFaces(),images=newImages(),defaultOptions={iM:void 0,rM:!1},domtoimage={eM:toSvg,oM:toPng,aM:toJpeg,pP:toCanvas,toBlob:toBlob,uM:toPixelData,sM:{fM:fontFaces,images:images,cM:util,lM:inliner,options:{}}};function cloneNode(n,r,i){if(!i&&r&&!r(n))return Promise.resolve();return Promise.resolve(n).then(s).then(function(l){return a(n,l,r)}).then(function(l){return o(n,l)});function s(l){return _instanceof(l,HTMLCanvasElement)?util.pM(l.toDataURL()):l.cloneNode(!1)}function a(l,u,f){var c=l.childNodes;if(c.length===0)return Promise.resolve(u);return h(u,util.mM(c),f).then(function(){return u});function h(p,d,v){var g=Promise.resolve();return d.forEach(function(m){g=g.then(function(){return cloneNode(m,v)}).then(function(y){y&&p.appendChild(y)})}),g}}function o(l,u){if(!_instanceof(u,Element))return u;return Promise.resolve().then(f).then(c).then(h).then(p).then(function(){return u});function f(){d(window.getComputedStyle(l),u.style);function d(v,g){m(v,g);function m(y,b){util.mM(y).forEach(function(_){b.setProperty(_,y.getPropertyValue(_),y.getPropertyPriority(_))})}}}function c(){[":before",":after"].forEach(function(v){d(v)});function d(v){var g=window.getComputedStyle(l,v),m=g.getPropertyValue("content");if(m===""||m==="none")return;var y=util.bM();u.className=u.className+" "+y;var b=document.createElement("style");b.appendChild(_(y,v,g)),u.appendChild(b);function _(C,A,I){var D="."+C+":"+A,X=I.cssText?W(I):K(I);return document.createTextNode(D+"{"+X+"}");function W(U){var M=U.getPropertyValue("content");return U.cssText+" content: "+M+";"}function K(U){return util.mM(U).map(M).join("; ")+";";function M(L){return L+": "+U.getPropertyValue(L)+(U.getPropertyPriority(L)?" !important":"")}}}}}function h(){_instanceof(l,HTMLTextAreaElement)&&(u.innerHTML=l.value),_instanceof(l,HTMLInputElement)&&u.setAttribute("value",l.value)}function p(){!_instanceof(u,SVGElement)||(u.setAttribute("xmlns","http://www.w3.org/2000/svg"),_instanceof(u,SVGRectElement)&&["width","height"].forEach(function(d){var v=u.getAttribute(d);!v||u.style.setProperty(d,v)}))}}}var pushArray$4=CommonUtil$1._C,ZMarkerFusion=function(n){_inherits(i,n);var r=_createSuper(i);function i(){_classCallCheck(this,i);var a;return a=r.call.apply(r,[this].concat(Array.prototype.slice.call(arguments))),a.kx={},a.PM=new Map,a}var s=i.prototype;return s.buildStyle=function(a,o,l){for(var u,f=zmarker.style,c=[],h=0;h<a.length;h++)if(!(!a[h].features||!a[h].features.points)){for(var p=a[h].features.points,d=StyleInstance.parse(p,o,f),v={},g=0;g<p.length;g++)if(d)for(var m in d.attributes){var y=d.attributes[m];v[m]||(v[m]=[]),typeof y[g]=="string"?m==="content"?v[m].push(this.TM(y[g])):pushArray$4(v[m],[y[g]]):((u=y[g])==null?void 0:u.length)>0?pushArray$4(v[m],y[g]):v[m][v[m].length]=y[g]}c.push({attributes:v,uniforms:d.uniforms,si:d.si}),this.jM(l)}return c},s.DC=function(){},s.fusion=function(a,o,l,u){if(!this.regl||!l.loca)return[];u=u||this.buildStyle(a,o,l);var f=[];return o&&a&&a.length&&(f=this.Cx({dataset:a,styleOptions:o,Sw:l,Ax:u})),f},s.Cx=function(a){for(var o=a.dataset,l=a.Ax,u=a.Sw,f,c=[],h=(f=u==null?void 0:u.loca)==null?void 0:f.customCoords,p=function(W){var K=W.mesh,U=W.style,M=W.lnglat,L=W.id,P=W.pickColor,$=h.lngLatToCoord(M);pushArray$4(K.position,[$[0],$[1],$[2]||U.altitude,L]),pushArray$4(K.size,U.size),pushArray$4(K.uv,U.uv),K.rotation.push(U.rotation/180*Math.PI),pushArray$4(K.pickColor,P)},d=0;d<o.length;d++){var v=o[d];if(!(!v.features||!v.features.points)){for(var g=v.features.points,m=l[d],y={position:[],size:[],uv:[],rotation:[],pickColor:[]},b=u.zx().BM,_=0;_<g.length;_++){var C=g[_],A=C==null?void 0:C.coordinates,I=u.colorPick.add(C),D={uv:b.get(""+m.attributes.content[_]),size:m.attributes.size.slice(_*2,_*2+2),rotation:m.attributes.rotation[_],altitude:m.attributes.altitude[_]};if(A&&A.length)if(C.type=="MultiPoint")for(var X=0;X<A.length;X++)p({mesh:y,style:D,lnglat:A[X],pickColor:I,id:C.sr});else p({mesh:y,style:D,lnglat:A,pickColor:I,id:C.sr})}y.rect=[0,0,0,0,0,1,1,0,0,1,0,0,0,0,1,1,0,1],c[d]={id:v.id,attributes:{rect:{buffer:this.regl.buffer(y.rect),offset:0,stride:4*3,td:!1,divisor:0},position:{buffer:this.regl.buffer(y.position),offset:0,stride:4*4,td:!1,divisor:1},uv:{buffer:this.regl.buffer(y.uv),offset:0,stride:4*4,td:!1,divisor:1},size:{buffer:this.regl.buffer(y.size),offset:0,stride:4*2,td:!1,divisor:1},rotation:{buffer:this.regl.buffer(y.rotation),offset:0,stride:4*1,td:!1,divisor:1},pickColor:{buffer:this.regl.buffer(y.pickColor),offset:0,stride:4*4,td:!1,divisor:1}},uniforms:m.uniforms,mf:{count:y.rotation.length}}}}return c},s.EC=function(){return[]},s.destroy=function(){this.regl=null},s.TM=function(a){var o=this.PM.has(a);if(o)return this.PM.get(a);var l=this.PM.size;return this.PM.set(a,l),l},s.jM=function(a){var o=this,l=a.zx().BM,u=this.PM,f=document.createElement("div");f.setAttribute("style","position: fixed; z-index: 999999; top: 0; left: 0; opacity: 0; poinert-events: none; width: 4096px;"),document.body.appendChild(f);var c="";u.forEach(function(d,v){c+='<div data-index="'+d+'" style="float: left; padding: 2px;">'+v+"</div>"}),f.innerHTML=c;var h=f.scrollWidth,p=f.scrollHeight;f.querySelectorAll("div").forEach(function(d){l.set(d.dataset.index,[d.offsetLeft/h,d.offsetTop/p,(d.offsetLeft+d.scrollWidth)/h,(d.offsetTop+d.scrollHeight)/p])}),document.body.removeChild(f),f.setAttribute("style","position: fixed; z-index: 999999; top: 0; left: 0; poinert-events: none; width: 4096px;"),domtoimage.pP(f,{width:h,height:p,dM:1}).then(function(d){a.DM(o==null?void 0:o.regl.texture({format:"rgba",width:h,height:p,data:d}))})},i}(GeometryFusion),ZMarkerShader={vertex:"\n        precision highp float;\n\n        uniform mat4 mvp;\n        uniform float resolution;\n        // unit: px=0, meter=1\n        uniform float unit;\n        uniform bool alwaysFront;\n        uniform float rot;\n\n        attribute vec3 rect;\n        attribute vec4 position;\n        attribute vec2 size;\n        attribute vec4 uv;\n        attribute float rotation;\n\n        varying vec2 vSize;\n        varying float vRotation;\n        varying vec2 vTextureCoord;\n        ".concat(ColorGLSL.getColorShader().vertex,"\n        ").concat(RenderUtil.getBezier(),"\n        ").concat(RenderUtil.getScaleType("altitude"),"\n        ").concat(RenderUtil.getScaleType("rotation"),"\n\n        // z \u8F74\u65CB\u8F6C\n        mat4 rotateZ(mat4 a, float rad) {\n            float s = sin(rad);\n            float c = cos(rad);\n\n            // \u7B2C\u4E8C\u79CD\n            mat4 rotate = mat4(\n                c, -s, 0, 0,\n                s, c, 0, 0,\n                0, 0, 1, 0,\n                0, 0, 0, 1\n            );\n            return a * rotate;\n        }\n\n        // \u901A\u8FC7\u9876\u70B9\u8BA1\u7B97\u51FA uv\n        vec2 getUV() {\n            vec2 result = vec2(0);\n            if(rect == vec3(0, 0, 1)) {\n                // \u5DE6\u4E0B\n                result = vec2(uv);\n            } else if(rect == vec3(0, 0, 0)) {\n                // \u5DE6\u4E0A\n                result = vec2(uv.x, uv.w);\n            } else if(rect == vec3(1, 0, 1)) {\n                // \u53F3\u4E0B\n                result = vec2(uv.z, uv.y);\n            } else if(rect == vec3(1, 0, 0)) {\n                // \u53F3\u4E0A\n                result = vec2(uv.z, uv.w);\n            }\n            return result;\n        }\n\n        // \u6839\u636E rect \u83B7\u53D6\u771F\u5B9E\u7684\u5750\u6807\n        vec4 getPos(float rotationScale, float altitudeScale) {\n            float res = unit == 1.0 ? 1.0 : resolution;\n            vec4 result = vec4(position.xyz, 1);\n            result.z *= altitudeScale;\n            if(rect == vec3(0, 0, 1)) {\n                // \u5DE6\u4E0A\n                result.x = result.x - size.x * res / 2.0;\n                result.z = result.z + size.y * res;\n            } else if(rect == vec3(0, 0, 0)) {\n                // \u5DE6\u4E0B\n                result.x = result.x - size.x * res / 2.0;\n            } else if(rect == vec3(1, 0, 1)) {\n                // \u53F3\u4E0A\n                result.x = result.x + size.x * res / 2.0;\n                result.z = result.z + size.y * res;\n            } else if(rect == vec3(1, 0, 0)) {\n                // \u53F3\u4E0B\n                result.x = result.x + size.x * res / 2.0;\n            }\n\n            // \u65CB\u8F6C\n            mat4 matrix = mat4(0);\n            matrix[0].x = 1.0;\n            matrix[1].y = 1.0;\n            matrix[2].z = 1.0;\n            matrix[3].w = 1.0;\n            float r = alwaysFront ? rot : rotation * rotationScale;\n            result.xy -= position.xy;\n            result = rotateZ(matrix, r) * result;\n            result.xy += position.xy;\n            return result;\n        }\n\n        void main() {\n            float rotationScale = rotationScaleValue(position.w);\n            float altitudeScale = altitudeScaleValue(position.w);\n            gl_Position = mvp * getPos(rotationScale, altitudeScale);\n            vTextureCoord = getUV();\n            ").concat(ColorGLSL.getColorShader().mainVert,"\n        }\n    "),fragment:"\n        precision highp float;\n        uniform sampler2D texture;\n        uniform float layerOpacity;\n\n        varying vec2 vTextureCoord;\n        ".concat(ColorGLSL.getColorShader().fragment,"\n\n        void main() {\n            gl_FragColor = texture2D(texture, vTextureCoord);\n            gl_FragColor.a *= layerOpacity;\n            ").concat(ColorGLSL.getColorShader().mainFrag,"\n        }\n    ")},__defProp$6=Object.defineProperty,__defProps$3=Object.defineProperties,__getOwnPropDescs$3=Object.getOwnPropertyDescriptors,__getOwnPropSymbols$6=Object.getOwnPropertySymbols,__hasOwnProp$6=Object.prototype.hasOwnProperty,__propIsEnum$6=Object.prototype.propertyIsEnumerable,__defNormalProp$6=function(n,r,i){return r in n?__defProp$6(n,r,{Fr:!0,Lr:!0,writable:!0,value:i}):n[r]=i},__spreadValues$6=function(n,r){for(var i in r||(r={}))__hasOwnProp$6.call(r,i)&&__defNormalProp$6(n,i,r[i]);var s=!0,a=!1,o=void 0;if(__getOwnPropSymbols$6)try{for(var l=__getOwnPropSymbols$6(r)[Symbol.iterator](),u;!(s=(u=l.next()).done);s=!0){var i=u.value;__propIsEnum$6.call(r,i)&&__defNormalProp$6(n,i,r[i])}}catch(f){a=!0,o=f}finally{try{!s&&l.return!=null&&l.return()}finally{if(a)throw o}}return n},__spreadProps$3=function(n,r){return __defProps$3(n,__getOwnPropDescs$3(r))},ZMarkerRender=function(n){_inherits(i,n);var r=_createSuper(i);function i(){return _classCallCheck(this,i),r.apply(this,arguments)}var s=i.prototype;return s.m$=function(a){if(!this.regl)return!1;var o=this.regl;this.gA(ZMarkerShader,a,{attributes:__spreadValues$6({rect:o.prop("rect"),position:o.prop("position"),size:o.prop("size"),uv:o.prop("uv"),rotation:o.prop("rotation")},ColorGLSL.getColor(o).attribute),uniforms:__spreadValues$6(__spreadValues$6(__spreadValues$6({mvp:o.prop("mvp"),resolution:o.prop("resolution"),rot:o.prop("rot"),texture:o.prop("texture"),layerOpacity:o.prop("layerOpacity"),unit:o.prop("unit"),alwaysFront:o.prop("alwaysFront")},RenderUtil.getScaleUniform("rotation",o)),RenderUtil.getScaleUniform("altitude",o)),ColorGLSL.getColor(o).uniform),depth:{enable:o.prop("depth"),mask:!0,func:"less",range:[0,1]},blend:{enable:!0,func:RenderUtil.getBlend("normal")},count:6,instances:o.prop("count")})},s.render=function(a){var o=this.yA(ZMarkerShader);if(o){var l=a.meshes,u=a.mvp,f=a.opacity,c=a.resolution,h=a.texture,p=a.vP,d=a.rot,v=a.depth;if(!(l.length<1))for(var g=0;g<l.length;g++){var m=l[g],y=m.attributes,b=m.uniforms,_=m.mf,C=_.count;o(__spreadValues$6(__spreadProps$3(__spreadValues$6(__spreadValues$6({},y),b),{unit:b.unit==="px"?0:1,resolution:c,layerOpacity:f,rot:d,texture:h,count:C,depth:v,mvp:u,isPick:!1}),RenderUtil.getScaleProps(p)))}}},s.pickRender=function(a){var o=this.yA(ZMarkerShader);if(o){var l=a.meshes,u=a.mvp,f=a.opacity,c=a.resolution,h=a.texture,p=a.vP,d=a.rot,v=a.depth,g=a.pickFbo,m=a.pickPos;if(!(l.length<1)&&g&&m){var y=this;g.use(function(){y.regl.clear({color:[0,0,0,0],depth:1});for(var b=0;b<l.length;b++){var _=l[b],C=_.attributes,A=_.uniforms,I=_.mf,D=I.count;o(__spreadValues$6(__spreadProps$3(__spreadValues$6(__spreadValues$6({},C),A),{unit:A.unit==="px"?0:1,resolution:c,layerOpacity:f,rot:d,depth:v,texture:h,count:D,mvp:u,isPick:!0}),RenderUtil.getScaleProps(p)))}})}}},i}(Render),pushArray$3=CommonUtil$1._C,ZMarkerLayer=function(n){_inherits(i,n);var r=_createSuper(i);function i(a){_classCallCheck(this,i);var o;o=r.call(this,a),o.CLASS_NAME="ZMarker",o.fusion=new ZMarkerFusion,o.ll=new ZMarkerRender,o.jx=[],o.EM=new Map;var l=zmarker.Sw;return o.zooms=a.zooms===void 0?l.zooms:a.zooms,o.visible=a.visible===void 0?l.visible:a.visible,o.zIndex=a.zIndex===void 0?l.zIndex:a.zIndex,o.opacity=a.opacity===void 0?l.opacity:a.opacity,o.depth=a.depth===void 0?l.depth:a.depth,o.AC({zooms:o.zooms,visible:o.visible,zIndex:o.zIndex}),o.buryPoint.record(o.CLASS_NAME),o}var s=i.prototype;return s.setStyle=function(a){if(_get(_getPrototypeOf(i.prototype),"setStyle",this).call(this,a),this.dataset=this.source.LC(),this.colorPick.clear(),this.Kf=null,this.jx=[],this.EM.clear(),this.dataset&&this.dataset.length>0){var o=this.WC(),l=o.didFusionDataset,u=this.fusion.fusion(l,this.styleOptions,this);this.meshes=u,this.vA.state|=MeshesDirty,this.loca&&this.loca.requestRender()}},s.getInitialAnimateState=function(){return{altitude:{time:[1,0,0,0],type:[-1,1,0,0],value:[0,1]},rotation:{time:[1,0,0,0],type:[-1,1,0,0],value:[0,1]}}},s.receiveDataset=function(a){this.dataset=a,this.setStyle(this.styleOptions),this.onAdd()},s.jC=function(){_get(_getPrototypeOf(i.prototype),"jC",this).call(this),!(!this.loca||!this.loca.regl||this.ll.regl)&&(this.ll.regl=this.loca.regl,this.loca.rendererManager.addRenderer(this.ll))},s.beforeRender=function(){if(_get(_getPrototypeOf(i.prototype),"beforeRender",this).call(this),!this.fusion.regl&&this.loca&&(this.fusion.regl=this.loca.regl,this.loca.fusionManager.addFusion(this.fusion)),this.jC(),this.source&&(this.dataset=this.source.LC()),this.fusion){var a=this.WC(),o=a.willFusion;if(o.length>0){var l=this.fusion.fusion(o,this.styleOptions,this);this.meshes=pushArray$3(this.meshes,l),this.vA.state|=MeshesDirty}}},s.render=function(){var a,o,l;if(!!this.loca&&!!this.PA()&&(this.loca.regl._refresh(),this.Kf)){var u=(a=this.loca)==null?void 0:a.customCoords.getMVPMatrix(),f=this.projection.getResolution((o=this.loca)==null?void 0:o.map.getZoom()),c=-(((l=this.loca)==null?void 0:l.map.getRotation())/180)*Math.PI,h=this.Kf?this.meshes:this.Vx;if(this.ll&&h.length>0)return this.ll.render({texture:this.Kf||this.VM,meshes:h,depth:this.depth,mvp:u,rot:c,resolution:f,opacity:this._getOpacity(),vP:this._animateLayerState}),!0}},s.pickRender=function(){var a,o,l;if(!!this.loca&&!!this.PA()&&(this.loca.regl._refresh(),this.Kf)){var u=(a=this.loca)==null?void 0:a.customCoords.getMVPMatrix(),f=this.projection.getResolution((o=this.loca)==null?void 0:o.map.getZoom()),c=-(((l=this.loca)==null?void 0:l.map.getRotation())/180)*Math.PI,h=this.Kf?this.meshes:this.Vx;this.ll&&h.length>0&&this.ll.pickRender({texture:this.Kf||this.VM,meshes:h,mvp:u,rot:c,depth:this.depth,resolution:f,pickFbo:this._needPickFrame&&this._pickFbo,pickPos:this._pickPos,opacity:this._getOpacity(),vP:this._animateLayerState})}},s.destroy=function(){_get(_getPrototypeOf(i.prototype),"destroy",this).call(this),this.Kf&&this.Kf.destroy&&this.Kf.destroy(),this.Kf=null},s.afterRender=function(){},s.zx=function(){return{BM:this.EM,_x:this.jx}},s.DM=function(a){this.Kf=a,this.loca&&this.loca.requestRender()},s.PA=function(){return RenderHelper.SA(this.ll,this)},i}(Layer),BINARY_EXTENSION_HEADER_MAGIC="glTF",BINARY_EXTENSION_HEADER_LENGTH=12,BINARY_EXTENSION_CHUNK_TYPES={JSON:1313821514,mP:5130562},KHR_BINARY_GLTF="KHR_binary_glTF",LoaderUtils=function(){function n(){_classCallCheck(this,n)}return n.gP=function(r){if(typeof TextDecoder!="undefined")return new TextDecoder().decode(r);for(var i="",s=0,a=r.length;s<a;s++)i+=String.fromCharCode(r[s]);try{return decodeURIComponent(escape(i))}catch(o){return i}},n.bP=function(r){var i=r.lastIndexOf("/");return i===-1?"./":r.substr(0,i+1)},n.yP=function(r,i){return typeof r!="string"||r===""?"":(/^https?:\/\//i.test(i)&&/^\//.test(r)&&(i=i.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(r)||/^data:.*,.*$/i.test(r)||/^blob:.*$/i.test(r)?r:i+r)},n}(),GLTFBinaryExtension=function n(r){_classCallCheck(this,n),this.name=KHR_BINARY_GLTF,this.content=null,this.body=null;var i=new DataView(r,0,BINARY_EXTENSION_HEADER_LENGTH);if(this.xP={wP:"glTF",version:i.getUint32(4,!0),length:i.getUint32(8,!0)},this.xP.wP!==BINARY_EXTENSION_HEADER_MAGIC)throw new Error("error magic");if(this.xP.version<2)throw new Error("error version");for(var s=this.xP.length-BINARY_EXTENSION_HEADER_LENGTH,a=new DataView(r,BINARY_EXTENSION_HEADER_LENGTH),o=0;o<s;){var l=a.getUint32(o,!0);o+=4;var u=a.getUint32(o,!0);if(o+=4,u===BINARY_EXTENSION_CHUNK_TYPES.JSON){var f=new Uint8Array(r,BINARY_EXTENSION_HEADER_LENGTH+o,l);this.content=LoaderUtils.gP(f)}else if(u===BINARY_EXTENSION_CHUNK_TYPES.mP){var c=BINARY_EXTENSION_HEADER_LENGTH+o;this.body=r.slice(c,c+l)}o+=l}if(this.content===null)throw new Error("JSON content not found.")},__async$1=function(n,r,i){return new Promise(function(s,a){var o=function(f){try{u(i.next(f))}catch(c){a(c)}},l=function(f){try{u(i.LA(f))}catch(c){a(c)}},u=function(f){return f.done?s(f.value):Promise.resolve(f.value).then(o,l)};u((i=i.apply(n,r)).next())})},globalUniformBlockID=0,curLoader=null,NUM_MAX_JOINTS=65,Scene=function n(r,i){this.name=i.name!==void 0?i.name:null,this.nodes=new Array(i.nodes.length);for(var s=0,a=i.nodes.length;s<a;s++)this.nodes[s]=r.nodes[i.nodes[s]];this.extensions=i.extensions!==void 0?i.extensions:null,this.CP=i.CP!==void 0?i.CP:null,this.kP=null},BoundingBox=function n(r,i,s){r=r||glMatrix.vec3.fromValues(Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),i=i||glMatrix.vec3.fromValues(Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY),s===void 0||s===!0?(this.min=glMatrix.vec3.clone(r),this.max=glMatrix.vec3.clone(i)):(this.min=r,this.max=i),this.transform=glMatrix.mat4.create()};BoundingBox.prototype.zP=function(n){glMatrix.vec3.min(this.min,this.min,n.min),glMatrix.vec3.max(this.max,this.max,n.max)},BoundingBox.prototype.PP=function(){this.transform[0]=this.max[0]-this.min[0],this.transform[5]=this.max[1]-this.min[1],this.transform[10]=this.max[2]-this.min[2],this.transform[12]=this.min[0],this.transform[13]=this.min[1],this.transform[14]=this.min[2]},BoundingBox.SP=function(){var n=glMatrix.vec3.create(),r=glMatrix.vec3.create(),i=glMatrix.vec3.create(),s=glMatrix.vec3.create(),a=glMatrix.vec3.create();return function(o,l){glMatrix.vec3.set(n,l[0],l[1],l[2]),glMatrix.vec3.set(r,l[4],l[5],l[6]),glMatrix.vec3.set(i,l[8],l[9],l[10]);var u=glMatrix.vec3.fromValues(l[12],l[13],l[14]),f=glMatrix.vec3.clone(u);glMatrix.vec3.scale(s,n,o.min[0]),glMatrix.vec3.scale(a,n,o.max[0]),glMatrix.vec3.min(n,s,a),glMatrix.vec3.add(u,u,n),glMatrix.vec3.max(n,s,a),glMatrix.vec3.add(f,f,n),glMatrix.vec3.scale(s,r,o.min[1]),glMatrix.vec3.scale(a,r,o.max[1]),glMatrix.vec3.min(r,s,a),glMatrix.vec3.add(u,u,r),glMatrix.vec3.max(r,s,a),glMatrix.vec3.add(f,f,r),glMatrix.vec3.scale(s,i,o.min[2]),glMatrix.vec3.scale(a,i,o.max[2]),glMatrix.vec3.min(i,s,a),glMatrix.vec3.add(u,u,i),glMatrix.vec3.max(i,s,a),glMatrix.vec3.add(f,f,i);var c=new BoundingBox(u,f,!1);return c.PP(),c}}();var Accessor=function n(r,i){this.bufferView=i,this.componentType=r.componentType,this.byteOffset=r.byteOffset!==void 0?r.byteOffset:0,this.byteStride=i.byteStride,this.td=r.td!==void 0?r.td:!1,this.count=r.count,this.type=r.type,this.size=Type2NumOfComponent[this.type],this.min=r.min,this.max=r.max,this.extensions=r.extensions!==void 0?r.extensions:null,this.CP=r.CP!==void 0?r.CP:null};Accessor.prototype.MP=function(n,r){r.vertexAttribPointer(n,this.size,this.componentType,this.td,this.byteStride,this.byteOffset),r.enableVertexAttribArray(n)};var BufferView=function n(r,i){this.byteLength=r.byteLength,this.byteOffset=r.byteOffset!==void 0?r.byteOffset:0,this.byteStride=r.byteStride!==void 0?r.byteStride:0,this.target=r.target!==void 0?r.target:null,this.data=i&&i.slice(this.byteOffset,this.byteOffset+this.byteLength),this.extensions=r.extensions!==void 0?r.extensions:null,this.CP=r.CP!==void 0?r.CP:null,this.buffer=null};BufferView.prototype.createBuffer=function(n){this.buffer=n.createBuffer()},BufferView.prototype._P=function(n){return this.target?(n.bindBuffer(this.target,this.buffer),n.bufferData(this.target,this.data,n.STATIC_DRAW),n.bindBuffer(this.target,null),!0):!1};var Camera=function n(r){this.name=r.name!==void 0?r.name:null,this.type=r.type,this.IP=r.IP===void 0?null:r.IP,this.perspective=r.perspective===void 0?null:{VP:r.perspective.VP,DP:r.perspective.DP,LP:r.perspective.LP!==void 0?r.perspective.LP:null,FP:r.perspective.FP!==void 0?r.perspective.FP:null},this.extensions=r.extensions!==void 0?r.extensions:null,this.CP=r.CP!==void 0?r.CP:null},Node=function n(r,i){if(this.name=r.name!==void 0?r.name:null,this.nodeID=i,this.Np=r.Np!==void 0?r.Np:null,this.matrix=glMatrix.mat4.create(),r.hasOwnProperty("matrix")){for(var s=0;s<16;++s)this.matrix[s]=r.matrix[s];this.translation=glMatrix.vec3.create(),glMatrix.mat4.getTranslation(this.translation,this.matrix),this.rotation=glMatrix.quat.create(),glMatrix.mat4.getRotation(this.rotation,this.matrix),this.scale=glMatrix.vec3.create(),glMatrix.mat4.getScaling(this.scale,this.matrix)}else this.RP(r.translation,r.rotation,r.scale);if(this.children=r.children||[],this.mesh=r.mesh!==void 0?curLoader.TP.meshes[r.mesh]:null,this.OP=r.OP!==void 0?r.OP:null,r.extensions!==void 0&&r.extensions.BP!==void 0&&curLoader.AP===!0){var a=curLoader.NP.json.extensions.BP.WP[r.extensions.BP.OP.name],o=curLoader.NP.WP[a];this.OP=new SkinLink(curLoader.TP,o,r.extensions.BP.OP.EP)}this.jP=r.jP!==void 0?r.jP:null,this.extensions=r.extensions!==void 0?r.extensions:null,this.CP=r.CP!==void 0?r.CP:null,this.UP=null,this.GP=new BoundingBox};Node.prototype.HP=function(n,r){r(this,n);for(var i=0,s=this.children.length;i<s;i++)this.children[i].HP(this,r)},Node.prototype.qP=function(n,r){for(var i=0,s=this.children.length;i<s;i++)this.children[i].qP(this,r);r(this,n)},Node.prototype.QP=function(n,r,i){r(this,n);for(var s=0,a=this.children.length;s<a;s++)this.children[s].QP(this,r,i);i(this,n)};var TRSMatrix=glMatrix.mat4.create();Node.prototype.RP=function(n,r,i){this.translation=n!==void 0?glMatrix.vec3.fromValues(n[0],n[1],n[2]):glMatrix.vec3.fromValues(0,0,0),this.rotation=r!==void 0?glMatrix.vec4.fromValues(r[0],r[1],r[2],r[3]):glMatrix.vec4.fromValues(0,0,0,1),this.scale=i!==void 0?glMatrix.vec3.fromValues(i[0],i[1],i[2]):glMatrix.vec3.fromValues(1,1,1),this.XP()},Node.prototype.XP=function(){glMatrix.mat4.fromRotationTranslation(TRSMatrix,this.rotation,this.translation),glMatrix.mat4.scale(this.matrix,TRSMatrix,this.scale)};var Mesh=function n(r,i){this.JP=i,this.name=r.name!==void 0?r.name:null,this.primitives=[],this.kP=null;for(var s,a,o=0,l=r.primitives.length;o<l;++o)s=r.primitives[o],a=new Primitive(curLoader.TP,s),this.primitives.push(a),a.kP&&(this.kP||(this.kP=new BoundingBox),this.kP.zP(a.kP));this.kP&&this.kP.PP(),this.jP=r.jP!==void 0?r.jP:null,this.extensions=r.extensions!==void 0?r.extensions:null,this.CP=r.CP!==void 0?r.CP:null},Primitive=function n(r,i){this.attributes=i.attributes,this.indices=i.indices!==void 0?i.indices:null;var s;if(i.extensions!==void 0&&i.extensions.BP!==void 0&&curLoader.AP===!0&&i.extensions.BP.attributes)for(s in i.extensions.BP.attributes)this.attributes[s]=i.extensions.BP.attributes[s];this.indices!==null?(this.YP=r.json.accessors[this.indices].componentType,this.$P=r.json.accessors[this.indices].count,this.ZP=r.json.accessors[this.indices].byteOffset||0):(this.KP=r.json.accessors[this.attributes.POSITION].count,this.tS=r.json.accessors[this.attributes.POSITION].byteOffset||0);for(s in this.attributes)this.attributes[s]=r.accessors[this.attributes[s]];if(this.material=i.material!==void 0?r.materials[i.material]:null,this.mode=i.mode!==void 0?i.mode:4,this.iS=i.iS,this.extensions=i.extensions!==void 0?i.extensions:null,this.CP=i.CP!==void 0?i.CP:null,this.Lw=null,this.nS=null,this.eS=null,this.Sd=null,this.kP=null,this.attributes.POSITION!==void 0){var a=this.attributes.POSITION;a.max&&a.type==="VEC3"&&(this.kP=new BoundingBox(glMatrix.vec3.fromValues(a.min[0],a.min[1],a.min[2]),glMatrix.vec3.fromValues(a.max[0],a.max[1],a.max[2]),!1),this.kP.PP())}},Texture=function n(r){this.name=r.name!==void 0?r.name:null,this.sampler=r.sampler!==void 0?curLoader.TP.samplers[r.sampler]:null,this.source=r.source!==void 0?curLoader.TP.images[r.source]:null,this.extensions=r.extensions!==void 0?r.extensions:null,this.CP=r.CP!==void 0?r.CP:null,this.texture=null};Texture.prototype.createTexture=function(n){this.texture=n.createTexture(),n.bindTexture(n.TEXTURE_2D,this.texture),n.texImage2D(n.TEXTURE_2D,0,n.RGBA,n.RGBA,n.UNSIGNED_BYTE,this.source),n.generateMipmap(n.TEXTURE_2D),n.bindTexture(n.TEXTURE_2D,null)};var magFilters={9728:"nearest",9729:"linear"},minFilters={9728:"nearest",9729:"linear",9987:"linear mipmap linear",9986:"nearest mipmap linear",9985:"linear mipmap nearest",9984:"nearest mipmap nearest"},wrapMode={10497:"repeat",33071:"clamp",33648:"mirror"},Sampler=function n(r){this.name=r.name!==void 0?r.name:null,this.mag=r.ac!==void 0?magFilters[r.ac]:"linear",this.min=r.oc!==void 0?minFilters[r.oc]:"linear",this.wrapS=r.wrapS!==void 0?wrapMode[r.wrapS]:"repeat",this.wrapT=r.wrapT!==void 0?wrapMode[r.wrapT]:"repeat"},TextureInfo=function n(r){this.index=r.index,this.rS=r.rS!==void 0?r.rS:0,this.extensions=r.extensions!==void 0?r.extensions:null,this.CP=r.CP!==void 0?r.CP:null},PbrMetallicRoughness=function n(r){this.baseColorFactor=r.baseColorFactor!==void 0?r.baseColorFactor:[1,1,1,1],this.baseColorTexture=r.baseColorTexture!==void 0?new TextureInfo(r.baseColorTexture):null,this.metallicFactor=r.metallicFactor!==void 0?r.metallicFactor:1,this.roughnessFactor=r.roughnessFactor!==void 0?r.roughnessFactor:1,this.oS=r.oS!==void 0?new TextureInfo(r.oS):null,this.extensions=r.extensions!==void 0?r.extensions:null,this.CP=r.CP!==void 0?r.CP:null},NormalTextureInfo=function n(r){this.index=r.index,this.rS=r.rS!==void 0?r.rS:0,this.scale=r.scale!==void 0?r.scale:1,this.extensions=r.extensions!==void 0?r.extensions:null,this.CP=r.CP!==void 0?r.CP:null},OcclusionTextureInfo=function n(r){this.index=r.index,this.rS=r.rS!==void 0?r.rS:0,this.sS=r.sS!==void 0?r.sS:1,this.extensions=r.extensions!==void 0?r.extensions:null,this.CP=r.CP!==void 0?r.CP:null},Material=function n(r){this.name=r.name!==void 0?r.name:null,this.pbrMetallicRoughness=r.pbrMetallicRoughness!==void 0?new PbrMetallicRoughness(r.pbrMetallicRoughness):new PbrMetallicRoughness({baseColorFactor:[1,1,1,1],metallicFactor:1,oS:1}),this.aS=r.aS!==void 0?new NormalTextureInfo(r.aS):null,this.uS=r.uS!==void 0?new OcclusionTextureInfo(r.uS):null,this.emissiveTexture=r.emissiveTexture!==void 0?new TextureInfo(r.emissiveTexture):null,this.hS=r.hS!==void 0?r.hS:[0,0,0],this.lS=r.lS!==void 0?r.lS:"OPAQUE",this.fS=r.fS!==void 0?r.fS:.5,this.cS=r.cS||!1,this.extensions=r.extensions!==void 0?r.extensions:null,this.CP=r.CP!==void 0?r.CP:null},Skin=function n(r,i,s){this.name=i.name!==void 0?i.name:null,this.vS=s,this.dS=new Array(i.dS.length);var a,o;for(a=0,o=this.dS.length;a<o;a++)this.dS[a]=r.nodes[i.dS[a]];if(this.pS=i.pS!==void 0?r.nodes[i.pS]:null,this.EP=i.EP!==void 0?r.accessors[i.EP]:null,this.extensions=i.extensions!==void 0?i.extensions:null,this.CP=i.CP!==void 0?i.CP:null,this.mS=globalUniformBlockID++,this.EP)for(this.gS=_getAccessorData(this.EP),this.bS=[],this.yS=null,this.xS=new Float32Array(NUM_MAX_JOINTS*16),a=0,o=this.gS.length;a<o;a+=16)this.bS.push(glMatrix.mat4.fromValues(this.gS[a],this.gS[a+1],this.gS[a+2],this.gS[a+3],this.gS[a+4],this.gS[a+5],this.gS[a+6],this.gS[a+7],this.gS[a+8],this.gS[a+9],this.gS[a+10],this.gS[a+11],this.gS[a+12],this.gS[a+13],this.gS[a+14],this.gS[a+15]))},SkinLink=function n(r,i,s){if(this.wS=!0,r.WP||(r.WP=[]),r.WP.push(this),this.name=i.name,this.vS=r.WP.length-1,this.dS=i.dS,this.pS=i.pS,this.EP=s!==void 0?r.accessors[s]:null,this.mS=globalUniformBlockID++,this.EP){this.gS=_getAccessorData(this.EP),this.bS=[],this.yS=null,this.xS=new Float32Array(NUM_MAX_JOINTS*16);for(var a=0,o=this.gS.length;a<o;a+=16)this.bS.push(glMatrix.mat4.fromValues(this.gS[a],this.gS[a+1],this.gS[a+2],this.gS[a+3],this.gS[a+4],this.gS[a+5],this.gS[a+6],this.gS[a+7],this.gS[a+8],this.gS[a+9],this.gS[a+10],this.gS[a+11],this.gS[a+12],this.gS[a+13],this.gS[a+14],this.gS[a+15]))}},Target=function n(r){this.nodeID=r.node!==void 0?r.node:null,this.path=r.path,this.extensions=r.extensions!==void 0?r.extensions:null,this.CP=r.CP!==void 0?r.CP:null},Channel=function n(r,i){this.sampler=i.samplers[r.sampler],this.target=new Target(r.target),this.extensions=r.extensions!==void 0?r.extensions:null,this.CP=r.CP!==void 0?r.CP:null},AnimationSampler=function n(r,i){this.input=r.accessors[i.input],this.CS=r.accessors[i.CS],this.kS=_getAccessorData(this.input),this.zS=_getAccessorData(this.CS),this.PS=i.PS!==void 0?i.PS:"LINEAR",this.extensions=i.extensions!==void 0?i.extensions:null,this.CP=i.CP!==void 0?i.CP:null,this.SS=0,this.MS=glMatrix.vec4.create(),this._S=this.kS[this.kS.length-1],this.IS=this._S-this.kS[0]},animationOutputValueVec4a=glMatrix.vec4.create(),animationOutputValueVec4b=glMatrix.vec4.create();AnimationSampler.prototype.jf=function(n){n>this._S&&(n-=this.IS*Math.ceil((n-this._S)/this.IS),this.SS=0);for(var r=this.kS.length;this.SS<=r-2&&n>=this.kS[this.SS+1];)this.SS++;this.SS>=r-1&&(n-=this.IS,this.SS=0);for(var i=Type2NumOfComponent[this.CS.type],s=i===4?glMatrix.quat.lb:glMatrix.vec4.Ia,a=this.SS,o=a*i,l=o+i,u=Math.max(0,n-this.kS[a])/(this.kS[a+1]-this.kS[a]),f=0;f<i;f++)animationOutputValueVec4a[f]=this.zS[o+f],animationOutputValueVec4b[f]=this.zS[l+f];switch(this.PS){case"LINEAR":s(this.MS,animationOutputValueVec4a,animationOutputValueVec4b,u);break}};var Animation=function n(r,i){this.name=i.name!==void 0?i.name:null;var s,a;for(this.samplers=[],s=0,a=i.samplers.length;s<a;s++)this.samplers[s]=new AnimationSampler(r,i.samplers[s]);for(this.ic=[],s=0,a=i.ic.length;s<a;s++)this.ic[s]=new Channel(i.ic[s],this);this.extensions=i.extensions!==void 0?i.extensions:null,this.CP=i.CP!==void 0?i.CP:null},glTFModel=function n(r){this.json=r,this.VS=r.scene!==void 0?r.scene:0,this.version=Number(r.asset.version),r.accessors&&(this.accessors=new Array(r.accessors.length)),r.bufferViews&&(this.bufferViews=new Array(r.bufferViews.length)),r.scenes&&(this.scenes=new Array(r.scenes.length)),r.nodes&&(this.nodes=new Array(r.nodes.length)),r.meshes&&(this.meshes=new Array(r.meshes.length)),r.materials&&(this.materials=new Array(r.materials.length)),r.textures&&(this.textures=new Array(r.textures.length)),r.samplers&&(this.samplers=new Array(r.samplers.length)),r.images&&(this.images=new Array(r.images.length)),r.WP&&(this.WP=new Array(r.WP.length)),r.DS&&(this.DS=new Array(r.DS.length)),r.cameras&&(this.cameras=new Array(r.cameras.length)),this.extensions=r.extensions!==void 0?r.extensions:null,this.CP=r.CP!==void 0?r.CP:null},glTFLoader=function n(){this.LS(),this.TP=null,this.AP=!1,this.FS=null};glTFLoader.prototype.LS=function(){this.RS=!1,this.TS=0,this.OS=0,this.BS=[],this.AS={},this.WS=0,this.NS=0,this.ES=0,this.jS=0,this.US=0,this.GS=0,this.onload=null,curLoader=this},glTFLoader.prototype.HS=function(){this.TS==this.OS&&this.ES==this.jS&&(this.RS=!0),this.RS&&this.US==this.GS&&(this.qS(),this.onload(this.TP))},glTFLoader.prototype.QS=function(n,r,i){this.AP=!0,this.NP=r,this.XS(n,i)},glTFLoader.prototype.JS=function(n){var r=0,i=0;if(this.TP.bufferViews)for(r=0,i=this.TP.bufferViews.length;r<i;r++)this.TP.bufferViews[r]=new BufferView(this.TP.json.bufferViews[r],this.BS[this.TP.json.bufferViews[r].buffer]);var s=this,a=function(c,h){s.jS++,s.TP.images[h]=c,s.HS()},o;if(n.images){for(o in n.images)if(s.ES++,n.images[o].uri)if(n.images[o].uri.indexOf("data:")>-1){var l=n.images[o].uri;_loadImage(l,o,a)}else _loadImage(s.YS+n.images[o].uri,o,a);else if(n.images[o].bufferView!==void 0){var u=new Blob([this.TP.bufferViews[this.TP.json.images[o].bufferView].data],{type:n.images[o].mimeType}),f=URL.createObjectURL(u);_loadImage(f,o,a)}}else s.HS()},glTFLoader.prototype.XS=function(n,r){n.indexOf("glb")>-1?this.$S(n,r):this.ZS(n,r)},glTFLoader.prototype.ZS=function(n,r){this.LS(),this.onload=r||function(s){console.log("glTF model loaded.")},this.YS=_getBaseUri(n);var i=this;_loadJSON(n,function(s){var a=JSON.parse(s);i.TP=new glTFModel(a);var o,l=function(h,p){var d=parseInt(p);i.BS[d]=h,i.OS++,i.OS===i.TS&&i.JS(a)};if(a.buffers)for(o in a.buffers){var u=o;if(i.TS++,a.buffers[u].uri.indexOf("data:")>-1){var f=function(h){for(var p=h.split("base64,")[1],d=window.atob(p),v=d.length,g=new Uint8Array(v),m=0;m<v;m++)g[m]=d.charCodeAt(m);return g.buffer},c=f(a.buffers[u].uri);l(c,u)}else _loadArrayBuffer(i.YS+a.buffers[u].uri,l,u)}else i.JS(a)})},glTFLoader.prototype.$S=function(n,r){this.LS(),this.onload=r||function(s){console.log("glTF model loaded.")},this.YS=_getBaseUri(n);var i=this;_loadGlb(n,function(s){var a=JSON.parse(s.content);i.TP=new glTFModel(a);var o,l=function(f,c){var h=parseInt(c);i.BS[h]=f,i.OS++,i.OS===i.TS&&i.JS(a)};if(a.buffers)for(o in a.buffers){var u=o;i.TS++,l(s.body,u)}else i.JS(a)})},glTFLoader.prototype.qS=function(){var n=function(p,d){var v=c[p.nodeID];d!==null?glMatrix.mat4.mul(v,c[d.nodeID],p.matrix):glMatrix.mat4.copy(v,p.matrix)},r=function(p,d){var v=c[p.nodeID],g;d!==null?g=d.GP:g=l.kP,p.mesh&&(f=p.mesh,f.kP&&(p.UP=BoundingBox.SP(f.kP,v),p.children.length===0&&(glMatrix.vec3.copy(p.GP.min,p.UP.min),glMatrix.vec3.copy(p.GP.max,p.UP.max)))),glMatrix.vec3.min(g.min,g.min,p.GP.min),glMatrix.vec3.max(g.max,g.max,p.GP.max)};curLoader=this;var i,s,a,o,l,u,f;if(this.TP.cameras)for(i=0,s=this.TP.cameras.length;i<s;i++)this.TP.cameras[i]=new Camera(this.TP.json.cameras[i]);if(this.TP.accessors)for(i=0,s=this.TP.accessors.length;i<s;i++)this.TP.accessors[i]=new Accessor(this.TP.json.accessors[i],this.TP.bufferViews[this.TP.json.accessors[i].bufferView]);if(this.TP.materials)for(i=0,s=this.TP.materials.length;i<s;i++)this.TP.materials[i]=new Material(this.TP.json.materials[i]);if(this.TP.samplers)for(i=0,s=this.TP.samplers.length;i<s;i++)this.TP.samplers[i]=new Sampler(this.TP.json.samplers[i]);if(this.TP.textures)for(i=0,s=this.TP.textures.length;i<s;i++)this.TP.textures[i]=new Texture(this.TP.json.textures[i]);for(i=0,s=this.TP.meshes.length;i<s;i++)this.TP.meshes[i]=new Mesh(this.TP.json.meshes[i],i);for(i=0,s=this.TP.nodes.length;i<s;i++)this.TP.nodes[i]=new Node(this.TP.json.nodes[i],i);for(i=0,s=this.TP.nodes.length;i<s;i++)for(u=this.TP.nodes[i],a=0,o=u.children.length;a<o;a++)u.children[a]=this.TP.nodes[u.children[a]];var c=new Array(this.TP.nodes.length);for(i=0,s=c.length;i<s;i++)c[i]=glMatrix.mat4.create();for(i=0,s=this.TP.scenes.length;i<s;i++){for(l=this.TP.scenes[i]=new Scene(this.TP,this.TP.json.scenes[i]),l.kP=new BoundingBox,a=0,o=l.nodes.length;a<o;a++)u=l.nodes[a],u.QP(null,n,r);l.kP.PP()}for(a=0,o=this.TP.nodes.length;a<o;a++)u=this.TP.nodes[a],u.GP!==null&&u.GP.PP();if(this.TP.DS)for(i=0,s=this.TP.DS.length;i<s;i++)this.TP.DS[i]=new Animation(this.TP,this.TP.json.DS[i]);var h;if(this.TP.json.WP)for(i=0,s=this.TP.WP.length;i<s;i++)for(this.TP.WP[i]=new Skin(this.TP,this.TP.json.WP[i],i),h=this.TP.WP[i].dS,a=0,o=h.length;a<o;a++)h[a].KS=a;for(i=0,s=this.TP.nodes.length;i<s;i++)u=this.TP.nodes[i],u.OP!==null&&typeof u.OP=="number"&&(u.OP=this.TP.WP[u.OP])};var Type2NumOfComponent={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},canvas=document.createElement("canvas"),context=canvas.getContext("2d"),__defProp$5=Object.defineProperty,__getOwnPropSymbols$5=Object.getOwnPropertySymbols,__hasOwnProp$5=Object.prototype.hasOwnProperty,__propIsEnum$5=Object.prototype.propertyIsEnumerable,__defNormalProp$5=function(n,r,i){return r in n?__defProp$5(n,r,{Fr:!0,Lr:!0,writable:!0,value:i}):n[r]=i},__spreadValues$5=function(n,r){for(var i in r||(r={}))__hasOwnProp$5.call(r,i)&&__defNormalProp$5(n,i,r[i]);var s=!0,a=!1,o=void 0;if(__getOwnPropSymbols$5)try{for(var l=__getOwnPropSymbols$5(r)[Symbol.iterator](),u;!(s=(u=l.next()).done);s=!0){var i=u.value;__propIsEnum$5.call(r,i)&&__defNormalProp$5(n,i,r[i])}}catch(f){a=!0,o=f}finally{try{!s&&l.return!=null&&l.return()}finally{if(a)throw o}}return n},__async=function(n,r,i){return new Promise(function(s,a){var o=function(f){try{u(i.next(f))}catch(c){a(c)}},l=function(f){try{u(i.LA(f))}catch(c){a(c)}},u=function(f){return f.done?s(f.value):Promise.resolve(f.value).then(o,l)};u((i=i.apply(n,r)).next())})},GLTF=function(){function n(i,s){_classCallCheck(this,n),this.nodes=[],this.meshes=[],this.t_=[],this.i_=[],this.materials=[],this.textures=[],this.accessors=[],this.bufferViews=[],this.samplers=[],this.DS=[],this.scene={},this.n_={},this.url=i,this.regl=s,this.i_=[]}var r=n.prototype;return r.e_=function(){return __async(this,null,regeneratorRuntime$1.mark(function i(){var s;return regeneratorRuntime$1.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,this.r_();case 2:return s=a.sent,a.abrupt("return",s);case 4:case"end":return a.stop()}},i,this)}))},r.r_=function(){return __async(this,null,regeneratorRuntime$1.mark(function i(){var s;return regeneratorRuntime$1.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return s=this,a.next=3,new Promise(function(o,l){var u=s,f=new glTFLoader;f.XS(s.url,function(c){!c||!c.json?l({s_:"no gltf"}):(u.o_=c,u.parseData(c),o(u))})});case 3:return a.abrupt("return",a.sent);case 4:case"end":return a.stop()}},i,this)}))},r.parseData=function(i){var s=i.scenes,a=i.nodes,o=i.json,l=i.accessors;this.accessors=l;for(var u=o.scene||0,f=s[u].nodes,c=0;c<f.length;c++){var h=a[f[c].nodeID];this.a_(h)}var p=this.u_();this.h_(p),this.l_()},r.l_=function(){this.i_.sort(function(i,s){return i.parseData.f_.length-s.parseData.f_.length})},r.a_=function(i,s){var a=glMatrix.mat4.create();if(i.matrix&&glMatrix.mat4.multiply(a,i.matrix,a),s&&glMatrix.mat4.multiply(a,s,a),i.mesh)this.t_.push({mesh:i.mesh,finalMatrix:a});else if(i.children)for(var o=i.children,l=o.length,u=0;u<l;u++)a?this.a_(o[u],a):this.a_(o[u])},r.u_=function(){for(var i=this.t_.length,s={},a=0;a<i;a++){var o=this.t_[a],l=o.mesh,u=l.JP;s[u]||(s[u]={finalMatrix:[],mesh:o.mesh}),s[u].finalMatrix.push(o.finalMatrix)}return s},r.h_=function(i){for(var s=Object.keys(i),a=s.length,o=0;o<a;o++)for(var l=s[o],u=i[l],f=u.mesh,c=u.finalMatrix,h=f.primitives,p=0;p<h.length;p++){var d=h[p],v=d.attributes,g=d.indices,m=d.material,y={array:this.regl.elements()},b={array:this.regl.buffer(),offset:0,stride:0},_={array:this.regl.buffer(),offset:0,stride:0,HAS:0},C={array:this.regl.buffer(),offset:0,stride:0},A={color:[0,0,0,1],texture:this.regl.texture(),MRtexture:this.regl.texture(),emissiveTexture:this.regl.texture(),HAS_TEXTURE:0,metallicFactor:1,roughnessFactor:1},I={};if(m&&m.pbrMetallicRoughness){if(m.pbrMetallicRoughness.baseColorFactor&&(A.color=m.pbrMetallicRoughness.baseColorFactor),m.pbrMetallicRoughness.baseColorTexture){var D=m.pbrMetallicRoughness.baseColorTexture.index,X=this.o_.textures[D],W=X.source;A.texture=this.regl.texture(__spreadValues$5({data:W.data||W,width:W.width,height:W.height},X.sampler)),I.HAS_BASE_TEXTURE=1}if(m.pbrMetallicRoughness.roughnessFactor&&(A.roughnessFactor=m.pbrMetallicRoughness.roughnessFactor),m.pbrMetallicRoughness.metallicFactor&&(A.metallicFactor=m.pbrMetallicRoughness.metallicFactor),m.pbrMetallicRoughness.oS){var K=m.pbrMetallicRoughness.oS.index,U=this.o_.textures[K],M=U.source;A.MRtexture=this.regl.texture(__spreadValues$5({data:M.data||M,width:M.width,height:M.height},U.sampler)),I.HAS_MR_TEXTURE=1}if(m.emissiveTexture){var L=m.emissiveTexture.index,P=this.o_.textures[L],$=P.source;A.emissiveTexture=this.regl.texture(__spreadValues$5({data:$.data||$,width:$.width,height:$.height},P.sampler)),I.HAS_EMIS_TEXTURE=1}}if(g!==void 0){var R=this.accessors[g];y=formatArray(R,this.regl,"element")}var T=v.POSITION,w=v.NORMAL,E=v.TEXCOORD_0;T&&(b=formatArray(v.POSITION,this.regl,"buffer")),w&&(_=formatArray(v.NORMAL,this.regl,"buffer"),I.HAS_NORMAL=1),E&&(C=formatArray(v.TEXCOORD_0,this.regl,"buffer"));var O={c_:this.accessors[g||0],v_:b,d_:_,p_:C,m_:y,g_:A,b_:I,f_:JSON.stringify(I)};this.i_.push({parseData:O,finalMatrix:c,finalMatrixCount:c.length})}},n}(),GLTFFusion=function(n){_inherits(i,n);var r=_createSuper(i);function i(){return _classCallCheck(this,i),r.apply(this,arguments)}var s=i.prototype;return s.buildStyle=function(a,o){for(var l=gltf.style,u=[],f=0;f<a.length;f++)if(!(!a[f].features||!a[f].features.points)){var c=a[f].features.points,h=StyleInstance.parse(c,o,l);u.push(h)}return u},s.fusion=function(a,o,l){var u=this,f=function(m,y){for(var b=u,_=function(D){var X=A[D],W=X.coordinates,K=X.properties,U=(c=l.loca)==null?void 0:c.customCoords,M=U.lngLatToCoord(W),L=d[m].attributes,P=L.rotateX,$=L.rotateY,R=L.rotateZ,T=L.visible,w=L.height,E=L.scale,O=[P[D],$[D],R[D]],k=T[D],F=w[D],q=E[D];if(K&&K.url){var Y=K.url,fe=new GLTF(Y,(h=l.loca)==null?void 0:h.regl),_e=l.x_.y_(Y);if(_e)_e.status==="loaded"?b.w_(_e.data,{properties:K,C_:O,k_:k,z_:F,P_:q,position:M,coordinates:W},l):(l.S_[Y]||(l.S_[Y]=[]),l.S_[Y].push({style:{properties:K,C_:O,k_:k,z_:F,P_:q,position:M,coordinates:W}}));else{var Pe=b;l.x_.M_(Y),fe.e_().then(function(De){if(l.x_.__(Y,De),Pe.w_(De,{properties:K,C_:O,k_:k,z_:F,P_:q,position:M,coordinates:W},l),l.S_[Y]&&l.S_[Y].length>0)for(var tt=l.S_[Y].length;tt>0;tt--)Pe.w_(De,l.S_[Y][tt-1].style,l),l.S_[Y].pop()})}}},C=a[m],A=C.features.points,I=0;I<A.length;I++)_(I);p[m]={id:C.id,attributes:{},uniforms:{},si:{},mf:{},status:"buffered"}},c,h;if(!this.regl||!l.loca)return[];for(var p=[],d=this.buildStyle(a,o),v=0,g=a.length;v<g;v++)f(v);return p},s.w_=function(a,o,l){var u=o.C_,f=o.k_,c=o.z_,h=o.P_,p=o.position,d=o.coordinates,v=o.properties,g=JSON.parse(JSON.stringify(a.o_.scenes[0].kP||{}));g.scale=h,g.height=c,g.position={lnglat:d,locaPos:p};for(var m=a.i_,y=[],b=0;b<m.length;b++){var _=m[b],C={id:b.toString(),status:"buffered",attributes:{Iw:_,I_:p,C_:u,k_:f,z_:c,P_:h},uniforms:{color:[1,0,0,1]},si:{}};y.push(C)}l.V_.push({sceneBBox:g,meshes:y,D_:v.url}),this.L_(l),l.requestRender()},s.L_=function(a){for(var o,l={},u=0;u<a.V_.length;u++){var f=a.V_[u],c=f.D_,h=f.sceneBBox,p=f.meshes,d=h.position.locaPos,v=h.height;l[c]||(l[c]={F_:p,position:[]}),l[c].position.push([d[0],d[1],v]),l[c].sceneBBox=h}for(var g in l)l[g].positionBuffer=(o=a.loca)==null?void 0:o.regl.buffer(l[g].position.map(function(m){return m}));a.R_=l},s.DC=function(){},s.EC=function(){return[]},s.destroy=function(){this.regl=null},i}(GeometryFusion),__defProp$4=Object.defineProperty,__getOwnPropSymbols$4=Object.getOwnPropertySymbols,__hasOwnProp$4=Object.prototype.hasOwnProperty,__propIsEnum$4=Object.prototype.propertyIsEnumerable,__defNormalProp$4=function(n,r,i){return r in n?__defProp$4(n,r,{Fr:!0,Lr:!0,writable:!0,value:i}):n[r]=i},__spreadValues$4=function(n,r){for(var i in r||(r={}))__hasOwnProp$4.call(r,i)&&__defNormalProp$4(n,i,r[i]);var s=!0,a=!1,o=void 0;if(__getOwnPropSymbols$4)try{for(var l=__getOwnPropSymbols$4(r)[Symbol.iterator](),u;!(s=(u=l.next()).done);s=!0){var i=u.value;__propIsEnum$4.call(r,i)&&__defNormalProp$4(n,i,r[i])}}catch(f){a=!0,o=f}finally{try{!s&&l.return!=null&&l.return()}finally{if(a)throw o}}return n},GLTFShader={vertex:"\n        precision mediump float;\n        attribute vec3 model_pos;\n        \n        #ifdef HAS_BASE_TEXTURE\n            attribute vec2 uvs;\n            varying vec2 vUv;\n        #endif\n\n        attribute vec3 normal_pos;\n        // attribute mat4 model_matrix;\n        uniform mat4 model_matrix;\n\n\n        varying vec3 vNormal;\n        varying vec3 vPosition;\n\n\n        uniform mat4 mvp;\n        uniform mat4 rotateMatrix;\n        // uniform vec3 point_pos;\n        attribute vec3 point_pos;\n\n        void main () {\n\n            #ifdef HAS_BASE_TEXTURE\n                vUv = uvs;\n            #endif\n\n            vNormal = normalize(normal_pos.xzy);\n            vec4 tmpPos = rotateMatrix * model_matrix * vec4(model_pos.xyz,1.);\n            \n            // vPosition \u5C40\u90E8\u58A8\u5361\u6258\u5750\u6807\n            vPosition = vec3(tmpPos.xy + point_pos.xy, tmpPos.z + point_pos.z);\n\n            vec4 pos =  mvp * vec4(tmpPos.xy + point_pos.xy, tmpPos.z + point_pos.z,1);\n            gl_Position = pos;\n\n        }\n    ",fragment:"\n            precision mediump float;\n            // precision highp float;\n\n            uniform vec4 model_texture_color;\n            uniform sampler2D texture; \n\n            uniform sampler2D MRtexture; \n\n            uniform sampler2D emissiveTexture; \n\n            uniform float roughnessFactor;\n            uniform float metallicFactor;\n\n            // uniform float ambIntensity;\n\n                \n            uniform vec3 lightDir;\n            #ifdef HAS_BASE_TEXTURE\n                varying vec2 vUv;\n            #endif\n\n            varying vec3 vNormal;\n            varying vec3 vPosition;\n\n            // uniform float shininess;\n\n            const float c_MinRoughness = 0.04;\n\n            struct PBRInfo\n            {\n                float NdotL;                  // cos angle between normal and light direction\n                float NdotV;                  // cos angle between normal and view direction\n                float NdotH;                  // cos angle between normal and half vector\n                float LdotH;                  // cos angle between light direction and half vector\n                float VdotH;                  // cos angle between view direction and half vector\n                float perceptualRoughness;    // roughness value, as authored by the model creator (input to shader)\n                float metalness;              // metallic value at the surface\n                vec3 reflectance0;            // full reflectance color (normal incidence angle)\n                vec3 reflectance90;           // reflectance color at grazing angle\n                float alphaRoughness;         // roughness mapped to a more linear change in the roughness (proposed by [2])\n                vec3 diffuseColor;            // color contribution from diffuse lighting\n                vec3 specularColor;           // color contribution from specular lighting\n            };\n\n            uniform vec3 cameraPosition;\n            uniform float shininess;\n            #include <lightUniforms>;\n\n            // vec3 lightDir = normalize(lightPosition - position);\n            // vec3 cameraDirection = normalize(cameraPosition - position);\n\n\n            const float PI = 3.14159265359;\n            const float M_PI = 3.141592653589793;\n\n\n\n            // http://chilliant.blogspot.com/2012/08/srgb-approximations-for-hlsl.html\n            vec3 linearTosRGB(vec3 color)\n            {\n                const float GAMMA = 2.2;\n                const float INV_GAMMA = 1.0 / GAMMA;    \n                return pow(color, vec3(INV_GAMMA));\n            }\n\n            float DistributionGGX(vec3 N, vec3 H, float roughness)\n            {\n                float a = roughness * roughness;\n                float a2 = a * a;\n                float NdotH = max(dot(N, H), 0.0);\n                float NdotH2 = NdotH * NdotH;\n\n                float nom = a2;\n                float denom = (NdotH2 * (a2 - 1.0) + 1.0);\n                denom = PI * denom * denom;\n\n                return nom / max(denom, 0.001);\n            }\n            float GeometrySchlickGGX(float NdotV, float roughness)\n            {\n                float r = (roughness + 1.0);\n                float k = (r*r) / 8.0;\n\n                float nom   = NdotV;\n                float denom = NdotV * (1.0 - k) + k;\n\n                return nom / denom;\n            }\n            float GeometrySmith(vec3 N, vec3 V, vec3 L, float roughness)\n            {\n                float NdotV = max(dot(N, V), 0.0);\n                float NdotL = max(dot(N, L), 0.0);\n                float ggx2 = GeometrySchlickGGX(NdotV, roughness);\n                float ggx1 = GeometrySchlickGGX(NdotL, roughness);\n\n                return ggx1 * ggx2;\n            }\n            vec3 fresnelSchlick(float cosTheta, vec3 F0)\n            {\n                return F0 + (1.0 - F0) * pow(1.0 - cosTheta, 5.0);\n            }\n\n            vec3 specularReflection(PBRInfo pbrInputs)\n            {\n                return pbrInputs.reflectance0 + (pbrInputs.reflectance90 - pbrInputs.reflectance0) * pow(clamp(1.0 - pbrInputs.VdotH, 0.0, 1.0), 5.0);\n            }\n\n            float visibilityOcclusion(PBRInfo pbrInputs)\n            {\n                float NdotL = pbrInputs.NdotL;\n                float NdotV = pbrInputs.NdotV;\n                float alphaRoughnessSq = pbrInputs.alphaRoughness * pbrInputs.alphaRoughness;\n\n                float GGXV = NdotL * sqrt(NdotV * NdotV * (1.0 - alphaRoughnessSq) + alphaRoughnessSq);\n                float GGXL = NdotV * sqrt(NdotL * NdotL * (1.0 - alphaRoughnessSq) + alphaRoughnessSq);\n                return 0.5 / (GGXV + GGXL);\n            }\n\n            float microfacetDistribution(PBRInfo pbrInputs)\n            {\n                float roughnessSq = pbrInputs.alphaRoughness * pbrInputs.alphaRoughness;\n                float f = (pbrInputs.NdotH * roughnessSq - pbrInputs.NdotH) * pbrInputs.NdotH + 1.0;\n                return roughnessSq / (M_PI * f * f);\n            }\n            vec3 diffuse(PBRInfo pbrInputs)\n            {\n                return pbrInputs.diffuseColor / M_PI;\n            }\n\n            vec3 gammaCorrection(vec3 color) {\n                return pow(color, vec3(1.0 / 2.2));\n            }\n\n\n           \n\n\n            void main () {\n                // \u57FA\u8272\n                vec4 baseColor = model_texture_color;\n\n                #ifdef HAS_BASE_TEXTURE\n                    baseColor = texture2D(texture, vUv);\n                #endif\n\n                // \u8BA1\u7B97 \u7C97\u7CD9\u5EA6 \u548C \u91D1\u5C5E\u5EA6\n           \n                float perceptualRoughness = roughnessFactor;\n                float metallic = metallicFactor;\n\n                #ifdef HAS_MR_TEXTURE\n                    vec4 MRtextureColor = texture2D(MRtexture, vUv);\n                    perceptualRoughness = MRtextureColor.g;\n                    metallic = MRtextureColor.b;\n                #endif\n \n                // c_MinRoughness = 0.04 \u7ECF\u9A8C\u503C\n                perceptualRoughness = clamp(perceptualRoughness, c_MinRoughness, 1.0);\n                metallic = clamp(metallic, 0.0, 1.0);\n                float alphaRoughness = perceptualRoughness * perceptualRoughness;\n                \n\n                vec3 f0 = vec3(0.04);\n                vec3 diffuseColor = baseColor.rgb * (vec3(1.0) - f0);\n                diffuseColor *= 1.0 - metallic;\n                vec3 specularColor = mix(f0, baseColor.rgb, metallic);\n\n                // \u8BA1\u7B97\u53CD\u5C04\u7387 reflectance.\n                float reflectance = max(max(specularColor.r, specularColor.g), specularColor.b);\n                float reflectance90 = clamp(reflectance * 25.0, 0.0, 1.0);\n                vec3 specularEnvironmentR0 = specularColor.rgb;\n                vec3 specularEnvironmentR90 = vec3(1.0, 1.0, 1.0) * reflectance90;\n\n                vec3 n = normalize(vNormal);\n                vec3 v = normalize(cameraPosition - vPosition);  \n                // vec3 l = normalize(u_LightDirection);             \n                // Vector from surface point to light\n\n                // \u70B9\u3001\u5E73\u884C\u5149\u3001\u73AF\u5883\u5149\n                // vec3 color = baseColor.rgb;\n                vec3 color = vec3(0.0);\n\n\n                vec3 diffuseContrib = vec3(0.0);\n                vec3 specContrib = vec3(0.0);\n\n                for (int i = 0; i < NUMBER_OF_POINT_LIGHTS; i++) {\n                    PointLight pointLight = pointLights[i];\n                    // vec3 lightPosition = vec3(1.,1.,100.);\n                    vec3 l = normalize(pointLight.position - vPosition);\n\n                    // \u8BA1\u7B97\u534A\u89D2\u5411\u91CF h \n                    vec3 h = normalize(l + v);                         \n                    vec3 reflection = -normalize(reflect(v, n));\n\n                    float NdotL = clamp(dot(n, l), 0.001, 1.0);\n                    float NdotV = clamp(abs(dot(n, v)), 0.001, 1.0);\n                    float NdotH = clamp(dot(n, h), 0.0, 1.0);\n                    float LdotH = clamp(dot(l, h), 0.0, 1.0);\n                    float VdotH = clamp(dot(v, h), 0.0, 1.0);\n\n                    PBRInfo pbrInputs = PBRInfo(\n                        NdotL,\n                        NdotV,\n                        NdotH,\n                        LdotH,\n                        VdotH,\n                        perceptualRoughness,\n                        metallic,\n                        specularEnvironmentR0,\n                        specularEnvironmentR90,\n                        alphaRoughness,\n                        diffuseColor,\n                        specularColor\n                    );\n\n                    vec3 F = specularReflection(pbrInputs);\n                    float Vis = visibilityOcclusion(pbrInputs);\n                    float D = microfacetDistribution(pbrInputs);\n\n                    // Calculation of analytical lighting contribution\n                    diffuseContrib = (1.0 - F) * diffuse(pbrInputs);\n                    specContrib = F * Vis * D;\n\n\n                    // vec3 lightColor = vec3(1.,0.,1.);\n\n\n                    color =  NdotL * pointLight.lightColor * (diffuseContrib + specContrib);\n\n                }\n\n\n                // color = mix(color, baseColor.rgb, 1.);\n\n                // \u574F\u5883\u5149\n                // vec4 ambLightColor = vec4(1.,1.,1.,1.);\n\n                // float ambintensityFactor = 0.6;\n                // if(ambIntensity) {\n                //     ambintensityFactor = ambIntensity;\n                // }\n\n\n                vec4 amb = vec4(ambientLight.lightColor, 1.) * baseColor * ambientLight.intensity;\n\n                gl_FragColor = amb + vec4(gammaCorrection(color), baseColor.a);\n                // gl_FragColor = baseColor;\n\n\n                return;\n\n              \n            }\n        ",includes:__spreadValues$4({},LightIncludes)},__defProp$3=Object.defineProperty,__defProps$2=Object.defineProperties,__getOwnPropDescs$2=Object.getOwnPropertyDescriptors,__getOwnPropSymbols$3=Object.getOwnPropertySymbols,__hasOwnProp$3=Object.prototype.hasOwnProperty,__propIsEnum$3=Object.prototype.propertyIsEnumerable,__defNormalProp$3=function(n,r,i){return r in n?__defProp$3(n,r,{Fr:!0,Lr:!0,writable:!0,value:i}):n[r]=i},__spreadValues$3=function(n,r){for(var i in r||(r={}))__hasOwnProp$3.call(r,i)&&__defNormalProp$3(n,i,r[i]);var s=!0,a=!1,o=void 0;if(__getOwnPropSymbols$3)try{for(var l=__getOwnPropSymbols$3(r)[Symbol.iterator](),u;!(s=(u=l.next()).done);s=!0){var i=u.value;__propIsEnum$3.call(r,i)&&__defNormalProp$3(n,i,r[i])}}catch(f){a=!0,o=f}finally{try{!s&&l.return!=null&&l.return()}finally{if(a)throw o}}return n},__spreadProps$2=function(n,r){return __defProps$2(n,__getOwnPropDescs$2(r))},__objRest=function(n,r){var i={};for(var s in n)__hasOwnProp$3.call(n,s)&&r.indexOf(s)<0&&(i[s]=n[s]);var a=!0,o=!1,l=void 0;if(n!=null&&__getOwnPropSymbols$3)try{for(var u=__getOwnPropSymbols$3(n)[Symbol.iterator](),f;!(a=(f=u.next()).done);a=!0){var s=f.value;r.indexOf(s)<0&&__propIsEnum$3.call(n,s)&&(i[s]=n[s])}}catch(c){o=!0,l=c}finally{try{!a&&u.return!=null&&u.return()}finally{if(o)throw l}}return i},GLTFRender=function(n){_inherits(i,n);var r=_createSuper(i);function i(){return _classCallCheck(this,i),r.apply(this,arguments)}var s=i.prototype;return s.m$=function(a){if(!this.regl)return!1;for(var o=this.regl,l=RenderHelper._A(a,o),u=a,f=u.GLTF_PARAMS,c=__objRest(u,["GLTF_PARAMS"]),h=0;h<f.length;h++)this.gA(GLTFShader,__spreadValues$3(__spreadValues$3({},f[h]),c),{attributes:{model_pos:o.prop("model_pos"),uvs:o.prop("model_uvs"),normal_pos:o.prop("normal_pos"),point_pos:o.prop("point_pos")},uniforms:__spreadValues$3({mvp:o.prop("mvp"),rotateMatrix:o.prop("rotateMatrix"),shininess:o.prop("shininess"),cameraPosition:o.prop("cameraPosition"),texture:o.prop("model_texture"),MRtexture:o.prop("model_MRtexture"),emissiveTexture:o.prop("model_emissiveTexture"),lightColor:[1,1,1],lightDir:[1,1,1],HAS_TEXTURE:o.prop("HAS_TEXTURE"),metallicFactor:o.prop("metallicFactor"),roughnessFactor:o.prop("roughnessFactor"),model_texture_color:o.prop("model_texture_color"),model_matrix:o.prop("model_matrix")},l),elements:o.prop("element"),blend:{enable:!0,func:RenderUtil.getBlend("normal")},cull:{enable:!0},instances:o.prop("instances_count")},h)},s.render=function(a){var o=a.B_,l=a.mvp,u=a.cameraPosition,f=a.lights;if(this.regl)for(var c=Object.keys(o),h=c.length,p=-1,d=0;d<h;d++)for(var v=o[c[d]].F_,g=v.length,m=0;m<g;m++){p+=1;var y=v[m],b=y.attributes,_=b.C_,C=b.P_,A=b.Iw,I=A.finalMatrix,D=A.parseData,X=D.v_,W=D.m_,K=D.p_,U=D.g_,M=D.d_;D.b_;var L=glMatrix.mat4.create();if(_&&_[0]){var P=_[0]*Math.PI/180;glMatrix.mat4.rotateX(L,L,P)}if(_&&_[1]){var $=_[1]*Math.PI/180;glMatrix.mat4.rotateY(L,L,$)}if(_&&_[2]){var R=_[2]*Math.PI/180;glMatrix.mat4.rotateZ(L,L,R)}C&&glMatrix.mat4.scale(L,L,C);var T=o[c[d]].position.length;b={model_pos:{buffer:X.array,offset:X.offset,divisor:0,stride:X.stride},model_uvs:{buffer:K.array,offset:K.offset,divisor:0,stride:K.stride},normal_pos:{buffer:M.array,offset:M.offset,divisor:0,stride:M.stride},model_texture:U.texture,model_MRtexture:U.MRtexture,model_emissiveTexture:U.emissiveTexture,model_texture_color:U.color,point_pos:{buffer:o[c[d]].positionBuffer,divisor:1},element:W.array,rotateMatrix:L,roughnessFactor:U.roughnessFactor,metallicFactor:U.metallicFactor,instances_count:T};var w=this.yA(GLTFShader,p);if(!w){console.error("Missing shader cmd at ".concat(p));continue}for(var E=0;E<I.length;E++)b.model_matrix=I[E],w(__spreadProps$2(__spreadValues$3(__spreadProps$2(__spreadValues$3({},b),{isPick:!1,mvp:l,cameraPosition:u}),f),{acceptLight:!0,shininess:5,HAS_TEXTURE:U.HAS_TEXTURE}))}},s.pickRender=function(a){},i}(Render),ModelCache=function(){function n(i){_classCallCheck(this,n),this.N_=[],this.E_=6,this.N_=[],i&&i.E_&&(this.E_=i.E_)}var r=n.prototype;return r.M_=function(i){var s=this.N_.length;s>=this.E_&&this.N_.splice(0,1),this.N_.push({key:i,status:"loading"})},r.__=function(i,s){var a=this.y_(i);a.status="loaded",a.data=s},r.y_=function(i){for(var s=this.N_.length,a=0;a<s;a++){var o=this.N_[a];if(o.key===i)return o}return!1},n}(),GLTFLayer=function(n){_inherits(i,n);var r=_createSuper(i);function i(a){_classCallCheck(this,i);var o;return o=r.call(this,a),o.CLASS_NAME="GLTF",o.fusion=new GLTFFusion,o.ll=new GLTFRender,o.j_={},o.V_=[],o.R_={},o.S_={},o.acceptLight=!0,o.AC(a),o.x_=new ModelCache,o}var s=i.prototype;return s.setStyle=function(a){_get(_getPrototypeOf(i.prototype),"setStyle",this).call(this,a),this.dataset=this.source.LC(),this.dataset&&this.dataset.length>0&&this.meshes&&this.loca&&this.loca.requestRender()},s.buildStyle=function(a,o){for(var l=gltf.style,u=[],f=0;f<a.length;f++)if(!(!a[f].features||!a[f].features.points)){var c=a[f].features.points,h=StyleInstance.parse(c,o,l);u.push(h)}return u},s.receiveDataset=function(a){this.V_=[],this.R_={},this.dataset=a,this.setStyle(this.styleOptions),this.onAdd()},s.jC=function(){_get(_getPrototypeOf(i.prototype),"jC",this).call(this),!(!this.loca||!this.loca.regl||this.ll.regl)&&(this.ll.regl=this.loca.regl,this.loca.rendererManager.addRenderer(this.ll))},s.beforeRender=function(){if(_get(_getPrototypeOf(i.prototype),"beforeRender",this).call(this),!this.fusion.regl&&this.loca&&(this.fusion.regl=this.loca.regl,this.loca.fusionManager.addFusion(this.fusion)),this.jC(),this.source&&(this.dataset=this.source.LC()),this.fusion){var a=this.WC(),o=a.willFusion,l=a.didFusion,u=this.fusion.EC();if(this.styleOptions.unit==="px"?this.meshes=u||[]:this.meshes=l||[],o.length>0){var f=this.fusion.fusion(o,this.styleOptions,this);this.meshes=f}}},s.requestRender=function(){var a;this.vA.state|=MeshesDirty,(a=this.loca)==null||a.requestRender()},s.U_=function(a,o,l){var u=a.min,f=a.max,c=a.scale;c||(c=[1,1,1]);var h=[u[0]*c[0]+o[0],f[0]*c[0]+o[0]].sort(),p=[u[1]*c[1]+o[1],f[1]*c[1]+o[1]].sort(),d=[l[0][0],l[1][0]].sort(),v=[l[0][1],l[1][1]].sort();return h[0]>d[0]&&h[1]<d[1]&&p[0]>v[0]&&p[1]<v[1]},s.G_=function(){if(!this.loca)return{};for(var a=this.loca.map.getBounds(),o=this.loca.customCoords.lngLatToCoord(a.northEast.toArray()),l=this.loca.customCoords.lngLatToCoord(a.southWest.toArray()),u=Object.keys(this.R_),f=0;f<u.length;f++){for(var c=u[f],h=this.R_[c],p=h.position,d=h.sceneBBox,v=!1,g=0;g<p.length;g++){var m=this.U_(d,p[g],[o,l]);if(m){v=!0;break}}this.R_[c].isinmap=v}return this.R_},s.render=function(){var a,o;if(!!this.loca&&!!this.PA()){this.loca.regl._refresh();var l=(a=this.loca)==null?void 0:a.customCoords.getMVPMatrix(),u=RenderHelper.IA(this.loca.lights);if(this.ll&&this.V_&&this.V_.length>0)return this.ll.render({B_:this.R_,cameraPosition:(o=this.loca)==null?void 0:o.customCoords.getCameraParams().position,mvp:l,lights:u}),!0}},s.pickRender=function(){},s.afterRender=function(){},s.destroy=function(){_get(_getPrototypeOf(i.prototype),"destroy",this).call(this)},s.PA=function(){var a=this;this.R_=this.G_();var o=function(){var l=a.R_,u=a.vA;u.GLTF_PARAMS=[];for(var f=Object.keys(l),c=f.length,h=0;h<c;h++)for(var p=l[f[h]].F_,d=p.length,v=0;v<d;v++){var g=p[v],m=g.attributes,y=m.Iw,b=y.parseData,_=b.b_;u.GLTF_PARAMS.push(_)}};return RenderHelper.SA(this.ll,this,function(l){switch(l){case"onFirstRendering":case"meshes":o();break;case"light":RenderHelper.MA(a.vA,a.loca.lights);break}})},i}(Layer),__defProp$2=Object.defineProperty,__getOwnPropSymbols$2=Object.getOwnPropertySymbols,__hasOwnProp$2=Object.prototype.hasOwnProperty,__propIsEnum$2=Object.prototype.propertyIsEnumerable,__defNormalProp$2=function(n,r,i){return r in n?__defProp$2(n,r,{Fr:!0,Lr:!0,writable:!0,value:i}):n[r]=i},__spreadValues$2=function(n,r){for(var i in r||(r={}))__hasOwnProp$2.call(r,i)&&__defNormalProp$2(n,i,r[i]);var s=!0,a=!1,o=void 0;if(__getOwnPropSymbols$2)try{for(var l=__getOwnPropSymbols$2(r)[Symbol.iterator](),u;!(s=(u=l.next()).done);s=!0){var i=u.value;__propIsEnum$2.call(r,i)&&__defNormalProp$2(n,i,r[i])}}catch(f){a=!0,o=f}finally{try{!s&&l.return!=null&&l.return()}finally{if(a)throw o}}return n},pushArray$2=CommonUtil$1._C,LabelsFusion=function(n){_inherits(i,n);var r=_createSuper(i);function i(){return _classCallCheck(this,i),r.apply(this,arguments)}var s=i.prototype;return s.DC=function(){},s.buildStyle=function(a,o){for(var l,u=labels.style,f=[],c=0;c<a.length;c++)if(!(!a[c].features||!a[c].features.points)){for(var h=a[c].features.points,p=StyleInstance.parse(h,{label:o},u),d={},v=0;v<h.length;v++)if(p)for(var g in p.attributes){var m=p.attributes[g];d[g]||(d[g]=[]),((l=m[v])==null?void 0:l.length)>0?pushArray$2(d[g],m[v]):d[g][d[g].length]=m[v]}f.push({attributes:d,uniforms:p.uniforms,si:p.si})}return f},s.fusion=function(a,o,l){if(!l.loca)return[];for(var u=this.buildStyle(a,o),f=[],c=0,h=a.length;c<h;c++){var p=a[c];if(!(!p.features||!p.features.points)){for(var d=u[c].attributes,v=p.features.points,g={labels:[]},m=0;m<v.length;m++){var y=v[m],b=y.coordinates;if(y.type==="MultiPoint"){if(d.label[m])for(var _=0,C=b.length;_<C;_++){var A=b[_];g.labels.push(__spreadValues$2({position:A},d.label[m]))}}else d.label[m]&&g.labels.push(__spreadValues$2({position:b},d.label[m]))}f[c]={id:p.id,attributes:{},uniforms:{},si:{},mf:{labels:g.labels}}}}return f},s.updateStyle=function(a,o){for(var l=0,u=a.length;l<u;l++)for(var f=a[l],c=o[l].attributes,h=c.label,p=f.mf.labels,d=0;d<p.length;d++)p[d]=__spreadValues$2(__spreadValues$2({},p[d]),h[d])},s.destroy=function(){},s.EC=function(){return[]},i}(GeometryFusion),LabelsRender=function(n){_inherits(i,n);var r=_createSuper(i);function i(){_classCallCheck(this,i);var a;return a=r.call.apply(r,[this].concat(Array.prototype.slice.call(arguments))),a.v$=[new LabelsRender$1],a}var s=i.prototype;return s.m$=function(a){this.v$.forEach(function(o){return o.m$(a)})},s.render=function(a){for(var o=a.meshes,l=a.opacity,u=0;u<o.length;u++){var f=!0,c=!1,h=void 0;try{for(var p=this.v$[Symbol.iterator](),d;!(f=(d=p.next()).done);f=!0){var v=d.value;v.render(o[u],l)}}catch(g){c=!0,h=g}finally{try{!f&&p.return!=null&&p.return()}finally{if(c)throw h}}}},s.pickRender=function(a){},i}(Render),__defProp$1=Object.defineProperty,__defProps$1=Object.defineProperties,__getOwnPropDescs$1=Object.getOwnPropertyDescriptors,__getOwnPropSymbols$1=Object.getOwnPropertySymbols,__hasOwnProp$1=Object.prototype.hasOwnProperty,__propIsEnum$1=Object.prototype.propertyIsEnumerable,__defNormalProp$1=function(n,r,i){return r in n?__defProp$1(n,r,{Fr:!0,Lr:!0,writable:!0,value:i}):n[r]=i},__spreadValues$1=function(n,r){for(var i in r||(r={}))__hasOwnProp$1.call(r,i)&&__defNormalProp$1(n,i,r[i]);var s=!0,a=!1,o=void 0;if(__getOwnPropSymbols$1)try{for(var l=__getOwnPropSymbols$1(r)[Symbol.iterator](),u;!(s=(u=l.next()).done);s=!0){var i=u.value;__propIsEnum$1.call(r,i)&&__defNormalProp$1(n,i,r[i])}}catch(f){a=!0,o=f}finally{try{!s&&l.return!=null&&l.return()}finally{if(a)throw o}}return n},__spreadProps$1=function(n,r){return __defProps$1(n,__getOwnPropDescs$1(r))},LabelsLayer=function(n){_inherits(i,n);var r=_createSuper(i);function i(a){_classCallCheck(this,i);var o;o=r.call(this,__spreadProps$1(__spreadValues$1({},a),{labelsLayerOptions:a})),o.CLASS_NAME="Labels",o.fusion=new LabelsFusion,o.ll=new LabelsRender;var l=labels.Sw;return o.zooms=a.zooms===void 0?l.zooms:a.zooms,o.visible=a.visible===void 0?l.visible:a.visible,o.zIndex=a.zIndex===void 0?l.zIndex:a.zIndex,o.opacity=a.opacity===void 0?l.opacity:a.opacity,o.z$=a.z$===void 0?l.z$:a.z$,o.A$=a.A$===void 0?l.A$:a.A$,o.AC({}),o.buryPoint.record(o.CLASS_NAME),o}var s=i.prototype;return s.getLabelsLayer=function(){return this.ll.v$[0]._$||null},s.setStyle=function(a){if(_get(_getPrototypeOf(i.prototype),"setStyle",this).call(this,a),this.dataset=this.source.LC(),this.dataset&&this.dataset.length>0){var o=this.WC(),l=o.didFusion,u=this.fusion.buildStyle(this.dataset,this.styleOptions);this.fusion.updateStyle(l,u),this.vA.state|=MeshDirty}this.loca&&this.loca.requestRender()},s.getCollision=function(){return this.z$},s.setCollision=function(a){this.z$=a;var o=this.getLabelsLayer();o&&o.setCollision(a)},s.getAllowCollision=function(){return this.A$},s.setAllowCollision=function(a){this.A$=a;var o=this.getLabelsLayer();o&&o.setAllowCollision(a)},s.receiveDataset=function(a){this.dataset=a,this.setStyle(this.styleOptions),this.onAdd()},s.beforeRender=function(){if(_get(_getPrototypeOf(i.prototype),"beforeRender",this).call(this),this.loca&&this.loca.fusionManager.addFusion(this.fusion),this.source&&(this.dataset=this.source.LC()),this.fusion){var a=this.WC(),o=a.willFusion;if(o.length>0){var l=this.fusion.fusion(o,this.styleOptions,this);this.meshes=l,this.vA.state|=MeshesDirty}}},s.render=function(){var a;if(!!this.loca&&!!this.PA()){var o=(a=this.loca)==null?void 0:a.customCoords.getMVPMatrix();if(this.ll&&this.meshes.length>0)return this.ll.render({meshes:this.meshes,opacity:this._getOpacity(),mvp:o}),!0}},s.pickRender=function(){},s.afterRender=function(){},s.PA=function(){return RenderHelper.SA(this.ll,this)},i}(Layer),pushArray$1=CommonUtil$1._C,LaserFusion=function(n){_inherits(i,n);var r=_createSuper(i);function i(){return _classCallCheck(this,i),r.apply(this,arguments)}var s=i.prototype;return s.DC=function(){},s.buildStyle=function(a,o){for(var l=laser.style,u=[],f=0;f<a.length;f++)if(!(!a[f].features||!a[f].features.points)){var c=a[f].features.points,h=StyleInstance.parse(c,o,l);u.push(h)}return u},s.updateStyle=function(a,o,l,u){if(!l.loca)return[];var f=l.dataset;return this.fusion(f,o,l,u)},s.fusion=function(a,o,l,u){var f=this,c=function(v){var g=f,m=a[v];if(!m.features||!m.features.points||!u[v])return"continue";var y=m.features.points,b=u[v],_={vertex:[],color:[],pickColor:[],height:[],duration:[],interval:[],delay:[],dir:[],index:[]};y.forEach(function(C,A){var I=C.type,D=C.coordinates,X=l.colorPick.add(C);if(I==="MultiPoint"){var W=g;D.forEach(function(K){W.B$(h(K),_,{style:b,index:A,pickColor:X})})}else g.B$(h(D),_,{style:b,index:A,pickColor:X})}),p[v]={id:m.id,attributes:{position:{buffer:f.regl.buffer(_.vertex),offset:0,stride:4*3,td:!1,divisor:0},dir:{buffer:f.regl.buffer(_.dir),offset:0,stride:4*1,td:!1,divisor:0},color:{buffer:f.regl.buffer(_.color),offset:0,stride:4*4,td:!1,divisor:0},pickColor:{buffer:f.regl.buffer(_.pickColor),offset:0,stride:4*4,td:!1,divisor:0},height:{buffer:f.regl.buffer(_.height),offset:0,stride:4*1,td:!1,divisor:0},duration:{buffer:f.regl.buffer(_.duration),offset:0,stride:4*1,td:!1,divisor:0},interval:{buffer:f.regl.buffer(_.interval),offset:0,stride:4*1,td:!1,divisor:0},delay:{buffer:f.regl.buffer(_.delay),offset:0,stride:4*1,td:!1,divisor:0},index:f.regl.elements({primitive:"triangles",type:"uint32",data:_.index})},uniforms:b.uniforms,si:b.si}};if(!this.regl||!l.loca)return[];u=u||this.buildStyle(a,o);for(var h=l.loca.customCoords.lngLatToCoord.bind(l.loca.customCoords),p=[],d=0;d<a.length;d++)c(d);return p},s.EC=function(){return[]},s.destroy=function(){this.regl=null},s.B$=function(a,o,l){var u=l.style,f=u.attributes,c=l.index,h=l.pickColor,p=_slicedToArray(a,2),d=p[0],v=p[1],g=f.height,m=f.color,y=f.duration,b=f.interval,_=f.delay,C=g[c],A=this.nM([d,v,0],[d,v,C],{color:m[c],pickColor:h,height:C,duration:y[c],interval:b[c],delay:_[c]});GeoUtil.mergeTriangles(o,A,3),pushArray$1(o.dir,A.dir),pushArray$1(o.color,A.color),pushArray$1(o.pickColor,A.pickColor),pushArray$1(o.height,A.height),pushArray$1(o.duration,A.duration),pushArray$1(o.interval,A.interval),pushArray$1(o.delay,A.delay)},s.nM=function(a,o,l){var u=_toConsumableArray(o).concat(_toConsumableArray(a),_toConsumableArray(o),_toConsumableArray(a)),f=l.color,c=l.pickColor,h=l.height,p=l.duration,d=l.interval,v=l.delay;return{vertex:u,dir:[-1,-1,1,1],color:_toConsumableArray(f).concat(_toConsumableArray(f),_toConsumableArray(f),_toConsumableArray(f)),pickColor:_toConsumableArray(c).concat(_toConsumableArray(c),_toConsumableArray(c),_toConsumableArray(c)),height:[h,h,h,h],duration:[p,p,p,p],interval:[d,d,d,d],delay:[v,v,v,v],index:[1,0,2,2,3,1]}},i}(GeometryFusion),LaserShader={vertex:"\n        precision highp float;\n        attribute vec3 position;\n        attribute float dir;\n        attribute vec4 color;\n        attribute float height;\n        attribute float duration;\n        attribute float interval;\n        attribute float delay;\n        uniform float lineWidth;\n        uniform float angle;\n        uniform mat4 mvp;\n        uniform float unit;\n        uniform float resolution;\n        uniform vec3 cameraPosition;\n        varying float vRad;\n        varying vec4 vColor;\n        varying float vDistance;\n        varying float vTotalDistance;\n        varying float vDuration;\n        varying float vInterval;\n        varying float vDelay;\n        ".concat(ColorGLSL.getColorShader().vertex,"\n\n        void main() {\n          vRad = radians(angle);\n          float res = unit == 0.0 ? resolution : 1.0;\n          float halfWidth = (lineWidth / 2.0) * res;\n          vec3 pos = vec3(position.xy, position.z * res);\n          vec3 cameraNor = normalize(cross(cameraPosition - pos, vec3(0, 0, -1)));\n          // \u503E\u659C\n          if (pos.z > 0.0) {\n            pos += cameraNor * pos.z * tan(vRad);\n          }\n          // \u7EBF\u5BBD\n          pos += cameraNor * dir * halfWidth * cos(vRad) + vec3(0, 0, -dir * halfWidth * sin(vRad));\n          gl_Position = mvp * vec4(pos, 1.0);\n          vDistance = position.z / abs(cos(vRad));\n          vTotalDistance = height / abs(cos(vRad));\n          vColor = color;\n          vDuration = duration;\n          vInterval = interval;\n          vDelay = delay;\n          ").concat(ColorGLSL.getColorShader().mainVert,"\n        }\n    "),fragment:"\n        precision mediump float;\n        uniform float opacity;\n        uniform float time;\n        uniform float trailLength;\n        uniform float repeat;\n        uniform float fadeOpacity;\n        varying float vRad;\n        varying vec4 vColor;\n        varying float vDistance;\n        varying float vTotalDistance;\n        varying float vDuration;\n        varying float vInterval;\n        varying float vDelay;\n        float ratio;\n        float distance;\n        ".concat(ColorGLSL.getColorShader().fragment,"\n\n        void main(){\n          float now = time * 1000.0 - vDelay;\n          if(now < 0.0) {\n            discard;\n          }\n          float count = ceil(now / (vDuration + vInterval));\n          float timeOffset = mod(now, vDuration + vInterval);\n          float fade;\n          if (count > repeat) {\n            distance = vTotalDistance;\n          } else if (count == repeat) {\n            distance = vTotalDistance * min(timeOffset / vDuration, 1.0);\n          } else {\n            distance = (vTotalDistance + trailLength) * timeOffset / vDuration;\n          }\n          if (cos(vRad) < 0.0) { // \u5411\u4E0B\n            float remain = vTotalDistance - distance;\n            if(vDistance < remain || vDistance > remain + trailLength) {\n              discard;\n            }\n            ratio = (vDistance - remain) / trailLength;\n            // \u4ECE\u8D77\u70B9\u9732\u51FA\u65F6\u989C\u8272\u8870\u51CF\n            fade = min(distance / trailLength + fadeOpacity, 1.0);\n          } else {\n            if(vDistance > distance || vDistance < distance - trailLength) {\n              discard;\n            }\n            ratio = (distance - vDistance) / trailLength;\n            // \u63A5\u8FD1\u7EC8\u70B9\u6D88\u5931\u524D\u989C\u8272\u8870\u51CF\n            fade = count >= repeat ? 1.0 : min(max((vTotalDistance - distance) / trailLength, 0.0) + fadeOpacity, 1.0);\n          }\n          gl_FragColor = vColor;\n          gl_FragColor.a *= opacity * fade * (1.0 - ratio);\n          ").concat(ColorGLSL.getColorShader().mainFrag,"\n        }\n    ")},__defProp=Object.defineProperty,__defProps=Object.defineProperties,__getOwnPropDescs=Object.getOwnPropertyDescriptors,__getOwnPropSymbols=Object.getOwnPropertySymbols,__hasOwnProp=Object.prototype.hasOwnProperty,__propIsEnum=Object.prototype.propertyIsEnumerable,__defNormalProp=function(n,r,i){return r in n?__defProp(n,r,{Fr:!0,Lr:!0,writable:!0,value:i}):n[r]=i},__spreadValues=function(n,r){for(var i in r||(r={}))__hasOwnProp.call(r,i)&&__defNormalProp(n,i,r[i]);var s=!0,a=!1,o=void 0;if(__getOwnPropSymbols)try{for(var l=__getOwnPropSymbols(r)[Symbol.iterator](),u;!(s=(u=l.next()).done);s=!0){var i=u.value;__propIsEnum.call(r,i)&&__defNormalProp(n,i,r[i])}}catch(f){a=!0,o=f}finally{try{!s&&l.return!=null&&l.return()}finally{if(a)throw o}}return n},__spreadProps=function(n,r){return __defProps(n,__getOwnPropDescs(r))},LaserRender=function(n){_inherits(i,n);var r=_createSuper(i);function i(){return _classCallCheck(this,i),r.apply(this,arguments)}var s=i.prototype;return s.m$=function(a){if(!this.regl)return!1;var o=this.regl;this.gA(LaserShader,a,{frag:LaserShader.fragment,vert:LaserShader.vertex,attributes:__spreadValues({position:o.prop("position"),color:o.prop("color"),height:o.prop("height"),duration:o.prop("duration"),interval:o.prop("interval"),delay:o.prop("delay"),dir:o.prop("dir")},ColorGLSL.getColor(o).attribute),uniforms:__spreadValues({mvp:o.prop("mvp"),opacity:o.prop("opacity"),resolution:o.prop("resolution"),angle:o.prop("angle"),trailLength:o.prop("trailLength"),lineWidth:o.prop("lineWidth"),repeat:o.prop("repeat"),fadeOpacity:o.prop("fadeOpacity"),unit:o.prop("unit"),time:o.prop("time"),cameraPosition:o.prop("cameraPosition")},ColorGLSL.getColor(o).uniform),depth:{enable:o.prop("depth")},blend:{enable:!0,func:RenderUtil.getBlend(),equation:{rgb:"add",alpha:"add"}},primitive:"triangles",elements:o.prop("index")})},s.render=function(a){var o=this.yA(LaserShader);if(o)for(var l=a.meshes,u=a.mvp,f=a.animateCounter,c=a.cameraPosition,h=a.opacity,p=a.resolution,d=a.depth,v=0;v<l.length;v++){var g=l[v],m=g.attributes,y=g.uniforms,b=y.unit,_=y.trailLength,C=y.lineWidth,A=y.repeat,I=y.angle,D=y.fadeOpacity,X=60,W=f/X;o(__spreadProps(__spreadValues({},m),{mvp:u,unit:b==="px"?0:1,resolution:p,cameraPosition:c,opacity:h,time:W,trailLength:_,lineWidth:C,angle:I,depth:d,repeat:A,fadeOpacity:D,isPick:!1}))}},s.pickRender=function(a){var o=this.yA(LaserShader);if(o){var l=a.meshes,u=a.animateCounter,f=a.mvp,c=a.opacity,h=a.pickFbo,p=a.pickPos,d=a.resolution,v=a.cameraPosition,g=a.depth;if(h&&p){var m=this;h.use(function(){m.regl.clear({color:[0,0,0,0],depth:1});for(var y=0;y<l.length;y++){var b=l[y],_=b.attributes,C=b.uniforms,A=C.unit,I=C.trailLength,D=C.lineWidth,X=C.repeat,W=C.angle,K=C.fadeOpacity,U=60,M=u/U;o(__spreadProps(__spreadValues({},_),{mvp:f,time:M,unit:A==="px"?0:1,resolution:d,cameraPosition:v,opacity:c,trailLength:I,lineWidth:D,angle:W,depth:g,repeat:X,fadeOpacity:K,isPick:!0}))}})}}},i}(Render),pushArray=CommonUtil$1._C,LaserLayer=function(n){_inherits(i,n);var r=_createSuper(i);function i(a){_classCallCheck(this,i);var o;o=r.call(this,a),o.CLASS_NAME="Laser",o.fusion=new LaserFusion,o.ll=new LaserRender,o.depth=!0;var l=laser.Sw;return o.zooms=a.zooms===void 0?l.zooms:a.zooms,o.visible=a.visible===void 0?l.visible:a.visible,o.zIndex=a.zIndex===void 0?l.zIndex:a.zIndex,o.opacity=a.opacity===void 0?l.opacity:a.opacity,o.depth=a.depth===void 0?l.depth:a.depth,o.AC({zooms:o.zooms,visible:o.visible,zIndex:o.zIndex}),o.buryPoint.record(o.CLASS_NAME),o}var s=i.prototype;return s.receiveDataset=function(a){this.dataset=a,this.setStyle(this.styleOptions),this.onAdd()},s.setStyle=function(a){if(_get(_getPrototypeOf(i.prototype),"setStyle",this).call(this,a),this.dataset=this.source.LC(),this.dataset&&this.dataset.length>0){var o=this.WC(),l=o.didFusion,u=this.fusion.buildStyle(this.dataset,this.styleOptions),f=this.fusion.updateStyle(l,this.styleOptions,this,u);this.meshes=f,this.loca&&this.loca.requestRender()}},s.jC=function(){_get(_getPrototypeOf(i.prototype),"jC",this).call(this),!(!this.loca||!this.loca.regl||this.ll.regl)&&(this.ll.regl=this.loca.regl,this.loca.rendererManager.addRenderer(this.ll))},s.beforeRender=function(){if(_get(_getPrototypeOf(i.prototype),"beforeRender",this).call(this),!this.fusion.regl&&this.loca&&(this.fusion.regl=this.loca.regl,this.loca.fusionManager.addFusion(this.fusion)),this.jC(),this.source&&(this.dataset=this.source.LC()),this.fusion){var a=this.WC(),o=a.willFusion,l=a.didFusion;if(this.fusion.EC(),o.length>0){var u=this.fusion.fusion(o,this.styleOptions,this);this.meshes=pushArray(l,u)}}},s.render=function(){var a,o;if(!!this.loca&&!!this.PA()){this.loca.regl._refresh();var l=(a=this.loca)==null?void 0:a.customCoords.getMVPMatrix(),u=this.projection.getResolution((o=this.loca)==null?void 0:o.map.getZoom()),f=this.loca.customCoords.getCameraParams().position;if(this.ll&&this.meshes.length){var c=this.hP();return this.ll.render({meshes:this.meshes,mvp:l,depth:this.depth,resolution:u,opacity:this._getOpacity(),animateCounter:c,cameraPosition:f}),!0}}},s.pickRender=function(){var a,o;if(!!this.loca&&!!this.PA()){this.loca.regl._refresh();var l=(a=this.loca)==null?void 0:a.customCoords.getMVPMatrix(),u=this.projection.getResolution((o=this.loca)==null?void 0:o.map.getZoom()),f=this.loca.customCoords.getCameraParams().position;if(this.ll&&this.meshes.length>0){var c=this.hP();this.ll.pickRender({meshes:this.meshes,mvp:l,depth:this.depth,resolution:u,opacity:this._getOpacity(),animateCounter:c,pickFbo:this._needPickFrame&&this._pickFbo,pickPos:this._pickPos,cameraPosition:f})}}},s.afterRender=function(){},s.PA=function(){return RenderHelper.SA(this.ll,this)},i}(Layer),version="2.0.0";Object.defineProperty(exports,"Bezier",{Fr:!0,get:function n(){return bezierJs.Bezier}}),exports.AmbientLight=AmbientLight,exports.Animation=Animation$1,exports.$$=AttributesDirty,exports.Clip=Clip,exports.ColorGLSL=ColorGLSL,exports.Df=ColorPick,exports.VC=ColorUtil$1,exports.CommonUtil=CommonUtil$1,exports.Container=Loca,exports.Ef=Context,exports.Dat=Dat,exports.Vf=DataSource,exports.tL=DefaultLight,exports.wA=Defines,exports.DirectionalLight=DirectionalLight,exports.IC=DomUtil,exports.Rf=Earth,exports.Event=Event,exports.H_=GLTFLayer,exports.GeoBufferSource=GeoBufferSource,exports.GeoJSONSource=GeoJSONSource,exports.lL=GeoUtil,exports.TC=GeometryFusion,exports.GeometryUtil=GeometryUtil,exports.GltfLayer=GLTFLayer,exports.GridLayer=GridLayer,exports.HeatMapLayer=HeatMapLayer,exports.HexagonLayer=HexagonLayer,exports.IconLayer=IconLayer,exports.w$=LabelsDirty,exports.LabelsLayer=LabelsLayer,exports.iL=LagacyLight,exports.S$=LangUtil,exports.LaserLayer=LaserLayer,exports.Layer=Layer,exports.Legend=Legend,exports.Light=Light,exports.xA=LightDirty,exports.kA=LightGLSL,exports.LineLayer=LineLayer,exports.LinkLayer=LinkLayer,exports.Map=Map$1,exports.OC=MathUtil,exports.Ff=Mercator,exports.L$=MeshDirty,exports.C$=MeshesDirty,exports.eL=NewLight,exports.CA=NotDirty,exports.PointLayer=PointLayer,exports.PointLight=PointLight,exports.PolygonLayer=PolygonLayer,exports.PrismLayer=PrismLayer,exports.UC=Project,exports.aL=ProjectInstance,exports.Lf=Projection,exports.PulseLineLayer=PulseLineLayer,exports.PulseLinkLayer=PulseLinkLayer,exports.AA=Render,exports.RenderUtil=RenderUtil,exports.ScatterLayer=Scatter,exports.OA=Shader,exports.FC=Style,exports.RC=StyleInstance,exports.M$=SubRender,exports.ViewControl=ViewControl$1,exports.ZMarkerLayer=ZMarkerLayer,exports.buryPoint=buryPoint,exports.version=version,Object.defineProperty(exports,"i",{value:!0})})})(lbsLocaLayers_umd_tmp$1,lbsLocaLayers_umd_tmp$1.exports);var lbsLocaLayers_umd_tmp=lbsLocaLayers_umd_tmp$1.exports;return lbsLocaLayers_umd_tmp});